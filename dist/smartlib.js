!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("smartlib.browser",[],t):"object"==typeof exports?exports["smartlib.browser"]=t():e["smartlib.browser"]=t()}("undefined"!=typeof self?self:global,(function(){return function(){var __webpack_modules__={665:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";function nativeRequire(lib){return eval("require")(lib)}function nativeMainRequire(lib){return eval("require").main.require(lib)}__webpack_require__.d(__webpack_exports__,{A:function(){return nativeRequire},W:function(){return nativeMainRequire}})},831:function(e,t){!function(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&apos;":"'","&quot;":'"'};function i(e){return e&&e.replace(/^\s+|\s+$/g,"")}function n(e){return e.replace(/(&(?:lt|gt|amp|apos|quot|#(?:\d{1,6}|x[0-9a-fA-F]{1,5}));)/g,(function(e){if("#"===e[1]){var i="x"===e[2]?parseInt(e.substr(3),16):parseInt(e.substr(2),10);if(i>-1)return String.fromCharCode(i)}return t[e]||e}))}function r(e,t){if("string"==typeof e)return e;var s=e.r;if(s)return s;var o,u=function(e,t){if(e.t){for(var r,s,o=e.t.split(/([^\s='"]+(?:\s*=\s*(?:'[\S\s]*?'|"[\S\s]*?"|[^\s'"]*))?)/),u=o.length,l=0;l<u;l++){var d=i(o[l]);if(d){r||(r={});var c=d.indexOf("=");if(c<0)d="@"+d,s=null;else{s=d.substr(c+1).replace(/^\s+/,""),d="@"+d.substr(0,c).replace(/\s+$/,"");var h=s[0];h!==s[s.length-1]||"'"!==h&&'"'!==h||(s=s.substr(1,s.length-2)),s=n(s)}t&&(s=t(d,s)),a(r,d,s)}}return r}}(e,t),l=e.f,d=l.length;if(u||d>1)o=u||{},l.forEach((function(e){"string"==typeof e?a(o,"#",e):a(o,e.n,r(e,t))}));else if(d){var c=l[0];if(o=r(c,t),c.n){var h={};h[c.n]=o,o=h}}else o=e.c?null:"";return t&&(o=t(e.n||"",o)),o}function a(e,t,i){if(void 0!==i){var n=e[t];n instanceof Array?n.push(i):e[t]=t in e?[n,i]:i}}e.fromXML=function(e,t){return r(function(e){for(var t=String.prototype.split.call(e,/<([^!<>?](?:'[\S\s]*?'|"[\S\s]*?"|[^'"<>])*|!(?:--[\S\s]*?--|\[[^\[\]'"<>]+\[[\S\s]*?]]|DOCTYPE[^\[<>]*?\[[\S\s]*?]|(?:ENTITY[^"<>]*?"[\S\s]*?")?[\S\s]*?)|\?[\S\s]*?\?)>/),r=t.length,a={f:[]},s=a,o=[],u=0;u<r;){var l=t[u++];l&&f(l);var d=t[u++];d&&c(d)}return a;function c(e){var t=e.length,i=e[0];if("/"===i)for(var n=e.replace(/^\/|[\s\/].*$/g,"").toLowerCase();o.length;){var r=s.n&&s.n.toLowerCase();if(s=o.pop(),r===n)break}else if("?"===i)h({n:"?",r:e.substr(1,t-2)});else if("!"===i)"[CDATA["===e.substr(1,7)&&"]]"===e.substr(-2)?f(e.substr(8,t-10)):h({n:"!",r:e.substr(1)});else{var a=function(e){var t={f:[]},i=(e=e.replace(/\s*\/?$/,"")).search(/[\s='"\/]/);i<0?t.n=e:(t.n=e.substr(0,i),t.t=e.substr(i));return t}(e);h(a),"/"===e[t-1]?a.c=1:(o.push(s),s=a)}}function h(e){s.f.push(e)}function f(e){(e=i(e))&&h(n(e))}}(e),t)}}(t||{})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](i,i.exports,__webpack_require__),i.exports}__webpack_require__.d=function(e,t){for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return function(){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AdInteractionType:function(){return Gi},AdManager:function(){return ne},AnalyticsRequestManager:function(){return or},GenericPlayerAdapter:function(){return Rn},GenericPlayerApi:function(){return $n},LoggerManager:function(){return P},Metrics:function(){return pr},MetricsManager:function(){return br},PlayerAdapter:function(){return vn},PlayerEventListener:function(){return Ln},PlayerManager:function(){return zn},RequestManager:function(){return me},SessionTrackerEvent:function(){return Cr},SessionTrackerEvents:function(){return _r},SessionTrackerTimeline:function(){return qr},SmartLib:function(){return Jt},StreamingSession:function(){return St},StreamingSessionOptions:function(){return ze},StreamingSessionResult:function(){return pt},adSmartLibModule:function(){return t},analyticsSmartLibModule:function(){return e},avplaySmartLibModule:function(){return r},bitmovinSmartLibModule:function(){return v},connectplayerSmartLibModule:function(){return a},dashjsSmartLibModule:function(){return s},diversitySmartLibModule:function(){return n},diw387SmartLibModule:function(){return d},hbbtv1SmartLibModule:function(){return o},hlsjsSmartLibModule:function(){return f},html5SmartLibModule:function(){return u},kalturaSmartLibModule:function(){return l},nanocdnSmartLibModule:function(){return i},rxplayerSmartLibModule:function(){return h},shakaSmartLibModule:function(){return c}});var e={};__webpack_require__.r(e),__webpack_require__.d(e,{AnalyticsRequestManager:function(){return or},GenericPlayerAdapter:function(){return Rn},GenericPlayerApi:function(){return $n},Metrics:function(){return pr},MetricsManager:function(){return br},PlayerAdapter:function(){return vn},PlayerEventListener:function(){return Ln},PlayerManager:function(){return zn},SessionTrackerEvent:function(){return Cr},SessionTrackerEvents:function(){return _r},SessionTrackerTimeline:function(){return qr}});var t={};__webpack_require__.r(t),__webpack_require__.d(t,{AdBeginProgressTracker:function(){return Ua},AdBreakBeginTracker:function(){return Ca},AdBreakDataTracker:function(){return La},AdBreakEndTracker:function(){return Ia},AdDashEvent:function(){return Xa},AdDataTracker:function(){return Ma},AdEvent:function(){return Ja},AdEventFactory:function(){return $a},AdFriendlyObstructionPurpose:function(){return te},AdJSONEvent:function(){return Za},AdManager:function(){return ne},AdMetrics:function(){return ia},AdMetricsBuilder:function(){return na},AdMetricsManager:function(){return os},AdProgressTracker:function(){return Ba},AdSession:function(){return oe},AdSkippableTracker:function(){return ja},AdSmartLibLegacyTracker:function(){return pa},AdSmartLibTracker:function(){return Oa},AdThirdPartyTracker:function(){return wa},AdTracker:function(){return Ta},AdTrackerFactory:function(){return Fa},AdTrackingManager:function(){return ns},AdViewState:function(){return ee},InternalAdManager:function(){return ce},OMSDKManager:function(){return ys},OMSessionHandler:function(){return _s}});var i={};__webpack_require__.r(i),__webpack_require__.d(i,{HostResolvingTask:function(){return Vs},MdnsManager:function(){return so},NanoCDNDescr:function(){return Bs},NanoCDNHostManager:function(){return vo},NanoCDNRequestManager:function(){return Os},NanoCDNService:function(){return Gs}});var n={};__webpack_require__.r(n),__webpack_require__.d(n,{DiversityFailoverCache:function(){return ko},DiversityFailoverSession:function(){return go},DiversityManager:function(){return Go},DiversityRequestManager:function(){return Jo}});var r={};__webpack_require__.r(r),__webpack_require__.d(r,{AVPlayAdapter:function(){return gu}});var a={};__webpack_require__.r(a),__webpack_require__.d(a,{ConnectPlayerAdapter:function(){return Mu}});var s={};__webpack_require__.r(s),__webpack_require__.d(s,{DashJsPlayerAdapter:function(){return Zu}});var o={};__webpack_require__.r(o),__webpack_require__.d(o,{HbbTV1PlayerAdapter:function(){return vl}});var u={};__webpack_require__.r(u),__webpack_require__.d(u,{HTML5PlayerAdapter:function(){return wl}});var l={};__webpack_require__.r(l),__webpack_require__.d(l,{KalturaPlayerAdapter:function(){return xl}});var d={};__webpack_require__.r(d),__webpack_require__.d(d,{SagemcomDIW387Adapter:function(){return nd}});var c={};__webpack_require__.r(c),__webpack_require__.d(c,{ShakaPlayerAdapter:function(){return bd}});var h={};__webpack_require__.r(h),__webpack_require__.d(h,{RxPlayerAdapter:function(){return Bd}});var f={};__webpack_require__.r(f),__webpack_require__.d(f,{HlsJsPlayerAdapter:function(){return Qd}});var v={};function p(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,g(e,t,"get"))}function y(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,g(e,t,"set"),i),i}function g(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function E(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k(e,t,i){return t&&b(e.prototype,t),i&&b(e,i),e}__webpack_require__.r(v),__webpack_require__.d(v,{BitmovinPlayerAdapter:function(){return sc}});var m=function(){function e(){S(this,e)}return k(e,null,[{key:"log",value:function(e,t,i){}}]),e}(),_=function e(){S(this,e)};E(_,"VERBOSE",0),E(_,"DEBUG",1),E(_,"INFO",2),E(_,"WARN",3),E(_,"ERROR",4);var A=function e(){S(this,e)};E(A,"NONE",-1),E(A,"BASIC",0),E(A,"VERBOSE",1);var N=new WeakMap,R=new WeakMap,D=new WeakMap,P=function(){function e(){S(this,e),N.set(this,{writable:!0,value:m}),R.set(this,{writable:!0,value:void 0}),D.set(this,{writable:!0,value:void 0}),y(this,R,[]),y(this,D,A.VERBOSE)}return k(e,[{key:"init",value:function(e){y(this,N,e)}},{key:"release",value:function(){y(this,N,void 0)}},{key:"printLogs",value:function(e,t,i,n){p(this,R).length>100&&y(this,R,[]),void 0!==n&&(i="["+n+"] "+i),p(this,R).push(t+": "+i),p(this,N).log(e,t,i,n)}},{key:"printVerboseLogs",value:function(e,t,i){p(this,D)<A.VERBOSE||this.printLogs(_.VERBOSE,e,t,i)}},{key:"printDebugLogs",value:function(e,t,i){p(this,D)<A.VERBOSE||this.printLogs(_.DEBUG,e,t,i)}},{key:"printInfoLogs",value:function(e,t,i){p(this,D)<=A.NONE||this.printLogs(_.INFO,e,t,i)}},{key:"printWarnLogs",value:function(e,t,i){p(this,D)<=A.NONE||this.printLogs(_.WARN,e,t,i)}},{key:"printErrorLogs",value:function(e,t,i){p(this,D)<=A.NONE||this.printLogs(_.ERROR,e,t,i)}},{key:"getLogs",value:function(){return p(this,R).join("\n")}},{key:"resetLogs",value:function(){y(this,R,[])}},{key:"getLogLevel",value:function(e){return p(this,D)}},{key:"setLogLevel",value:function(e){y(this,D,e)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}},{key:"v",value:function(t,i,n){e.getInstance().printVerboseLogs(t,i,n)}},{key:"d",value:function(t,i,n){e.getInstance().printDebugLogs(t,i,n)}},{key:"i",value:function(t,i,n){e.getInstance().printInfoLogs(t,i,n)}},{key:"w",value:function(t,i,n){e.getInstance().printWarnLogs(t,i,n)}},{key:"e",value:function(t,i,n){e.getInstance().printErrorLogs(t,i,n)}}]),e}();function T(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function w(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}E(P,"instance",void 0);var O=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"parseURL",value:function(e){if(null===e||""===e)return null;var t=e.match("^(https?)\\:\\/\\/(([^:\\/?#]*)(?:\\:([0-9]+))?)([\\/]{0,1}[^?#]*)(\\?[^#]*|)(#.*|)$"),i=t&&{href:e,protocol:t[1],host:t[2],hostname:t[3],port:t[4],path:t[5],query:t[6],hash:t[7]};return null!==i&&null!==i.query&&i.query.length>0&&(i.query=i.query.substring(1)),i}},{key:"getParam",value:function(e,t){if("string"!=typeof e)return"";t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i&&i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):""}},{key:"addOrReplaceParam",value:function(e,t,i){var n=e.indexOf("?"+t+"=");if(n<0&&(n=e.indexOf("&"+t+"=")),n>=0){var r=e.substring(0,e.indexOf(t)),a=e.substring(e.indexOf(t));return r+t+"="+i+(a=a.indexOf("&")>=0?a.substring(a.indexOf("&")):"")}return(e.indexOf("?")<0?e+"?":e+"&")+t+"="+i}},{key:"extractHostnamePort",value:function(e){return null===e||""===e?"":(e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0]).split("?")[0]}}],(i=null)&&T(t.prototype,i),n&&T(t,n),e}();w(O,"REGEX_IP","^(?:[0-9]{1,3}\\.){3}[0-9]{1,3}(:[0-9]+)?$"),w(O,"REGEX_HOSTNAME","^([A-Za-z0-9\\_\\-\\.]+)(:[0-9]+)?$"),w(O,"REGEX_TICKET","^[0-5a-z]{30,50}$"),w(O,"REGEX_TICKET_TRANSCODED","^.*@[0-5a-z]{30,50}$");var L="03.03.04.3756";function C(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var I=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"randomIntFromInterval",value:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}},{key:"bufferToBase64Lookup",value:function(e){return e<26?String.fromCharCode(e+"A".charCodeAt(0)):e<52?String.fromCharCode(e-26+"a".charCodeAt(0)):e<62?String.fromCharCode(e-52+"0".charCodeAt(0)):62===e?"-":63===e?"_":""}},{key:"bufferToBase64",value:function(t){var i,n=t.data(),r=t.length(),a="";for(i=0;i<r;i+=3){var s=[void 0,void 0,void 0,void 0];s[0]=n[i]>>2,s[1]=(3&n[i])<<4,r>i+1&&(s[1]|=n[i+1]>>4,s[2]=(15&n[i+1])<<2),r>i+2&&(s[2]|=n[i+2]>>6,s[3]=63&n[i+2]);for(var o=0;o<s.length;o++)void 0===s[o]||(a+=e.bufferToBase64Lookup(s[o]))}return a}},{key:"stringToBase64Lookup",value:function(e){return e<26?String.fromCharCode(e+"A".charCodeAt(0)):e<52?String.fromCharCode(e-26+"a".charCodeAt(0)):e<62?String.fromCharCode(e-52+"0".charCodeAt(0)):62===e?"+":63===e?"/":""}},{key:"stringToBase64",value:function(t){var i;for(t=String(t),i=0;i<t.length;i++)if(t.charCodeAt(i)>255)return null;var n="";for(i=0;i<t.length;i+=3){var r=[void 0,void 0,void 0,void 0];r[0]=t.charCodeAt(i)>>2,r[1]=(3&t.charCodeAt(i))<<4,t.length>i+1&&(r[1]|=t.charCodeAt(i+1)>>4,r[2]=(15&t.charCodeAt(i+1))<<2),t.length>i+2&&(r[2]|=t.charCodeAt(i+2)>>6,r[3]=63&t.charCodeAt(i+2));for(var a=0;a<r.length;a++)void 0===r[a]?n+="=":n+=e.stringToBase64Lookup(r[a])}return n}},{key:"floor",value:function(e){return e>>>0}},{key:"bufferToString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,i="[0x",n=0;n<t;n++){var r=e[n];i+=("00"+Number(r).toString(16)).slice(-2),n<t-1&&(i+=",0x")}return i+="] (capacity:"+e.length+")"}}],(i=null)&&C(t.prototype,i),n&&C(t,n),e}();function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function U(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function j(e,t,i,n){return x(e,t),V(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n),n}function F(e,t,i){return x(e,t),V(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}function V(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function x(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}var G="BpkJobMgr",H=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),U(this,"worker",void 0),U(this,"jobs",void 0),this.jobs={}}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){return F(e,e,W)||j(e,e,W,new e),F(e,e,W)}}],(i=[{key:"async",value:function(e,t,i,n){return this.start(e,0,-1,t,i,n)}},{key:"asyncGet",value:function(e,t,i,n){return this.start("get",0,-1,(function(){me.getInstance().requestHandler.get(e,t,i,n)}),(function(){return{url:e,headers:t,timeout:i}}),n)}},{key:"asyncPost",value:function(e,t,i,n,r){return this.start("post",0,-1,(function(){me.getInstance().requestHandler.post(e,t,i,n,r)}),(function(){return{url:e,headers:t,body:i,timeout:n}}),r)}},{key:"asyncDelay",value:function(e,t){var i,n=this.start("delay",e,-1,(function(t){i=setTimeout(t,e)}),void 0,t);return n.task=i,n}},{key:"asyncNonce",value:function(e,t,i){var n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;void 0===r&&(r=function(){P.d(G,"ios async nonce"),n=setTimeout(i,e)});var a=this.start("waitNonce",0,e,r,void 0,t,i,!0);return a.task=n,a}},{key:"waitNonce",value:function(e,t,i){var n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;void 0===r&&(r=function(){P.d(G,"ios wait nonce"),n=setTimeout(i,e)});var a=this.start("waitNonce",0,e,r,void 0,t,i,!1);return a.task=n,a}},{key:"start",value:function(e,t,i,n,r,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:function(){},o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(void 0===this.worker&&("function"==typeof CoreWorker?this.worker=new CoreWorker:"object"===("undefined"==typeof CoreWorker?"undefined":M(CoreWorker))&&(this.worker=CoreWorker)),void 0!==this.worker){var u=this.createJob();return u.active=!0,u.command=e,u.startDelay=t,u.timeoutDelay=i,u.requestInfo=r,u.result=a,u.timeout=s,u.async=o,P.v(G,'Starting job "'+e+'"...'),o?this.worker.async(u.id,u.command,u.startDelay,u.timeoutDelay):this.worker.sync(u.id,u.command,u.startDelay,u.timeoutDelay),u}return n(a),{command:e}}},{key:"interrupt",value:function(e){void 0!==e&&void 0!==this.worker&&(P.v(G,'Interrupting job "'+e.command+'"...'),this.worker.interrupt(e.id))}},{key:"cancel",value:function(e){void 0!==e&&(void 0!==this.worker&&(P.v(G,'Cancelling job "'+e.command+'"...'),e.active=!1,this.worker.cancel(e.id),delete this.jobs[e.id]),void 0!==e.task&&clearTimeout(e.task))}},{key:"requestInfo",value:function(e){var t=this.jobs[e];return void 0!==t&&"function"==typeof t.requestInfo?t.requestInfo():{}}},{key:"result",value:function(e,t){var i=this.jobs[e];void 0!==i&&"function"==typeof i.result&&!0===i.active&&(i.active=!1,i.result(t)),delete this.jobs[e]}},{key:"timeout",value:function(e){var t=this.jobs[e];void 0!==t&&"function"==typeof t.timeout&&!0===t.active&&(P.v(G,'Job "'+t.command+'" timeout...'),t.active=!1,t.timeout()),delete this.jobs[e]}},{key:"createJob",value:function(){for(var e=I.randomIntFromInterval(1e6,9999999);void 0!==this.jobs[e];)e=I.randomIntFromInterval(1e6,9999999);return this.jobs[e]={id:e},this.jobs[e]}}])&&B(t.prototype,i),n&&B(t,n),e}(),W={writable:!0,value:void 0};function q(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Y(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var K="BpkAdPalSessionRequest",Q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Y(this,"active",void 0),Y(this,"timeout",void 0),Y(this,"adPalManager",void 0),Y(this,"adPalSession",void 0),Y(this,"generatingAdPalSession",void 0),Y(this,"waitNonceResolveCallback",void 0),this.active=!0,this.timeout=!1,this.adPalManager=t,this.generatingAdPalSession=!1}var t,i,n;return t=e,(i=[{key:"setAdPalSession",value:function(e){this.adPalSession=e,this.active=!1}},{key:"generateAdPalSession",value:function(){var t=this,i=function(){P.d(K,"Nonce generation timeout"),t.timeout=!0,void 0!==t.waitNonceResolveCallback&&(t.setAdPalSession(void 0),t.waitNonceResolveCallback(void 0))};H.getInstance().asyncNonce(e.TIMEOUT_DELAY,(function(e){var i=e.adPalSession;P.d(K,"AdPalSession async nonce="+(null==i?void 0:i.getNonce())),t.setAdPalSession(i)}),i,(function(){t.generatingAdPalSession=!0;var n=setTimeout(i,e.TIMEOUT_DELAY);t.adPalManager.generateAdPalSession((function(e){clearTimeout(n),P.d(K,"AdPalSession nonce="+(null==e?void 0:e.getNonce())),t.setAdPalSession(e),void 0!==t.waitNonceResolveCallback&&!1===t.timeout?t.waitNonceResolveCallback(e):void 0!==t.waitNonceResolveCallback&&!0===t.timeout&&t.waitNonceResolveCallback(void 0)}))}))}},{key:"getAdPalSession",value:function(){var t=this;return void 0===this.adPalSession&&!0===this.active?new Promise((function(i,n){H.getInstance().waitNonce(e.TIMEOUT_DELAY,(function(e){var n=e.adPalSession;P.d(K,"AdPalSession nonce="+(null==n?void 0:n.getNonce())),t.setAdPalSession(n),i(t.adPalSession)}),(function(){t.active=!1,t.timeout=!0,t.waitNonceResolveCallback=void 0,i(t.adPalSession)}),(function(){!0===t.generatingAdPalSession?t.waitNonceResolveCallback=i:(t.waitNonceResolveCallback=i,t.generateAdPalSession())}))})):new Promise((function(e,i){e(t.adPalSession)}))}}])&&q(t.prototype,i),n&&q(t,n),e}();function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Z(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $(e,t,i){return t&&Z(e.prototype,t),i&&Z(e,i),e}Y(Q,"TIMEOUT_DELAY",5e3);var ee=function(){function e(){X(this,e)}return $(e,null,[{key:"isAdViewState",value:function(t){switch(t){case e.MINIMIZED:case e.COLLAPSED:case e.NORMAL:case e.EXPANDED:case e.FULLSCREEN:return!0}return!1}}]),e}();J(ee,"MINIMIZED","minimized"),J(ee,"COLLAPSED","collapsed"),J(ee,"NORMAL","normal"),J(ee,"EXPANDED","expanded"),J(ee,"FULLSCREEN","fullscreen");var te=function(){function e(){X(this,e)}return $(e,null,[{key:"isAdFriendlyObstructionPurpose",value:function(e){return e>=0&&e<=3}}]),e}();J(te,"VIDEO_CONTROLS",0),J(te,"CLOSE_AD",1),J(te,"NOT_VISIBLE",2),J(te,"OTHER",3);var ie="BpkAdMgr",ne=function(){function e(){X(this,e),J(this,"smartLib",void 0),J(this,"palSDK",void 0),"undefined"==typeof goog||z(goog)}return $(e,[{key:"init",value:function(e){this.smartLib=e}},{key:"release",value:function(){}},{key:"attachPALSDK",value:function(e){"object"===z(e.pal)?(P.d(ie,"PAL SDK attached"),this.palSDK=e):P.e(ie,"Try to attach PAL SDK, but it is not recognized")}},{key:"setConsentSettings",value:function(e){this.smartLib.internalAdManager.setConsentSettings(e)}},{key:"setPalParameters",value:function(e,t,i,n,r,a,s,o,u,l,d){this.smartLib.internalAdManager.setPalParameters(e,t,i,n,r,a,s,o,u,l,d)}},{key:"setPartner",value:function(e,t){this.smartLib.internalAdManager.setPartner(e,t)}},{key:"activateAdvertising",value:function(){this.smartLib.internalAdManager.adSession.activateAdvertising()}},{key:"setAdParameter",value:function(e,t){this.smartLib.internalAdManager.adSession.setAdParameter(e,t)}},{key:"setEventCallbackEnabled",value:function(e){this.smartLib.internalAdManager.eventCallbackEnabled=e,this.smartLib.internalAdManager.adSession.setEventCallbackEnabled(e)}},{key:"setAdEventsListener",value:function(e){this.smartLib.internalAdManager.adEventsListener=e,this.smartLib.internalAdManager.adSession.setAdEventsListener(e)}}],[{key:"getInstance",value:function(){return Jt.getInstance().adManager}}]),e}();function re(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ae(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var se="BpkAdSession",oe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ae(this,"session",void 0),ae(this,"adEventsListener",void 0),ae(this,"adActivated",void 0),ae(this,"adParameters",void 0),ae(this,"eventCallbackEnabled",void 0),ae(this,"adView",void 0),ae(this,"adViewState",void 0),ae(this,"adFriendlyObstructionViews",void 0),ae(this,"adCustomReference",void 0),ae(this,"adVerificationData",void 0),ae(this,"adPalSession",void 0),this.adEventsListener=void 0,this.adActivated=!1,this.adParameters={},this.eventCallbackEnabled=!0,this.adView=void 0,this.adViewState=ee.NORMAL,this.adFriendlyObstructionViews=[],this.adCustomReference="",this.adVerificationData=[]}var t,i,n;return t=e,(i=[{key:"setAdEventsListener",value:function(e){this.adEventsListener=e}},{key:"activateAdvertising",value:function(){var e;!0!==this.adActivated&&(this.adActivated=!0,P.d(se,"Ad session activated",null===(e=this.session)||void 0===e?void 0:e.id))}},{key:"setAdParameter",value:function(e,t){var i;this.activateAdvertising(),this.adParameters[e]=t,P.d(se,"Adding parameter "+e+"="+t,null===(i=this.session)||void 0===i?void 0:i.id)}},{key:"setEventCallbackEnabled",value:function(e){this.eventCallbackEnabled=e}},{key:"isAdActivated",value:function(){return!0===this.adActivated}},{key:"resetAdParameters",value:function(){this.adParameters={}}},{key:"hasAdParameters",value:function(){return Object.keys(this.adParameters).length>0}},{key:"onDashEvent",value:function(e){var t;if(this.isAdActivated())if(this.eventCallbackEnabled)if(!1===(null===(t=this.session.adTrackingManager)||void 0===t?void 0:t.bkYouSession)){var i=e;-1!==i.indexOf("<![CDATA[")&&-1!==i.indexOf("]]>")&&(i=i.trim().replace(/^(\/\/\s*)?<!\[CDATA\[|(\/\/\s*)?\]\]>$/g,"")),i=i.replace(/&&;/g,"&").trim(),void 0!==Jt.adModule?Jt.adModule.AdEventFactory.parseDashEvent(this.session,i).tracker.process():P.d(se,"Event received but ad module not loaded",this.session.id)}else P.d(se,"Event received but legacy mode not enabled",this.session.id);else P.d(se,"Event received but callbacks are disabled",this.session.id);else P.d(se,"Event received but ad not enabled (advertising not activated)",this.session.id)}}])&&re(t.prototype,i),n&&re(t,n),e}();function ue(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function le(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var de="BpkAdMgr",ce=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),le(this,"smartLib",void 0),le(this,"initialized",void 0),le(this,"adPalManager",void 0),le(this,"omPartnerName",void 0),le(this,"omPartnerVersion",void 0),le(this,"firstAdPalSessionRequest",void 0),le(this,"palSessionEnabled",!1),le(this,"adSession",void 0),le(this,"eventCallbackEnabled",void 0),le(this,"adEventsListener",void 0),this.initialized=!1,this.palSessionEnabled=!1,this.adSession=new oe,this.eventCallbackEnabled=!0,this.adEventsListener=void 0}var t,i,n;return t=e,(i=[{key:"init",value:function(e){this.smartLib=e,this.initialized||(this.initialized=!0,this.adSession=new oe,this.eventCallbackEnabled=!0,this.adEventsListener=void 0,P.d(de,"Ad manager loaded"))}},{key:"setPalManager",value:function(e){P.d(de,"Native PAL manager registered"),this.adPalManager=e}},{key:"requestAdPalSession",value:function(){var e=this.firstAdPalSessionRequest;return void 0!==e&&void 0===e.adPalSession&&!0===e.active&&!1===e.timeout?(P.d(de,"Using first nonce request..."),this.firstAdPalSessionRequest=void 0,e):(this.firstAdPalSessionRequest=void 0,e=new Q(this.adPalManager),this.initialized&&this.palSessionEnabled?(P.d(de,"Generating nonce..."),e.generateAdPalSession(),void 0===this.adPalManager&&e.setAdPalSession(void 0)):e.setAdPalSession(void 0),e)}},{key:"release",value:function(){this.initialized=!1,this.palSessionEnabled=!1,this.adSession=new oe,this.eventCallbackEnabled=!0,this.adEventsListener=void 0,void 0!==this.firstAdPalSessionRequest&&(this.firstAdPalSessionRequest.setAdPalSession(void 0),this.firstAdPalSessionRequest=void 0),void 0!==this.adPalManager&&this.adPalManager.reset()}},{key:"setConsentSettings",value:function(e){var t;null===(t=this.adPalManager)||void 0===t||t.setConsentSettings(e)}},{key:"setPalParameters",value:function(e,t,i,n,r,a,s,o,u,l,d){void 0!==this.adPalManager&&(void 0!==e&&this.adPalManager.setDescriptionURL(e),void 0!==t&&void 0!==i&&this.adPalManager.setOmidPartner(t,i),void 0!==n&&this.adPalManager.setOmidVersion(n),void 0!==r&&this.adPalManager.setPlayerType(r),void 0!==a&&this.adPalManager.setPlayerVersion(a),void 0!==s&&this.adPalManager.setPpid(s),0!==o&&this.adPalManager.setVideoPlayerHeight(o),0!==u&&this.adPalManager.setVideoPlayerWidth(u),this.adPalManager.setWillAdAutoPlay(l),this.adPalManager.setWillAdPlayMuted(d),this.palSessionEnabled||(this.palSessionEnabled=!0,P.d(de,"Generating first nonce..."),this.firstAdPalSessionRequest=new Q(this.adPalManager),this.firstAdPalSessionRequest.generateAdPalSession()))}},{key:"setPartner",value:function(e,t){this.omPartnerName=e,this.omPartnerVersion=t}}])&&ue(t.prototype,i),n&&ue(t,n),e}();function he(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function fe(e,t,i,n){return ye(e,t),pe(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n),n}function ve(e,t,i){return ye(e,t),pe(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}function pe(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function ye(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ee(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Se(e,t,i){return t&&Ee(e.prototype,t),i&&Ee(e,i),e}le(ce,"AD_NONCE_QUERY_PARAMETER","paln");var be="BpkRequestMgr",ke=function(){function e(){ge(this,e)}return Se(e,null,[{key:"get",value:function(e,t,i,n){n({body:void 0,headers:void 0,statusCode:-1})}},{key:"post",value:function(e,t,i,n,r){r({body:void 0,headers:void 0,statusCode:-1})}}]),e}(),me=function(){function e(){ge(this,e),he(this,"requestHandler",ke),he(this,"smartLib",void 0)}return Se(e,[{key:"init",value:function(e){this.requestHandler=e}},{key:"attachInstance",value:function(e){this.smartLib=e}},{key:"release",value:function(){}},{key:"getURL",value:function(t,i,n){var r,a,s=this,o=n.options,u=void 0!==i.nanoCDNDescr&&!0===o.get(ze.REQUEST_NANO_CDN),l=e.isBroadpeakDomainName(t,i.broadpeakDomainNames)&&!0===o.get(ze.REQUEST_BROADPEAK_CDN),d=!0===o.get(ze.MULTICAST_ONLY)||!0===o.get(ze.LEGACY_MULTICAST_ONLY);if(u?"*"===i.broadpeakDomainNames?P.i(be,"Workflow 5.2 (v"+L+")",n.id):""===i.broadpeakDomainNames?P.i(be,"Workflow 5.4 (v"+L+")",n.id):l?P.i(be,"Workflow 5.6 => 5.2 (v"+L+")",n.id):P.i(be,"Workflow 5.6 => 5.4 (v"+L+")",n.id):"*"===i.broadpeakDomainNames?P.i(be,"Workflow 5.1 (v"+L+")",n.id):""===i.broadpeakDomainNames?P.i(be,"Workflow 5.3 (v"+L+")",n.id):l?P.i(be,"Workflow 5.5 => 5.1 (v"+L+")",n.id):P.i(be,"Workflow 5.5 => 5.3 (v"+L+")",n.id),P.i(be,"   Parameters",n.id),P.i(be,"      analyticsAddress="+i.analyticsAddress,n.id),P.i(be,"      nanoCDNHost="+(void 0===i.nanoCDNDescr?"":i.nanoCDNDescr.hostIP),n.id),P.i(be,"      broadpeakDomainNames="+i.broadpeakDomainNames,n.id),o.print(be,"   ",n.id),u)return null===(r=Jt.nanoCDNModule)||void 0===r?void 0:r.NanoCDNRequestManager.getInstance().processNanoCDNSession(t,i,n,l,d);if(!0===d)return Promise.resolve(pt.error(pt.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN));if(void 0===n.adSession||!n.adSession.isAdActivated())return this.requestBkM(t,i,void 0,n);var c=this.smartLib.internalAdManager.requestAdPalSession();return this.requestBkM(t,i,void 0,n).then((function(e){return a=e,c.getAdPalSession()})).then((function(e){if(!a.isError()){if(void 0!==n.adSession&&n.adSession.isAdActivated()){var t=n.adSession.adParameters;for(var r in t)a.url=O.addOrReplaceParam(a.url,r,t[r]);void 0!==e&&(n.adSession.adPalSession=e,e.setAdView(n.adSession.adView))}return s.requestBkYou(a,i,n,e)}return a}))}},{key:"requestBkM",value:function(t,i,n,r){var a=this,s=r.options;if(e.isBroadpeakDomainName(t,i.broadpeakDomainNames)&&!0===s.get(ze.REQUEST_BROADPEAK_CDN)||!0===s.get(ze.REQUEST_REDIRECT_THIRD_PARTY_CDN)){var o=O.addOrReplaceParam(t,"response","200");return o=O.addOrReplaceParam(o,"bk-ml","1"),"string"==typeof n&&0!==n.length?o=O.addOrReplaceParam(o,"nanocdnhost",n):!0===s.get(ze.REQUEST_DIVERSITY_DYNAMIC_FAILOVER)?o=O.addOrReplaceParam(o,"diversityfailover","1"):!0===s.get(ze.REQUEST_DIVERSITY)&&(o=O.addOrReplaceParam(o,"diversityhost","127.0.0.1:18080")),e.isBroadpeakDomainName(t,i.broadpeakDomainNames)?P.d(be,"Sending request to the BkM/umbrella: "+o,r.id):P.d(be,"Sending request to third party CDN: "+o,r.id),this.getRedirectionLocation(o,e.CDN_REQUEST_TIMEOUT,i,r).then((function(n){return e.isBroadpeakDomainName(t,i.broadpeakDomainNames)?P.d(be,"BkM/umbrella responded with status code "+n.httpStatus,r.id):P.d(be,"Third party CDN responded with status code "+n.httpStatus,r.id),r.sessionReport.cdnStatusCode=n.httpStatus,n.httpStatus>=200&&n.httpStatus<400&&""!==n.redirectedURL?pt.success(n.redirectedURL):n.httpStatus<=0?pt.error(pt.RESULT_CDN_RESPONSE_UNREADABLE):n.httpStatus>=400&&n.httpStatus<500?pt.error(pt.RESULT_REQUESTED_URL_NOT_FOUND_ON_CDN,a.getBkMDetailedErrorMessage(n,r)):n.httpStatus>=500&&n.httpStatus<600?pt.error(pt.RESULT_REQUESTED_URL_CDN_ERROR,a.getBkMDetailedErrorMessage(n,r)):pt.error(pt.RESULT_NO_STREAMING_URL_FOUND,a.getBkMDetailedErrorMessage(n,r))})).then((function(e){return e.isError()&&(r.sessionReport.cdnStatusCode=e.getDetailedErrorCode()),e}))}return Promise.resolve(pt.success(t))}},{key:"getBkMDetailedErrorMessage",value:function(t,i){if(!0===t.headers.hasOwnProperty(e.HEADER_CDN_DETAILED_ERROR_CODE)){var n=t.headers[e.HEADER_CDN_DETAILED_ERROR_CODE];return P.d(be,"Reading detailed error code from header: "+n,i.id),n}return P.d(be,"Reading detailed error code from http status: "+t.httpStatus+" "+t.httpMessage,i.id),String(t.httpStatus+" "+t.httpMessage)}},{key:"requestBkYou",value:function(e,t,i,n){var r,a=O.addOrReplaceParam(e.getURL(),"bk-ml","1"),s=a;return void 0!==n&&(r=n.getNonce(),s=O.addOrReplaceParam(s,ce.AD_NONCE_QUERY_PARAMETER,r)),this.adTracking(i,t,s,!1).then((function(t){if(!(t.httpStatus>=200&&t.httpStatus<300))return P.d(be,"BkYou response unreadable (status code), falling back to legacy mode",i.id),void 0!==r&&(e.url=O.addOrReplaceParam(e.url,ce.AD_NONCE_QUERY_PARAMETER,r)),e;var s,o;try{o=JSON.parse(t.content)}catch(t){return P.d(be,"BkYou file unreadable (parsing), falling back to legacy mode",i.id),void 0!==r&&(e.url=O.addOrReplaceParam(e.url,ce.AD_NONCE_QUERY_PARAMETER,r)),e}var u=o.sessiontoken;if(void 0===u)return e;P.d(be,"BkYou session token: "+u,i.id);var l=o.playbackqueries;return Array.isArray(l)&&l.forEach((function(t){if(-1!==t.indexOf("=")){var i=t.split("=");e.url=O.addOrReplaceParam(e.url,i[0],i[1]),a=O.addOrReplaceParam(a,i[0],i[1])}})),null===(s=i.adTrackingManager)||void 0===s||s.initBkYouSession(a,u,o,n,r),e}))}},{key:"getRedirectionLocation",value:function(e,t,i,n){return new Promise((function(r,a){var s={Connection:"close"};void 0!==i.userAgent&&(s["User-Agent"]=i.userAgent);var o=H.getInstance().asyncGet(e,s,t,(function(e){var t=0,i="";void 0!==e.statusCode&&(t=parseInt(e.statusCode,10)),void 0!==e.headers&&void 0!==e.headers.location?i=e.headers.location:t>=200&&t<400&&P.e(be,'Location header cannot be read, please ensure "Access-Control-Expose-Headers: Location" is configured.',n.id),r({httpStatus:t,httpMessage:e.message,headers:e.headers,redirectedURL:i})}));n.jobs.push(o)}))}},{key:"keepalive",value:function(t,i){var n=t.sessionReport,r=n.redirectedURL,a=r.indexOf("?");a>0&&(r=r.substring(0,a)),r.endsWith("/")||(r+="/"),r+=e.KEEPALIVE_PATH;var s=t.options.get(ze.SESSION_REPORTING_MODE);return s===ze.SESSION_REPORTING_MODE_DEFAULT||s===ze.SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN?(r+="?",void 0!==n.timeline&&(r+=e.TEARDOWN_TIMELINE_QUERY+n.timeline.data().base64()+"&"),r+=e.TEARDOWN_METRICS_QUERY+n.toQuery(),P.i(be,"Sending keepalive with metrics to "+r,t.id)):P.i(be,"Sending keepalive without metrics to "+r,t.id),new Promise((function(n,a){var s={Connection:"close"};void 0!==i.userAgent&&(s["User-Agent"]=i.userAgent),H.getInstance().asyncGet(r,s,e.BKS_REQUEST_TIMEOUT,(function(e){P.i(be,"Send keepalive ends with status code: "+e.statusCode,t.id),n(e.statusCode)}))}))}},{key:"teardown",value:function(t,i){var n=t.sessionReport,r=n.redirectedURL,a=r.indexOf("?");a>0&&(r=r.substring(0,a)),r.endsWith("/")||(r+="/"),r+=e.TEARDOWN_PATH,r+=n.statusCode;var s=t.options.get(ze.SESSION_REPORTING_MODE);return s===ze.SESSION_REPORTING_MODE_DEFAULT||s===ze.SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN?(r+="?",void 0!==n.timeline&&(r+=e.TEARDOWN_TIMELINE_QUERY+n.timeline.data().base64()+"&"),r+=e.TEARDOWN_METRICS_QUERY+n.toQuery(),P.i(be,"Sending teardown with metrics to "+r,t.id)):P.i(be,"Sending teardown without metrics to "+r,t.id),new Promise((function(n,a){var s={Connection:"close"};void 0!==i.userAgent&&(s["User-Agent"]=i.userAgent),H.getInstance().asyncGet(r,s,e.BKS_REQUEST_TIMEOUT,(function(e){P.i(be,"Send teardown ends with status code: "+e.statusCode,t.id)}))}))}},{key:"adEvent",value:function(e,t){var i=this.smartLib.getParameters(),n={Connection:"close"};void 0!==i.userAgent&&(n["User-Agent"]=i.userAgent);var r=e.options.get(ze.USERAGENT_AD_EVENT);void 0!==r&&(n["User-Agent"]=r),H.getInstance().asyncGet(t,n,2e4,(function(e){P.i(be,"Ad event request ends with status code: "+e.statusCode)}))}},{key:"adTracking",value:function(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return P.d(be,"Sending request to the BkYou: "+n,t.id),new Promise((function(a,s){var o={Connection:"close"};if(void 0!==i.userAgent&&(o["User-Agent"]=i.userAgent),!1===r){var u=H.getInstance().asyncGet(n,o,e.BKS_REQUEST_TIMEOUT,(function(e){P.d(be,"BkYou responded with status code "+e.statusCode,t.id),a({httpStatus:e.statusCode,content:e.body})}));t.jobs.push(u)}else H.getInstance().asyncGet(n,o,e.BKS_REQUEST_TIMEOUT,(function(e){P.d(be,"BkYou responded with status code "+e.statusCode,t.id),a({httpStatus:e.statusCode,content:e.body})}))}))}}],[{key:"getInstance",value:function(){return ve(e,e,_e)||fe(e,e,_e,new e),ve(e,e,_e)}},{key:"isBroadpeakDomainName",value:function(e,t){if(null===t||""===t)return!1;if("*"===t)return!0;var i=O.parseURL(e);return null!==i&&null!==i.hostname&&t.split(",").indexOf(i.hostname)>=0}}]),e}();he(me,"TEARDOWN_PATH","teardown/"),he(me,"TEARDOWN_METRICS_QUERY","metrics="),he(me,"TEARDOWN_TIMELINE_QUERY","metricsTL="),he(me,"KEEPALIVE_PATH","keepalive"),he(me,"QUERY_PARAMETER_SESSION_ID","bk-session_id"),he(me,"QUERY_PARAMETER_SESSION_CREATED","bk-session"),he(me,"HEADER_CDN_DETAILED_ERROR_CODE","x-bpk-error"),he(me,"CDN_REQUEST_TIMEOUT",2e4),he(me,"BKS_REQUEST_TIMEOUT",5e3),he(me,"KEEPALIVE_REQUEST_INTERVAL",5e3);var _e={writable:!0,value:void 0};function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ne(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Re="BpkValidator",De=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"typeParameter",value:function(e,t,i){return Ae(e)===t||(P.e(Re,i),!1)}},{key:"typeOrUndefinedParameter",value:function(e,t,i){return Ae(e)===t||void 0===e||(P.e(Re,i),!1)}},{key:"typeOrNullParameter",value:function(e,t,i){return Ae(e)===t||null===e||(P.e(Re,i),!1)}},{key:"stringNonEmpty",value:function(e,t){return"string"==typeof e&&e.length>0||(P.e(Re,t),!1)}},{key:"toBkAString",value:function(e){return void 0!==e&&"string"==typeof e?e.replace(/\n/g,"").replace(/\t/g,"").replace(/\r/g,""):e}}],(i=null)&&Ne(t.prototype,i),n&&Ne(t,n),e}();function Pe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Te(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var we=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Te(this,"requestedURL",void 0),Te(this,"redirectedURL",void 0),Te(this,"sessionRunning",void 0),Te(this,"sessionCreated",void 0),Te(this,"sessionId",void 0),Te(this,"teardownActivated",void 0),Te(this,"smartLibParameters",void 0),Te(this,"customParameters",void 0),Te(this,"playerName",void 0),Te(this,"playerVersion",void 0),Te(this,"osName",void 0),Te(this,"osVersion",void 0),Te(this,"deviceType",void 0),Te(this,"smartLibVersion",void 0),Te(this,"networkTypeList",void 0),Te(this,"nanoCDNStatus",void 0),Te(this,"statusCode",void 0),Te(this,"cdnStatusCode",void 0),Te(this,"nanoCDNStatusCode",void 0),Te(this,"playerErrorCode",void 0),Te(this,"metrics",void 0),Te(this,"adMetrics",void 0),Te(this,"timeline",void 0),Te(this,"diversity",void 0),Te(this,"endSessionDate",void 0),Te(this,"startSessionRequestDate",void 0),Te(this,"keepaliveRequestDate",void 0),Te(this,"teardownRequestDate",void 0),Te(this,"endSessionRequestDate",void 0),this.requestedURL="",this.redirectedURL="",this.sessionRunning=!1,this.sessionCreated=!1,this.sessionId="",this.teardownActivated=!1,this.smartLibParameters={},this.customParameters={},this.playerName="",this.playerVersion="",this.osName="",this.osVersion="",this.deviceType="",this.smartLibVersion=L,this.networkTypeList=[],this.nanoCDNStatus=et.NANOCDN_STATUS_UNAVAILABLE,this.statusCode=Jt.BPSessionEndsNormally,this.cdnStatusCode=-1,this.nanoCDNStatusCode=-1,this.playerErrorCode="",void 0!==Jt.analyticsModule&&(this.timeline=new Jt.analyticsModule.SessionTrackerTimeline),this.endSessionDate=0,this.startSessionRequestDate=0,this.keepaliveRequestDate=0,this.teardownRequestDate=0,this.endSessionRequestDate=0}var t,i,n;return t=e,(i=[{key:"toQuery",value:function(){var e,t=""===this.playerName?"Generic":this.playerName,i=this.customParameters.pre_startup_time;if(e=void 0===this.metrics?"-1+"+encodeURIComponent(t)+"+"+encodeURIComponent(this.playerVersion)+"+"+encodeURIComponent(this.osName)+"+"+encodeURIComponent(this.osVersion)+"+"+(""!==this.smartLibParameters.deviceType?encodeURIComponent(this.smartLibParameters.deviceType):encodeURIComponent(this.deviceType))+"+-1+-1+-1++-1+-1+-1+-1+-1+-1+-1+-1+-1+-1+-1++":this.metrics.redirectionTime+"+"+encodeURIComponent(t)+"+"+encodeURIComponent(this.playerVersion)+"+"+encodeURIComponent(this.osName)+"+"+encodeURIComponent(this.osVersion)+"+"+(""!==this.smartLibParameters.deviceType?encodeURIComponent(this.smartLibParameters.deviceType):encodeURIComponent(this.deviceType))+"+"+this.metrics.startupTime+"+"+this.metrics.completion+"+"+Math.round(this.metrics.playbackDuration/1e3)+"+"+this.metrics.playbackType+"+"+this.metrics.stallsNumber+"+"+this.metrics.maxStallDuration+"+"+this.metrics.totalStallsDuration+"+"+this.metrics.rebufferingsNumber+"+"+this.metrics.maxRebufferingDuration+"+"+this.metrics.totalRebufferingDuration+"+"+Math.round(this.metrics.maxBitrate)+"+"+Math.round(this.metrics.minBitrate)+"+"+Math.round(this.metrics.averageBitrate)+"+"+this.metrics.layerSwitchesNumber+"+"+Math.round(this.metrics.sessionDuration/1e3)+"+"+this.getTimeSpentPerLayerQuery()+"+",e+=encodeURIComponent(this.smartLibParameters.uuid)+"+"+this.nanoCDNStatus+"+"+(void 0!==i?encodeURIComponent(i):"")+"+"+encodeURIComponent(this.smartLibVersion)+"+",void 0!==Jt.adModule&&void 0!==this.adMetrics&&this.adMetrics.length>0){var n=Jt.adModule.AdMetrics.merge(this.adMetrics);e+=(n.adSkippable?1:0)+"+"+(n.adSkipped?1:0)+"+"+(n.adProgress>=0?n.adProgress/25:n.adProgress)+"+"+Math.round(n.adDuration/1e3)+"+"+n.stallsNumber+"+"+Math.round(n.stallsDuration/1e3)+"+"+n.layerSwitchesNumber+"+"+n.averageBitrate}else e+="+++++++";return e+="+"+this.getNetworkTypeListStr()+"+"+encodeURIComponent(this.playerErrorCode),e+="+"+(this.cdnStatusCode>=0?this.cdnStatusCode:"")+"+"+(this.nanoCDNStatusCode>=0?this.nanoCDNStatusCode:"")}},{key:"toStartSessionJSON",value:function(){var t={};return t[e.IS_START_TAG]=!0,t[e.SESSION_ID_TAG]=this.sessionId,void 0!==this.metrics&&(t[e.STARTUP_TIME_TAG]=this.metrics.startupTime),t}},{key:"toEndSessionJSON",value:function(){var t={};if(t[e.IS_START_TAG]=!1,t[e.SESSION_ID_TAG]=this.sessionId,t[e.STATUS_CODE_TAG]=this.statusCode,t[e.CONTENT_URL_TAG]=De.toBkAString(this.requestedURL),this.redirectedURL.includes(ce.AD_NONCE_QUERY_PARAMETER)?t[e.REDIRECT_URL_TAG]=De.toBkAString(O.addOrReplaceParam(this.redirectedURL,ce.AD_NONCE_QUERY_PARAMETER,"ignored")):t[e.REDIRECT_URL_TAG]=De.toBkAString(this.redirectedURL),void 0!==this.metrics?(t[e.REDIRECTION_TIME_TAG]=this.metrics.redirectionTime,t[e.STARTUP_TIME_TAG]=this.metrics.startupTime,t[e.COMPLETION_TAG]=this.metrics.completion,t[e.PLAYED_TIME_TAG]=Math.round(this.metrics.playbackDuration/1e3),t[e.DURATION_TAG]=Math.round(this.metrics.sessionDuration/1e3),t[e.PLAYBACK_TYPE_TAG]=this.metrics.playbackType,t[e.NUMBER_OF_STALLS_TAG]=this.metrics.stallsNumber,t[e.MAX_STALL_TIME_TAG]=this.metrics.maxStallDuration,t[e.TOTAL_STALL_TIME_TAG]=this.metrics.totalStallsDuration,t[e.NUMBER_OF_REBUFFERING_TAG]=this.metrics.rebufferingsNumber,t[e.MAX_REBUFFERING_TIME_TAG]=this.metrics.maxRebufferingDuration,t[e.TOTAL_REBUFFERING_TIME_TAG]=this.metrics.totalRebufferingDuration,t[e.MIN_BITRATE_TAG]=Math.round(this.metrics.minBitrate),t[e.MAX_BITRATE_TAG]=Math.round(this.metrics.maxBitrate),t[e.AVERAGE_BITRATE_TAG]=Math.round(this.metrics.averageBitrate),t[e.NUMBER_OF_LAYER_SWITCH_TAG]=this.metrics.layerSwitchesNumber,t[e.TIME_SPENT_PER_LAYER_TAG]=this.metrics.timeSpentPerLayer):(t[e.REDIRECTION_TIME_TAG]=-1,t[e.STARTUP_TIME_TAG]=-1,t[e.COMPLETION_TAG]=-1,t[e.PLAYED_TIME_TAG]=-1,t[e.DURATION_TAG]=-1,t[e.PLAYBACK_TYPE_TAG]="",t[e.NUMBER_OF_STALLS_TAG]=-1,t[e.MAX_STALL_TIME_TAG]=-1,t[e.TOTAL_STALL_TIME_TAG]=-1,t[e.NUMBER_OF_REBUFFERING_TAG]=-1,t[e.MAX_REBUFFERING_TIME_TAG]=-1,t[e.TOTAL_REBUFFERING_TIME_TAG]=-1,t[e.MIN_BITRATE_TAG]=-1,t[e.MAX_BITRATE_TAG]=-1,t[e.AVERAGE_BITRATE_TAG]=-1,t[e.NUMBER_OF_LAYER_SWITCH_TAG]=-1,t[e.TIME_SPENT_PER_LAYER_TAG]={}),t[e.PLAYER_NAME_TAG]=De.toBkAString(this.playerName),t[e.PLAYER_VERSION_TAG]=De.toBkAString(this.playerVersion),t[e.DEVICE_OS_TAG]=De.toBkAString(this.osName),t[e.DEVICE_VERSION_TAG]=De.toBkAString(this.osVersion),""!==this.smartLibParameters.deviceType?t[e.DEVICE_TYPE]=De.toBkAString(this.smartLibParameters.deviceType):t[e.DEVICE_TYPE]=De.toBkAString(this.deviceType),t[e.UUID_TAG]=De.toBkAString(this.smartLibParameters.uuid),t[e.NANOCDN_STATUS_TAG]=this.nanoCDNStatus,t[e.CUSTOM_PARAMETERS_TAG]=this.customParameters,void 0!==this.timeline?t[e.TIMELINE_TAG]=this.timeline.data().base64():t[e.TIMELINE_TAG]="",t[e.SMARTLIB_VERSION_TAG]=De.toBkAString(this.smartLibVersion),t[e.MULTIPATH_TAG]=this.diversity,t[e.PLAYER_ERROR_CODE_TAG]=De.toBkAString(this.playerErrorCode),t[e.AD_METRICS_TAG]=[],void 0!==this.adMetrics&&this.adMetrics.length>0)for(var i=0;i<this.adMetrics.length;i++){var n=this.adMetrics[i];t[e.AD_METRICS_TAG].push({ad_skippable:n.adSkippable?1:0,ad_skipped:n.adSkipped?1:0,ad_progress:n.adProgress>=0?n.adProgress/25:n.adProgress,ad_duration:Math.round(n.adDuration/1e3),stalls_number:n.stallsNumber,stalls_duration:Math.round(n.stallsDuration/1e3),layer_switches_number:n.layerSwitchesNumber,average_bitrate:n.averageBitrate,session_token:n.sessionToken,creative_id:n.creativeId,ad_id:n.adId})}return t[e.NETWORK_TYPE_TAG]=this.getNetworkTypeListStr(),t[e.CDN_STATUS_CODE]=this.cdnStatusCode>=0?this.cdnStatusCode:"",t[e.NANOCDN_STATUS_CODE]=this.nanoCDNStatusCode>=0?this.nanoCDNStatusCode:"",t}},{key:"getTimeSpentPerLayerQuery",value:function(){var e="";for(var t in this.metrics.timeSpentPerLayer)""!==e&&(e+=","),e+=t+":"+this.metrics.timeSpentPerLayer[t];return e}},{key:"addNetworkType",value:function(e){this.networkTypeList.includes(e)||this.networkTypeList.push(e)}},{key:"getNetworkTypeListStr",value:function(){return this.networkTypeList.length>0?this.networkTypeList.sort().join("-"):""}},{key:"toString",value:function(){return JSON.stringify(this,(function(e,t){return"timeline"===e&&void 0!==Jt.analyticsModule&&t instanceof Jt.analyticsModule.SessionTrackerTimeline?t.toString():void 0===t?"undefined":t}),"  ")}}])&&Pe(t.prototype,i),n&&Pe(t,n),e}();function Oe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Le(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Ie(e,t,"get"))}function Ce(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Ie(e,t,"set"),i),i}function Ie(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}Te(we,"SESSION_ID_TAG","session_id"),Te(we,"IS_START_TAG","start"),Te(we,"STATUS_CODE_TAG","status_code"),Te(we,"STARTUP_TIME_TAG","startup_time"),Te(we,"REDIRECTION_TIME_TAG","redirection_time"),Te(we,"COMPLETION_TAG","completion"),Te(we,"PLAYED_TIME_TAG","played_time"),Te(we,"DURATION_TAG","duration"),Te(we,"PLAYBACK_TYPE_TAG","playback_type"),Te(we,"NUMBER_OF_STALLS_TAG","cnt_stall"),Te(we,"TOTAL_STALL_TIME_TAG","total_stall_time"),Te(we,"MAX_STALL_TIME_TAG","max_stall_time"),Te(we,"NUMBER_OF_REBUFFERING_TAG","cnt_rebuffering"),Te(we,"TOTAL_REBUFFERING_TIME_TAG","total_rebuffering_time"),Te(we,"MAX_REBUFFERING_TIME_TAG","max_rebuffering_time"),Te(we,"REDIRECT_URL_TAG","redirect_url"),Te(we,"CONTENT_URL_TAG","content_url"),Te(we,"MAX_BITRATE_TAG","max_bitrate"),Te(we,"MIN_BITRATE_TAG","min_bitrate"),Te(we,"AVERAGE_BITRATE_TAG","average_bitrate"),Te(we,"NUMBER_OF_LAYER_SWITCH_TAG","cnt_layer_switch"),Te(we,"TIME_SPENT_PER_LAYER_TAG","time_spent_per_layer"),Te(we,"PLAYER_NAME_TAG","player_name"),Te(we,"PLAYER_VERSION_TAG","player_version"),Te(we,"DEVICE_OS_TAG","device_os"),Te(we,"DEVICE_VERSION_TAG","device_version"),Te(we,"DEVICE_TYPE","device_type"),Te(we,"MULTIPATH_TAG","multipath"),Te(we,"UUID_TAG","uuid"),Te(we,"NANOCDN_STATUS_TAG","nano_status"),Te(we,"CUSTOM_PARAMETERS_TAG","custom_parameters"),Te(we,"TIMELINE_TAG","timeline"),Te(we,"SMARTLIB_VERSION_TAG","smartlib_version"),Te(we,"AD_METRICS_TAG","ad_metrics"),Te(we,"NETWORK_TYPE_TAG","network_type_list"),Te(we,"PLAYER_ERROR_CODE_TAG","player_error_code"),Te(we,"CDN_STATUS_CODE","cdn_status_code"),Te(we,"NANOCDN_STATUS_CODE","nanocdn_status_code");var Me=new WeakMap,Be=new WeakMap,Ue=new WeakMap,je=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Me.set(this,{writable:!0,value:void 0}),Be.set(this,{writable:!0,value:void 0}),Ue.set(this,{writable:!0,value:void 0}),Ce(this,Me,t),Ce(this,Be,!0)}var t,i,n;return t=e,(i=[{key:"start",value:function(){var e=this;Ce(this,Ue,H.getInstance().asyncDelay(me.KEEPALIVE_REQUEST_INTERVAL,(function(){e.process()})))}},{key:"process",value:function(){var e=this;if(Le(this,Be)){Le(this,Me).notifyKeepaliveSessionReportRequested(Le(this,Me).sessionReport),Le(this,Me).sessionReport.keepaliveRequestDate=Date.now();var t={userAgent:Le(this,Me).smartLib.getParameters().userAgent};me.getInstance().keepalive(Le(this,Me),t).then((function(t){t>0&&(t<200||t>=300)?(P.d("BpkKeepAliveMgr","Stopping keepalive...",Le(e,Me).id),e.stop()):Ce(e,Ue,H.getInstance().asyncDelay(me.KEEPALIVE_REQUEST_INTERVAL,(function(){e.process()})))}))}}},{key:"stop",value:function(){Ce(this,Be,!1),H.getInstance().cancel(Le(this,Ue))}},{key:"isActive",value:function(){return Le(this,Be)}}])&&Oe(t.prototype,i),n&&Oe(t,n),e}();function Fe(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function Ve(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(i),!0).forEach((function(t){Ge(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Fe(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function xe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ge(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function He(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,qe(e,t,"get"))}function We(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,qe(e,t,"set"),i),i}function qe(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}var Ye="BpkStreamingSessionOptions",Ke=new WeakMap,Qe=new WeakMap,ze=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ke.set(this,{writable:!0,value:void 0}),Qe.set(this,{writable:!0,value:void 0}),We(this,Ke,{}),He(this,Ke)[e.MULTICAST_ONLY]=!1,He(this,Ke)[e.ULTRA_LOW_LATENCY_SUPPORT]=!1,He(this,Ke)[e.PIP_SESSION]=!1,He(this,Ke)[e.REQUEST_REDIRECT_THIRD_PARTY_CDN]=!1,He(this,Ke)[e.REQUEST_DIVERSITY]=!1,He(this,Ke)[e.REQUEST_NANO_CDN]=!0,He(this,Ke)[e.REQUEST_BROADPEAK_CDN]=!0,He(this,Ke)[e.REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI]=!1,He(this,Ke)[e.REQUEST_DIVERSITY_DYNAMIC_FAILOVER]=!1,He(this,Ke)[e.SESSION_KEEPALIVE]=e.SESSION_ENABLED_IF_BROADPEAK_DOMAIN,He(this,Ke)[e.SESSION_TEARDOWN]=e.SESSION_ENABLED_IF_BROADPEAK_DOMAIN,He(this,Ke)[e.SESSION_REPORTING_MODE]=e.SESSION_REPORTING_MODE_DEFAULT,He(this,Ke)[e.USERAGENT_AD_EVENT]=void 0,He(this,Ke)[e.EXPERIMENTAL_METRICS_LATENCY]=!1,He(this,Ke)[e.LEGACY_MULTICAST_ONLY]=!1,We(this,Qe,[])}var t,i,n;return t=e,n=[{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new e;return t instanceof e&&We(n,Ke,Ve({},He(t,Ke))),void 0!==i&&He(i,Qe).forEach((function(e){He(n,Ke)[e]=He(i,Ke)[e]})),n}},{key:"optionToString",value:function(e){switch(e){case this.MULTICAST_ONLY:return"MULTICAST_ONLY";case this.PIP_SESSION:return"PIP_SESSION";case this.ULTRA_LOW_LATENCY_SUPPORT:return"ULTRA_LOW_LATENCY_SUPPORT";case this.REQUEST_REDIRECT_THIRD_PARTY_CDN:return"REQUEST_REDIRECT_THIRD_PARTY_CDN";case this.REQUEST_DIVERSITY:return"REQUEST_DIVERSITY";case this.REQUEST_NANO_CDN:return"REQUEST_NANO_CDN";case this.REQUEST_BROADPEAK_CDN:return"REQUEST_BROADPEAK_CDN";case this.REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI:return"REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI";case this.REQUEST_DIVERSITY_DYNAMIC_FAILOVER:return"REQUEST_DIVERSITY_DYNAMIC_FAILOVER";case this.SESSION_KEEPALIVE:return"SESSION_KEEPALIVE";case this.SESSION_TEARDOWN:return"SESSION_TEARDOWN";case this.SESSION_REPORTING_MODE:return"SESSION_REPORTING_MODE";case this.USERAGENT_AD_EVENT:return"USERAGENT_AD_EVENT";case this.LEGACY_MULTICAST_ONLY:return"LEGACY_MULTICAST_ONLY"}return"unknown"}},{key:"valueToString",value:function(e,t){switch(e){case this.SESSION_KEEPALIVE:case this.SESSION_TEARDOWN:return this.stateToString(t);case this.SESSION_REPORTING_MODE:return this.reportingModeToString(t)}return String(t)}},{key:"stateToString",value:function(t){switch(t){case e.SESSION_DISABLED:return"disabled";case e.SESSION_ENABLED_IF_BROADPEAK_DOMAIN:return"enabled if broadpeak domain name";case e.SESSION_ENABLED:return"enabled"}return"unknown"}},{key:"reportingModeToString",value:function(t){switch(t){case e.SESSION_REPORTING_MODE_DEFAULT:return"default";case e.SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN:return"keepalive/teardown";case e.SESSION_REPORTING_MODE_METRICS_RECEIVER:return"metricsReceiver";case e.SESSION_REPORTING_MODE_DISABLED:return"disabled"}return"unknown"}}],(i=[{key:"option",value:function(t,i){return this.validate(t,i)&&(He(this,Ke)[t]=i,t===e.PIP_SESSION&&!0===i&&this.option(e.REQUEST_NANO_CDN,!1),-1===He(this,Qe).indexOf(t)&&He(this,Qe).push(t)),this}},{key:"get",value:function(t){var i=[e.USERAGENT_AD_EVENT];return void 0===He(this,Ke)[t]&&-1===i.indexOf(t)&&P.w(Ye,"Warning: get option "+t+" not found"),He(this,Ke)[t]}},{key:"set",value:function(e,t){this.option(e,t)}},{key:"validate",value:function(t,i){if(t===e.SESSION_REPORTING_MODE)return i===e.SESSION_REPORTING_MODE_DEFAULT||i===e.SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN||i===e.SESSION_REPORTING_MODE_METRICS_RECEIVER||i===e.SESSION_REPORTING_MODE_DISABLED||(P.e(Ye,"Error: SESSION_REPORTING_MODE should be SESSION_REPORTING_MODE_DEFAULT, SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN, SESSION_REPORTING_MODE_METRICS_RECEIVER or SESSION_REPORTING_MODE_DISABLED"),!1);if(t===e.SESSION_KEEPALIVE||t===e.SESSION_TEARDOWN)return i===e.SESSION_DISABLED||i===e.SESSION_ENABLED_IF_BROADPEAK_DOMAIN||i===e.SESSION_ENABLED||(P.e(Ye,"Error: "+e.optionToString(t)+" value should be SESSION_ENABLED_IF_BROADPEAK_DOMAIN, SESSION_DISABLED or SESSION_ENABLED"),!1);if(t===e.USERAGENT_AD_EVENT)return"string"==typeof i||void 0===i||(P.e(Ye,"Error: "+e.optionToString(t)+" value should be a string or undefined"),!1);var n="boolean"==typeof i;return n||P.e(Ye,"Error: "+e.optionToString(t)+" value should be a boolean"),n}},{key:"print",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ye,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;P.i(t,i+"Options",n),P.i(t,i+"   MULTICAST_ONLY="+this.get(e.MULTICAST_ONLY),n),P.i(t,i+"   REQUEST_REDIRECT_THIRD_PARTY_CDN="+this.get(e.REQUEST_REDIRECT_THIRD_PARTY_CDN),n),P.i(t,i+"   REQUEST_DIVERSITY="+this.get(e.REQUEST_DIVERSITY),n),P.i(t,i+"   REQUEST_NANO_CDN="+this.get(e.REQUEST_NANO_CDN),n),P.i(t,i+"   REQUEST_BROADPEAK_CDN="+this.get(e.REQUEST_BROADPEAK_CDN),n),P.i(t,i+"   REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI="+this.get(e.REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI),n),P.i(t,i+"   REQUEST_DIVERSITY_DYNAMIC_FAILOVER="+this.get(e.REQUEST_DIVERSITY_DYNAMIC_FAILOVER),n),P.i(t,i+"   SESSION_KEEPALIVE="+e.stateToString(this.get(e.SESSION_KEEPALIVE)),n),P.i(t,i+"   SESSION_TEARDOWN="+e.stateToString(this.get(e.SESSION_TEARDOWN)),n),P.i(t,i+"   SESSION_REPORTING_MODE="+e.reportingModeToString(this.get(e.SESSION_REPORTING_MODE)),n),void 0!==this.get(e.USERAGENT_AD_EVENT)&&P.i(t,i+"   USERAGENT_AD_EVENT="+this.get(e.USERAGENT_AD_EVENT),n),P.i(t,i+"   PIP_SESSION="+this.get(e.PIP_SESSION),n),P.i(t,i+"   ULTRA_LOW_LATENCY_SUPPORT="+this.get(e.ULTRA_LOW_LATENCY_SUPPORT),n)}},{key:"printUpdates",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ye,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;He(this,Qe).forEach((function(a){P.i(i,n+"   "+e.optionToString(a)+"="+e.valueToString(a,t.get(a)),r)}))}}])&&xe(t.prototype,i),n&&xe(t,n),e}();function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ze(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Ge(ze,"MULTICAST_ONLY",0),Ge(ze,"ULTRA_LOW_LATENCY_SUPPORT",1),Ge(ze,"PIP_SESSION",2),Ge(ze,"REQUEST_REDIRECT_THIRD_PARTY_CDN",100),Ge(ze,"REQUEST_DIVERSITY",101),Ge(ze,"REQUEST_NANO_CDN",102),Ge(ze,"REQUEST_BROADPEAK_CDN",103),Ge(ze,"REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI",104),Ge(ze,"REQUEST_DIVERSITY_DYNAMIC_FAILOVER",105),Ge(ze,"SESSION_KEEPALIVE",200),Ge(ze,"SESSION_TEARDOWN",201),Ge(ze,"SESSION_REPORTING_MODE",202),Ge(ze,"USERAGENT_AD_EVENT",300),Ge(ze,"EXPERIMENTAL_METRICS_LATENCY",900),Ge(ze,"LEGACY_MULTICAST_ONLY",1e3),Ge(ze,"SESSION_DISABLED",-1),Ge(ze,"SESSION_ENABLED_IF_BROADPEAK_DOMAIN",0),Ge(ze,"SESSION_ENABLED",1),Ge(ze,"SESSION_REPORTING_MODE_DEFAULT",0),Ge(ze,"SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN",1),Ge(ze,"SESSION_REPORTING_MODE_METRICS_RECEIVER",2),Ge(ze,"SESSION_REPORTING_MODE_DISABLED",-1);var $e="BpkSession",et=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;Je(this,e),Ze(this,"smartLib",void 0),Ze(this,"streamingSession",void 0),Ze(this,"options",void 0),Ze(this,"adSession",void 0),Ze(this,"diversityFailoverSession",void 0),Ze(this,"omSessionHandler",void 0),Ze(this,"id",void 0),Ze(this,"listeners",void 0),Ze(this,"playerAdapter",void 0),Ze(this,"metricsManager",void 0),Ze(this,"keepAliveManager",void 0),Ze(this,"adMetricsManager",void 0),Ze(this,"adTrackingManager",void 0),Ze(this,"sessionReport",void 0),Ze(this,"firstImageCalled",void 0),Ze(this,"stopped",void 0),Ze(this,"jobs",void 0),Ze(this,"deviceInitDate",void 0),Ze(this,"manifestInitDate",void 0),this.smartLib=t,this.streamingSession=i,this.adSession=void 0,this.listeners=[],this.sessionReport=new we,this.firstImageCalled=!1,this.stopped=!1,this.jobs=[],this.sessionReport.smartLibParameters=t.getParameters(),this.sessionReport.customParameters=this.getCustomParameters()}var t,i,n;return t=e,(i=[{key:"initPlayerAdapter",value:function(){void 0!==this.playerAdapter?(P.i($e,"Player:name="+this.playerAdapter.getName()+", version="+this.playerAdapter.getVersion(),this.id),P.i($e,"Player:capabilities="+JSON.stringify(this.playerAdapter.getCapabilities()),this.id),this.playerAdapter.attachSession(this),this.playerAdapter.initSessionPlayerObjects()):P.i($e,"Player:no player attached",this.id)}},{key:"initManagers",value:function(){var e,t,i;void 0!==Jt.analyticsModule&&(this.metricsManager=new Jt.analyticsModule.MetricsManager(this,this.playerAdapter)),void 0!==Jt.adModule&&(this.adMetricsManager=new Jt.adModule.AdMetricsManager(this),this.adTrackingManager=new Jt.adModule.AdTrackingManager(this,this.playerAdapter)),void 0!==this.playerAdapter&&(this.addListener(this.metricsManager),this.addListener(this.playerAdapter)),this.addListener(this.sessionReport.timeline),this.addListener(this.adMetricsManager),null===(e=this.adTrackingManager)||void 0===e||e.addListener(this.adMetricsManager),void 0!==this.adSession&&this.adSession.isAdActivated()&&null!==(t=Jt.adModule)&&void 0!==t&&t.OMSDKManager.getInstance().isEnabled()&&(this.omSessionHandler=new Jt.adModule.OMSessionHandler(this,this.playerAdapter),this.addListener(this.omSessionHandler),null===(i=this.adTrackingManager)||void 0===i||i.addListener(this.omSessionHandler)),this.addListener(this),Ot.getInstance().addListener(this.sessionReport.timeline),Ot.getInstance().addListener(this)}},{key:"start",value:function(t){var i,n,r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};P.i($e,"Starting streaming session with redirect...",this.id),this.sessionReport.requestedURL=t,this.initPlayerAdapter(),this.initManagers(),this.notifyStart();var s=this.smartLib.getParameters(),o={analyticsAddress:s.analyticsAddress,nanoCDNDescr:null===(i=this.smartLib.nanoCDNHostManager)||void 0===i?void 0:i.getCurrentNanoCDNDescr(),nanoCDNDescrConfigured:null===(n=this.smartLib.nanoCDNHostManager)||void 0===n?void 0:n.getCurrentNanoCDNDescr(),broadpeakDomainNames:s.broadpeakDomainNames,forceTeardown:s.forceTeardown,userAgent:s.userAgent},u=me.isBroadpeakDomainName(t,o.broadpeakDomainNames)&&!0===this.options.get(ze.REQUEST_BROADPEAK_CDN);return void 0!==o.nanoCDNDescr&&(this.sessionReport.nanoCDNStatus=e.NANOCDN_STATUS_DETECTED_NOT_USED),Promise.resolve().then((function(){return void 0!==Jt.diversityModule&&!0===r.options.get(ze.REQUEST_DIVERSITY_DYNAMIC_FAILOVER)&&u?Jt.diversityModule.DiversityRequestManager.getInstance().processFailoverSession(t,o,r):me.getInstance().getURL(t,o,r)})).then((function(e){return e.isError()&&(r.sessionReport.statusCode=e.getErrorCode()),r.sessionReport.redirectedURL=r.patchBkmResult(e.getURL()),r.handleRedirectedURL(o),e.url=r.sessionReport.redirectedURL,r.stopped?(P.d($e,"The session has been stopped while creating it.",r.id),r.stop(),e=pt.error(pt.RESULT_SESSION_HAS_BEEN_STOPPED_DURING_REQUEST),P.i($e,"getURL error code: "+e.getErrorMessage()+" (code "+e.getErrorCode()+", detail "+e.getDetailedErrorMessage()+")",r.id),P.i($e,"getURL result:",r.id),a(""),e):(P.i($e,"getURL status: "+e.getErrorMessage()+" (code "+e.getErrorCode()+", detail "+e.getDetailedErrorMessage()+")",r.id),P.i($e,"getURL result: "+r.sessionReport.redirectedURL,r.id),a(r.sessionReport.redirectedURL),e)}))}},{key:"handleRedirectedURL",value:function(t){var i;this.isNanoCDNUsed()&&(this.sessionReport.nanoCDNStatus=e.NANOCDN_STATUS_USED),0!==this.sessionReport.redirectedURL.length&&(this.sessionReport.sessionRunning=!0),this.sessionReport.sessionCreated=!0,this.sessionReport.sessionRunning&&(this.sessionReport.teardownActivated=this.isTeardownActivated(t)),this.sessionReport.redirectedURL=this.removeBroadpeakParameters(this.sessionReport.redirectedURL),this.sessionReport.sessionId=this.getTicket(),this.sessionReport.teardownActivated||null===(i=this.sessionReport.timeline)||void 0===i||i.encoder.extend(),this.notifyRedirectionEnd(),void 0===this.playerAdapter&&this.sessionReport.sessionRunning&&this.notifyFirstImage(0,0)}},{key:"stop",value:function(e){if(Ot.getInstance().removeListener(this.sessionReport.timeline),Ot.getInstance().removeListener(this),void 0===e||isNaN(e)||(this.sessionReport.statusCode=e),this.sessionReport.endSessionDate=Date.now(),this.notifyStop(this.sessionReport.statusCode),void 0!==this.keepAliveManager&&this.keepAliveManager.stop(),this.sessionReport.sessionCreated){P.d($e,"Session ends with status code: "+this.sessionReport.statusCode,this.id);var t=this.smartLib.getParameters();this.sessionReport.sessionRunning=!1,this.sessionReport.sessionCreated=!1;try{var i,n=null===(i=Jt.diversityModule)||void 0===i?void 0:i.DiversityManager.getInstance().getStats(this.sessionReport.sessionId,1);null!=n&&0!==n.length?this.sessionReport.diversity=JSON.parse(n):this.sessionReport.diversity={}}catch(e){P.w($e,"Invalid Diversity metrics",this.id)}this.sessionReport.smartLibParameters=JSON.parse(JSON.stringify(this.sessionReport.smartLibParameters)),this.sessionReport.customParameters=JSON.parse(JSON.stringify(this.getCustomParameters())),this.notifyEndSessionReportUpdateRequested(this.sessionReport),P.d($e,"SessionReport: "+this.sessionReport.toString(),this.id),this.resetCustomParameters();var r,a={analyticsAddress:t.analyticsAddress,userAgent:t.userAgent},s=this.options.get(ze.SESSION_TEARDOWN),o=this.options.get(ze.SESSION_REPORTING_MODE);if(s===ze.SESSION_ENABLED)this.sessionReport.teardownRequestDate=Date.now(),me.getInstance().teardown(this,a),o===ze.SESSION_REPORTING_MODE_METRICS_RECEIVER&&(this.sessionReport.endSessionRequestDate=Date.now(),null===(r=Jt.analyticsModule)||void 0===r||r.AnalyticsRequestManager.getInstance().endSession(this,a));else if(s===ze.SESSION_ENABLED_IF_BROADPEAK_DOMAIN){var u,l;this.sessionReport.teardownActivated?(this.sessionReport.teardownRequestDate=Date.now(),me.getInstance().teardown(this,a),o===ze.SESSION_REPORTING_MODE_METRICS_RECEIVER&&(this.sessionReport.endSessionRequestDate=Date.now(),null===(u=Jt.analyticsModule)||void 0===u||u.AnalyticsRequestManager.getInstance().endSession(this,a))):o!==ze.SESSION_REPORTING_MODE_DEFAULT&&o!==ze.SESSION_REPORTING_MODE_METRICS_RECEIVER||(this.sessionReport.endSessionRequestDate=Date.now(),null===(l=Jt.analyticsModule)||void 0===l||l.AnalyticsRequestManager.getInstance().endSession(this,a))}else if(s===ze.SESSION_DISABLED){var d;o!==ze.SESSION_REPORTING_MODE_DEFAULT&&o!==ze.SESSION_REPORTING_MODE_METRICS_RECEIVER||(this.sessionReport.endSessionRequestDate=Date.now(),null===(d=Jt.analyticsModule)||void 0===d||d.AnalyticsRequestManager.getInstance().endSession(this,a))}}void 0!==this.playerAdapter&&(this.playerAdapter.releaseSessionPlayerObjects(),this.playerAdapter.detachSession());for(var c=0,h=0;h<this.jobs.length;h++)!0===this.jobs[h].active&&c++,H.getInstance().interrupt(this.jobs[h]);P.d($e,c+" active job(s)",this.id),this.jobs=[],this.listeners=[],this.stopped=!0}},{key:"onFirstImage",value:function(e,t){if(!this.isSessionCreated(this.sessionReport.requestedURL)){var i=this.options.get(ze.SESSION_TEARDOWN),n=this.options.get(ze.SESSION_REPORTING_MODE),r=i===ze.SESSION_ENABLED_IF_BROADPEAK_DOMAIN&&!this.sessionReport.teardownActivated||i===ze.SESSION_DISABLED;if(n===ze.SESSION_REPORTING_MODE_DEFAULT&&r||n===ze.SESSION_REPORTING_MODE_METRICS_RECEIVER){var a;this.sessionReport.startSessionRequestDate=Date.now(),this.notifyStartSessionReportUpdateRequested(this.sessionReport);var s=this.smartLib.getParameters(),o={analyticsAddress:s.analyticsAddress,userAgent:s.userAgent};null===(a=Jt.analyticsModule)||void 0===a||a.AnalyticsRequestManager.getInstance().startSession(this,o)}}var u=this.options.get(ze.SESSION_KEEPALIVE);u===ze.SESSION_ENABLED?(P.i($e,"Keepalive is enabled (SESSION_KEEPALIVE=SESSION_ENABLED)",this.id),this.keepAliveManager=new je(this),this.keepAliveManager.start()):u===ze.SESSION_ENABLED_IF_BROADPEAK_DOMAIN?this.sessionReport.teardownActivated&&(this.keepAliveManager=new je(this),this.keepAliveManager.start()):u===ze.SESSION_DISABLED&&this.sessionReport.teardownActivated&&P.i($e,"Keepalive is disabled (SESSION_KEEPALIVE=SESSION_DISABLED)",this.id)}},{key:"isNanoCDNUsed",value:function(){var e,t=this,i=!1;return void 0!==Jt.nanoCDNModule&&("string"==typeof this.sessionReport.redirectedURL&&0!==this.sessionReport.redirectedURL.length&&(null===(e=this.smartLib.nanoCDNHostManager)||void 0===e?void 0:e.getNanoCDNDescrList()).forEach((function(e){t.sessionReport.redirectedURL.indexOf(e.hostIP)>0&&(i=!0)})),i)}},{key:"patchBkmResult",value:function(e){var t=O.parseURL(e);if(null!==t){var i=e,n=t.query.split("&");return n.length>=2&&-1===n[0].indexOf("bk-teardown=")&&(i=i.replace("?bk-teardown=","&bk-teardown=")),-1!==i.indexOf("//bpk-token")&&(i=i.replace("//bpk-token","/bpk-token")),i}return e}},{key:"getTicket",value:function(){var e,t="";if(void 0!==this.adTrackingManager&&!0===this.adTrackingManager.bkYouSession&&void 0!==this.adTrackingManager.bkYouSessionToken&&this.adTrackingManager.bkYouSessionToken.length>0&&(t=this.adTrackingManager.bkYouSessionToken),""===t&&(t=O.getParam(this.sessionReport.redirectedURL,me.QUERY_PARAMETER_SESSION_ID)),""===t&&(e=this.sessionReport.redirectedURL.split("/")).length>=4&&(e[3].match("\\[(.*)\\]")?t=e[3].substring(1,e[3].length-1):e[3].match("\\%5B(.*)\\%5D")&&(t=e[3].substring(3,e[3].length-3))),""===t){var i=this.sessionReport.redirectedURL.split("//");(e=i[i.length-1].split("/")).length>=3&&(e[0].match(O.REGEX_IP)||e[0].match(O.REGEX_HOSTNAME))&&"bpk-token"===e[1]&&(e[2].match(O.REGEX_TICKET)||e[2].match(O.REGEX_TICKET_TRANSCODED))&&(t=e[2],P.v($e,"Ticket detected: "+t,this.id))}if(""===t){var n=this.sessionReport.redirectedURL.split("//");(e=n[n.length-1].split("/")).length>=2&&(e[0].match(O.REGEX_IP)||e[0].match(O.REGEX_HOSTNAME))&&(e[1].match(O.REGEX_TICKET)||e[1].match(O.REGEX_TICKET_TRANSCODED))&&(t=e[1],P.v($e,"Ticket detected: "+t,this.id))}return""===t&&(t=this.generateTicket()),""===t&&(P.w($e,"Failed getting ticket",this.id),P.w($e,"SmartLib won't be able to post metrics",this.id)),t}},{key:"generateTicket",value:function(){var e=Date.now(),t=I.randomIntFromInterval(1e6,9999999),i=I.stringToBase64(t+e);return null===i?(P.w($e,"Cannot encode base 64 ticket",this.id),""):(P.v($e,"Ticket generated: "+i,this.id),i)}},{key:"getTeardown",value:function(){var e=O.getParam(this.sessionReport.redirectedURL,"bk-teardown");return e.startsWith("T")||e.startsWith("t")||e.startsWith("1")}},{key:"isTeardownActivated",value:function(t){if(t.forceTeardown===Jt.FORCE_TEARDOWN_ENABLED)return P.i($e,"Session will start with keepalives/teardown (forceTeardown)",this.id),!0;if(t.forceTeardown===Jt.FORCE_TEARDOWN_DISABLED)return P.i($e,"Session will start without keepalives/teardown (forceTeardown)",this.id),!1;if(null!==this.sessionReport.redirectedURL&&"0"===O.getParam(this.sessionReport.redirectedURL,"bk-teardown"))return P.i($e,"Session will start without keepalives/teardown (bk-teardown=0)",this.id),!1;if(null!==this.sessionReport.redirectedURL&&this.getTeardown())return P.i($e,"Session will start with keepalives/teardown (bk-teardown=1)",this.id),!0;if(this.sessionReport.nanoCDNStatus===e.NANOCDN_STATUS_USED)return P.i($e,"Session will start with keepalives/teardown (nanoCDN used)",this.id),!0;if(!1===this.options.get(ze.REQUEST_BROADPEAK_CDN))return P.i($e,"Session will start without keepalives/teardown (REQUEST_BROADPEAK_CDN=false)",this.id),!1;if(void 0===this.diversityFailoverSession){if(null!==this.sessionReport.requestedURL&&me.isBroadpeakDomainName(this.sessionReport.requestedURL,t.broadpeakDomainNames))return P.i($e,"Session will start with keepalives/teardown (in broadpeak domains list)",this.id),!0}else if(me.isBroadpeakDomainName(this.diversityFailoverSession.getMainURL(),t.broadpeakDomainNames))return P.i($e,"Diversity session will start with keepalives/teardown (in broadpeak domains list)",this.id),!0;return P.i($e,"Session will start without keepalives/teardown",this.id),!1}},{key:"removeBroadpeakParameters",value:function(e){var t=O.parseURL(e);if(null!==t){for(var i="",n=t.query.split("&"),r=1,a=0;a<n.length;a++){var s=n[a];s.startsWith("bk-")||s.startsWith("bpk-")?P.d($e,"Remove query parameter '"+s+"' from url",this.id):(r||(i+="&"),i+=s,r=0)}return""===i?e.replace("?"+t.query,""):e.replace(t.query,i)}return e}},{key:"isSessionCreated",value:function(e){if(null===e)return!1;var t=O.getParam(e,me.QUERY_PARAMETER_SESSION_ID);return 0!==t.length||(t=O.getParam(e,me.QUERY_PARAMETER_SESSION_CREATED)).startsWith("T")||t.startsWith("t")||t.startsWith("1")}},{key:"getCustomParameters",value:function(){return void 0!==this.streamingSession?this.streamingSession.customParameters:this.smartLib.getParameters().customParameters}},{key:"resetCustomParameters",value:function(){void 0!==this.streamingSession||this.smartLib.resetCustomParameters()}},{key:"addListener",value:function(e){void 0===e||this.listeners.includes(e)||this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}},{key:"notifyEvent",value:function(e,t,i,n){"function"==typeof e[t]&&e[t](i,n)}},{key:"notifyStart",value:function(){var e,t,i=this;e=Ot.getInstance().networkType,this.sessionReport.addNetworkType(e),t=Ot.getInstance().mute,this.listeners.forEach((function(n){i.notifyEvent(n,"onStart",e,t)}))}},{key:"notifyRedirectionEnd",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onRedirectionEnd")}))}},{key:"notifyFirstImage",value:function(e,t){var i=this;this.firstImageCalled?P.e($e,"Implementation error: PlayerEventListener.onSessionStart() already called. If you don't attach any player, please remove this call, SmartLib is now handling it automatically.",this.id):(this.firstImageCalled=!0,void 0!==this.adSession&&this.adSession.isAdActivated()?void 0!==this.playerAdapter?!0===this.playerAdapter.getCapabilities().adTracking?(P.d($e,"Ad tracking enabled",this.id),this.addListener(this.adTrackingManager)):P.d($e,"Ad tracking disabled (player not compatible)",this.id):P.d($e,"Ad tracking disabled (no player attached)",this.id):P.d($e,"Ad tracking disabled (advertising not activated)",this.id),this.listeners.forEach((function(n){i.notifyEvent(n,"onFirstImage",e,t)})))}},{key:"notifyLayerSwitch",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onLayerSwitch",e)}))}},{key:"notifyPause",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onPause")}))}},{key:"notifyResume",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onResume")}))}},{key:"notifyBufferingStart",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onBufferingStart")}))}},{key:"notifyBufferingEnd",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onBufferingEnd",e)}))}},{key:"notifyStallEnd",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onStallEnd")}))}},{key:"notifyRebufferingEnd",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onRebufferingEnd")}))}},{key:"notifySeek",value:function(e,t){var i=this;this.listeners.forEach((function(n){i.notifyEvent(n,"onSeek",e,t)}))}},{key:"notifyStop",value:function(e){var t,i,n=this;null===(t=this.adSession)||void 0===t||null===(i=t.adPalSession)||void 0===i||i.setAdView(void 0),this.listeners.forEach((function(t){n.notifyEvent(t,"onStop",e)}))}},{key:"notifyStartSessionReportUpdateRequested",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onStartSessionReportUpdateRequested",e)}))}},{key:"notifyKeepaliveSessionReportRequested",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onKeepaliveSessionReportUpdateRequested",e)}))}},{key:"notifyEndSessionReportUpdateRequested",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onEndSessionReportUpdateRequested",e)}))}},{key:"notifyVolumeChanged",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onVolumeChanged",e)}))}},{key:"notifyPlayerError",value:function(e,t){var i=this;this.listeners.forEach((function(n){i.notifyEvent(n,"onPlayerError",e,t)}))}},{key:"onNetworkAvailable",value:function(e){P.v($e,"Received event onNetworkAvailable type:"+e),this.sessionReport.addNetworkType(e)}}])&&Xe(t.prototype,i),n&&Xe(t,n),e}();function tt(e){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function it(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rt(e,t){return(rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function at(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ut(e);if(t){var r=ut(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return st(this,i)}}function st(e,t){return!t||"object"!==tt(t)&&"function"!=typeof t?ot(e):t}function ot(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e){return(ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Ze(et,"NANOCDN_STATUS_UNAVAILABLE",1),Ze(et,"NANOCDN_STATUS_DETECTED_NOT_USED",2),Ze(et,"NANOCDN_STATUS_USED",3);var dt="BpkProxySession",ct=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rt(e,t)}(a,e);var t,i,n,r=at(a);function a(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return it(this,a),lt(ot(t=r.call(this,e,i)),"startCalled",void 0),t.startCalled=!1,t}return t=a,(i=[{key:"getQuery",value:function(){var e,t=null===(e=this.smartLib.nanoCDNHostManager)||void 0===e?void 0:e.getCurrentNanoCDNDescr(),i=void 0!==t?"nanoCDN host: "+t.hostIP:"No nanoCDN found";P.i(dt,i+" ("+L+")"),this.initPlayerAdapter(),this.initManagers(),this.notifyStart();var n="bk-ml=1";return void 0!==t&&(n+="&nanocdnhost="+t.hostIP,this.sessionReport.nanoCDNStatus=et.NANOCDN_STATUS_DETECTED_NOT_USED),P.i(dt,"getQuery result : "+n),n}},{key:"start",value:function(e,t){if(this.startCalled)P.e(dt,"Implementation error: SmartLib.startStreamingSession(...) already called.");else{P.i(dt,"Starting streaming session..."),this.startCalled=!0,this.sessionReport.requestedURL=e,this.sessionReport.redirectedURL=t;var i=this.smartLib.getParameters(),n={broadpeakDomainNames:i.broadpeakDomainNames,forceTeardown:i.forceTeardown};this.handleRedirectedURL(n)}}}])&&nt(t.prototype,i),n&&nt(t,n),a}(et);function ht(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ft(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var pt=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";ht(this,e),vt(this,"url",void 0),vt(this,"diversityFailoverSession",void 0),vt(this,"errorCode",void 0),vt(this,"detailedErrorCode",void 0),vt(this,"detailedErrorMessage",void 0),this.url=t,this.errorCode=i,this.detailedErrorMessage=n.trim();var r=n.match("^([0-9]+).*");null!==r&&void 0!==r[1]?this.detailedErrorCode=parseInt(r[1],10):""===this.detailedErrorMessage?this.detailedErrorCode=e.RESULT_NO_DETAILED_ERROR:this.detailedErrorCode=e.RESULT_DETAILED_ERROR_PARSING_ERROR}var t,i,n;return t=e,n=[{key:"success",value:function(t){return new e(t,e.RESULT_NO_ERROR)}},{key:"error",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new e("",t,i)}},{key:"getErrorMessage",value:function(t){switch(t){case e.RESULT_NO_ERROR:return"Result success. A streaming session has been created.";case e.RESULT_NO_STREAMING_URL_FOUND:return"Request error. No streaming URL has been found. Default error when requesting the CDN (BkM/uCDN).";case e.RESULT_CDN_RESPONSE_UNREADABLE:return"Request error. The CDN response is unreadable (timeout error, CORS error, connection error).";case e.RESULT_REQUESTED_URL_NOT_FOUND_ON_CDN:return"Request error. Content not found on the CDN (error 4XX).";case e.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN:return"Request error. Content not found on the nanoCDN (error 404, timeout error, CORS error or connection error).";case e.RESULT_REQUESTED_URL_CDN_ERROR:return"Request error. The CDN returned an unknown error (error 5XX).";case e.RESULT_NANOCDN_SESSION_LIMIT_REACHED:return"nanoCDN error. All nanoCDN on the network responded with session limit reached error.";case e.RESULT_NANOCDN_SESSION_LIMIT_REACHED_ON_REQUESTED_CHANNEL:return"nanoCDN error. All nanoCDN on the network responded with session limit reached error for the requested channel.";case e.RESULT_NANOCDN_SERVICE_UNAVAILABLE:return"nanoCDN error. All nanoCDN on the network have their service unavailable.";case e.RESULT_NANOCDN_CHANNEL_UNAVAILABLE:return"nanoCDN error. The requested channel is unavailable on all nanoCDN of the network.";case e.RESULT_NANOCDN_REQUEST_LOCAL_IF_CONNECTED_TO_WIFI_NOT_ALLOWED:return"nanoCDN error. A nanoCDN on 127.0.0.1 has been found and is connected to Wi-Fi but it is not allowed.";case e.RESULT_API_PARAMETER_FORMAT_ERROR:return"Api error. A method parameter does not have the right format.";case e.RESULT_API_NOT_INITIALIZED:return"Api error. SmartLib init not called";case e.RESULT_SESSION_HAS_BEEN_STOPPED_DURING_REQUEST:return"Workflow error. The session has been stopped during request.";case e.RESULT_REQUEST_ALREADY_DONE:return"Workflow error. The request has already been done for that session."}return"No error message for the error code "+t}}],(i=[{key:"getURL",value:function(){return this.url}},{key:"getFallbackURLList",value:function(){return void 0!==this.diversityFailoverSession?this.diversityFailoverSession.getFallbackURLList():[]}},{key:"isError",value:function(){return this.errorCode!==e.RESULT_NO_ERROR}},{key:"getErrorCode",value:function(){return this.errorCode}},{key:"getErrorMessage",value:function(){return e.getErrorMessage(this.errorCode)}},{key:"getDetailedErrorCode",value:function(){return this.detailedErrorCode}},{key:"getDetailedErrorMessage",value:function(){return this.detailedErrorMessage}}])&&ft(t.prototype,i),n&&ft(t,n),e}();function yt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}vt(pt,"RESULT_NO_ERROR",0),vt(pt,"RESULT_NO_STREAMING_URL_FOUND",3100),vt(pt,"RESULT_CDN_RESPONSE_UNREADABLE",3101),vt(pt,"RESULT_REQUESTED_URL_NOT_FOUND_ON_CDN",3102),vt(pt,"RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN",3103),vt(pt,"RESULT_REQUESTED_URL_CDN_ERROR",3104),vt(pt,"RESULT_NANOCDN_SESSION_LIMIT_REACHED",3201),vt(pt,"RESULT_NANOCDN_SESSION_LIMIT_REACHED_ON_REQUESTED_CHANNEL",3202),vt(pt,"RESULT_NANOCDN_SERVICE_UNAVAILABLE",3203),vt(pt,"RESULT_NANOCDN_CHANNEL_UNAVAILABLE",3204),vt(pt,"RESULT_NANOCDN_REQUEST_LOCAL_IF_CONNECTED_TO_WIFI_NOT_ALLOWED",3205),vt(pt,"RESULT_NANOCDN_RESPONSE_UNREADABLE",3206),vt(pt,"RESULT_API_PARAMETER_FORMAT_ERROR",3400),vt(pt,"RESULT_API_NOT_INITIALIZED",3401),vt(pt,"RESULT_SESSION_HAS_BEEN_STOPPED_DURING_REQUEST",3500),vt(pt,"RESULT_REQUEST_ALREADY_DONE",3501),vt(pt,"RESULT_NO_DETAILED_ERROR",0),vt(pt,"RESULT_DETAILED_ERROR_PARSING_ERROR",-1);var Et="BpkStreamingSession",St=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),gt(this,"smartLib",void 0),gt(this,"options",void 0),gt(this,"customParameters",void 0),gt(this,"adSession",void 0),gt(this,"id",void 0),gt(this,"date",void 0),gt(this,"handler",void 0),gt(this,"playerAdapter",void 0),gt(this,"stopped",void 0),this.smartLib=t,this.options=i,this.customParameters={},this.id=I.randomIntFromInterval(1e4,99999),this.date=Date.now(),this.stopped=!1}var t,i,n;return t=e,(i=[{key:"attachPlayer",value:function(e,t){void 0!==e?void 0===this.handler?(this.playerAdapter=e,P.i(Et,"Player "+this.playerAdapter.getName()+" attached",this.id)):P.e(Et,"Exception: attachPlayer error, you cannot attach a player when a session is running.",this.id):void 0===Jt.analyticsModule?P.w(Et,"Try to attach a player, but analytics module not loaded",this.id):P.w(Et,"Try to attach a player, but it is not recognized",this.id)}},{key:"setOption",value:function(e,t){void 0===this.handler?(P.d(Et,"Setting session option "+ze.optionToString(e)+" to "+ze.valueToString(e,t),this.id),this.options.set(e,t)):P.e(Et,"Exception: setOption error, you cannot set an option when a session is running.",this.id)}},{key:"setAdEventsListener",value:function(e){void 0===this.adSession&&(this.adSession=new oe(this.smartLib)),this.adSession.setAdEventsListener(e)}},{key:"activateAdvertising",value:function(){void 0===this.adSession&&(this.adSession=new oe(this.smartLib)),this.adSession.activateAdvertising()}},{key:"setAdParameter",value:function(e,t){void 0===this.adSession&&(this.adSession=new oe(this.smartLib)),this.adSession.setAdParameter(e,t)}},{key:"setAdView",value:function(e){var t,i,n;void 0===this.adSession&&(this.adSession=new oe(this.smartLib)),this.adSession.adView=e,null===(t=this.handler)||void 0===t||null===(i=t.omSessionHandler)||void 0===i||null===(n=i.omAdSession)||void 0===n||n.setAdView(e)}},{key:"setAdViewState",value:function(e){var t,i,n;void 0===this.adSession&&(this.adSession=new oe(this.smartLib)),!0===ee.isAdViewState(e)?(this.adSession.adViewState=e,null===(t=this.handler)||void 0===t||null===(i=t.omSessionHandler)||void 0===i||null===(n=i.omAdSession)||void 0===n||n.setAdViewState(e)):P.e(Et,"Please use a defined state within the AdViewState enum.",this.id)}},{key:"registerAdFriendlyObstructionView",value:function(e,t,i){var n,r,a;void 0===this.adSession&&(this.adSession=new oe(this.smartLib)),te.isAdFriendlyObstructionPurpose(t)&&"string"==typeof i?(this.adSession.adFriendlyObstructionViews.push({view:e,purpose:t,reason:i}),null===(n=this.handler)||void 0===n||null===(r=n.omSessionHandler)||void 0===r||null===(a=r.omAdSession)||void 0===a||a.registerAdFriendlyObstructionView(e,t,i)):P.e(Et,"Ad friendly objection view not registered, please check arguments types: purpose -> state within the AdFriendlyObstructionPurpose enum, reason -> string",this.id)}},{key:"unregisterFriendlyObstruction",value:function(e){var t,i,n;void 0!==this.adSession&&(this.adSession.adFriendlyObstructionViews=this.adSession.adFriendlyObstructionViews.filter((function(t){return t.view!==e})),null===(t=this.handler)||void 0===t||null===(i=t.omSessionHandler)||void 0===i||null===(n=i.omAdSession)||void 0===n||n.unregisterFriendlyObstruction(e))}},{key:"unregisterAllFriendlyObstructions",value:function(){var e,t,i;void 0!==this.adSession&&(this.adSession.adFriendlyObstructionViews=[],null===(e=this.handler)||void 0===e||null===(t=e.omSessionHandler)||void 0===t||null===(i=t.omAdSession)||void 0===i||i.unregisterAllFriendlyObstructions())}},{key:"setAdCustomReference",value:function(e){var t,i;void 0===this.adSession&&(this.adSession=new oe(this.smartLib)),"string"==typeof e?(this.adSession.adCustomReference=e,void 0!==(null===(t=this.handler)||void 0===t||null===(i=t.omSessionHandler)||void 0===i?void 0:i.omAdSession)&&P.w(Et,'An ad is already playing, the ad custom reference "'+e+'" will be set for the next ad',this.id)):P.e(Et,"Ad custom reference not set, reference argument has to be a string",this.id)}},{key:"registerAdVerificationData",value:function(e){var t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;void 0===this.adSession&&(this.adSession=new oe(this.smartLib));var a={verificationVendor:n,verificationURL:e,verificationParameters:r};this.adSession.adVerificationData.push(a),void 0!==(null===(t=this.handler)||void 0===t||null===(i=t.omSessionHandler)||void 0===i?void 0:i.omAdSession)&&P.w(Et,'An ad is already playing, the ad verification data "'+JSON.stringify(a)+'" will be set for the next ad',this.id)}},{key:"adUserInteraction",value:function(e){var t,i,n,r,a;void 0===this.adSession&&(this.adSession=new oe(this.smartLib)),"string"==typeof e?(P.d(Et,"Ad interaction: "+e,this.id),null===(t=this.handler)||void 0===t||null===(i=t.adTrackingManager)||void 0===i||i.adUserInteraction(e),null===(n=this.adSession.adPalSession)||void 0===n||n.sendAdClick(),void 0!==(null===(r=this.handler)||void 0===r||null===(a=r.omSessionHandler)||void 0===a?void 0:a.omAdSession)&&this.handler.omSessionHandler.omAdSession.adUserInteraction(e)):P.e(Et,"Ad interaction type not triggered, interactionType argument has to be a string",this.id)}},{key:"adTouch",value:function(e){var t;void 0===this.adSession&&(this.adSession=new oe(this.smartLib)),P.d(Et,"Ad touch",this.id),null===(t=this.adSession.adPalSession)||void 0===t||t.sendTouch(e)}},{key:"setCustomParameter",value:function(e,t){"string"==typeof e&&"string"==typeof t?this.customParameters[e]=De.toBkAString(t):P.e(Et,"Error: Only string values are accepted for custom parameters",this.id)}},{key:"setEventCallbackEnabled",value:function(e){void 0===this.adSession&&(this.adSession=new oe(this.smartLib)),this.adSession.setEventCallbackEnabled(e)}},{key:"getURL",value:function(e){return P.i(Et,"getURL with "+e,this.id),void 0===this.handler?De.typeParameter(e,"string","Error: requestedURL should be a string")&&De.stringNonEmpty(e,"Error: requestedURL is empty")?(this.handler=this.smartLib.sessionManager.createSessionHandler(this),this.handler.adSession=this.adSession,void 0!==this.adSession&&(this.adSession.session=this.handler),this.handler.start(e)):Promise.resolve(pt.error(pt.RESULT_API_PARAMETER_FORMAT_ERROR)):(P.e(Et,"Exception: getURL error, the session is already running.",this.id),Promise.resolve(pt.error(pt.RESULT_REQUEST_ALREADY_DONE)))}},{key:"getQuery",value:function(){return P.i(Et,"getQuery",this.id),void 0===this.handler?(this.handler=this.smartLib.sessionManager.createProxySessionHandler(this),this.handler.getQuery()):(P.e(Et,"Exception: getQuery error, the session is already running.",this.id),"")}},{key:"startStreamingSession",value:function(e,t){return P.i(Et,"startStreamingSession with "+e+" and "+t,this.id),!(!De.typeParameter(e,"string","Error: requestedURL should be a string")||!De.typeParameter(t,"string","Error: redirectedURL should be a string")||(void 0===this.handler?(P.e(Et,"Exception: startSteamingSession error, getQuery() should be called prior to startStreamingSession(...)"),1):this.handler instanceof ct?(this.handler.start(e,t),0):(P.e(Et,"Exception: startSteamingSession error, startStreamingSession(...) cannot be called once getURL(...) has been called"),1)))}},{key:"stopStreamingSession",value:function(e){return void 0!==e?P.i(Et,"Stopping streaming session with statusCode "+e+"...",this.id):P.i(Et,"Stopping streaming session...",this.id),void 0!==this.handler&&this.handler.stop(e),void 0!==this.playerAdapter&&this.playerAdapter.detachPlayer(),this.stopped=!0,this.handler}}])&&yt(t.prototype,i),n&&yt(t,n),e}();function bt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function kt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var mt="BpkSessionMgr",_t=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),kt(this,"smartLib",void 0),kt(this,"sessions",void 0)}var t,i,n;return t=e,(i=[{key:"init",value:function(e){this.smartLib=e,this.sessions=[]}},{key:"createStreamingSession",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.cleanFinishedSessions();var i=new St(this.smartLib,ze.create(e,t));return this.sessions.push(i),this.sessions.length>10&&P.w(mt,"There are "+this.sessions.length+" active sessions. Use session.stopStreamingSession() to free up memory."),i}},{key:"cleanFinishedSessions",value:function(){for(var t=this.sessions.length-1;t>=0;t--){var i,n,r=this.sessions[t];void 0===r.handler&&Date.now()-r.date>e.UNSTARTED_SESSION_MAX_DURATION?(null===(n=r.playerAdapter)||void 0===n||n.detachPlayer(),this.sessions.splice(t,1)):(!0===(null===(i=r.handler)||void 0===i?void 0:i.stopped)||!0===r.stopped)&&this.sessions.splice(t,1)}}},{key:"createSessionHandler",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=new et(this.smartLib,e);return void 0!==e?(t.id=e.id,t.options=e.options,t.playerAdapter=e.playerAdapter):(t.id="main-"+I.randomIntFromInterval(10,99),t.options=new ze),t}},{key:"createProxySessionHandler",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=new ct(this.smartLib,e);return void 0!==e?(t.id=e.id,t.options=e.options,t.playerAdapter=e.playerAdapter):(t.id="main-"+I.randomIntFromInterval(10,99),t.options=new ze),t}},{key:"release",value:function(){this.cleanFinishedSessions(),this.sessions.forEach((function(e){e.stopStreamingSession()})),this.sessions=[]}}])&&bt(t.prototype,i),n&&bt(t,n),e}();function At(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Nt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Rt(e,t,i,n){return Tt(e,t),Pt(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n),n}function Dt(e,t,i){return Tt(e,t),Pt(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}function Pt(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Tt(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}kt(_t,"UNSTARTED_SESSION_MAX_DURATION",36e4);var wt="BpkAppStateMgr",Ot=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Nt(this,"smartLib",void 0),Nt(this,"listeners",void 0),Nt(this,"bound",void 0),Nt(this,"networkAvailable",void 0),Nt(this,"appInBackground",void 0),Nt(this,"networkType",99),Nt(this,"mute",0),this.bound=!1,this.release()}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){return Dt(e,e,Lt)||Rt(e,e,Lt,new e),Dt(e,e,Lt)}}],(i=[{key:"init",value:function(e){P.d(wt,"Initializing core app state manager..."),this.smartLib=e,!1===this.bound?(this.networkAvailable=!0,this.appInBackground=!1):P.d(wt,"Core app state manager is bound to the target, skipping default values..."),this.release()}},{key:"release",value:function(){this.listeners=[]}},{key:"bind",value:function(){this.bound=!0}},{key:"isConnectedToWifi",value:function(){return this.networkType>=10&&this.networkType<=12}},{key:"addListener",value:function(e){void 0===e||this.listeners.includes(e)||this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}},{key:"notifyEvent",value:function(e,t,i,n){"function"==typeof e[t]&&e[t](i,n)}},{key:"notifyForeground",value:function(){var e=this;P.d(wt,"App is in foreground"),this.appInBackground=!1,this.listeners.forEach((function(t){e.notifyEvent(t,"onForeground")}))}},{key:"notifyBackground",value:function(){var e=this;P.d(wt,"App is in background"),this.appInBackground=!0,this.listeners.forEach((function(t){e.notifyEvent(t,"onBackground")}))}},{key:"notifyNetworkAvailable",value:function(e){var t=this;void 0===e?(P.d(wt,"Network is available (networkType:"+e+")"),this.networkAvailable=!0,this.listeners.forEach((function(e){t.notifyEvent(e,"onNetworkAvailable",99)}))):this.networkType!==e&&(P.d(wt,"Network is available (networkType:"+e+")"),this.networkAvailable=!0,this.networkType=e,this.listeners.forEach((function(i){t.notifyEvent(i,"onNetworkAvailable",e)})))}},{key:"notifyNetworkLost",value:function(){var e=this;!1!==this.networkAvailable&&(P.d(wt,"Network is unavailable"),this.networkAvailable=!1,this.networkType=0,this.listeners.forEach((function(t){e.notifyEvent(t,"onNetworkLost")})))}},{key:"notifyMute",value:function(){var e=this;P.d(wt,"Volume is muted"),this.mute=1,this.listeners.forEach((function(t){e.notifyEvent(t,"onMute")}))}},{key:"notifyUnmute",value:function(){var e=this;P.d(wt,"Volume is unmuted"),this.mute=0,this.listeners.forEach((function(t){e.notifyEvent(t,"onUnmute")}))}}])&&At(t.prototype,i),n&&At(t,n),e}(),Lt={writable:!0,value:void 0};function Ct(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function It(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Mt(e,t){return Gt(e,Ut(e,t,"get"))}function Bt(e,t,i){return jt(e,Ut(e,t,"set"),i),i}function Ut(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function jt(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function Ft(e,t,i){return xt(e,t),Vt(i,"get"),Gt(e,i)}function Vt(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function xt(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function Gt(e,t){return t.get?t.get.call(e):t.value}var Ht="BpkSmartLib",Wt=new WeakMap,qt=new WeakMap,Yt=new WeakMap,Kt=new WeakMap,Qt=new WeakMap,zt=new WeakMap,Jt=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Wt.set(this,{writable:!0,value:void 0}),qt.set(this,{writable:!0,value:void 0}),Yt.set(this,{writable:!0,value:void 0}),It(this,"sessionManager",void 0),It(this,"nanoCDNHostManager",void 0),It(this,"adManager",void 0),It(this,"internalAdManager",void 0),It(this,"session",void 0),It(this,"nanoCDNReceiver",void 0),Kt.set(this,{writable:!0,value:function(e){null!=e&&0!==e.length?Mt(t,qt).analyticsAddress=e:Mt(t,qt).analyticsAddress=""}}),Qt.set(this,{writable:!0,value:function(i){null!=i&&0!==i.length?(void 0===e.nanoCDNModule&&P.w(Ht,"Warning: nanoCDNHost is set while the module is not loaded."),Mt(t,qt).nanoCDNHost=i.replace(/\s/g,"")):Mt(t,qt).nanoCDNHost=""}}),zt.set(this,{writable:!0,value:function(e){null!=e&&0!==e.length?Mt(t,qt).broadpeakDomainNames=e.replace(/\s/g,""):Mt(t,qt).broadpeakDomainNames=""}}),Bt(this,Wt,!1),Bt(this,qt,{analyticsAddress:"",nanoCDNHost:"",broadpeakDomainNames:"",forceTeardown:e.FORCE_TEARDOWN_DEFAULT,uuid:"",userAgent:void 0,deviceType:"",customParameters:{}}),Bt(this,Yt,new ze),this.sessionManager=new _t,this.adManager=new ne,this.internalAdManager=new ce}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){var t,i,n,r;return Ft(e,e,Xt)||(t=e,i=e,n=Xt,r=new e,xt(t,i),Vt(n,"set"),jt(t,n,r)),Ft(e,e,Xt)}}],(i=[{key:"init",value:function(t,i,n,r){var a,s,o,u,l;return P.i(Ht,"Init SmartLib..."),P.i(Ht,"Version: "+L),Mt(this,Wt)?(P.e(Ht,"Error: SmartLib already initialized, please use SmartLib.release() before initializing."),!1):void 0!==r?(P.e(Ht,"Error: this init method has been removed, please use SmartLib.init(analyticsAddress, nanoCDNHost, broadpeakDomainNames) instead."),!1):De.typeOrNullParameter(t,"string","Error: analyticsAddress should be a string or null")&&De.typeOrNullParameter(i,"string","Error: nanoCDNHost should be a string or null")&&De.typeOrNullParameter(n,"string","Error: broadpeakDomainNames should be a string or null")?(Mt(this,Kt).call(this,t),Mt(this,Qt).call(this,i),Mt(this,zt).call(this,n),this.setForceTeardown(e.FORCE_TEARDOWN_DEFAULT),Bt(this,Yt,new ze),P.i(Ht,"Parameters:analyticsAddress="+t+", nanoCDNHost="+i+", broadpeakDomainNames="+n),void 0!==e.nanoCDNModule&&void 0===this.nanoCDNHostManager&&(this.nanoCDNHostManager=new e.nanoCDNModule.NanoCDNHostManager),void 0!==this.nanoCDNReceiver&&void 0!==this.nanoCDNHostManager&&(this.nanoCDNHostManager.registerNanoCDNReceiver(this.nanoCDNReceiver),this.nanoCDNReceiver=void 0),this.sessionManager.init(this),null===(a=this.nanoCDNHostManager)||void 0===a||a.init(this,i),this.adManager.init(this),this.internalAdManager.init(this),me.getInstance().attachInstance(this),null===(s=e.analyticsModule)||void 0===s||s.PlayerManager.getInstance().attachInstance(this),null===(o=e.nanoCDNModule)||void 0===o||o.MdnsManager.getInstance().attachInstance(this),null===(u=e.diversityModule)||void 0===u||u.DiversityManager.getInstance().attachInstance(this),null===(l=e.adModule)||void 0===l||l.OMSDKManager.getInstance().attachInstance(this),Ot.getInstance().init(this),Ot.getInstance().addListener(this.nanoCDNHostManager),Bt(this,Wt,!0),!0):(P.e(Ht,"Error: initialization aborted"),!1)}},{key:"getURL",value:function(t,i){var n,r,a;return void 0!==this.session&&(P.e(Ht,"Exception: A session is already running, please use SmartLib.stopStreamingSession(...) before. Stopping the current one...",this.session.id),this.stopStreamingSession()),P.i(Ht,"getURL with "+t,null===(n=this.session)||void 0===n?void 0:n.id),void 0===i&&(i=function(){}),De.typeParameter(i,"function","Error: callback should be a function")?Mt(this,Wt)?De.typeParameter(t,"string","Error: requestedURL should be a string")&&De.stringNonEmpty(t,"Error: requestedURL is empty")?(this.session=this.sessionManager.createSessionHandler(),this.session.options=ze.create(Mt(this,Yt)),this.session.playerAdapter=null===(r=e.analyticsModule)||void 0===r?void 0:r.PlayerManager.getInstance().getPlayerAdapter(),this.session.adSession=this.internalAdManager.adSession,void 0!==this.internalAdManager.adSession&&(this.internalAdManager.adSession.session=this.session),this.internalAdManager.adSession=new oe,this.internalAdManager.adSession.setEventCallbackEnabled(this.internalAdManager.eventCallbackEnabled),this.internalAdManager.adSession.setAdEventsListener(this.internalAdManager.adEventsListener),this.session.start(t,i)):(i(""),Promise.resolve("")):(P.e(Ht,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.getURL(...)",null===(a=this.session)||void 0===a?void 0:a.id),i(""),Promise.resolve("")):Promise.resolve("")}},{key:"getQuery",value:function(){var t;return void 0!==this.session&&(P.e(Ht,"Exception: A session is already running, please use SmartLib.stopStreamingSession(...) before. Stopping the current one..."),this.stopStreamingSession()),P.i(Ht,"getQuery"),Mt(this,Wt)?(this.session=this.sessionManager.createProxySessionHandler(),this.session.options=ze.create(Mt(this,Yt)),this.session.playerAdapter=null===(t=e.analyticsModule)||void 0===t?void 0:t.PlayerManager.getInstance().getPlayerAdapter(),this.session.getQuery()):(P.e(Ht,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.getQuery(...)"),"")}},{key:"startStreamingSession",value:function(e,t){var i,n,r,a;return P.i(Ht,"startStreamingSession with "+e+" and "+t,null===(i=this.session)||void 0===i?void 0:i.id),Mt(this,Wt)?!(!De.typeParameter(e,"string","Error: contentURL should be a string")||!De.typeParameter(t,"string","Error: redirectedURL should be a string")||(void 0===this.session?(P.e(Ht,"Exception: Implementation error, SmartLib.getQuery() should be called prior to SmartLib.startStreamingSession(...)",null===(r=this.session)||void 0===r?void 0:r.id),1):this.session instanceof ct?(this.session.start(e,t),0):(P.e(Ht,"Exception: Implementation error, SmartLib.startStreamingSession(...) cannot be called with SmartLib.getURL(...)",null===(a=this.session)||void 0===a?void 0:a.id),1))):(P.e(Ht,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.startStreamingSession(...)",null===(n=this.session)||void 0===n?void 0:n.id),!1)}},{key:"stopStreamingSession",value:function(e){var t,i;void 0!==e?P.i(Ht,"Stopping streaming session with statusCode "+e+"...",null===(t=this.session)||void 0===t?void 0:t.id):P.i(Ht,"Stopping streaming session...",null===(i=this.session)||void 0===i?void 0:i.id);var n=this.session;return void 0!==this.session?(this.session.stop(e),this.session=void 0):P.d(Ht,"Stopping streaming session aborted, no session started"),n}},{key:"createStreamingSession",value:function(e){if(Mt(this,Wt)){var t=void 0===e;t&&(e=Mt(this,Yt));var i=this.sessionManager.createStreamingSession(Mt(this,Yt),e);return t?P.i(Ht,"Creating streaming session...",i.id):(P.i(Ht,"Creating streaming session with options...",i.id),e.printUpdates(Ht,"",i.id)),i}P.e(Ht,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.createStreamingSession(...)")}},{key:"release",value:function(){var t,i,n,r,a;Mt(this,Wt)&&(P.i(Ht,"Releasing SmartLib..."),this.stopStreamingSession(),this.internalAdManager.release(),this.adManager.release(),null===(t=this.nanoCDNHostManager)||void 0===t||t.release(),this.sessionManager.release(),Ot.getInstance().release(),null===(i=e.diversityModule)||void 0===i||i.DiversityManager.getInstance().release(),null===(n=e.nanoCDNModule)||void 0===n||n.MdnsManager.getInstance().release(),null===(r=e.analyticsModule)||void 0===r||r.PlayerManager.getInstance().release(),me.getInstance().release(),null===(a=e.adModule)||void 0===a||a.OMSDKManager.getInstance().release(this),Bt(this,Wt,!1))}},{key:"attachPlayer",value:function(t,i){var n,r,a;void 0!==t?(null===(n=e.analyticsModule)||void 0===n||n.PlayerManager.getInstance().setPlayerAdapter(t),void 0!==this.session&&P.e(Ht,"Exception: You cannot attach a player when a session is running, this player will be used for the next session.",this.session.id)):void 0===e.analyticsModule?P.w(Ht,"Try to attach a player, but analytics module not loaded",null===(r=this.session)||void 0===r?void 0:r.id):P.w(Ht,"Try to attach a player, but it is not recognized",null===(a=this.session)||void 0===a?void 0:a.id)}},{key:"detachPlayer",value:function(){var t;return void 0!==this.session?(P.e(Ht,"Exception: You cannot detach the player when a session is running",this.session.id),!1):(null===(t=e.analyticsModule)||void 0===t||t.PlayerManager.getInstance().setPlayerAdapter(void 0),!0)}},{key:"getMetricsManager",value:function(){if(void 0!==this.session)return this.session.metricsManager}},{key:"getListener",value:function(){var t;return null===(t=e.analyticsModule)||void 0===t?void 0:t.PlayerManager.getInstance().getPlayerAdapter()}},{key:"getVersion",value:function(){return L}},{key:"getParameters",value:function(){return Mt(this,qt)}},{key:"setUUID",value:function(e){De.typeParameter(e,"string","Error: uuid should be a string")&&(e.length>32?Mt(this,qt).uuid=e.substring(0,32):Mt(this,qt).uuid=e)}},{key:"setUserAgent",value:function(e){De.typeOrUndefinedParameter(e,"string","Error: userAgent should be a string")&&(Mt(this,qt).userAgent=e)}},{key:"setDeviceType",value:function(e){De.typeParameter(e,"string","Error: deviceType should be a string")&&(Mt(this,qt).deviceType=e)}},{key:"setCustomParameter",value:function(e,t){"string"==typeof e&&"string"==typeof t?Mt(this,qt).customParameters[e]=De.toBkAString(t):P.e(Ht,"Error: Only string values are accepted for custom parameters")}},{key:"resetCustomParameters",value:function(){Mt(this,qt).customParameters={}}},{key:"setForceTeardown",value:function(t){"number"==typeof t?Mt(this,qt).forceTeardown=t>=1?e.FORCE_TEARDOWN_ENABLED:t<=-1?e.FORCE_TEARDOWN_DISABLED:e.FORCE_TEARDOWN_DEFAULT:P.e(Ht,"Exception: parameter forceTeardown must be SmartLib.FORCE_TEARDOWN_DISABLED, SmartLib.FORCE_TEARDOWN_DEFAULT or SmartLib.FORCE_TEARDOWN_ENABLED")}},{key:"setNanoCDNResolvingRetryDelay",value:function(e){var t;void 0!==this.nanoCDNHostManager?(P.v(Ht,"Updating nanoCDN resolving retry asyncDelay to "+e+"ms"),null===(t=this.nanoCDNHostManager)||void 0===t||t.setNanoCDNResolvingRetryDelay(e)):P.e(Ht,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.setNanoCDNResolvingRetryDelay(...)")}},{key:"registerNanoCDNReceiver",value:function(e){void 0!==this.nanoCDNHostManager?(this.nanoCDNReceiver=void 0,this.nanoCDNHostManager.registerNanoCDNReceiver(e)):this.nanoCDNReceiver=e}},{key:"setOption",value:function(e,t){P.d(Ht,"Setting global option "+ze.optionToString(e)+" to "+ze.valueToString(e,t)),Mt(this,Yt).set(e,t)}}])&&Ct(t.prototype,i),n&&Ct(t,n),e}(),Xt={writable:!0,value:void 0};function Zt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}It(Jt,"FORCE_TEARDOWN_DISABLED",-1),It(Jt,"FORCE_TEARDOWN_DEFAULT",0),It(Jt,"FORCE_TEARDOWN_ENABLED",1),It(Jt,"BPSessionEndsNormally",200),It(Jt,"BPFormatNotSupportedError",3001),It(Jt,"BPDecodingError",3002),It(Jt,"BPNetworkingError",3003),It(Jt,"BPAccessRightError",3004),It(Jt,"BPUnspecifiedError",3005),It(Jt,"analyticsModule",void 0),It(Jt,"adModule",void 0),It(Jt,"nanoCDNModule",void 0),It(Jt,"diversityModule",void 0);var $t="BpkAdPalMgr",ei=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,(i=[{key:"setConsentSettings",value:function(e){P.e($t,"setConsentSettings not implemented")}},{key:"registerPalManagerCallback",value:function(e){P.e($t,"registerPalManagerCallback not implemented")}},{key:"unregisterPalManagerCallback",value:function(){P.e($t,"unregisterPalManagerCallback not implemented")}},{key:"generateAdPalSession",value:function(e){P.e($t,"generateAdPalSession not implemented")}},{key:"reset",value:function(){P.e($t,"reset not implemented")}},{key:"release",value:function(){}},{key:"setValue",value:function(e,t,i){P.e($t,"setValue not implemented")}},{key:"setDescriptionURL",value:function(e){this.setValue("setDescriptionURL",e)}},{key:"setOmidPartner",value:function(e,t){this.setValue("setOmidPartner",e,t)}},{key:"setOmidVersion",value:function(e){this.setValue("setOmidVersion",e)}},{key:"setPlayerType",value:function(e){this.setValue("setPlayerType",e)}},{key:"setPlayerVersion",value:function(e){this.setValue("setPlayerVersion",e)}},{key:"setPpid",value:function(e){this.setValue("setPpid",e)}},{key:"setVideoPlayerHeight",value:function(e){this.setValue("setVideoPlayerHeight",e)}},{key:"setVideoPlayerWidth",value:function(e){this.setValue("setVideoPlayerWidth",e)}},{key:"setWillAdAutoPlay",value:function(e){this.setValue("setWillAdAutoPlay",e)}},{key:"setWillAdPlayMuted",value:function(e){this.setValue("setWillAdPlayMuted",e)}}])&&Zt(t.prototype,i),n&&Zt(t,n),e}();function ti(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ii="BpkAdPalSession",ni=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,(i=[{key:"getNonce",value:function(){return P.e(ii,"getNonce not implemented"),""}},{key:"sendAdClick",value:function(){P.e(ii,"sendAdClick not implemented")}},{key:"sendAdImpression",value:function(){P.e(ii,"sendAdImpression not implemented")}},{key:"sendTouch",value:function(e){P.e(ii,"sendTouch not implemented")}},{key:"setAdView",value:function(e){}}])&&ti(t.prototype,i),n&&ti(t,n),e}();function ri(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ai=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"formatDate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t="";e<0&&(e*=-1,t="-");var i=e.getDate()<=9?"0"+e.getDate():e.getDate(),n=e.getMonth()+1<=9?"0"+(e.getMonth()+1):e.getMonth()+1,r=e.getHours()<=9?"0"+e.getHours():e.getHours(),a=e.getMinutes()<=9?"0"+e.getMinutes():e.getMinutes(),s=e.getSeconds()<=9?"0"+e.getSeconds():e.getSeconds(),o=String(e.getMilliseconds());return 1===o.length?o="00"+o:2===o.length&&(o="0"+o),t+n+"-"+i+" "+r+":"+a+":"+s+"."+o}},{key:"formatTime",value:function(e){var t="";e<0&&(e*=-1,t="-");var i=e%1e3,n=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),a=Math.floor(e/36e5%24),s=a<=9?"0"+a:a,o=r<=9?"0"+r:r,u=n<=9?"0"+n:n,l=String(i);return 1===l.length?l="00"+l:2===l.length&&(l="0"+l),t+s+":"+o+":"+u+"."+l}}],(i=null)&&ri(t.prototype,i),n&&ri(t,n),e}();function si(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var oi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,(i=[{key:"log",value:function(e,t,i){var n=ai.formatDate();switch(e){case 0:console.log(n+" V/"+t+": "+i);break;case 1:console.log(n+" D/"+t+": "+i);break;case 2:console.log(n+" I/"+t+": "+i);break;case 3:console.log(n+" W/"+t+": "+i);break;case 4:console.log(n+" E/"+t+": "+i);break;default:console.log(n+" ?/"+t+": "+i)}}}])&&si(t.prototype,i),n&&si(t,n),e}();function ui(e){return(ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function li(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var di=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,(i=[{key:"get",value:function(e,t,i,n){var r=new XMLHttpRequest,a=!1,s={};for(var o in r.onreadystatechange=function(){r.readyState===r.DONE&&(r.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((function(e){var t=e.split(": "),i=t.shift().toLowerCase();s[i]=t.join(": ")})),r.status>=200&&r.status<300?n({body:r.responseText,headers:s,statusCode:r.status,message:r.statusText}):0!==r.status&&n({body:"",headers:s,statusCode:r.status,message:r.statusText}))},r.onerror=function(){a||n({body:"",headers:s,statusCode:r.status,message:r.statusText})},r.ontimeout=function(){n({body:"",headers:s,statusCode:r.status,message:r.statusText})},r.open("GET",e,!0),r.timeout=i,this.deleteUnsafeHeaders(t),t)r.setRequestHeader(o,t[o]);r.send(),setTimeout((function(){r.readyState!==r.DONE&&(a=!0,r.abort(),n({body:"",headers:s,statusCode:r.status,message:r.statusText}))}),i+100)}},{key:"post",value:function(e,t,i,n,r){var a=new XMLHttpRequest,s=!1,o={};for(var u in a.onreadystatechange=function(){a.readyState===a.DONE&&(a.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((function(e){var t=e.split(": "),i=t.shift().toLowerCase();o[i]=t.join(": ")})),a.status>=200&&a.status<300?r({body:a.responseText,headers:o,statusCode:a.status,message:a.statusText}):0!==a.status&&r({body:"",headers:o,statusCode:a.status,message:a.statusText}))},a.onerror=function(){s||r({body:"",headers:o,statusCode:a.status,message:a.statusText})},a.ontimeout=function(){r({body:"",headers:o,statusCode:a.status,message:a.statusText})},a.open("POST",e,!0),a.timeout=n,this.deleteUnsafeHeaders(t),t)a.setRequestHeader(u,t[u]);a.send(i),setTimeout((function(){a.readyState!==a.DONE&&(s=!0,a.abort(),r({body:"",headers:o,statusCode:a.status,message:a.statusText}))}),n+100)}},{key:"deleteUnsafeHeaders",value:function(e){"object"!==("undefined"==typeof window?"undefined":ui(window))&&"function"!=typeof XMLHttpRequest||(delete e["User-Agent"],delete e["Accept-Charset"],delete e["Accept-Encoding"],delete e["Access-Control-Request-Headers"],delete e["Access-Control-Request-Method"],delete e.Connection,delete e["Content-Length"],delete e.Cookie,delete e.Cookie2,delete e.Date,delete e.DNT,delete e.Expect,delete e.Host,delete e["Keep-Alive"],delete e.Origin,delete e.Referer,delete e.TE,delete e.Trailer,delete e["Transfer-Encoding"],delete e.Upgrade,delete e.Via)}}])&&li(t.prototype,i),n&&li(t,n),e}(),ci=__webpack_require__(665);function hi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var vi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),fi(this,"initialized",void 0),fi(this,"listeners",void 0)}var t,i,n;return t=e,(i=[{key:"init",value:function(){P.d("BpkBrowserAppStateMgr","Initializing browser app state manager..."),this.initialized||(Ot.getInstance().bind(),this.listeners={},this.registerNetworkObserver(),this.initialized=!0)}},{key:"release",value:function(){this.initialized&&(this.unregisterNetworkObserver(),this.initialized=!1)}},{key:"registerNetworkObserver",value:function(){this.listeners[0]=this.onNetworkOnline.bind(this),this.listeners[1]=this.onNetworkOffline.bind(this),"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.onLine&&(!0===window.navigator.onLine?Ot.getInstance().notifyNetworkAvailable(1):Ot.getInstance().notifyNetworkLost()),window.addEventListener("online",this.listeners[0]),window.addEventListener("offline",this.listeners[1])}},{key:"unregisterNetworkObserver",value:function(){window.removeEventListener("online",this.listeners[0]),window.removeEventListener("offline",this.listeners[1]),this.listeners[0]=void 0,this.listeners[1]=void 0}},{key:"onNetworkOnline",value:function(){Ot.getInstance().notifyNetworkAvailable(1)}},{key:"onNetworkOffline",value:function(){Ot.getInstance().notifyNetworkLost()}},{key:"registerLifecycleEvents",value:function(){this.listeners[2]=this.onMoveToForeground.bind(this),this.listeners[3]=this.onMoveToBackground.bind(this),window.addEventListener("focus",this.listeners[2]),window.addEventListener("blur",this.listeners[3])}},{key:"unregisterLifecycleEvents",value:function(){window.removeEventListener("focus",this.listeners[2]),window.removeEventListener("blur",this.listeners[3]),this.listeners[2]=void 0,this.listeners[3]=void 0}},{key:"onMoveToForeground",value:function(){Ot.getInstance().notifyForeground()}},{key:"onMoveToBackground",value:function(){Ot.getInstance().notifyBackground()}}])&&hi(t.prototype,i),n&&hi(t,n),e}();function pi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function yi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var gi="BpkWebOSAppStateMgr",Ei=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),yi(this,"initialized",void 0),yi(this,"subscriptionHandle",void 0),yi(this,"webOSVersion",void 0)}var t,i,n;return t=e,(i=[{key:"init",value:function(){var e=this;P.d(gi,"Initializing webOS app state manager..."),this.initialized||(this.webOSVersion="",webOS.deviceInfo((function(t){e.webOSVersion=t.sdkVersion,e.registerNetworkObserver()})),Ot.getInstance().bind(),this.initialized=!0)}},{key:"release",value:function(){this.initialized&&(this.unregisterNetworkObserver(),this.initialized=!1)}},{key:"updateNetworkState",value:function(e){var t,i,n="yes"===(null===(t=e.wifi)||void 0===t?void 0:t.onInternet);!0==("yes"===(null===(i=e.wired)||void 0===i?void 0:i.onInternet))?Ot.getInstance().notifyNetworkAvailable(30):!0===n?Ot.getInstance().notifyNetworkAvailable(10):Ot.getInstance().notifyNetworkLost()}},{key:"registerNetworkObserver",value:function(){var e=this.webOSVersion.startsWith("3")?"luna://com.webos.service.connectionmanager":"luna://com.palm.connectionmanager",t=this;webOS.service.request(e,{method:"getStatus",onSuccess:function(e){t.updateNetworkState(e)},onFailure:function(e){P.e(gi,"Failed to get network state"),P.e(gi,"["+e.errorCode+"]: "+e.errorText)}}),this.subscriptionHandle=webOS.service.request(e,{method:"getStatus",parameters:{subscribe:!0},onSuccess:function(e){void 0===e.subscribed||e.subscribed?t.updateNetworkState(e):P.e(gi,"Failed to subscribe network state")},onFailure:function(e){P.e(gi,"Failed to get network state"),P.e(gi,"["+e.errorCode+"]: "+e.errorText)}})}},{key:"unregisterNetworkObserver",value:function(){void 0!==this.subscriptionHandle&&(this.subscriptionHandle.cancel(),this.subscriptionHandle=void 0)}}])&&pi(t.prototype,i),n&&pi(t,n),e}();function Si(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function bi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ki="BpkTizenAppStateMgr",mi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),bi(this,"initialized",void 0),bi(this,"networkInitializer",void 0),bi(this,"networkInitializerNumber",void 0),bi(this,"listeners",void 0)}var t,i,n;return t=e,(i=[{key:"init",value:function(){P.d(ki,"Initializing tizen app state manager..."),this.initialized||(Ot.getInstance().bind(),this.listeners={},this.startNetworkInitializer(),this.initialized=!0)}},{key:"release",value:function(){this.initialized&&(this.unregisterNetworkObserver(),this.initialized=!1)}},{key:"onNetworkChange",value:function(e){var t=null;try{t=webapis.network.getActiveConnectionType()}catch(e){P.e(ki,"getActiveConnectionType exception ["+e.code+"] message: "+e.message)}if(null!=t){switch(t){case webapis.network.NetworkActiveConnectionType.DISCONNECTED:Ot.getInstance().notifyNetworkLost();break;case webapis.network.NetworkActiveConnectionType.WIFI:Ot.getInstance().notifyNetworkAvailable(10);break;case webapis.network.NetworkActiveConnectionType.ETHERNET:Ot.getInstance().notifyNetworkAvailable(30)}P.d(ki,"Active connection type: "+t)}}},{key:"startNetworkInitializer",value:function(){var e=this;void 0!==this.networkInitializer&&clearInterval(this.networkInitializer),this.networkInitializerNumber=0,this.networkInitializer=setInterval((function(){void 0!==webapis.network?(P.d(ki,"Network API is now available"),clearInterval(e.networkInitializer),e.networkInitializer=void 0,e.registerNetworkObserver()):e.networkInitializerNumber>30?(P.e(ki,"The webapis.js script is required in order to get the network type."),clearInterval(e.networkInitializer),e.networkInitializer=void 0):e.networkInitializerNumber++}),100)}},{key:"registerNetworkObserver",value:function(){void 0===webapis.network&&P.e(ki,"The webapis.js script is required in order to get the network type."),this.onNetworkChange(void 0);try{this.listeners[0]=webapis.network.addNetworkStateChangeListener(this.onNetworkChange)}catch(e){P.e(ki,"addNetworkStateChangeListener exception ["+e.code+"] name: "+e.name+" message: "+e.message)}}},{key:"unregisterNetworkObserver",value:function(){try{webapis.network.removeNetworkStateChangeListener(this.listeners[0])}catch(e){P.e(ki,"removeNetworkStateChangeListener exception ["+e.code+"] name: "+e.name+" message: "+e.message)}this.listeners[0]=void 0}}])&&Si(t.prototype,i),n&&Si(t,n),e}();function _i(e){return(_i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ai(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ni(e,t){return(Ni=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ri(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ti(e);if(t){var r=Ti(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Di(this,i)}}function Di(e,t){return!t||"object"!==_i(t)&&"function"!=typeof t?Pi(e):t}function Pi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ti(e){return(Ti=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var wi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ni(e,t)}(a,e);var t,i,n,r=Ri(a);function a(e){var t,i,n,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),t=r.call(this),i=Pi(t),s=void 0,(n="nonceManager")in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s,t.nonceManager=e,t}return t=a,(i=[{key:"getNonce",value:function(){return this.nonceManager.getNonce()}},{key:"sendAdClick",value:function(){this.nonceManager.sendAdClick()}},{key:"sendAdImpression",value:function(){this.nonceManager.sendAdImpression()}}])&&Ai(t.prototype,i),n&&Ai(t,n),a}(ni);function Oi(e){return(Oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Li(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ci(e,t){return(Ci=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ii(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ui(e);if(t){var r=Ui(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Mi(this,i)}}function Mi(e,t){return!t||"object"!==Oi(t)&&"function"!=typeof t?Bi(e):t}function Bi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ui(e){return(Ui=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ji(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Fi="BpkBrowserAdPalManager",Vi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ci(e,t)}(a,e);var t,i,n,r=Ii(a);function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),ji(Bi(e=r.call(this)),"palSDK",void 0),ji(Bi(e),"consentSettings",void 0),ji(Bi(e),"nonceLoader",void 0),ji(Bi(e),"descriptionURL",void 0),ji(Bi(e),"partnerName",void 0),ji(Bi(e),"partnerVersion",void 0),ji(Bi(e),"omidVersion",void 0),ji(Bi(e),"playerType",void 0),ji(Bi(e),"playerVersion",void 0),ji(Bi(e),"ppid",void 0),ji(Bi(e),"videoPlayerHeight",void 0),ji(Bi(e),"videoPlayerWidth",void 0),ji(Bi(e),"willAdAutoPlay",void 0),ji(Bi(e),"willAdPlayMuted",void 0),e}return t=a,(i=[{key:"loadPALSDK",value:function(){this.palSDK=ne.getInstance().palSDK}},{key:"setConsentSettings",value:function(e){this.loadPALSDK(),void 0!==this.palSDK?(this.consentSettings=e,this.nonceLoader=new this.palSDK.pal.NonceLoader(e)):P.e(Fi,"PAL SDK not attached, please set it through AdManager.getInstance().attachPALSDK(...)")}},{key:"generateAdPalSession",value:function(e){if(void 0===this.nonceLoader||void 0===this.consentSettings)return P.e(Fi,"Cannot generate a nonce, please set a ConsentSettings through AdManager.getInstance().setConsentSettings(...)"),void e(void 0);var t=new this.palSDK.pal.NonceRequest;void 0!==this.descriptionURL&&(t.descriptionUrl=this.descriptionURL),void 0!==this.partnerName&&(t.omidPartnerName=this.partnerName),void 0!==this.partnerVersion&&(t.omidPartnerVersion=this.partnerVersion),void 0!==this.omidVersion&&(t.omidVersion=this.omidVersion),void 0!==this.playerType&&(t.playerType=this.playerType),void 0!==this.playerVersion&&(t.playerVersion=this.playerVersion),void 0!==this.ppid&&(t.ppid=this.ppid),void 0!==this.videoPlayerHeight&&(t.videoHeight=this.videoPlayerHeight),void 0!==this.videoPlayerWidth&&(t.videoWidth=this.videoPlayerWidth),void 0!==this.willAdAutoPlay&&(t.adWillAutoPlay=this.willAdAutoPlay),void 0!==this.willAdPlayMuted&&(t.adWillPlayMuted=this.willAdPlayMuted),this.nonceLoader.loadNonceManager(t).then((function(t){var i=new wi(t);e(i)})).catch((function(t){P.e(Fi,"Error when generating the nonce"),console.log(t),e(void 0)}))}},{key:"reset",value:function(){}},{key:"release",value:function(){this.consentSettings=void 0,this.nonceLoader=void 0}},{key:"setDescriptionURL",value:function(e){this.descriptionURL=e}},{key:"setOmidPartner",value:function(e,t){this.partnerName=e,this.partnerVersion=t}},{key:"setOmidVersion",value:function(e){this.omidVersion=e}},{key:"setPlayerType",value:function(e){this.playerType=e}},{key:"setPlayerVersion",value:function(e){this.playerVersion=e}},{key:"setPpid",value:function(e){this.ppid=e}},{key:"setVideoPlayerHeight",value:function(e){this.videoPlayerHeight=e}},{key:"setVideoPlayerWidth",value:function(e){this.videoPlayerWidth=e}},{key:"setWillAdAutoPlay",value:function(e){this.willAdAutoPlay=e}},{key:"setWillAdPlayMuted",value:function(e){this.willAdPlayMuted=e}}])&&Li(t.prototype,i),n&&Li(t,n),a}(ei);function xi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Gi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};function Hi(e){return(Hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Yi(e,t){return $i(e,Qi(e,t,"get"))}function Ki(e,t,i){return zi(e,Qi(e,t,"set"),i),i}function Qi(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function zi(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function Ji(e,t,i){return Zi(e,t),Xi(i,"get"),$i(e,i)}function Xi(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Zi(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function $i(e,t){return t.get?t.get.call(e):t.value}xi(Gi,"CLICK","click"),xi(Gi,"INVITATION_ACCEPTED","invitationAccept");var en="BpkCoreEngine",tn=new WeakMap,nn=new WeakMap,rn=new WeakMap,an=new WeakMap,sn=new WeakMap,on=new WeakMap,un=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),tn.set(this,{writable:!0,value:void 0}),nn.set(this,{writable:!0,value:void 0}),rn.set(this,{writable:!0,value:void 0}),an.set(this,{writable:!0,value:void 0}),sn.set(this,{writable:!0,value:void 0}),on.set(this,{writable:!0,value:void 0}),Ki(this,tn,!1),Ki(this,nn,new oi)}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){var t,i,n,r;return Ji(e,e,ln)||(t=e,i=e,n=ln,r=new e,Zi(t,i),Xi(n,"set"),zi(t,n,r)),Ji(e,e,ln)}}],(i=[{key:"init",value:function(){if(!Yi(this,tn)){Ki(this,tn,!0);var e=Date.now();this.log(_.VERBOSE,en,"Loading engine..."),this.log(_.VERBOSE,en,"Version: 3756"),this.registerSystemFunctions(),"object"===("undefined"==typeof window?"undefined":Hi(window))?this.registerSmartLibFunctions(window):(this.registerSmartLibFunctions(),"undefined"==typeof XMLHttpRequest&&(__webpack_require__.g.XMLHttpRequest=(0,ci.A)("xmlhttprequest").XMLHttpRequest)),this.log(_.VERBOSE,en,"Took "+(Date.now()-e)+"ms to load")}}},{key:"registerSystemFunctions",value:function(){this.log(_.VERBOSE,en,"Registering system functions..."),P.getInstance().init(Yi(this,nn)),me.getInstance().init(new di),Jt.getInstance().internalAdManager.setPalManager(new Vi)}},{key:"registerPlayerAdapters",value:function(){void 0!==e.analyticsModule&&(Ki(this,rn,new e.analyticsModule.PlayerManagerHandler),"object"===("undefined"==typeof window?"undefined":Hi(window))&&(window.PlayerEventListener=e.analyticsModule.PlayerEventListener,window.GenericPlayerApi=e.analyticsModule.GenericPlayerApi))}},{key:"loadModules",value:function(){"object"===("undefined"==typeof window?"undefined":Hi(window))?(Jt.analyticsModule=this.getBrowserModule("analyticsSmartLibModule","Analytics",Jt.analyticsModule),Jt.adModule=this.getBrowserModule("adSmartLibModule","Ad",Jt.adModule),Jt.nanoCDNModule=this.getBrowserModule("nanocdnSmartLibModule","nanoCDN",Jt.nanoCDNModule),Jt.diversityModule=this.getBrowserModule("diversitySmartLibModule","Diversity",Jt.diversityModule),e.shakaModule=this.getBrowserModule("shakaSmartLibModule","Shaka Player",e.shakaModule),void 0!==e.shakaModule&&(window.ShakaPlayerAdapter=e.shakaModule.ShakaPlayerAdapter),e.dashjsModule=this.getBrowserModule("dashjsSmartLibModule","Dash.js",e.dashjsModule),void 0!==e.dashjsModule&&(window.DashJsPlayerAdapter=e.dashjsModule.DashJsPlayerAdapter),e.html5Module=this.getBrowserModule("html5SmartLibModule","HTML5 player",e.html5Module),e.avplayModule=this.getBrowserModule("avplaySmartLibModule","AVPlay",e.avplayModule),e.diw387Module=this.getBrowserModule("diw387SmartLibModule","Sagemcom",e.diw387Module),e.hbbtv1Module=this.getBrowserModule("hbbtv1SmartLibModule","HbbTV1",e.hbbtv1Module),e.kalturaModule=this.getBrowserModule("kalturaSmartLibModule","Kaltura",e.kalturaModule),e.connectplayerModule=this.getBrowserModule("connectplayerSmartLibModule","CONNECT Player",e.connectplayerModule),void 0!==e.connectplayerModule&&(window.ConnectPlayerAdapter=e.connectplayerModule.ConnectPlayerAdapter),e.rxplayerModule=this.getBrowserModule("rxplayerSmartLibModule","RxPlayer",e.rxplayerModule),e.hlsjsModule=this.getBrowserModule("hlsjsModule","HLS.js",e.hlsjsModule),e.bitmovinModule=this.getBrowserModule("bitmovinModule","Bitmovin",e.bitmovinModule)):!0===e.modular&&(Jt.analyticsModule=this.getNodeModule("analytics","Analytics"),Jt.adModule=this.getNodeModule("ad","Ad"),Jt.nanoCDNModule=this.getNodeModule("nanocdn","nanoCDN"),Jt.diversityModule=this.getNodeModule("diversity","Diversity"),e.shakaModule=this.getNodeModule("shaka","Shaka Player"),e.dashjsModule=this.getNodeModule("dashjs","Dash.js"),e.html5Module=this.getNodeModule("html5","HTML5 player"),e.avplayModule=this.getNodeModule("avplay","AVPlay"),e.diw387Module=this.getNodeModule("diw387","Sagemcom"),e.hbbtv1Module=this.getNodeModule("hbbtv1","HbbTV1"),e.kalturaModule=this.getNodeModule("kaltura","Kaltura"),e.connectplayerModule=this.getNodeModule("connectplayer","CONNECT Player"),e.rxplayerModule=this.getNodeModule("rxplayer","RxPlayer"),e.hlsjsModule=this.getNodeModule("hlsjs","HLS.js"),e.bitmovinModule=this.getNodeModule("bitmovin","Bitmovin"))}},{key:"getBrowserModule",value:function(e,t,i){if(void 0!==i)return P.i(en,t+" module loaded (from index)"),i;P.i(en,t+" module not loaded")}},{key:"getNodeModule",value:function(e,t){try{var i=(0,ci.W)("@broadpeak/smartlib-"+e);return P.i(en,t+" module loaded"),i}catch(i){try{var n=(0,ci.A)("./"+e+".smartlib.browser");return P.i(en,t+" module loaded"),n}catch(e){P.i(en,t+" module not loaded")}}}},{key:"registerSmartLibFunctions",value:function(t){var i,n,r=this;Jt.prototype.defaultInit=Jt.prototype.init,Jt.prototype.init=function(e,t,i,n){"undefined"!=typeof webOS?(void 0===Yi(r,sn)&&Ki(r,sn,new Ei),Yi(r,sn).init()):"undefined"!=typeof tizen&&"undefined"!=typeof webapis?(void 0===Yi(r,on)&&Ki(r,on,new mi),Yi(r,on).init()):"undefined"!=typeof sagem||"undefined"!=typeof window&&(void 0===Yi(r,an)&&Ki(r,an,new vi),Yi(r,an).init()),r.loadModules(),this.defaultInit(e,t,i,n)},Jt.prototype.defaultAttachPlayer=Jt.prototype.attachPlayer,Jt.prototype.attachPlayer=function(e,t){var i,n;null===(i=Jt.analyticsModule)||void 0===i||i.PlayerManager.getInstance().init(Yi(r,rn));var a=null===(n=Yi(r,rn))||void 0===n?void 0:n.attachPlayer(e,t);this.defaultAttachPlayer(a)},Jt.prototype.defaultRelease=Jt.prototype.release,Jt.prototype.release=function(){this.defaultRelease(),void 0!==Yi(r,an)&&(Yi(r,an).release(),Ki(r,an,void 0)),void 0!==Yi(r,sn)&&(Yi(r,sn).release(),Ki(r,sn,void 0)),void 0!==Yi(r,on)&&(Yi(r,on).release(),Ki(r,on,void 0))},St.prototype.defaultAttachPlayer=St.prototype.attachPlayer,St.prototype.attachPlayer=function(e,t){var i,n;null===(i=Jt.analyticsModule)||void 0===i||i.PlayerManager.getInstance().init(Yi(r,rn));var a=null===(n=Yi(r,rn))||void 0===n?void 0:n.attachPlayer(e,t);this.defaultAttachPlayer(a)},"object"===Hi(t)&&(t.SmartLib=Object.assign(Jt.getInstance(),Jt),t.SmartLib.getInstance=function(){return Jt.getInstance()},t.LoggerManager=P,t.PlayerEventListener=null===(i=e.analyticsModule)||void 0===i?void 0:i.PlayerEventListener,t.GenericPlayerApi=null===(n=e.analyticsModule)||void 0===n?void 0:n.GenericPlayerApi,t.PlayerApiImp={getVersion:function(){var e,t=null===(e=Jt.analyticsModule)||void 0===e?void 0:e.PlayerManager.getInstance().getPlayerAdapter();return void 0!==t&&"function"==typeof t.getVersion?t.getVersion():"undefined"},getErrorCode:function(e){var t,i=null===(t=Jt.analyticsModule)||void 0===t?void 0:t.PlayerManager.getInstance().getPlayerAdapter();return void 0!==i&&"function"==typeof i.getErrorCode?i.getErrorCode(e):Jt.BPUnspecifiedError}},t.StreamingSession=St,t.StreamingSessionOptions=ze,t.StreamingSessionResult=pt,t.AdManager=ne,t.AdInteractionType=Gi)}},{key:"log",value:function(e,t,i){Yi(this,nn).log(e,t,i)}}])&&Wi(t.prototype,i),n&&Wi(t,n),e}(),ln={writable:!0,value:void 0};function dn(e){return(dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function hn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}qi(un,"modular",!0),qi(un,"analyticsModule",void 0),qi(un,"shakaModule",void 0),qi(un,"dashjsModule",void 0),qi(un,"html5Module",void 0),qi(un,"avplayModule",void 0),qi(un,"diw387Module",void 0),qi(un,"hbbtv1Module",void 0),qi(un,"kalturaModule",void 0),qi(un,"connectplayerModule",void 0),qi(un,"rxplayerModule",void 0),qi(un,"hlsjsModule",void 0),qi(un,"bitmovinModule",void 0);var fn="BpkPlayerAdapter",vn=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),hn(this,"session",void 0),hn(this,"webOSVersion",void 0),"undefined"!=typeof webOS&&webOS.deviceInfo((function(e){t.webOSVersion=e.sdkVersion}))}var t,i,n;return t=e,n=[{key:"checkPlayer",value:function(e,t){return P.e(fn,"Implementation error: static checkPlayer not implemented for this adapter."),!1}}],(i=[{key:"getName",value:function(){return""}},{key:"getVersion",value:function(){return""}},{key:"getOSName",value:function(){return"undefined"!=typeof device&&void 0!==device.platform?device.platform:"undefined"!=typeof webOS||"object"===("undefined"==typeof navigator?"undefined":dn(navigator))&&void 0!==navigator.userAgent&&-1!==navigator.userAgent.indexOf("Web0S")?"webOS":"undefined"!=typeof tizen||"object"===("undefined"==typeof navigator?"undefined":dn(navigator))&&void 0!==navigator.userAgent&&-1!==navigator.userAgent.indexOf("Tizen")?"Tizen":"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.platform?window.navigator.platform:"NA"}},{key:"getOSVersion",value:function(){var e;if("undefined"!=typeof device&&void 0!==device.version)e=device.version;else if("undefined"!=typeof webOS)e=this.webOSVersion;else{if("undefined"!=typeof tizen&&void 0!==tizen.systeminfo)return tizen.systeminfo.getCapability("http://tizen.org/feature/platform.version");"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.appVersion&&(e=window.navigator.appVersion)}void 0===e&&(e="");var t=e.replace(/ /g,"_").replace(/;/g,"_");return t.length>=30?t.substring(0,30):0===t.length?"NA":t}},{key:"getDeviceType",value:function(){return"undefined"!=typeof cast&&void 0!==cast.receiver?"chromecast":"undefined"!=typeof tizen&&void 0!==tizen.systeminfo||"undefined"!=typeof webOS||"object"===("undefined"==typeof navigator?"undefined":dn(navigator))&&void 0!==navigator.userAgent&&-1!==navigator.userAgent.indexOf("Web0S")?"tv":""}},{key:"getBitrate",value:function(){return-1}},{key:"getPosition",value:function(){return 0}},{key:"getDuration",value:function(){return 0}},{key:"getVolume",value:function(){return 1}},{key:"getCapabilities",value:function(){return{adTracking:!1}}},{key:"initSessionPlayerObjects",value:function(){}},{key:"releaseSessionPlayerObjects",value:function(){}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(e){e.playerName=this.getName(),e.playerVersion=this.getVersion(),e.osName=this.getOSName(),e.osVersion=this.getOSVersion(),e.deviceType=this.getDeviceType()}},{key:"onEndSessionReportUpdateRequested",value:function(e){e.playerName=this.getName(),e.playerVersion=this.getVersion(),e.osName=this.getOSName(),e.osVersion=this.getOSVersion(),e.deviceType=this.getDeviceType()}},{key:"notifyFirstImage",value:function(){void 0!==this.session?this.session.notifyFirstImage(this.getBitrate(),this.getPosition()):P.e(fn,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onSessionStart event. This event is called when the first image is displayed.")}},{key:"notifyPause",value:function(){void 0!==this.session?this.session.notifyPause():P.e(fn,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onSessionPause event.")}},{key:"notifyResume",value:function(){void 0!==this.session?this.session.notifyResume():P.e(fn,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onSessionResume event.")}},{key:"notifyLayerSwitch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getBitrate();void 0!==this.session?this.session.notifyLayerSwitch(e):P.e(fn,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onLayerSwitch event.")}},{key:"notifySeek",value:function(e,t){void 0!==this.session?this.session.notifySeek(e,t):P.e(fn,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onSeek event.")}},{key:"notifyStallStart",value:function(){void 0!==this.session?this.session.notifyBufferingStart():P.e(fn,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onStallStart event.")}},{key:"notifyStallEnd",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];void 0!==this.session?this.session.notifyBufferingEnd(e):P.e(fn,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onStallEnd event.")}},{key:"notifyVolumeChanged",value:function(e){void 0!==this.session?this.session.notifyVolumeChanged(e):P.e(fn,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onVolumeChanged event.")}},{key:"notifyPlayerError",value:function(e,t){void 0!==this.session?this.session.notifyPlayerError(e,t):P.e(fn,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onPlayerError event.")}},{key:"attachPlayer",value:function(e,t){return P.e(fn,"Implementation error: attachPlayer not implemented for this adapter."),!1}},{key:"detachPlayer",value:function(){P.e(fn,"Implementation error: detachPlayer not implemented for this adapter.")}},{key:"attachSession",value:function(e){this.session=e}},{key:"detachSession",value:function(){this.session=void 0}},{key:"setStatusCode",value:function(e){void 0!==this.session&&(this.session.sessionReport.statusCode=e)}},{key:"setPlayerErrorCode",value:function(e){void 0!==this.session&&(this.session.sessionReport.playerErrorCode=String(e))}}])&&cn(t.prototype,i),n&&cn(t,n),e}();function pn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var yn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"hasMethods",value:function(e,t){var i=!0;return void 0!==e&&(t.forEach((function(t){"function"!=typeof e[t]&&(i=!1)})),i)}},{key:"count",value:function(e,t){var i=0;for(var n in e)!0===t(n,e[n])&&i++;return i}}],(i=null)&&pn(t.prototype,i),n&&pn(t,n),e}();function gn(e){return(gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function En(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Sn(e,t,i){return(Sn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=An(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function bn(e,t){return(bn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function kn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=An(e);if(t){var r=An(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return mn(this,i)}}function mn(e,t){return!t||"object"!==gn(t)&&"function"!=typeof t?_n(e):t}function _n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function An(e){return(An=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Nn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Rn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bn(e,t)}(a,e);var t,i,n,r=kn(a);function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Nn(_n(e=r.call(this)),"player",void 0),Nn(_n(e),"listener",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return yn.hasMethods(e,["getPlayerName","getVersion","getOSName","getDeviceVersion","getDeviceType","getCurrentPosition","getTotalDuration","getCurrentBitrate"])}}],(i=[{key:"getName",value:function(){return this.player.getPlayerName()}},{key:"getVersion",value:function(){return this.player.getVersion()}},{key:"getOSName",value:function(){return this.player.getOSName()}},{key:"getOSVersion",value:function(){return this.player.getDeviceVersion()}},{key:"getDeviceType",value:function(){return this.player.getDeviceType()}},{key:"getBitrate",value:function(){return this.player.getCurrentBitrate()}},{key:"getPosition",value:function(){return this.player.getCurrentPosition()}},{key:"getDuration",value:function(){return this.player.getTotalDuration()}},{key:"getCapabilities",value:function(){return"function"==typeof this.player.getCapabilities?this.player.getCapabilities():Sn(An(a.prototype),"getCapabilities",this).call(this)}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(this.player=e,this.listener=t,this.player.playerAdapter=this,!0)}},{key:"detachPlayer",value:function(){void 0!==this.player&&(this.player.playerAdapter=void 0),this.player=void 0,this.listener=void 0}}])&&En(t.prototype,i),n&&En(t,n),a}(vn);function Dn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Pn,Tn,wn,On="BpkPlayerEventListener",Ln=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"addPlayerAdapter",value:function(t){-1===e.playerAdapters.indexOf(t)&&e.playerAdapters.push(t)}},{key:"removePlayerAdapter",value:function(t){var i=e.playerAdapters.indexOf(t);-1!==i&&e.playerAdapters.splice(i,1)}},{key:"isStarted",value:function(){var t=e.playerAdapters;return t.length>0&&void 0!==t[t.length-1].session&&t[t.length-1].session.metricsManager.started}},{key:"isPlaying",value:function(){var t=e.playerAdapters;return t.length>0&&void 0!==t[t.length-1].session&&t[t.length-1].session.metricsManager.playing}},{key:"isBuffering",value:function(){var t=e.playerAdapters;return t.length>0&&void 0!==t[t.length-1].session&&t[t.length-1].session.metricsManager.buffering}},{key:"onSessionStart",value:function(){var t=e.playerAdapters;t.length>0?t.forEach((function(e){return e.notifyFirstImage()})):P.e(On,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onSessionStart event. If you don't attach any player, please remove this call, SmartLib is now handling it automatically.")}},{key:"onSessionPause",value:function(){var t=e.playerAdapters;t.length>0?t.forEach((function(e){return e.notifyPause()})):P.e(On,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onSessionPause event.")}},{key:"onSessionResume",value:function(){var t=e.playerAdapters;t.length>0?t.forEach((function(e){return e.notifyResume()})):P.e(On,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onSessionResume event.")}},{key:"onLayerSwitch",value:function(t){var i=e.playerAdapters;i.length>0?i.forEach((function(e){return e.notifyLayerSwitch(t)})):P.e(On,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onLayerSwitch event.")}},{key:"onSeek",value:function(t,i){var n=e.playerAdapters;n.length>0?n.forEach((function(e){return e.notifySeek(t,i)})):P.e(On,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onSeek event.")}},{key:"onStallStart",value:function(){var t=e.playerAdapters;t.length>0?t.forEach((function(e){return e.notifyStallStart()})):P.e(On,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onStallStart event.")}},{key:"onStallEnd",value:function(t){var i=e.playerAdapters;i.length>0?i.forEach((function(e){return e.notifyStallEnd(t)})):P.e(On,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onStallEnd event.")}}],(i=null)&&Dn(t.prototype,i),n&&Dn(t,n),e}();function Cn(e,t,i){return Bn(e,Mn(e,t,"set"),i),i}function In(e,t){return Vn(e,Mn(e,t,"get"))}function Mn(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function Bn(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function Un(e,t,i){return Fn(e,t),jn(i,"get"),Vn(e,i)}function jn(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Fn(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function Vn(e,t){return t.get?t.get.call(e):t.value}function xn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Hn(e,t,i){return t&&Gn(e.prototype,t),i&&Gn(e,i),e}wn=[],(Tn="playerAdapters")in(Pn=Ln)?Object.defineProperty(Pn,Tn,{value:wn,enumerable:!0,configurable:!0,writable:!0}):Pn[Tn]=wn;var Wn="BpkPlayerMgr",qn=function(){function e(){xn(this,e)}return Hn(e,null,[{key:"loadPlayerAdapters",value:function(){return{}}}]),e}(),Yn=new WeakMap,Kn=new WeakMap,Qn=new WeakMap,zn=function(){function e(){xn(this,e),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"smartLib",void 0),Yn.set(this,{writable:!0,value:qn}),Kn.set(this,{writable:!0,value:{}}),Qn.set(this,{writable:!0,value:void 0})}return Hn(e,[{key:"init",value:function(e){In(this,Yn)===qn&&(Cn(this,Yn,e),Cn(this,Kn,In(this,Yn).loadPlayerAdapters()),P.v(Wn,"Compatible players: "+Object.keys(In(this,Kn))))}},{key:"release",value:function(){this.setPlayerAdapter(void 0)}},{key:"attachInstance",value:function(e){this.smartLib=e}},{key:"getAdapters",value:function(){return In(this,Kn)}},{key:"setPlayerAdapter",value:function(e){void 0!==In(this,Qn)&&In(this,Qn)!==e&&(P.i(Wn,"Player "+In(this,Qn).getName()+" detached"),In(this,Qn).detachPlayer()),In(this,Qn)!==e&&void 0!==e?e instanceof Rn&&(P.d(Wn,"Attaching generic player to SmartLib singleton"),Ln.addPlayerAdapter(e)):In(this,Qn)!==e&&void 0===e&&In(this,Qn)instanceof Rn&&(P.d(Wn,"Detaching generic player from SmartLib singleton"),Ln.removePlayerAdapter(In(this,Qn))),In(this,Qn)!==e?Cn(this,Qn,e):void 0!==e&&P.i(Wn,"Player "+In(this,Qn).getName()+" already attached"),void 0!==e&&P.i(Wn,"Player "+e.getName()+" attached")}},{key:"getPlayerAdapter",value:function(){return In(this,Qn)}}],[{key:"getInstance",value:function(){return Un(e,e,Jn)||function(e,t,i,n){Fn(e,t),jn(i,"set"),Bn(e,i,n)}(e,e,Jn,new e),Un(e,e,Jn)}}]),e}(),Jn={writable:!0,value:void 0};function Xn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Zn="BpkGenericPlayerApi",$n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"playerAdapter",void 0)}var t,i,n;return t=e,(i=[{key:"getPlayerName",value:function(){return""}},{key:"getVersion",value:function(){return""}},{key:"getOSName",value:function(){return""}},{key:"getDeviceVersion",value:function(){return""}},{key:"getDeviceType",value:function(){return""}},{key:"getCurrentPosition",value:function(){return 0}},{key:"getTotalDuration",value:function(){return 0}},{key:"getCurrentBitrate",value:function(){return 0}},{key:"notifyFirstImage",value:function(){void 0!==this.playerAdapter?this.playerAdapter.notifyFirstImage():P.e(Zn,"Implementation error: session.attachPlayer(...) should be called prior to notifyFirstImage. This event is called when the first image is displayed.")}},{key:"notifyPause",value:function(){void 0!==this.playerAdapter?this.playerAdapter.notifyPause():P.e(Zn,"Implementation error: session.attachPlayer(...) should be called prior to notifyPause.")}},{key:"notifyResume",value:function(){void 0!==this.playerAdapter?this.playerAdapter.notifyResume():P.e(Zn,"Implementation error: session.attachPlayer(...) should be called prior to notifyResume.")}},{key:"notifyLayerSwitch",value:function(e){void 0!==this.playerAdapter?this.playerAdapter.notifyLayerSwitch(e):P.e(Zn,"Implementation error: session.attachPlayer(...) should be called prior to notifyLayerSwitch.")}},{key:"notifyStallStart",value:function(){void 0!==this.playerAdapter?this.playerAdapter.notifyStallStart():P.e(Zn,"Implementation error: session.attachPlayer(...) should be called prior to notifyStallStart.")}},{key:"notifyStallEnd",value:function(e){void 0!==this.playerAdapter?this.playerAdapter.notifyStallEnd(e):P.e(Zn,"Implementation error: session.attachPlayer(...) should be called prior to notifyStallEnd.")}},{key:"notifySeek",value:function(e,t){void 0!==this.playerAdapter?this.playerAdapter.notifySeek(e,t):P.e(Zn,"Implementation error: session.attachPlayer(...) should be called prior to notifySeek.")}},{key:"setPlayerErrorCode",value:function(e){void 0!==this.playerAdapter?this.playerAdapter.setPlayerErrorCode(e):P.e(Zn,"Implementation error: session.attachPlayer(...) should be called prior to setPlayerErrorCode. This has to be called before stopStreamingSession when the player error code as a string.")}}])&&Xn(t.prototype,i),n&&Xn(t,n),e}();function er(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ir(e,t,i,n){return ar(e,t),rr(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n),n}function nr(e,t,i){return ar(e,t),rr(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}function rr(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function ar(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}var sr="BpkAnalyticsRequestMgr",or=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){return nr(e,e,ur)||ir(e,e,ur,new e),nr(e,e,ur)}}],(i=[{key:"startSession",value:function(t,i){var n=this,r=t.sessionReport;if(0!==i.analyticsAddress.length){var a=i.analyticsAddress.split(","),s=[];return a.forEach((function(a){(a=a.trim()).endsWith("/")||(a+="/"),a+=e.METRICS_RECEIVER_PATH,P.i(sr,"Posting metrics to "+a,t.id);var o=n.postSession(a,r.toStartSessionJSON(),i).then((function(e){return P.i(sr,"Send creation session metrics ended with with status code "+e.httpStatus+" ("+a+")",t.id),e.httpStatus>=200&&e.httpStatus<300||(503===e.httpStatus&&P.d(sr,"Request execution failed",t.id),!1)}));s.push(o)})),Promise.all(s).then((function(){P.d(sr,"Send creation session metrics done",t.id)}))}return P.w(sr,"Metrics platform URL is null, creation metrics won't be posted anywhere.",t.id),Promise.resolve(!1)}},{key:"endSession",value:function(t,i){var n=this,r=t.sessionReport;if(0!==i.analyticsAddress.length){var a=i.analyticsAddress.split(","),s=[];return a.forEach((function(a){(a=a.trim()).endsWith("/")||(a+="/"),a+=e.METRICS_RECEIVER_PATH,P.i(sr,"Posting metrics to "+a,t.id);var o=n.postSession(a,r.toEndSessionJSON(),i).then((function(e){return P.i(sr,"Send session metrics ended with with status code "+e.httpStatus+" ("+a+")",t.id),e.httpStatus>=200&&e.httpStatus<300||(503===e.httpStatus&&P.d(sr,"Request execution failed",t.id),!1)}));s.push(o)})),Promise.all(s).then((function(){P.d(sr,"Send session metrics done",t.id)}))}return P.w(sr,"Metrics platform URL is null, metrics won't be posted anywhere.",t.id),Promise.resolve(!1)}},{key:"postSession",value:function(t,i,n){return new Promise((function(r,a){var s={Connection:"close"};void 0!==n.userAgent&&(s["User-Agent"]=n.userAgent);var o=JSON.stringify(i);P.v(sr,"Executing POST request with body: "+o),H.getInstance().asyncPost(t,s,o,e.POST_SESSION_REQUEST_TIMEOUT,(function(e){var t=0;void 0!==e.statusCode&&(t=parseInt(e.statusCode,10)),r({httpStatus:t})}))}))}}])&&er(t.prototype,i),n&&er(t,n),e}();tr(or,"METRICS_RECEIVER_PATH","fservices/metricsReceiver"),tr(or,"POST_SESSION_REQUEST_TIMEOUT",5e3);var ur={writable:!0,value:void 0};function lr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function dr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var cr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),dr(this,"index",void 0),dr(this,"buffer",void 0),this.index=0,this.buffer=new Uint8Array(t)}var t,i,n;return t=e,(i=[{key:"put",value:function(e){return this.buffer[this.index++]=e,this}},{key:"putChar",value:function(e){return this.buffer[this.index++]=(65280&e)>>8,this.buffer[this.index++]=255&e,this}},{key:"putTimestamp",value:function(e){return this.buffer[this.index++]=(16711680&e)>>16,this.buffer[this.index++]=(65280&e)>>8,this.buffer[this.index++]=255&e,this}},{key:"putArray",value:function(e){return this.buffer.length>=this.index+e.length&&(this.buffer.set(e,this.index),this.index+=e.length),this}},{key:"putByteBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.buffer.length,i=e.buffer;return this.buffer.length>=this.index+t&&(this.buffer.set(i,this.index,t),this.index+=t),this}},{key:"increment",value:function(e){return this.buffer[e]++,this}},{key:"set",value:function(e,t){return this.buffer[t]=e,this}},{key:"setChar",value:function(e,t){return this.buffer[t]=(65280&e)>>8,this.buffer[t+1]=255&e,this}},{key:"setTimestamp",value:function(e,t){return this.buffer[t]=(16711680&e)>>16,this.buffer[t+1]=(65280&e)>>8,this.buffer[t+2]=255&e,this}},{key:"shift",value:function(e){return this.buffer.copyWithin(e+1,e),this.index++,this}},{key:"data",value:function(){return this.buffer}},{key:"base64",value:function(){return I.bufferToBase64(this)}},{key:"length",value:function(){return this.index}},{key:"capacity",value:function(){return this.buffer.length}},{key:"remaining",value:function(){return this.capacity()-this.length()}},{key:"toString",value:function(){return I.bufferToString(this.buffer,this.index)+"(length:"+this.length()+")"}}])&&lr(t.prototype,i),n&&lr(t,n),e}();function hr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}dr(cr,"EMPTY",new cr(0));var pr=function e(t){fr(this,e),vr(this,"redirectionTime",void 0),vr(this,"startupTime",void 0),vr(this,"completion",void 0),vr(this,"playbackType",void 0),vr(this,"playbackDuration",void 0),vr(this,"sessionDuration",void 0),vr(this,"contentDuration",void 0),vr(this,"stallsNumber",void 0),vr(this,"maxStallDuration",void 0),vr(this,"totalStallsDuration",void 0),vr(this,"rebufferingsNumber",void 0),vr(this,"maxRebufferingDuration",void 0),vr(this,"totalRebufferingDuration",void 0),vr(this,"minBitrate",void 0),vr(this,"maxBitrate",void 0),vr(this,"averageBitrate",void 0),vr(this,"layerSwitchesNumber",void 0),vr(this,"timeSpentPerLayer",void 0),vr(this,"preStartupTime",void 0),void 0!==t?(this.redirectionTime=t.redirectionTime,this.startupTime=t.startupTime,this.completion=t.completion,this.playbackType=t.playbackType,this.playbackDuration=t.playbackDuration,this.sessionDuration=t.sessionDuration,this.contentDuration=t.contentDuration,this.stallsNumber=t.stallsNumber,this.maxStallDuration=t.maxStallDuration,this.totalStallsDuration=t.totalStallsDuration,this.rebufferingsNumber=t.rebufferingsNumber,this.maxRebufferingDuration=t.maxRebufferingDuration,this.totalRebufferingDuration=t.totalRebufferingDuration,this.minBitrate=t.minBitrate,this.maxBitrate=t.maxBitrate,this.averageBitrate=t.averageBitrate,this.layerSwitchesNumber=t.layerSwitchesNumber,this.timeSpentPerLayer=JSON.parse(JSON.stringify(t.timeSpentPerLayer)),this.preStartupTime=t.preStartupTime):(this.redirectionTime=0,this.startupTime=0,this.completion=0,this.playbackType="",this.playbackDuration=0,this.sessionDuration=0,this.contentDuration=0,this.stallsNumber=0,this.maxStallDuration=0,this.totalStallsDuration=0,this.rebufferingsNumber=0,this.maxRebufferingDuration=0,this.totalRebufferingDuration=0,this.minBitrate=0,this.maxBitrate=0,this.averageBitrate=0,this.layerSwitchesNumber=0,this.timeSpentPerLayer={},this.preStartupTime=0)};vr(pr,"PLAYBACK_TYPE_LIVE","LIVE"),vr(pr,"PLAYBACK_TYPE_VOD","VOD");var yr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pr;fr(this,e),vr(this,"metrics",void 0),vr(this,"watchingRanges",void 0),this.metrics=t,this.reset()}var t,i,n;return t=e,(i=[{key:"setRedirectionTime",value:function(e){return this.metrics.redirectionTime=e,this}},{key:"setStartupTime",value:function(e){return this.metrics.startupTime=e,this}},{key:"setSessionDuration",value:function(e){return this.metrics.sessionDuration=e,this}},{key:"setContentDuration",value:function(e){return this.metrics.contentDuration=e,this}},{key:"setPlaybackType",value:function(e){return this.metrics.playbackType=e,this}},{key:"setFirstLayer",value:function(e){return e>0&&(this.metrics.maxBitrate=e,this.metrics.minBitrate=e),this}},{key:"setPreStartupTime",value:function(e){return this.metrics.preStartupTime=e,this}},{key:"addTimeSpentPerLayer",value:function(e,t){if((e=Math.round(e))>0){var i=this.metrics.timeSpentPerLayer[e];void 0===i&&(i=0),i+=t,this.metrics.timeSpentPerLayer[e]=i,this.metrics.maxBitrate<e&&(this.metrics.maxBitrate=e),(this.metrics.minBitrate>e||0===this.metrics.minBitrate)&&(this.metrics.minBitrate=e)}return this}},{key:"addLayerSwitch",value:function(){return this.metrics.layerSwitchesNumber++,this}},{key:"addPlaybackDuration",value:function(e){return this.metrics.playbackDuration+=e,this}},{key:"addWatchingRange",value:function(e,t){return e<t&&(P.v("BpkMetrics","Add watching range, duration "+(t-e)+"ms"),this.watchingRanges.push({start:e,end:t,duration:t-e})),this}},{key:"addStall",value:function(e){return this.metrics.stallsNumber++,this.metrics.totalStallsDuration+=e,this.metrics.maxStallDuration<e&&(this.metrics.maxStallDuration=e),this}},{key:"addRebuffering",value:function(e){return this.metrics.rebufferingsNumber++,this.metrics.totalRebufferingDuration+=e,this.metrics.maxRebufferingDuration<e&&(this.metrics.maxRebufferingDuration=e),this}},{key:"clone",value:function(){var t=new e(new pr(this.metrics));return t.watchingRanges=JSON.parse(JSON.stringify(this.watchingRanges)),t}},{key:"computeCompletion",value:function(){if(this.metrics.playbackType===pr.PLAYBACK_TYPE_LIVE||0===this.metrics.contentDuration)return 1e3;var e=JSON.parse(JSON.stringify(this.watchingRanges)),t=e.slice(0);if(1===e.length)return Math.floor(1e3*t[0].duration/this.metrics.contentDuration);if(0===e.length)return 0;var i=[],n=null;t=t.sort((function(e,t){return parseInt(e.start,10)>parseInt(t.start,10)?1:parseInt(e.start,10)<parseInt(t.start,10)?-1:0})),i.push(t[0]);for(var r=1;r<t.length;r++)n=i[i.length-1],parseInt(n.end,10)<parseInt(t[r].start,10)?i.push(t[r]):parseInt(n.end,10)<parseInt(t[r].end,10)&&(n.end=parseInt(t[r].end,10),n.duration=n.end-n.start,i.pop(),i.push(n));for(var a=0,s=0;s<i.length;s++)i[s].duration=parseInt(i[s].end,10)-parseInt(i[s].start,10),a+=parseInt(i[s].duration,10);this.watchingRanges=i;var o=Math.floor(1e3*a/this.metrics.contentDuration);return o>1e3?1e3:o}},{key:"build",value:function(){var e=0,t=0;for(var i in this.metrics.timeSpentPerLayer){var n=this.metrics.timeSpentPerLayer[i];e+=i*n,t+=n}return 0!==t&&(this.metrics.averageBitrate=Math.round(e/t)),this.metrics.completion=this.computeCompletion(),this.metrics.startupTime+=this.metrics.preStartupTime,this.metrics}},{key:"reset",value:function(){return this.watchingRanges=[],this}}])&&hr(t.prototype,i),n&&hr(t,n),e}();function gr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Er(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Sr="BpkMetricsMgr",br=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Er(this,"session",void 0),Er(this,"builder",void 0),Er(this,"playerAdapter",void 0),Er(this,"timeline",void 0),Er(this,"started",void 0),Er(this,"playing",void 0),Er(this,"buffering",void 0),Er(this,"seeking",void 0),Er(this,"bitrate",void 0),Er(this,"redirectionStartDate",void 0),Er(this,"playingStartDate",void 0),Er(this,"bufferingStartDate",void 0),Er(this,"lastLayerSwitchDate",void 0),Er(this,"lastSeekDate",void 0),Er(this,"playOnNextBufferingEnd",void 0),Er(this,"startPosition",void 0),this.session=t,this.builder=new yr,this.playerAdapter=i,this.timeline=this.session.sessionReport.timeline,this.started=!1,this.playing=!1,this.buffering=!1,this.seeking=!1,this.bitrate=-1,this.redirectionStartDate=0,this.playingStartDate=0,this.bufferingStartDate=0,this.lastLayerSwitchDate=0,this.lastSeekDate=0,this.playOnNextBufferingEnd=!1,this.startPosition=0}var t,i,n;return t=e,(i=[{key:"onStart",value:function(){this.redirectionStartDate=Date.now()}},{key:"onRedirectionEnd",value:function(){this.builder.setRedirectionTime(Date.now()-this.redirectionStartDate),this.playingStartDate=Date.now()}},{key:"onFirstImage",value:function(e,t){P.i(Sr,"Streaming session started ("+e+"kpbs,"+ai.formatTime(t)+")",this.session.id),this.started=!0,this.playing=!0,this.startPosition=t,this.builder.setContentDuration(this.playerAdapter.getDuration()).setPlaybackType(this.playerAdapter.getDuration()<=0?pr.PLAYBACK_TYPE_LIVE:pr.PLAYBACK_TYPE_VOD),this.builder.setStartupTime(Date.now()-this.redirectionStartDate),this.playingStartDate=Date.now(),this.builder.setFirstLayer(e),this.bitrate=e,this.lastLayerSwitchDate=Date.now()}},{key:"onLayerSwitch",value:function(e){var t;P.d(Sr,"Player changed layer to "+e+"kbps",this.session.id),this.started&&(this.builder.addTimeSpentPerLayer(this.bitrate,Date.now()-this.lastLayerSwitchDate),this.lastLayerSwitchDate=Date.now(),this.bitrate!==e&&this.bitrate>0&&(P.d(Sr,"Player changed layer, before: "+this.bitrate+"kbps, now: "+e+"kbps",this.session.id),null===(t=this.timeline)||void 0===t||t.pushEventBitrate(_r.LayerSwitch,e),this.builder.addLayerSwitch())),this.bitrate=e}},{key:"onPause",value:function(){var e;this.playing&&(P.d(Sr,"Player is paused",this.session.id),null===(e=this.timeline)||void 0===e||e.pushEvent(_r.Pause),this.playing=!1,this.buffering||this.builder.addPlaybackDuration(Date.now()-this.playingStartDate),this.builder.addWatchingRange(this.startPosition,this.playerAdapter.getPosition()))}},{key:"onResume",value:function(){var e;this.started&&!this.playing&&(P.d(Sr,"Player is resumed",this.session.id),null===(e=this.timeline)||void 0===e||e.pushEvent(_r.Resume),this.playing=!0,this.buffering=!1,this.playingStartDate=Date.now())}},{key:"onBufferingStart",value:function(){if(!this.buffering&&this.started){var t;P.d(Sr,"Player is buffering",this.session.id),null===(t=this.timeline)||void 0===t||t.pushEvent(_r.BufferingStart);var i=Date.now();this.buffering=!0,this.seeking&&i-this.lastSeekDate>e.MAX_TIME_BETWEEN_SEEK_AND_REBUFFERING&&(this.seeking=!1),this.bufferingStartDate=i,this.playOnNextBufferingEnd=!1,this.playing&&this.builder.addPlaybackDuration(i-this.playingStartDate)}}},{key:"onBufferingEnd",value:function(e){var t=Date.now();e&&this.playOnNextBufferingEnd&&!this.buffering&&(this.playingStartDate=t,this.playOnNextBufferingEnd=!1),this.started&&this.bufferingStartDate>0&&(this.buffering=!1,e?this.playingStartDate=t:this.playOnNextBufferingEnd=!0,this.seeking?(this.seeking=!1,this.session.notifyRebufferingEnd()):this.session.notifyStallEnd(),this.bufferingStartDate=0)}},{key:"onStallEnd",value:function(){var e,t=Date.now()-this.bufferingStartDate;this.builder.addStall(t),null===(e=this.timeline)||void 0===e||e.pushEvent(_r.StallStop),P.d(Sr,"Player stalled for "+t+"ms",this.session.id)}},{key:"onRebufferingEnd",value:function(){var e,t=Date.now()-this.bufferingStartDate;this.builder.addRebuffering(t),null===(e=this.timeline)||void 0===e||e.pushEvent(_r.RebufferingStop),P.d(Sr,"Player buffered for "+t+"ms",this.session.id)}},{key:"onSeek",value:function(e,t){var i;P.d(Sr,"Player seeked from "+ai.formatTime(e)+" to "+ai.formatTime(t),this.session.id),null===(i=this.timeline)||void 0===i||i.pushEventPositionStartEnd(_r.Seek,e,t),this.builder.addWatchingRange(this.startPosition,e),this.startPosition=t,this.seeking=!0,this.lastSeekDate=Date.now()}},{key:"onStop",value:function(e){if(this.started){var t=Date.now();this.playing&&!this.buffering&&this.builder.addPlaybackDuration(t-this.playingStartDate),this.buffering&&this.onBufferingEnd(!1),this.playing&&(this.builder.addWatchingRange(this.startPosition,this.playerAdapter.getPosition()),this.playing=!1),this.builder.setSessionDuration(t-this.redirectionStartDate).addTimeSpentPerLayer(this.bitrate,t-this.lastLayerSwitchDate),this.started=!1}}},{key:"onStartSessionReportUpdateRequested",value:function(e){e.metrics=this.builder.build()}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(e){var t=Date.now(),i=this.builder.clone();if(this.playing&&!this.buffering&&i.addPlaybackDuration(t-this.playingStartDate),this.started&&this.bufferingStartDate>0){var n=Date.now()-this.bufferingStartDate;this.seeking?i.addRebuffering(n):i.addStall(n)}this.playing&&i.addWatchingRange(this.startPosition,this.playerAdapter.getPosition()),i.setSessionDuration(t-this.redirectionStartDate).addTimeSpentPerLayer(this.bitrate,t-this.lastLayerSwitchDate);var r=this.session.getCustomParameters().pre_startup_time,a=0;void 0===r||isNaN(r)||(a=parseInt(r,10)),i.setPreStartupTime(a),e.metrics=i.build()}},{key:"onEndSessionReportUpdateRequested",value:function(e){var t=Date.now();this.builder.setSessionDuration(t-this.redirectionStartDate);var i=this.session.getCustomParameters().pre_startup_time,n=0;void 0===i||isNaN(i)||(n=parseInt(i,10)),this.builder.setPreStartupTime(n),e.metrics=this.builder.build()}}])&&gr(t.prototype,i),n&&gr(t,n),e}();function kr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function mr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Er(br,"MAX_TIME_BETWEEN_SEEK_AND_REBUFFERING",1e3);var _r={None:0,Start:1,Stop:2,RedirectionEnd:3,FirstImage:4,Pause:5,Resume:6,BufferingStart:7,StallStart:8,StallStop:9,RebufferingStart:10,RebufferingStop:11,Seek:12,LayerSwitch:13,AdBreakStart:14,AdBreakStop:15,NetworkAvailable:16,NetworkLost:17,Mute:18,Unmute:19,DataSummary:144,EmptySummary:145},Ar=[_r.RedirectionEnd,_r.Pause,_r.Resume,_r.BufferingStart,_r.StallStart,_r.StallStop,_r.RebufferingStart,_r.RebufferingStop,_r.AdBreakStart,_r.NetworkLost,_r.Mute,_r.Unmute],Nr=[_r.Start],Rr=[_r.LayerSwitch],Dr=[_r.FirstImage],Pr=[_r.Seek],Tr=[_r.Stop],wr=[_r.AdBreakStop],Or=[_r.NetworkAvailable],Lr="BpkSessionTrackerEvent",Cr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),mr(this,"eventId",void 0),mr(this,"eventDate",void 0),mr(this,"eventData",void 0),mr(this,"startStopEvent",void 0),mr(this,"startEventId",void 0),mr(this,"stopEventId",void 0),mr(this,"triggerStartEventId",void 0),mr(this,"keepLastOnly",void 0),mr(this,"attachEventId",void 0),mr(this,"attachMaxDurationBeforeStart",void 0),mr(this,"startEvent",void 0),mr(this,"stopEvent",void 0),mr(this,"attachedEvent",void 0),mr(this,"compressed",void 0),mr(this,"compressedData",void 0),this.eventId=t,this.eventDate=Date.now(),this.eventData={},this.startStopEvent=!1,this.startEventId=0,this.stopEventId=0,this.triggerStartEventId=0,this.keepLastOnly=!1,this.attachEventId=0,this.attachMaxDurationBeforeStart=-1,this.startEvent=null,this.stopEvent=null,this.attachedEvent=null,this.addDataSizeInTimeline=!1,this.compressed=!1,this.compressedData=void 0,this.updateMetadata()}var t,i,n;return t=e,(i=[{key:"updateMetadata",value:function(){switch(this.startStopEvent=!1,this.startEventId=_r.None,this.stopEventId=_r.None,this.triggerStartEventId=_r.None,this.keepLastOnly=!1,this.attachEventId=_r.None,this.attachMaxDurationBeforeStart=-1,this.eventId){case _r.None:break;case _r.Start:this.startStopEvent=!0,this.startEventId=_r.Start,this.stopEventId=_r.Stop,this.addDataSizeInTimeline=!0;break;case _r.Stop:this.startStopEvent=!0,this.startEventId=_r.Start,this.stopEventId=_r.Stop;break;case _r.RedirectionEnd:this.startStopEvent=!1,this.attachEventId=_r.Start;break;case _r.FirstImage:this.startStopEvent=!1,this.keepLastOnly=!0,this.attachEventId=_r.RedirectionEnd;break;case _r.Pause:case _r.Resume:this.startStopEvent=!0,this.startEventId=_r.Pause,this.stopEventId=_r.Resume;break;case _r.BufferingStart:this.startStopEvent=!1;break;case _r.StallStart:this.startStopEvent=!0,this.startEventId=_r.StallStart,this.stopEventId=_r.StallStop;break;case _r.StallStop:this.startStopEvent=!0,this.startEventId=_r.StallStart,this.stopEventId=_r.StallStop,this.triggerStartEventId=_r.BufferingStart;break;case _r.RebufferingStart:this.startStopEvent=!0,this.startEventId=_r.RebufferingStart,this.stopEventId=_r.RebufferingStop;break;case _r.RebufferingStop:this.startStopEvent=!0,this.startEventId=_r.RebufferingStart,this.stopEventId=_r.RebufferingStop,this.triggerStartEventId=_r.BufferingStart,this.attachEventId=_r.Seek,this.attachMaxDurationBeforeStart=br.MAX_TIME_BETWEEN_SEEK_AND_REBUFFERING;break;case _r.Seek:case _r.LayerSwitch:this.startStopEvent=!1;break;case _r.AdBreakStart:this.startStopEvent=!0,this.startEventId=_r.AdBreakStart,this.stopEventId=_r.AdBreakStop;break;case _r.AdBreakStop:this.startStopEvent=!0,this.startEventId=_r.AdBreakStart,this.stopEventId=_r.AdBreakStop,this.attachEventId=_r.Seek,this.attachMaxDurationBeforeStart=0;break;case _r.NetworkAvailable:case _r.NetworkLost:this.startStopEvent=!1;break;case _r.Mute:case _r.Unmute:this.startStopEvent=!1,this.addDataSizeInTimeline=!0}}},{key:"getEventName",value:function(){switch(this.eventId){case _r.None:return"None";case _r.Start:return"Start";case _r.Stop:return"Stop";case _r.RedirectionEnd:return"RedirectionEnd";case _r.FirstImage:return"FirstImage";case _r.Pause:return"Pause";case _r.Resume:return"Resume";case _r.BufferingStart:return"BufferingStart";case _r.StallStart:return"StallStart";case _r.StallStop:return"StallStop";case _r.RebufferingStart:return"RebufferingStart";case _r.RebufferingStop:return"RebufferingStop";case _r.Seek:return"Seek";case _r.LayerSwitch:return"LayerSwitch";case _r.AdBreakStart:return"AdBreakStart";case _r.AdBreakStop:return"AdBreakStop";case _r.NetworkAvailable:return"NetworkAvailable";case _r.NetworkLost:return"NetworkLost";case _r.Mute:return"Mute";case _r.Unmute:return"Unmute"}return""}},{key:"isStartEvent",value:function(){return this.startStopEvent&&this.eventId===this.startEventId}},{key:"isStopEvent",value:function(){return this.startStopEvent&&this.eventId===this.stopEventId}},{key:"addEventData",value:function(e,t){"string"==typeof e&&(this.eventData[e]=t)}},{key:"toData",value:function(e){for(var t=Math.abs(this.eventDate-e)/100,i=I.floor(t/65535),n=t%65535,r=Object.keys(this.eventData).length,a=3*i+1+2+2*r+(this.addDataSizeInTimeline?1:0),s=new cr(a),o=0;o<i;o++)s.put(_r.None),s.put(255),s.put(255);switch(s.put(this.eventId),s.putChar(n),this.addDataSizeInTimeline&&s.put(2*r),this.eventId){case _r.Start:var u=parseInt(this.eventData.networkType,10),l=parseInt(this.eventData.muteState,10);s.putChar(u),s.putChar(l);break;case _r.Stop:var d=parseInt(this.eventData.statusCode,10);s.putChar(d);break;case _r.FirstImage:var c=parseInt(this.eventData.bitrate,10),h=parseInt(this.eventData.position,10);s.putChar(c),s.putChar(h);break;case _r.Seek:var f=parseInt(this.eventData.positionStart,10),v=parseInt(this.eventData.positionEnd,10);s.putChar(f),s.putChar(v);break;case _r.LayerSwitch:var p=parseInt(this.eventData.bitrate,10);s.putChar(p);break;case _r.AdBreakStop:var y=parseInt(this.eventData.progress,10);s.putChar(y);break;case _r.NetworkAvailable:var g=parseInt(this.eventData.state,10);s.putChar(g)}return s}},{key:"formatDate",value:function(e){return ai.formatDate(new Date(e))}},{key:"print",value:function(){for(var e in P.v(Lr,"   |"),P.v(Lr,"   ├--\x3e "+this.getEventName()+" -> "+(!0===this.compressed?"compressed":"not compressed")+" -> "+this.eventDate),P.v(Lr,"   |      date: "+this.formatDate(this.eventDate)),this.eventData)P.v(Lr,"   |      "+e+": "+this.eventData[e]);this.isStartEvent()&&null!==this.stopEvent&&P.v(Lr,"   |      stop event: "+this.stopEvent.getEventName()+" "+this.stopEvent.eventDate),this.isStopEvent()&&null!==this.startEvent&&P.v(Lr,"   |      start event: "+this.startEvent.getEventName()+" "+this.startEvent.eventDate),null!==this.attachedEvent&&P.v(Lr,"   |      attached event: "+this.attachedEvent.getEventName()+" "+this.attachedEvent.eventDate)}},{key:"toString",value:function(){return this.getEventName()+" ("+this.formatDate(this.eventDate)+")"}}])&&kr(t.prototype,i),n&&kr(t,n),e}();function Ir(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Mr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Br=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Mr(this,"timeline",void 0),Mr(this,"minIndex",void 0),Mr(this,"initialBitrate",void 0),Mr(this,"builder",void 0),Mr(this,"summaryDuration",void 0),Mr(this,"pauseDuration",void 0),Mr(this,"nbNetworkDisconnected",void 0),Mr(this,"nbNetworkWifi",void 0),Mr(this,"nbNetworkMobile",void 0),Mr(this,"nbNetworkEthernet",void 0),Mr(this,"lastNetworkState",void 0),Mr(this,"muteDuration",void 0),Mr(this,"lastMuteState",void 0),this.timeline=t,this.minIndex=i,this.initialBitrate=void 0,this.builder=void 0,this.summaryDuration=0,this.pauseDuration=0,this.nbNetworkDisconnected=0,this.nbNetworkWifi=0,this.nbNetworkMobile=0,this.nbNetworkEthernet=0,this.lastNetworkState=void 0,this.muteDuration=0,this.lastMuteState=void 0,this.init()}var t,i,n;return t=e,(i=[{key:"init",value:function(){for(var e=this.minIndex;e>=0;e--){var t=this.timeline.events[e];switch(t.eventId){case _r.LayerSwitch:case _r.FirstImage:void 0===this.initialBitrate&&(this.initialBitrate=parseInt(t.eventData.bitrate,10));break;case _r.Start:void 0===this.lastNetworkState&&(this.lastNetworkState=parseInt(t.eventData.networkType,10)),void 0===this.lastMuteState&&(this.lastMuteState=parseInt(t.eventData.muteState,10));break;case _r.NetworkAvailable:void 0===this.lastNetworkState&&(this.lastNetworkState=parseInt(t.eventData.state,10));break;case _r.NetworkLost:void 0===this.lastNetworkState&&(this.lastNetworkState=0);break;case _r.Mute:void 0===this.lastMuteState&&(this.lastMuteState=1);break;case _r.Unmute:void 0===this.lastMuteState&&(this.lastMuteState=0)}}void 0!==this.initialBitrate&&0!==this.initialBitrate||(this.initialBitrate=-1),void 0===this.lastNetworkState&&(this.lastNetworkState=1),void 0===this.lastMuteState&&(this.lastMuteState=0)}},{key:"update",value:function(e){if(!(this.minIndex>=this.timeline.events.length||e>=this.timeline.events.length)){var t,i,n,r=this.timeline.events[this.minIndex],a=this.timeline.events[e],s=this.initialBitrate,o=r.eventDate,u=1===this.lastMuteState?r.eventDate:-1;this.builder=new yr,this.summaryDuration=a.eventDate-r.eventDate,this.pauseDuration=0,this.nbNetworkDisconnected=0,this.nbNetworkWifi=0,this.nbNetworkMobile=0,this.nbNetworkEthernet=0,this.muteDuration=0;for(var l=this.minIndex;l<=e;l++){var d=this.timeline.events[l];switch(d.eventId){case _r.Pause:!1!==t&&void 0!==t||(null!==d.stopEvent&&d.stopEvent.eventDate<=a.eventDate&&(this.pauseDuration+=d.stopEvent.eventDate-d.eventDate),t=!0);break;case _r.Resume:void 0===t&&(this.pauseDuration+=d.eventDate-r.eventDate),t=!1;break;case _r.StallStart:!1!==i&&void 0!==i||(null!==d.stopEvent&&d.stopEvent.eventDate<=a.eventDate&&this.builder.addStall(d.stopEvent.eventDate-d.eventDate),i=!0);break;case _r.StallStop:void 0===i&&this.builder.addStall(d.eventDate-r.eventDate),i=!1;break;case _r.RebufferingStart:!1!==n&&void 0!==n||(null!==d.stopEvent&&d.stopEvent.eventDate<=a.eventDate&&this.builder.addRebuffering(d.stopEvent.eventDate-d.eventDate),n=!0);break;case _r.RebufferingStop:void 0===n&&this.builder.addRebuffering(d.eventDate-r.eventDate),n=!1;break;case _r.LayerSwitch:this.builder.addLayerSwitch(),-1!==s&&this.builder.addTimeSpentPerLayer(s,d.eventDate-o),s=parseInt(d.eventData.bitrate,10),o=d.eventDate;break;case _r.NetworkAvailable:this.lastNetworkState=parseInt(d.eventData.state,10),this.lastNetworkState>=10&&this.lastNetworkState<20?this.nbNetworkWifi++:this.lastNetworkState>=20&&this.lastNetworkState<30?this.nbNetworkMobile++:this.lastNetworkState>=30&&this.lastNetworkState<40&&this.nbNetworkEthernet++;break;case _r.NetworkLost:this.lastNetworkState=0,this.nbNetworkDisconnected++;break;case _r.Mute:this.lastMuteState=1,u=d.eventDate;break;case _r.Unmute:this.lastMuteState=0,-1!==u&&(this.muteDuration+=d.eventDate-u,u=-1)}}-1!==s&&this.builder.addTimeSpentPerLayer(s,a.eventDate-o),-1!==u&&(this.muteDuration+=a.eventDate-u),this.builder.build()}}},{key:"data",value:function(){if(void 0===this.builder)return cr.EMPTY;var t=new cr(e.BUFFER_SIZE),i=this.builder.metrics;return t.put(_r.DataSummary).putChar(Math.round(this.summaryDuration/1e3)).put(e.BUFFER_SIZE-2-1-1).putChar(this.pauseDuration/100).put(i.stallsNumber).putChar(i.totalStallsDuration/100).put(i.rebufferingsNumber).putChar(i.totalRebufferingDuration/100).put(i.layerSwitchesNumber).putChar(i.minBitrate).putChar(i.maxBitrate).putChar(i.averageBitrate).put(this.nbNetworkDisconnected).put(this.nbNetworkWifi).put(this.nbNetworkMobile).put(this.nbNetworkEthernet).putChar(this.lastNetworkState).putChar(Math.round(this.muteDuration/1e3)).put(this.lastMuteState),t}},{key:"toString",value:function(){if(void 0===this.builder)return"no data";var e=this.builder.metrics;return this.summaryDuration+", "+this.pauseDuration+", "+e.minBitrate+", "+e.maxBitrate+", "+e.layerSwitchesNumber+", "+e.averageBitrate+", "+e.stallsNumber+", "+e.totalStallsDuration+", "+e.rebufferingsNumber+", "+e.totalRebufferingDuration+", "+this.nbNetworkDisconnected+", "+this.nbNetworkWifi+", "+this.nbNetworkMobile+", "+this.nbNetworkEthernet+", "+this.lastNetworkState+", "+this.muteDuration+", "+this.lastMuteState}}])&&Ir(t.prototype,i),n&&Ir(t,n),e}();function Ur(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Mr(Br,"BUFFER_SIZE",28);var Vr="BpkSessionTrackerEncoder",xr=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_BUFFER_SIZE,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.DEFAULT_END_EVENTS_DURATION,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DEFAULT_END_EVENTS_NUMBER;Ur(this,e),Fr(this,"timeline",void 0),Fr(this,"maxBufferSize",void 0),Fr(this,"maxEndEventsDuration",void 0),Fr(this,"maxEndEventsNumber",void 0),Fr(this,"events",void 0),Fr(this,"uncompressedData",void 0),Fr(this,"uncompressedDataFull",void 0),Fr(this,"compressedStartData",void 0),Fr(this,"minSummaryIndex",void 0),Fr(this,"maxEndBufferSize",void 0),Fr(this,"summary",void 0),this.maxBufferSize=i,this.maxEndEventsDuration=n,this.maxEndEventsNumber=r,this.timeline=t,this.events=this.timeline.events,this.uncompressedData=new cr(this.maxBufferSize),this.uncompressedDataFull=!1,this.compressedStartData=void 0,this.minSummaryIndex=0,this.maxEndBufferSize=this.maxBufferSize,this.summary=void 0}var t,i,n;return t=e,(i=[{key:"onEventAdded",value:function(e){if(!this.uncompressedDataFull){var t=e;this.events.length>=2&&(t=this.events[this.events.length-2]),e.compressedData=e.toData(t.eventDate),e.compressed=!0,e.compressedData.capacity()<=this.uncompressedData.remaining()?this.uncompressedData.putByteBuffer(e.compressedData):(this.uncompressedDataFull=!0,this.compressedStartData=new cr(this.maxBufferSize))}}},{key:"onEventUpdated",value:function(){this.uncompressedData=new cr(this.maxBufferSize);for(var e=0;e<this.events.length;e++)void 0!==this.events[e].compressedData&&this.uncompressedData.putByteBuffer(this.events[e].compressedData)}},{key:"process",value:function(){var e=Date.now();if(!this.uncompressedDataFull)return P.d(Vr,"Timeline encoder generated uncompressed data ("+this.events.length+" events, "+this.uncompressedData.length()+" bytes)"),this.uncompressedData;for(var t,i="",n=[],r=0,a=this.events.length-1;a>=0;a--){var s=this.events[a];if(!(e-s.eventDate<this.maxEndEventsDuration&&n.length<this.maxEndEventsNumber)){t=a;break}var o=void 0;if(a<this.events.length-1){var u=this.events[a+1];o=s.toData(u.eventDate)}else o=s.toData(s.eventDate);if(!(r+o.length()<=this.maxEndBufferSize)){t=a;break}n.push(o),r+=o.length()}if(0===this.compressedStartData.length()){this.minSummaryIndex=t;for(var l=this.maxBufferSize-Br.BUFFER_SIZE-r,d=0;d<t;d++){var c=this.events[d];if(this.compressedStartData.length()+c.compressedData.length()>l){this.minSummaryIndex=d;break}this.compressedStartData.putByteBuffer(c.compressedData)}this.maxEndBufferSize=this.compressedStartData.remaining()-Br.BUFFER_SIZE,this.uncompressedData=void 0,i+="first iteration, "}var h=new cr(this.maxBufferSize);if(h.putByteBuffer(this.compressedStartData,this.compressedStartData.length()),this.minSummaryIndex===t)h.put(_r.EmptySummary),i+="no summary";else{void 0===this.summary&&(this.summary=new Br(this.timeline,this.minSummaryIndex)),this.summary.update(t);var f=this.summary.data();h.putByteBuffer(f),i+="summary {"+this.summary.toString()+"}"}for(var v=0;v<n.length;v++)h.putByteBuffer(n[v]);return P.d(Vr,"Timeline encoder generated compressed data ("+this.events.length+" events before encoding, "+(this.minSummaryIndex+n.length)+" events after encoding, "+h.length()+" bytes, ~"+(Date.now()-e)+"ms, "+i+")"),h}},{key:"extend",value:function(){if(this.uncompressedDataFull)P.w(Vr,"Failed to extend size from "+e.DEFAULT_BUFFER_SIZE+" to 768");else{this.maxBufferSize=768,this.maxEndEventsDuration=4e4,this.maxEndEventsNumber=40;var t=this.uncompressedData;this.uncompressedData=new cr(this.maxBufferSize),this.uncompressedData.putByteBuffer(t,t.length()),P.v(Vr,"Extended size from "+e.DEFAULT_BUFFER_SIZE+" to 768")}}}])&&jr(t.prototype,i),n&&jr(t,n),e}();function Gr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Hr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Fr(xr,"DEFAULT_BUFFER_SIZE",384),Fr(xr,"DEFAULT_END_EVENTS_DURATION",15e3),Fr(xr,"DEFAULT_END_EVENTS_NUMBER",20);var Wr="BpkSessionTrackerTimeline",qr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Hr(this,"session",void 0),Hr(this,"startDate",void 0),Hr(this,"stopDate",void 0),Hr(this,"events",void 0),Hr(this,"firstImageWithoutBitrateEvent",void 0),Hr(this,"encoder",void 0),this.startDate=null,this.stopDate=null,this.events=[],this.firstImageWithoutBitrateEvent=null,this.encoder=new xr(this)}var t,i,n;return t=e,(i=[{key:"pushEvent",value:function(e){if(this.checkType(e,Ar)){var t=this.createEvent(e);this.encoder.onEventAdded(t)}}},{key:"pushEventStart",value:function(e,t,i){if(this.checkType(e,Nr)){var n=this.createEvent(e);n.addEventData("networkType",t),n.addEventData("muteState",i),this.encoder.onEventAdded(n)}}},{key:"pushEventBitrate",value:function(e,t){if(this.checkType(e,Rr)){var i=this.createEvent(e);i.addEventData("bitrate",t),null!==this.firstImageWithoutBitrateEvent&&(this.firstImageWithoutBitrateEvent.addEventData("bitrate",t),this.firstImageWithoutBitrateEvent=null),this.encoder.onEventAdded(i)}}},{key:"pushEventBitratePosition",value:function(e,t,i){if(this.checkType(e,Dr)){var n=this.createEvent(e);n.addEventData("bitrate",t),n.addEventData("position",i),e===_r.FirstImage&&t<=0&&(this.firstImageWithoutBitrateEvent=n),this.encoder.onEventAdded(n)}}},{key:"pushEventPositionStartEnd",value:function(e,t,i){if(this.checkType(e,Pr)){var n=this.createEvent(e);n.addEventData("positionStart",t),n.addEventData("positionEnd",i),this.encoder.onEventAdded(n)}}},{key:"pushEventStatusCode",value:function(e,t){if(this.checkType(e,Tr)){var i=this.createEvent(e);i.addEventData("statusCode",t),this.encoder.onEventAdded(i)}}},{key:"pushEventProgress",value:function(e,t){if(this.checkType(e,wr)){var i=this.createEvent(e);i.addEventData("progress",t),this.encoder.onEventAdded(i)}}},{key:"pushEventState",value:function(e,t){if(this.checkType(e,Or)){var i=this.createEvent(e);i.addEventData("state",t),this.encoder.onEventAdded(i)}}},{key:"createEvent",value:function(e){var t=new Cr(e);return P.v(Wr,"Creating event "+t.getEventName()+"..."),this.applyKeepLastOnly(t),this.events.push(t),this.updateTimelineProperties(t),this.reconciliateStopWithStartEvent(t),t}},{key:"checkType",value:function(e,t){return t.indexOf(e)>=0||(P.v(Wr,"Can't push event '"+e+"' to timeline, invalid parameters"),!1)}},{key:"applyKeepLastOnly",value:function(e){if(e.keepLastOnly)for(var t=this.events.length-1;t>=0;t--)if(this.events[t].eventId===e.eventId)return this.events.splice(t,1),void this.encoder.onEventUpdated()}},{key:"attachEvent",value:function(e){if(e.attachEventId>_r.None){var t=-1;null!==e.startEvent&&-1!==e.attachMaxDurationBeforeStart&&(t=e.startEvent.eventDate-e.attachMaxDurationBeforeStart);for(var i=this.events.length-1;i>=0;i--){var n=this.events[i];if(n.eventId===e.attachEventId&&(-1===t||n.eventDate>=t))return void(e.attachedEvent=n)}}}},{key:"updateTimelineProperties",value:function(e){switch(e.eventId){case _r.Start:this.startDate=Date.now();break;case _r.Stop:this.stopDate=Date.now()}}},{key:"reconciliateStopWithStartEvent",value:function(e){if(e.isStopEvent())for(var t=this.events.length-1;t>=0;t--){var i=this.events[t];if(i.eventId===e.startEventId)return i.stopEvent=e,void(e.startEvent=i);if(i.eventId===e.triggerStartEventId)return i.eventId=e.startEventId,i.startStopEvent=!0,i.startEventId=e.startEventId,i.stopEventId=e.stopEventId,void 0!==i.compressedData&&(i.compressedData.set(i.eventId,0),this.encoder.onEventUpdated()),i.stopEvent=e,void(e.startEvent=i)}}},{key:"onStart",value:function(e,t){this.pushEventStart(_r.Start,e,t)}},{key:"onRedirectionEnd",value:function(){this.pushEvent(_r.RedirectionEnd)}},{key:"onFirstImage",value:function(e,t){this.pushEventBitratePosition(_r.FirstImage,e,t)}},{key:"onStop",value:function(e){this.pushEventStatusCode(_r.Stop,e)}},{key:"onForeground",value:function(){P.d(Wr,"Received event onForeground but ignored")}},{key:"onBackground",value:function(){P.d(Wr,"Received event onBackground but ignored")}},{key:"onNetworkAvailable",value:function(e){P.v(Wr,"Received event onNetworkAvailable type:"+e),this.pushEventState(_r.NetworkAvailable,e)}},{key:"onNetworkLost",value:function(){P.d(Wr,"Received event onNetworkLost"),this.pushEvent(_r.NetworkLost)}},{key:"onMute",value:function(){P.d(Wr,"Received event onMute"),this.pushEvent(_r.Mute)}},{key:"onUnmute",value:function(){P.d(Wr,"Received event onUnmute"),this.pushEvent(_r.Unmute)}},{key:"data",value:function(){return this.encoder.process()}},{key:"formatDate",value:function(e){return ai.formatDate(new Date(e))}},{key:"print",value:function(){P.v(Wr,"Timeline (startDate:"+this.formatDate(this.startDate)+", stopDate:"+this.formatDate(this.stopDate)+")");for(var e=0;e<this.events.length;e++)this.events[e].print()}},{key:"toString",value:function(){for(var e=[],t=0;t<this.events.length;t++)e.push(this.events[t].toString());return e.join(", ")}}])&&Gr(t.prototype,i),n&&Gr(t,n),e}();function Yr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Kr(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,zr(e,t,"get"))}function Qr(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,zr(e,t,"set"),i),i}function zr(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}Jt.analyticsModule={PlayerManager:zn,PlayerAdapter:vn,GenericPlayerAdapter:Rn,PlayerEventListener:Ln,GenericPlayerApi:$n,AnalyticsRequestManager:or,SessionTrackerTimeline:qr,SessionTrackerEvent:Cr,SessionTrackerEvents:_r,Metrics:pr,MetricsManager:br};var Jr=new WeakMap,Xr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Jr.set(this,{writable:!0,value:void 0})}var t,i,n;return t=e,(i=[{key:"loadPlayerAdapters",value:function(){var e,t,i,n,r,a,s,o,u,l,d;return Qr(this,Jr,{}),Kr(this,Jr).generic=Rn,this.addAdapter("shaka",null===(e=un.shakaModule)||void 0===e?void 0:e.ShakaPlayerAdapter),this.addAdapter("dashjs",null===(t=un.dashjsModule)||void 0===t?void 0:t.DashJsPlayerAdapter),this.addAdapter("html5",null===(i=un.html5Module)||void 0===i?void 0:i.HTML5PlayerAdapter),this.addAdapter("avplay",null===(n=un.avplayModule)||void 0===n?void 0:n.AVPlayAdapter),this.addAdapter("diw387",null===(r=un.diw387Module)||void 0===r?void 0:r.SagemcomDIW387Adapter),this.addAdapter("hbbtv1",null===(a=un.hbbtv1Module)||void 0===a?void 0:a.HbbTV1PlayerAdapter),this.addAdapter("kaltura",null===(s=un.kalturaModule)||void 0===s?void 0:s.KalturaPlayerAdapter),this.addAdapter("connectplayer",null===(o=un.connectplayerModule)||void 0===o?void 0:o.ConnectPlayerAdapter),this.addAdapter("rxplayer",null===(u=un.rxplayerModule)||void 0===u?void 0:u.RxPlayerAdapter),this.addAdapter("hlsjs",null===(l=un.hlsjsModule)||void 0===l?void 0:l.HlsJsPlayerAdapter),this.addAdapter("bitmovin",null===(d=un.bitmovinModule)||void 0===d?void 0:d.BitmovinPlayerAdapter),Kr(this,Jr)}},{key:"addAdapter",value:function(e,t){void 0!==t&&(Kr(this,Jr)[e]=t)}},{key:"attachPlayer",value:function(e,t){for(var i in Kr(this,Jr))if(void 0!==Kr(this,Jr)[i]&&Kr(this,Jr)[i].checkPlayer(e,t)){var n=new(Kr(this,Jr)[i]);return n.attachPlayer(e,t),n}}}])&&Yr(t.prototype,i),n&&Yr(t,n),e}();function Zr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ea(e,t,i){return t&&$r(e.prototype,t),i&&$r(e,i),e}function ta(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}un.analyticsModule={PlayerManagerHandler:Xr,PlayerEventListener:Ln,GenericPlayerApi:$n},un.getInstance().registerPlayerAdapters();var ia=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;Zr(this,e),ta(this,"adSkippable",void 0),ta(this,"adSkipped",void 0),ta(this,"adProgress",void 0),ta(this,"adDuration",void 0),ta(this,"stallsNumber",void 0),ta(this,"stallsDuration",void 0),ta(this,"layerSwitchesNumber",void 0),ta(this,"averageBitrate",void 0),ta(this,"sessionToken",void 0),ta(this,"creativeId",void 0),ta(this,"adId",void 0),void 0===t?(this.adSkippable=!1,this.adSkipped=!1,this.adProgress=-1,this.adDuration=0,this.stallsNumber=0,this.stallsDuration=0,this.layerSwitchesNumber=0,this.averageBitrate=0,this.sessionToken="",this.creativeId="",this.adId=""):(this.adSkippable=t.adSkippable,this.adSkipped=t.adSkipped,this.adProgress=t.adProgress,this.adDuration=t.adDuration,this.stallsNumber=t.stallsNumber,this.stallsDuration=t.stallsDuration,this.layerSwitchesNumber=t.layerSwitchesNumber,this.averageBitrate=t.averageBitrate,this.sessionToken=t.sessionToken,this.creativeId=t.creativeId,this.adId=t.adId)}return ea(e,[{key:"toString",value:function(){return"\n{ adSkippable="+this.adSkippable+"\n  adSkipped="+this.adSkipped+"\n  adProgress="+this.adProgress+"\n  adDuration="+this.adDuration+"\n  stallsNumber="+this.stallsNumber+"\n  stallsDuration="+this.stallsDuration+"\n  layerSwitchesNumber="+this.layerSwitchesNumber+"\n  averageBitrate="+this.averageBitrate+"\n  sessionToken='"+this.sessionToken+"'\n  creativeId='"+this.creativeId+"'\n  adId='"+this.adId+"' }"}}],[{key:"merge",value:function(t){if(void 0!==t&&t.length>0){var i=new e,n=t[t.length-1];i.adSkippable=n.adSkippable,i.adSkipped=n.adSkipped,i.adProgress=n.adProgress,i.sessionToken=n.sessionToken,i.creativeId=n.creativeId,i.adId=n.adId;for(var r=0,a=0,s=0;s<t.length;s++){var o=t[s];i.adDuration+=o.adDuration,i.stallsNumber+=o.stallsNumber,i.stallsDuration+=o.stallsDuration,i.layerSwitchesNumber+=o.layerSwitchesNumber,r+=o.averageBitrate*o.adDuration,a+=o.adDuration}return 0!==a&&(i.averageBitrate=Math.round(r/a)),i}}}]),e}(),na=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;Zr(this,e),ta(this,"adMetrics",void 0),ta(this,"timeSpentPerLayer",void 0),void 0===t&&void 0===i?(this.timeSpentPerLayer={},this.reset()):(this.adMetrics=t,this.timeSpentPerLayer=i)}return ea(e,[{key:"setAdSkippable",value:function(e){return this.adMetrics.adSkippable=e,this}},{key:"setAdSkipped",value:function(e){return this.adMetrics.adSkipped=e,this}},{key:"setAdProgress",value:function(e){return this.adMetrics.adProgress=e,this}},{key:"setSessionToken",value:function(e){return this.adMetrics.sessionToken=e,this}},{key:"setCreativeId",value:function(e){return this.adMetrics.creativeId=e,this}},{key:"setAdId",value:function(e){return this.adMetrics.adId=e,this}},{key:"addTimeSpentPerLayer",value:function(e,t){(e=Math.round(e))>0&&(void 0!==this.timeSpentPerLayer[e]?this.timeSpentPerLayer[e]+=t:this.timeSpentPerLayer[e]=t);return this}},{key:"addLayerSwitch",value:function(){return this.adMetrics.layerSwitchesNumber++,this}},{key:"addStall",value:function(e){return this.adMetrics.stallsNumber++,this.adMetrics.stallsDuration+=e,this}},{key:"reset",value:function(){return this.adMetrics=new ia,this.timeSpentPerLayer={},this}},{key:"clone",value:function(){return new e(new ia(this.adMetrics),Object.assign({},this.timeSpentPerLayer))}},{key:"build",value:function(){var e=0,t=0;for(var i in this.timeSpentPerLayer){var n=this.timeSpentPerLayer[i];e+=i*n,t+=n}return 0!==t&&(this.adMetrics.averageBitrate=Math.round(e/t)),this.adMetrics.adDuration=t,this.adMetrics}}]),e}();function ra(e){return(ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function aa(e,t){return(aa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function sa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=la(e);if(t){var r=la(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return oa(this,i)}}function oa(e,t){return!t||"object"!==ra(t)&&"function"!=typeof t?ua(e):t}function ua(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function la(e){return(la=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function da(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ca(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ha(e,t,i){return t&&ca(e.prototype,t),i&&ca(e,i),e}function fa(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var va="BpkAdLegacyTracker",pa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&aa(e,t)}(i,e);var t=sa(i);function i(e,n){var r,a;return da(this,i),fa(ua(a=t.call(this,n)),"session",void 0),fa(ua(a),"adTrackingManager",void 0),fa(ua(a),"adListener",void 0),a.session=e,a.adTrackingManager=e.adTrackingManager,a.adListener=null===(r=e.adSession)||void 0===r?void 0:r.adEventsListener,a}return ha(i,[{key:"process",value:function(){var e=this.url.substring(i.SMARTLIB_PREFIX.length).split("/");if(e[0]===i.AD_BREAKS_TYPE&&e.length>=3)return this.onAdBreak(e[1],e[2]);if(e[0]===i.AD_TRACKER_TYPE&&e.length>=5)return this.onAdTracker(e[1],e[2],e[3],e[4]);if(e[0]===i.AD_SKIP_TYPE&&e.length>=5){var t=parseInt(e[3],10),n=parseInt(e[4],10);if(Number.isInteger(t)&&Number.isInteger(n))return this.onAdSkip(e[1],e[2],t,n)}else P.d(va,"Cannot parse event type with URL "+this.url);return!1}},{key:"onAdBreak",value:function(e,t){return e===i.AD_BREAKS_ACTION_BEGIN?(P.d(va,"Ad breaks begin"),void 0!==this.adListener&&this.adListener.onAdBreakBegin(-1,-1),this.adTrackingManager.notifyAdBreakBegin(t),!0):e===i.AD_BREAKS_ACTION_END&&(P.d(va,"Ad breaks ended"),void 0!==this.adListener&&this.adListener.onAdBreakEnd(),this.adTrackingManager.notifyAdBreakEnd(t),!0)}},{key:"onAdTracker",value:function(e,t,n,r){switch(e){case i.AD_TRACKER_ACTION_BEGIN:return P.d(va,"Ad start"),void 0!==this.adListener&&this.adListener.onAdBegin(-1,-1,""),this.adTrackingManager.notifyAdBegin(t,n,r),this.adTrackingManager.notifyAdProgress(t,n,r,0),!0;case i.AD_TRACKER_ACTION_25:return P.d(va,"Ad progress 25%"),this.adTrackingManager.notifyAdProgress(t,n,r,25),!0;case i.AD_TRACKER_ACTION_50:return P.d(va,"Ad progress 50%"),this.adTrackingManager.notifyAdProgress(t,n,r,50),!0;case i.AD_TRACKER_ACTION_75:return P.d(va,"Ad progress 75%"),this.adTrackingManager.notifyAdProgress(t,n,r,75),!0;case i.AD_TRACKER_ACTION_END:return P.d(va,"Ad end"),void 0!==this.adListener&&this.adListener.onAdEnd(),this.adTrackingManager.notifyAdProgress(t,n,r,100),this.adTrackingManager.notifyAdEnd(t,n,r),!0}return!1}},{key:"onAdSkip",value:function(e,t,n,r){return e===i.AD_SKIP_ACTION_SKIPPABLE&&(P.d(va,"Ad skippable"),void 0!==this.adListener&&this.adListener.onAdSkippable(n,r),this.adTrackingManager.notifyAdSkippable(t,n,r),!0)}}]),i}(function(){function e(t){da(this,e),fa(this,"url",void 0),this.url=t}return ha(e,[{key:"process",value:function(){throw new Error("AdTracker is an abstract class")}}]),e}());function ya(e){return(ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ga(e,t,i){return(ga="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_a(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function Ea(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sa(e,t)}function Sa(e,t){return(Sa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ba(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=_a(e);if(t){var r=_a(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return ka(this,i)}}function ka(e,t){return!t||"object"!==ya(t)&&"function"!=typeof t?ma(e):t}function ma(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _a(e){return(_a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Aa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Na(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ra(e,t,i){return t&&Na(e.prototype,t),i&&Na(e,i),e}function Da(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}fa(pa,"SMARTLIB_PREFIX","http://smartlib.broadpeak.tv/"),fa(pa,"AD_BREAKS_TYPE","adbreaks"),fa(pa,"AD_BREAKS_ACTION_BEGIN","begin"),fa(pa,"AD_BREAKS_ACTION_END","end"),fa(pa,"AD_TRACKER_TYPE","adtracker"),fa(pa,"AD_TRACKER_ACTION_BEGIN","progress_begin"),fa(pa,"AD_TRACKER_ACTION_25","progress_25"),fa(pa,"AD_TRACKER_ACTION_50","progress_middle"),fa(pa,"AD_TRACKER_ACTION_75","progress_75"),fa(pa,"AD_TRACKER_ACTION_END","progress_end"),fa(pa,"AD_SKIP_TYPE","adskip"),fa(pa,"AD_SKIP_ACTION_SKIPPABLE","skippable");var Pa="BpkAdTracker",Ta=function(){function e(){Aa(this,e),Da(this,"processDate",void 0),this.processDate=0}return Ra(e,[{key:"canProcess",value:function(){return Date.now()-this.processDate>ns.POSITION_SEEK_ERROR_DELTA}},{key:"process",value:function(){return!!this.canProcess()&&(this.processDate=Date.now(),!0)}}]),e}(),wa=function(e){Ea(i,e);var t=ba(i);function i(e,n){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return Aa(this,i),Da(ma(r=t.call(this)),"session",void 0),Da(ma(r),"url",void 0),Da(ma(r),"sessionToken",void 0),Da(ma(r),"adBreakId",void 0),Da(ma(r),"adId",void 0),r.session=e,r.url=n,r.sessionToken=a,r.adBreakId=s,r.adId=o,r}return Ra(i,[{key:"process",value:function(){return!!ga(_a(i.prototype),"process",this).call(this)&&(P.d(Pa,"Requesting "+this.url,this.session.id),me.getInstance().adEvent(this.session,this.url),!0)}}]),i}(Ta),Oa=function(e){Ea(i,e);var t=ba(i);function i(e,n,r){var a,s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return Aa(this,i),Da(ma(s=t.call(this)),"session",void 0),Da(ma(s),"adTrackingManager",void 0),Da(ma(s),"adListener",void 0),Da(ma(s),"sessionToken",void 0),Da(ma(s),"adBreakId",void 0),Da(ma(s),"adId",void 0),s.session=e,s.adTrackingManager=e.adTrackingManager,s.adListener=null===(a=e.adSession)||void 0===a?void 0:a.adEventsListener,s.sessionToken=n,s.adBreakId=r,s.adId=o,s}return Ra(i,[{key:"process",value:function(){return ga(_a(i.prototype),"process",this).call(this)}}]),i}(Ta),La=function(e){Ea(i,e);var t=ba(i);function i(e,n,r,a){var s;return Aa(this,i),Da(ma(s=t.call(this,e,n,r)),"adBreakData",void 0),s.adBreakData=a,s}return Ra(i,[{key:"process",value:function(){return!!ga(_a(i.prototype),"process",this).call(this)&&(P.d(Pa,"Ad break data"),this.adTrackingManager.notifyAdBreakData(this.adBreakData),!0)}}]),i}(Oa),Ca=function(e){Ea(i,e);var t=ba(i);function i(e,n,r){var a;return Aa(this,i),Da(ma(a=t.call(this,e,n,r)),"adBreakEnd",void 0),Da(ma(a),"adBreakData",void 0),Da(ma(a),"position",void 0),a}return Ra(i,[{key:"process",value:function(){if(!ga(_a(i.prototype),"process",this).call(this))return!1;if(P.d(Pa,"Ad break begin"),void 0!==this.adListener){var e=this.adBreakData.tracker.adBreakData;this.adListener.onAdBreakBegin(this.position,e.duration)}return this.adTrackingManager.notifyAdBreakBegin(this.sessionToken),!0}}]),i}(Oa),Ia=function(e){Ea(i,e);var t=ba(i);function i(e,n,r){return Aa(this,i),t.call(this,e,n,r)}return Ra(i,[{key:"process",value:function(){return!!ga(_a(i.prototype),"process",this).call(this)&&(P.d(Pa,"Ad break ended"),void 0!==this.adListener&&this.adListener.onAdBreakEnd(),this.adTrackingManager.notifyAdBreakEnd(this.sessionToken),!0)}}]),i}(Oa),Ma=function(e){Ea(i,e);var t=ba(i);function i(e,n,r,a){var s;return Aa(this,i),Da(ma(s=t.call(this,e,n,r,a.adId)),"adData",void 0),s.adData=a,s}return Ra(i,[{key:"process",value:function(){return!!ga(_a(i.prototype),"process",this).call(this)&&(P.d(Pa,"Ad data"),this.adTrackingManager.notifyAdData(this.adData),!0)}}]),i}(Oa),Ba=function(e){Ea(i,e);var t=ba(i);function i(e,n,r,a,s,o){var u;return Aa(this,i),Da(ma(u=t.call(this,e,n,r,s)),"creativeId",void 0),Da(ma(u),"adProgress",void 0),Da(ma(u),"position",void 0),u.creativeId=a,u.adProgress=o,u}return Ra(i,[{key:"process",value:function(){if(!ga(_a(i.prototype),"process",this).call(this))return!1;switch(this.adProgress){case 0:P.d(Pa,"Ad start"),this.adTrackingManager.notifyAdBegin(this.sessionToken,this.creativeId,this.adId),this.adTrackingManager.notifyAdProgress(this.sessionToken,this.creativeId,this.adId,0);break;case 25:P.d(Pa,"Ad progress 25%"),this.adTrackingManager.notifyAdProgress(this.sessionToken,this.creativeId,this.adId,25);break;case 50:P.d(Pa,"Ad progress 50%"),this.adTrackingManager.notifyAdProgress(this.sessionToken,this.creativeId,this.adId,50);break;case 75:P.d(Pa,"Ad progress 75%"),this.adTrackingManager.notifyAdProgress(this.sessionToken,this.creativeId,this.adId,75);break;case 100:P.d(Pa,"Ad end"),void 0!==this.adListener&&this.adListener.onAdEnd(),this.adTrackingManager.notifyAdProgress(this.sessionToken,this.creativeId,this.adId,100),this.adTrackingManager.notifyAdEnd(this.sessionToken,this.creativeId,this.adId)}return!0}},{key:"skipped",value:function(){this.adTrackingManager.notifyAdSkipped(this.sessionToken,this.creativeId,this.adId)}}]),i}(Oa),Ua=function(e){Ea(i,e);var t=ba(i);function i(e,n,r,a,s,o){var u;return Aa(this,i),Da(ma(u=t.call(this,e,n,r,a,s,o)),"adBreakBegin",void 0),Da(ma(u),"adEnd",void 0),Da(ma(u),"adData",void 0),Da(ma(u),"adSkippable",void 0),u}return Ra(i,[{key:"process",value:function(){if(!this.canProcess())return!1;if(void 0!==this.adListener){var e=this.adData.tracker.adData;this.adListener.onAdBegin(this.position,e.duration,e.clickable.uri)}return ga(_a(i.prototype),"process",this).call(this)}}]),i}(Ba),ja=function(e){Ea(i,e);var t=ba(i);function i(e,n,r,a,s,o,u){var l;return Aa(this,i),Da(ma(l=t.call(this,e,n,r,s)),"creativeId",void 0),Da(ma(l),"offset",void 0),Da(ma(l),"limit",void 0),l.creativeId=a,l.offset=o,l.limit=u,l}return Ra(i,[{key:"process",value:function(){return!!ga(_a(i.prototype),"process",this).call(this)&&(P.d(Pa,"Ad skippable"),void 0!==this.adListener&&this.adListener.onAdSkippable(this.offset,this.limit),this.adTrackingManager.notifyAdSkippable(this.sessionToken,this.offset,this.limit),!0)}}]),i}(Oa),Fa=function(){function e(){Aa(this,e)}return Ra(e,null,[{key:"parseLegacyTracker",value:function(t,i){return e.isSmartLibPrefix(i)?new pa(t,i):new wa(t,i)}},{key:"isSmartLibPrefix",value:function(e){return e.startsWith(pa.SMARTLIB_PREFIX)}}]),e}();function Va(e){return(Va="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xa(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ga(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ha(e,t)}function Ha(e,t){return(Ha=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Wa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ka(e);if(t){var r=Ka(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return qa(this,i)}}function qa(e,t){return!t||"object"!==Va(t)&&"function"!=typeof t?Ya(e):t}function Ya(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ka(e){return(Ka=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function za(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Ja=function e(){Qa(this,e),za(this,"tracker",void 0)},Xa=function(e){Ga(i,e);var t=Wa(i);function i(){return Qa(this,i),t.apply(this,arguments)}return i}(Ja),Za=function(e){Ga(i,e);var t=Wa(i);function i(){var e;Qa(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return za(Ya(e=t.call.apply(t,[this].concat(r))),"position",void 0),e}return i}(Ja),$a=function(){function e(){Qa(this,e)}var t,i,n;return t=e,n=[{key:"parseDashEvent",value:function(e,t){var i=new Xa;return i.tracker=Fa.parseLegacyTracker(e,t),i}},{key:"parseJSONEvent",value:function(e,t){var i=new Za;return i.tracker=Fa.parseLegacyTracker(e,t.url),i.position=t.position,i}},{key:"createAdBreakData",value:function(e,t,i,n,r){var a=new Za;return a.tracker=new La(e,t,i,n),a.position=r,a}},{key:"createAdBreakBegin",value:function(e,t,i,n){var r=new Za;return r.tracker=new Ca(e,t,i),r.tracker.position=n,r.position=n,r}},{key:"createAdBreakEnd",value:function(e,t,i,n){var r=new Za;return r.tracker=new Ia(e,t,i),r.position=n,r}},{key:"createAdData",value:function(e,t,i,n,r){var a=new Za;return a.tracker=new Ma(e,t,i,n),a.position=r,a}},{key:"createAdProgress",value:function(e,t,i,n,r,a,s){var o=new Za;return o.tracker=0===a?new Ua(e,t,i,n,r,a):new Ba(e,t,i,n,r,a),o.tracker.position=s,o.position=s,o}},{key:"createAdSkippable",value:function(e,t,i,n,r,a,s,o){var u=new Za;return u.tracker=new ja(e,t,i,n,r,a,s),u.position=o,u}},{key:"createThirdParty",value:function(e,t,i,n,r,a){var s=new Za;return s.tracker=new wa(e,i,n,r,a),s.position=t,s}}],(i=null)&&xa(t.prototype,i),n&&xa(t,n),e}();function es(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ts(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var is="BpkAdTrackingMgr",ns=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ts(this,"session",void 0),ts(this,"playerAdapter",void 0),ts(this,"listeners",void 0),ts(this,"baseEvents",void 0),ts(this,"currentEvents",void 0),ts(this,"updatePositionJob",void 0),ts(this,"updateBkYouSessionJob",void 0),ts(this,"started",void 0),ts(this,"paused",void 0),ts(this,"buffering",void 0),ts(this,"lastPosition",void 0),ts(this,"lastPositionBeforePause",void 0),ts(this,"lastPositionBeforeBuffering",void 0),ts(this,"lastPositionAfterSeek",void 0),ts(this,"firstImageDate",void 0),ts(this,"currentAdBreakBegin",void 0),ts(this,"currentAdBegin",void 0),ts(this,"adPalSession",void 0),ts(this,"bkYouSession",void 0),ts(this,"bkYouSessionToken",void 0),ts(this,"bkYouBaseURL",void 0),ts(this,"bkYouNonce",void 0),ts(this,"bkYouAdPalSessionRequest",void 0),ts(this,"bkYouFirstFileReceived",void 0),ts(this,"bkYouFirstFileProceeded",void 0),this.session=t,this.playerAdapter=i,this.listeners=[],this.baseEvents=[],this.currentEvents=[],this.updatePositionJob=void 0,this.updateBkYouSessionJob=void 0,this.started=!1,this.paused=!1,this.buffering=!1,this.lastPosition=0,this.lastPositionBeforePause=0,this.lastPositionBeforeBuffering=0,this.lastPositionAfterSeek=0,this.currentAdBreakBegin=void 0,this.bkYouSession=!1,this.bkYouBaseURL=void 0,this.bkYouNonce=void 0,this.bkYouAdPalSessionRequest=void 0,this.bkYouFirstFileReceived=!1,this.bkYouFirstFileProceeded=!1}var t,i,n;return t=e,(i=[{key:"initBkYouSession",value:function(e,t,i,n,r){this.bkYouBaseURL=e,this.bkYouSessionToken=t,this.bkYouSession=!0,void 0!==n&&(this.adPalSession=n,this.bkYouNonce=r),this.parseAdPods(i)}},{key:"updateBkYouSession",value:function(){var t=this;if(!0!==this.session.stopped&&!0===this.bkYouSession){P.d(is,"Updating ad tracking file...",this.session.id);var i=this.bkYouBaseURL;void 0!==this.bkYouNonce&&(i=O.addOrReplaceParam(i,ce.AD_NONCE_QUERY_PARAMETER,this.bkYouNonce));var n={userAgent:this.session.smartLib.getParameters().userAgent};me.getInstance().adTracking(this.session,n,i,!0).then((function(i){if(!0!==t.session.stopped){if(void 0!==t.updateBkYouSessionJob&&H.getInstance().cancel(t.updateBkYouSessionJob),i.httpStatus>=200&&i.httpStatus<300){var n;try{n=JSON.parse(i.content)}catch(i){return P.d(is,"Ad tracking updated file unreadable",t.session.id),void(!0===t.bkYouFirstFileReceived&&(t.updateBkYouSessionJob=H.getInstance().asyncDelay(e.SESSION_UPDATE_INTERVAL,(function(){t.updateBkYouSessionJob=void 0,t.updateBkYouSession()}))))}t.bkYouFirstFileReceived=!0,void 0!==t.currentAdBreakBegin?(t.baseEvents=t.baseEvents.filter((function(e){return e.tracker.adBreakId===t.currentAdBreakBegin.tracker.adBreakId})),t.currentEvents=t.currentEvents.filter((function(e){return e.tracker.adBreakId===t.currentAdBreakBegin.tracker.adBreakId}))):(t.baseEvents=[],t.currentEvents=[]),t.parseAdPods(n)}i.httpStatus>=200&&i.httpStatus<300?t.updateBkYouSessionJob=H.getInstance().asyncDelay(e.SESSION_UPDATE_INTERVAL,(function(){t.updateBkYouSessionJob=void 0,t.updateBkYouSession()})):P.d(is,"Stopping ad tracking file update (status code "+i.httpStatus+")",t.session.id)}}))}}},{key:"parseAdPods",value:function(e){var t=this,i=[],n=e.sessiontoken||"",r=e.timereference_ms||0,a=e.adpods;Array.isArray(a)&&a.forEach((function(e){var a=e.id,s=e.starttime_ms+r,o=e.duration_ms||0,u=e.ads;if(Array.isArray(u)){var l=0,d=0;if(u.forEach((function(e){var t=e.starttime_ms+r,i=e.duration_ms||0;t>l&&(l=t,d=i)})),l>0){var c=l+d-s;c!==o&&(P.d(is,"Updating ad break duration from "+o+" to "+c),o=c)}}var h=$a.createAdBreakData(t.session,n,a,{adBreakId:a,startTime:s,duration:o},s);i.push(h);var f=$a.createAdBreakBegin(t.session,n,a,s),v=$a.createAdBreakEnd(t.session,n,a,s+o);f.tracker.adBreakEnd=v,f.tracker.adBreakData=h,i.push(f),Array.isArray(u)&&u.forEach((function(e){var s,o,u,l=e.creativeid||"",d=e.starttime_ms+r,c=e.skippable_ms+r||0,h=e.duration_ms||0,v=e.adid+"-"+d||"",p=e.trackingevents,y=(null===(s=e.videoclicks)||void 0===s?void 0:s.clickthroughurl)||"",g=(null===(o=e.videoclicks)||void 0===o?void 0:o.clicktracking)||[],E=(null===(u=e.videoclicks)||void 0===u?void 0:u.customclick)||[],S=e.adverifications||[],b=[];if(S.forEach((function(e){var t={vendor:e.vendor||"",javascriptResources:e.javascriptresources||[],executableResources:e.executableresources||[],trackingEvents:e.trackingevents||[],verificationParameters:e.verificationparameters||""};b.push(t)})),void 0!==d&&void 0!==h){var k=$a.createAdData(t.session,n,a,{creativeId:l,adId:v,startTime:d,skippableTime:c,duration:h,skippable:0!==c&&null!=c,clickable:{uri:y,trackers:g,customClick:E},verifications:b},d);i.push(k);var m=$a.createAdProgress(t.session,n,a,l,v,0,d);if(i.push(m),m.tracker.adData=k,c>0){var _=$a.createAdSkippable(t.session,n,a,l,v,c,d+h,d+1);i.push(_),m.tracker.adSkippable=_}i.push($a.createAdProgress(t.session,n,a,l,v,25,d+Math.round(h/4))),i.push($a.createAdProgress(t.session,n,a,l,v,50,d+Math.round(h/2))),i.push($a.createAdProgress(t.session,n,a,l,v,75,d+Math.round(3*h/4)));var A=$a.createAdProgress(t.session,n,a,l,v,100,d+h-1);i.push(A),m.tracker.adBreakBegin=f,m.tracker.adEnd=A}Array.isArray(p)&&p.forEach((function(e){var s=e.callbackurl,o=e.time_ms;void 0!==s&&void 0!==o&&i.push($a.createThirdParty(t.session,o+r,s,n,a,v))}))})),i.push(v)})),this.addEvents(i)}},{key:"start",value:function(){var t=this;void 0===this.updatePositionJob&&(this.updatePositionJob=H.getInstance().asyncDelay(e.POSITION_UPDATE_INTERVAL,(function(){t.updatePositionJob=void 0,t.onPositionUpdated(t.playerAdapter.getPosition())})))}},{key:"stop",value:function(){void 0!==this.updatePositionJob&&(P.d(is,"Ad tracking paused (player event)",this.session.id),H.getInstance().cancel(this.updatePositionJob),this.updatePositionJob=void 0)}},{key:"addEvents",value:function(e){var t=this;if(void 0!==this.currentAdBegin){this.currentAdBreakBegin=this.currentAdBegin.tracker.adBreakBegin;var i=this.currentAdBegin.tracker.adBreakId+"-"+this.currentAdBegin.tracker.adId,n=e.length,r=e.find((function(e){return e.tracker instanceof Ca&&e.tracker.adBreakId===t.currentAdBreakBegin.tracker.adBreakId}));(e=e.filter((function(e){return e.tracker.adBreakId+"-"+e.tracker.adId!==i&&(e.tracker.adBreakId!==t.currentAdBreakBegin.tracker.adBreakId||void 0!==e.tracker.adId)}))).length!==n&&(this.currentAdBreakBegin.tracker.adBreakEnd.position=r.tracker.adBreakEnd.position,this.currentAdBreakBegin.tracker.adBreakEnd.tracker.position=r.tracker.adBreakEnd.tracker.position,this.currentAdBreakBegin.tracker.adBreakData.tracker.adBreakData.duration=r.tracker.adBreakData.tracker.adBreakData.duration,e.forEach((function(e){e.tracker instanceof Ua&&e.tracker.adBreakId===t.currentAdBreakBegin.tracker.adBreakId&&(e.tracker.adBreakBegin=t.currentAdBreakBegin)})))}var a=[],s=[];this.baseEvents.forEach((function(e){void 0!==e.tracker.adBreakId&&void 0!==e.tracker.adId?s.push(e.tracker.adBreakId+"-"+e.tracker.adId):void 0!==e.tracker.adBreakId&&void 0===e.tracker.adId&&a.push(e.tracker.adBreakId+"-undefined")})),(e=e.filter((function(e){return-1===s.indexOf(e.tracker.adBreakId+"-"+e.tracker.adId)&&-1===a.indexOf(e.tracker.adBreakId+"-"+e.tracker.adId)}))).forEach((function(e){return t.baseEvents.push(e)})),this.baseEvents=this.baseEvents.sort((function(e,t){return e.position-t.position})),this.notifyAdsUpdated(this.baseEvents.filter((function(e){return e.tracker instanceof Ua}))),this.currentEvents=this.baseEvents.filter((function(e){return e.position>=t.lastPosition})),!this.started||this.paused||this.buffering||(void 0===this.updatePositionJob&&this.currentEvents.length>0&&(P.d(is,"Ad tracking resumed",this.session.id),this.lastPosition=this.playerAdapter.getPosition()),this.checkStart())}},{key:"onPositionUpdated",value:function(t){var i=this,n=this.lastPosition!==t?this.lastPosition:t-1,r=t;if(!0===this.bkYouFirstFileReceived&&!1===this.bkYouFirstFileProceeded&&(this.bkYouFirstFileProceeded=!0,Date.now()-this.firstImageDate<=4e3)){var a=this.baseEvents.slice().reverse().find((function(e){return e.tracker instanceof Ba&&0===e.tracker.adProgress&&n-1e3<e.position&&e.position<n}));void 0!==a?(this.currentAdBreakBegin=a.tracker.adBreakBegin,this.currentAdBreakBegin.tracker.adBreakData.tracker.process(),this.currentAdBreakBegin.tracker.process(),this.baseEvents.filter((function(e){return a.position<=e.position&&e.position<=n&&!(e.tracker instanceof Ca)&&!(e.tracker instanceof La)})).forEach((function(e){return e.tracker.process()})),this.currentAdBegin=a):this.processCurrentAdBreak(t)}if(n<r&&r-n<e.POSITION_SEEK_ERROR_DELTA){var s=this.currentEvents.filter((function(e){return e.position>n&&e.position<=r}));s.forEach((function(e){var t=e.tracker;t.constructor.name.length>3&&P.d(is,"Processing "+t.constructor.name,i.session.id),t instanceof Ca?i.currentAdBreakBegin=e:t instanceof Ia?i.currentAdBreakBegin=void 0:t instanceof Ba&&0===t.adProgress?i.currentAdBegin=e:t instanceof Ba&&100===t.adProgress&&(i.currentAdBegin=void 0),t.process()})),this.currentEvents=this.baseEvents.filter((function(e){return e.position>r})),this.lastPosition=t,P.d(is,"Start: "+(n+1)+", End: "+r+", Current events: "+JSON.stringify(s.map((function(e){return{position:e.position,url:e.tracker.url}})))+", Remaining events number: "+this.currentEvents.length+", Base events number: "+this.baseEvents.length,this.session.id),this.currentEvents.length>0?this.paused||this.buffering?P.d(is,"Ad tracking paused (playback paused)",this.session.id):this.start():P.d(is,"Ad tracking paused (no more event)",this.session.id)}else P.d(is,"Start: "+n+", End: "+r+", skipping...",this.session.id)}},{key:"checkStart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.playerAdapter.getPosition();this.currentEvents.length>0?this.onPositionUpdated(e):P.d(is,"Ad tracking paused (no more event)",this.session.id)}},{key:"adUserInteraction",value:function(e){var t,i,n=this,r=null===(t=this.currentAdBegin)||void 0===t||null===(i=t.tracker.adData)||void 0===i?void 0:i.tracker.adData;void 0!==r&&r.clickable.trackers.forEach((function(e){P.d(is,"Requesting click tracker "+e.clickurl,n.session.id),me.getInstance().adEvent(n.session,e.clickurl)}))}},{key:"onFirstImage",value:function(e,t){var i=this;this.started=!0,this.paused=!1,this.buffering=!1,this.lastPosition=t,this.firstImageDate=Date.now(),this.currentEvents=this.baseEvents.filter((function(e){return e.position>=i.lastPosition})),this.checkStart(t),this.updateBkYouSession()}},{key:"onPause",value:function(){this.paused=!0,this.stop();var e=this.playerAdapter.getPosition();this.lastPosition!==e?this.onPositionUpdated(e):P.d(is,"Ignoring player position "+e+", already proceeded...",this.session.id),this.lastPosition=e,this.lastPositionBeforePause=this.lastPosition}},{key:"onResume",value:function(){this.paused=!1,this.buffering||(this.lastPosition=this.playerAdapter.getPosition(),Math.abs(this.lastPosition-this.lastPositionBeforePause)<1e3&&(P.d(is,"Reverting position because of bad position when resuming...",this.session.id),this.lastPosition=this.lastPositionBeforePause,this.lastPositionBeforePause=0),this.checkStart())}},{key:"onBufferingStart",value:function(){this.buffering=!0,this.stop();var e=this.playerAdapter.getPosition();this.lastPosition!==e?this.onPositionUpdated(e):P.d(is,"Ignoring player position "+e+", already proceeded...",this.session.id),this.lastPosition=e,this.lastPositionBeforeBuffering=this.lastPosition}},{key:"onBufferingEnd",value:function(e){this.buffering=!1,this.paused||(this.lastPosition=this.playerAdapter.getPosition(),Math.abs(this.lastPosition-this.lastPositionBeforeBuffering)<1e3&&(P.d(is,"Reverting position because of period switch...",this.session.id),this.lastPosition=this.lastPositionBeforeBuffering,this.lastPositionBeforeBuffering=0),Math.abs(this.lastPosition-this.lastPositionAfterSeek)<1e3&&(P.d(is,"Reverting position because of seek...",this.session.id),this.lastPosition=this.lastPositionAfterSeek,this.lastPositionAfterSeek=0),this.checkStart())}},{key:"processCurrentAdBreak",value:function(e){if(void 0===this.currentAdBreakBegin)for(var t,i,n=this.baseEvents.slice().reverse().filter((function(t){return t.position<=e})),r=0;r<n.length;r++){var a=n[r];if(void 0===t&&a.tracker instanceof Ca&&(t=a),void 0===i&&a.tracker instanceof Ua&&(i=a),void 0!==t&&void 0!==i&&e<=i.tracker.adEnd.position){var s;this.currentAdBreakBegin=t,this.currentAdBegin=i,t.tracker.adBreakData.tracker.process(),t.tracker.process(),i.tracker.adData.tracker.process(),i.tracker.process(),i.tracker.skipped(),null===(s=i.tracker.adSkippable)||void 0===s||s.tracker.process();break}}}},{key:"onSeek",value:function(t,i){var n=this,r=this.lastPosition;if(this.lastPosition=i,this.buffering?this.lastPositionAfterSeek=i:this.lastPositionAfterSeek=0,this.currentEvents=this.baseEvents.filter((function(e){return e.position>=n.lastPosition})),Math.abs(i-t)<e.POSITION_SEEK_ERROR_DELTA){var a,s;P.d(is,"Seek detected, proceeding events..."),t<i?(a=r,s=i):(a=i,s=r<t?t:r);for(var o=a;o<=s;o+=e.POSITION_UPDATE_INTERVAL){var u=Math.min(o+e.POSITION_UPDATE_INTERVAL,s);P.d(is,"Between "+o+" and "+u),this.lastPosition=o,this.onPositionUpdated(u)}P.d(is,"Seek processed start:"+a+" end:"+s)}else if(this.processCurrentAdBreak(i),this.onPositionUpdated(i),void 0!==this.currentAdBreakBegin){var l,d=this.currentAdBreakBegin.position,c=null===(l=this.currentAdBreakBegin.tracker.adBreakEnd)||void 0===l?void 0:l.position;if(t<i&&c<=i)this.currentAdBreakBegin.tracker.adBreakEnd.tracker.process(),this.currentAdBreakBegin=void 0,this.currentAdBegin=void 0,this.processCurrentAdBreak(i);else if(i<t&&i<d)this.currentAdBreakBegin.tracker.adBreakEnd.tracker.process(),this.currentAdBreakBegin=void 0,this.currentAdBegin=void 0,this.processCurrentAdBreak(i);else if(d<i&&i<c){var h,f=this.baseEvents.slice().reverse().find((function(t){return t.tracker instanceof Ba&&0===t.tracker.adProgress&&i-e.POSITION_UPDATE_INTERVAL<t.position&&t.position<=i}));void 0!==f?this.currentAdBegin!==f&&(this.baseEvents.filter((function(e){return f.position<=e.position&&e.position<=i&&!(e.tracker instanceof Ca)})).forEach((function(e){e.tracker.process()})),this.currentAdBegin=f):void 0!==(f=this.baseEvents.slice().reverse().find((function(e){return e.tracker instanceof Ba&&0===e.tracker.adProgress&&e.position<i})))&&this.currentAdBegin!==f&&(this.currentAdBegin.tracker.adEnd.tracker.process(),f.tracker.adData.tracker.process(),f.tracker.process(),null===(h=f.tracker.adSkippable)||void 0===h||h.tracker.process(),this.currentAdBegin=f)}}}},{key:"onStop",value:function(e){this.stop(),this.lastPosition=this.playerAdapter.getPosition(),this.onPositionUpdated(this.lastPosition),this.stop(),void 0!==this.updateBkYouSessionJob&&H.getInstance().cancel(this.updateBkYouSessionJob)}},{key:"addListener",value:function(e){void 0===e||this.listeners.includes(e)||this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}},{key:"notifyEvent",value:function(e,t,i,n,r,a){"function"==typeof e[t]&&e[t](i,n,r,a)}},{key:"notifyAdBreakData",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdBreakData",e)}))}},{key:"notifyAdBreakBegin",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdBreakBegin",e)}))}},{key:"notifyAdData",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdData",e)}))}},{key:"notifyAdBegin",value:function(e,t,i){var n,r=this;this.listeners.forEach((function(n){r.notifyEvent(n,"onAdBegin",e,t,i)})),null===(n=this.adPalSession)||void 0===n||n.sendAdImpression()}},{key:"notifyAdSkippable",value:function(e,t,i){var n=this;this.listeners.forEach((function(r){n.notifyEvent(r,"onAdSkippable",e,t,i)}))}},{key:"notifyAdProgress",value:function(e,t,i,n){var r=this;this.listeners.forEach((function(a){r.notifyEvent(a,"onAdProgress",e,t,i,n)}))}},{key:"notifyAdSkipped",value:function(e,t,i){var n=this;this.listeners.forEach((function(r){n.notifyEvent(r,"onAdSkipped",e,t,i)}))}},{key:"notifyAdEnd",value:function(e,t,i){var n=this;this.listeners.forEach((function(r){n.notifyEvent(r,"onAdEnd",e,t,i)}))}},{key:"notifyAdBreakEnd",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdBreakEnd",e)}))}},{key:"notifyAdsUpdated",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdsUpdated",e)}))}}])&&es(t.prototype,i),n&&es(t,n),e}();function rs(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function as(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}ts(ns,"POSITION_UPDATE_INTERVAL",1e3),ts(ns,"POSITION_SEEK_ERROR_DELTA",6e3),ts(ns,"SESSION_UPDATE_INTERVAL",5e3),ts(ns,"NONCE_EXPIRATION_TIME",3e5);var ss="BpkAdMetricsMgr",os=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),as(this,"session",void 0),as(this,"timeline",void 0),as(this,"builder",void 0),as(this,"adMetrics",void 0),as(this,"firstImage",void 0),as(this,"lastLayerBitrate",void 0),as(this,"adBreakPlaying",void 0),as(this,"adPlaying",void 0),as(this,"adProgress",void 0),as(this,"adQuartiles",void 0),as(this,"adSkipped",void 0),as(this,"adLastLayerSwitchDate",void 0),as(this,"adLastBufferingStartDate",void 0),this.session=t,this.timeline=this.session.sessionReport.timeline,this.builder=new na,this.adMetrics={}}var t,i,n;return t=e,(i=[{key:"onStart",value:function(){this.adMetrics={},this.adLastLayerSwitchDate=0,this.firstImage=!1,this.lastLayerBitrate=0,this.adLastBufferingStartDate=-1,this.adBreakPlaying=!1,this.adPlaying=!1,this.adProgress=0,this.adQuartiles={},this.adSkipped=!1}},{key:"onFirstImage",value:function(e,t){this.lastLayerBitrate=e,this.adLastLayerSwitchDate=Date.now(),this.firstImage=!0}},{key:"onLayerSwitch",value:function(e){this.adBreakPlaying&&this.firstImage&&(this.builder.addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate),this.adLastLayerSwitchDate=Date.now(),this.lastLayerBitrate!==e&&this.builder.addLayerSwitch()),this.lastLayerBitrate=e}},{key:"onBufferingStart",value:function(){this.adBreakPlaying&&(this.adLastBufferingStartDate=Date.now())}},{key:"onStallEnd",value:function(){this.adBreakPlaying&&this.adLastBufferingStartDate>=0&&this.builder.addStall(Date.now()-this.adLastBufferingStartDate),this.adLastBufferingStartDate=-1}},{key:"onRebufferingEnd",value:function(){this.adLastBufferingStartDate=-1}},{key:"onSeek",value:function(e,t){this.adBreakPlaying&&(P.d(ss,"Ad seeked from "+ai.formatTime(e)+" to "+ai.formatTime(t)),Math.abs(t-e)<ns.POSITION_SEEK_ERROR_DELTA?P.d(ss,"Ignoring seek < "+ns.POSITION_SEEK_ERROR_DELTA+"ms"):this.adSkipped=!0)}},{key:"onStop",value:function(e){this.adBreakPlaying&&(this.adSkipped=!0,this.handleAdEnd(),this.adBreakPlaying=!1)}},{key:"onAdBreakBegin",value:function(e){var t;this.adBreakPlaying=!0,void 0!==this.timeline&&this.timeline.pushEvent(null===(t=Jt.analyticsModule)||void 0===t?void 0:t.SessionTrackerEvents.AdBreakStart)}},{key:"onAdBegin",value:function(e,t,i){this.adSkipped&&this.handleAdEnd(),this.adSkipped=!1,this.adLastLayerSwitchDate=Date.now(),this.builder.reset().setSessionToken(e).setCreativeId(t).setAdId(i),this.adQuartiles={},this.adPlaying=!0}},{key:"onAdSkippable",value:function(e,t,i){this.builder.setAdSkippable(!0)}},{key:"onAdSkipped",value:function(e,t,i){this.adSkipped=!0,void 0!==this.adQuartiles[0]&&delete this.adQuartiles[0]}},{key:"onAdProgress",value:function(e,t,i,n){this.adQuartiles[n]=!0,this.adProgress=25*Object.keys(this.adQuartiles).length-25,n>0&&void 0===this.adQuartiles[n-25]&&(this.adSkipped=!0)}},{key:"onAdEnd",value:function(e,t,i){this.handleAdEnd(),this.adPlaying=!1}},{key:"onAdBreakEnd",value:function(e){var t;!0===this.adPlaying&&(this.builder.setAdSkipped(!0),this.handleAdEnd()),this.adBreakPlaying=!1,void 0!==this.timeline&&this.timeline.pushEventProgress(null===(t=Jt.analyticsModule)||void 0===t?void 0:t.SessionTrackerEvents.AdBreakStop,this.adProgress)}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(e){if(this.adBreakPlaying){var t=this.builder.clone().setAdProgress(this.adProgress).addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate);this.adLastBufferingStartDate>=0&&t.addStall(Date.now()-this.adLastBufferingStartDate);var i=t.build();i.adId.length>0&&(this.adMetrics[i.adId]=i)}e.adMetrics=Object.values(this.adMetrics)}},{key:"onEndSessionReportUpdateRequested",value:function(e){e.adMetrics=Object.values(this.adMetrics)}},{key:"handleAdEnd",value:function(){this.builder.setAdSkipped(this.adSkipped).setAdProgress(this.adProgress).addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate);var e=this.builder.build();e.adId.length>0&&(this.adMetrics[e.adId]=e),P.d(ss,"Ad metrics : "+e.toString()),this.builder.reset(),this.adSkipped=!1}},{key:"onAdsUpdated",value:function(e){var t=this;e.forEach((function(e){if(void 0===t.adMetrics[e.tracker.adId]){var i=new na;t.adMetrics[e.tracker.adId]=i.setSessionToken(e.tracker.sessionToken).setCreativeId(e.tracker.creativeId).setAdId(e.tracker.adId).build(),P.d(ss,"Adding ad metrics report for ad id "+e.tracker.adId)}}))}}])&&rs(t.prototype,i),n&&rs(t,n),e}();function us(e,t,i,n){return cs(e,t),ds(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n),n}function ls(e,t,i){return cs(e,t),ds(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}function ds(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function cs(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function hs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fs(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vs(e,t,i){return t&&fs(e.prototype,t),i&&fs(e,i),e}var ps="BpkOMSDKMgr",ys=function(){function e(){hs(this,e),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"smartLib",void 0)}return vs(e,[{key:"init",value:function(){P.d(ps,"Initializing OM SDK manager...")}},{key:"release",value:function(){}},{key:"attachInstance",value:function(e){this.smartLib=e}},{key:"attachHandler",value:function(e){P.d(ps,"Attaching OM SDK handler..."),this.omsdkHandler=e}},{key:"isEnabled",value:function(){return void 0!==this.omsdkHandler&&null!==this.omsdkHandler}}],[{key:"getInstance",value:function(){return ls(e,e,gs)||us(e,e,gs,new e),ls(e,e,gs)}}]),e}(),gs={writable:!0,value:void 0};function Es(e){return function(e){if(Array.isArray(e))return Ss(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Ss(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ss(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ss(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function bs(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ks(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ms="BpkOMSessionHandler",_s=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ks(this,"session",void 0),ks(this,"adSession",void 0),ks(this,"playerAdapter",void 0),ks(this,"internalAdManager",void 0),ks(this,"omsdkHandler",void 0),ks(this,"omAdSession",void 0),ks(this,"firstImageDate",void 0),ks(this,"adBreakPosition",void 0),this.session=t,this.adSession=t.adSession,this.playerAdapter=i,this.internalAdManager=this.session.smartLib.internalAdManager,this.omsdkHandler=ys.getInstance().omsdkHandler,this.firstImageDate=0,this.adBreakPosition="midroll"}var t,i,n;return t=e,(i=[{key:"onStart",value:function(){}},{key:"onRedirectionEnd",value:function(){}},{key:"onFirstImage",value:function(e,t){this.firstImageDate=Date.now()}},{key:"onLayerSwitch",value:function(e){}},{key:"onPause",value:function(){var e;null===(e=this.omAdSession)||void 0===e||e.pause()}},{key:"onResume",value:function(){var e;null===(e=this.omAdSession)||void 0===e||e.resume()}},{key:"onBufferingStart",value:function(){var e;null===(e=this.omAdSession)||void 0===e||e.bufferStart()}},{key:"onBufferingEnd",value:function(e){var t;null===(t=this.omAdSession)||void 0===t||t.bufferFinish()}},{key:"onStallEnd",value:function(){}},{key:"onRebufferingEnd",value:function(){}},{key:"onSeek",value:function(e,t){var i;void 0!==this.adData&&Math.abs(t-e)>=1e3&&(t>=this.adData.startTime+this.adData.duration||t<this.adData.startTime)&&(null===(i=this.omAdSession)||void 0===i||i.skipped())}},{key:"onStop",value:function(e){this.adData=void 0,void 0!==this.omAdSession&&(this.omAdSession.finish(),this.omAdSession=void 0),this.adBreakPosition="midroll"}},{key:"onStartSessionReportUpdateRequested",value:function(e){}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(e){}},{key:"onEndSessionReportUpdateRequested",value:function(e){}},{key:"onAdBreakData",value:function(e){Math.abs(e.startTime+e.duration-this.playerAdapter.getDuration())<1e4?this.adBreakPosition="postroll":Date.now()-this.firstImageDate<3e3?this.adBreakPosition="preroll":this.adBreakPosition="midroll",P.d(ms,"Ad break position is "+this.adBreakPosition,this.session.id)}},{key:"onAdBreakBegin",value:function(e){}},{key:"onAdData",value:function(e){var t,i,n,r,a,s,o,u=this;void 0!==this.adData&&(null===(s=this.omAdSession)||void 0===s||s.finish(),this.omAdSession=void 0),this.adData=e,o=void 0!==(null===(t=this.adSession)||void 0===t?void 0:t.adVerificationData)?Es(this.adSession.adVerificationData):[],this.adData.verifications.forEach((function(e){var t=e.javascriptResources.find((function(e){return"omid"===e.apiframework}));o.push({verificationVendor:e.vendor,verificationURL:t.url,verificationParameters:e.verificationParameters})})),this.omAdSession=this.omsdkHandler.createOMAdSession(this.internalAdManager.omPartnerName,this.internalAdManager.omPartnerVersion,null===(i=this.adSession)||void 0===i?void 0:i.adCustomReference,o),void 0!==(null===(n=this.adSession)||void 0===n?void 0:n.adView)&&this.omAdSession.setAdView(this.adSession.adView),(null===(r=this.adSession)||void 0===r?void 0:r.adFriendlyObstructionViews.length)>0&&this.adSession.adFriendlyObstructionViews.forEach((function(e){u.omAdSession.registerAdFriendlyObstructionView(e.view,e.purpose,e.reason)})),this.omAdSession.start(),void 0!==(null===(a=this.adSession)||void 0===a?void 0:a.adViewState)&&this.omAdSession.setAdViewState(this.adSession.adViewState),!0===e.skippable?this.omAdSession.loaded(e.skippableTime-e.startTime,e.duration,this.adBreakPosition,this.playerAdapter.getVolume()):this.omAdSession.loaded(-1,e.duration,this.adBreakPosition,this.playerAdapter.getVolume())}},{key:"onAdBegin",value:function(e,t,i){}},{key:"onAdSkippable",value:function(e,t,i){}},{key:"onAdProgress",value:function(e,t,i,n){var r;null===(r=this.omAdSession)||void 0===r||r.progress(n)}},{key:"onAdEnd",value:function(e,t,i){var n;this.adData=void 0,null===(n=this.omAdSession)||void 0===n||n.finish(),this.omAdSession=void 0}},{key:"onAdBreakEnd",value:function(e){this.adData=void 0,void 0!==this.omAdSession&&(this.omAdSession.finish(),this.omAdSession=void 0),this.adBreakPosition="midroll"}},{key:"onVolumeChanged",value:function(e){var t;P.d(ms,"Volume is now "+e,this.session.id),null===(t=this.omAdSession)||void 0===t||t.volumeChange(e)}},{key:"onPlayerError",value:function(e,t){var i;P.e(ms,"Broadpeak status code "+e,this.session.id),P.e(ms,"Player error code "+t,this.session.id),null===(i=this.omAdSession)||void 0===i||i.error(e,t)}}])&&bs(t.prototype,i),n&&bs(t,n),e}();function As(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ns(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Rs(e,t,i,n){return Ts(e,t),Ps(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n),n}function Ds(e,t,i){return Ts(e,t),Ps(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}function Ps(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Ts(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}Jt.adModule={AdMetrics:ia,AdMetricsBuilder:na,AdMetricsManager:os,AdEvent:Ja,AdJSONEvent:Za,AdDashEvent:Xa,AdEventFactory:$a,AdSmartLibLegacyTracker:pa,AdTracker:Ta,AdThirdPartyTracker:wa,AdSmartLibTracker:Oa,AdBreakDataTracker:La,AdBreakBeginTracker:Ca,AdBreakEndTracker:Ia,AdDataTracker:Ma,AdProgressTracker:Ba,AdBeginProgressTracker:Ua,AdSkippableTracker:ja,AdTrackerFactory:Fa,AdTrackingManager:ns,AdManager:ne,AdViewState:ee,AdFriendlyObstructionPurpose:te,AdSession:oe,InternalAdManager:ce,OMSDKManager:ys,OMSessionHandler:_s};var ws="BpkNanoCDNRequestMgr",Os=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){return Ds(e,e,Ls)||Rs(e,e,Ls,new e),Ds(e,e,Ls)}}],(i=[{key:"requestNanoCDNStatus",value:function(t){var i="http://"+t+":"+e.NANOCDN_CORE_PORT+"/nanocdnstatus.xml";return new Promise((function(e,t){H.getInstance().asyncGet(i,{Connection:"close"},3e3,(function(t){var i=0,n="";void 0!==t.statusCode&&(i=parseInt(t.statusCode,10)),void 0!==t.body&&(n=t.body),e({httpStatus:i,body:n})}))}))}},{key:"requestNanoCDN",value:function(t,i,n){var r=this,a=n.options,s=O.parseURL(t),o=!Ot.getInstance().isConnectedToWifi()||!0===a.get(ze.REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI)&&Ot.getInstance().isConnectedToWifi();if(("127.0.0.1"===i.nanoCDNDescr.hostIP||"localhost"===i.nanoCDNDescr.hostIP)&&!1===o)return P.d(ws,"Ignoring nanoCDN "+i.nanoCDNDescr.hostIP+" because of the Wi-Fi connection...",n.id),Promise.resolve(pt.error(pt.RESULT_NANOCDN_REQUEST_LOCAL_IF_CONNECTED_TO_WIFI_NOT_ALLOWED));var u="";""!==s.query&&(u="&"+s.query);var l="";i.analyticsAddress.length>1&&(l="&ssu="+O.extractHostnamePort(i.analyticsAddress));var d="";!0===n.options.get(ze.MULTICAST_ONLY)&&(d="&mo=1");var c="";!0===n.options.get(ze.ULTRA_LOW_LATENCY_SUPPORT)&&(c="&ulls=1");var h="http://"+i.nanoCDNDescr.hostIP+":"+e.NANOCDN_RR_PORT+s.path+"?response=200&bk-ml=1"+l+"&us="+s.host+d+c+u;return P.d(ws,"Sending request to the nanoCDN ("+i.nanoCDNDescr.hostIP+")...",n.id),me.getInstance().getRedirectionLocation(h,e.NANOCDN_REQUEST_TIMEOUT,i,n).then((function(e){P.d(ws,"nanoCDN responded with status code "+e.httpStatus,n.id),n.sessionReport.nanoCDNStatusCode=e.httpStatus;var t=r.getNanoCDNDetailedErrorMessage(e,n),a=pt.error(pt.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN,t);if(200===e.httpStatus&&""!==e.redirectedURL)a=pt.success(e.redirectedURL);else if(509===e.httpStatus||503===e.httpStatus&&i.nanoCDNDescr.mcastFrame>0)a=pt.error(pt.RESULT_NANOCDN_SESSION_LIMIT_REACHED,t);else if(503===e.httpStatus&&0===i.nanoCDNDescr.mcastFrame)a=pt.error(pt.RESULT_NANOCDN_SERVICE_UNAVAILABLE,t);else if(404===e.httpStatus)a=pt.error(pt.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN,t);else if(e.httpStatus<=0)return pt.error(pt.RESULT_NANOCDN_RESPONSE_UNREADABLE);return a})).then((function(e){return e.isError()&&(n.sessionReport.nanoCDNStatusCode=e.getDetailedErrorCode()),e}))}},{key:"getNanoCDNDetailedErrorMessage",value:function(t,i){if(t.httpStatus>0){if(!0===t.headers.hasOwnProperty(e.HEADER_NANO_CDN_DETAILED_ERROR_CODE)){var n=t.headers[e.HEADER_NANO_CDN_DETAILED_ERROR_CODE];return P.d(ws,"Reading detailed error code from header: "+n,i.id),n}return P.d(ws,"Reading detailed error code from http status: "+t.httpStatus+" "+t.httpMessage,i.id),String(t.httpStatus+" "+t.httpMessage)}return String(pt.RESULT_NO_DETAILED_ERROR)}},{key:"requestNanoCDNList",value:function(e,t,i,n,r){var a=this,s=n.smartLib.nanoCDNHostManager.getNanoCDNDescrList();if(i>=s.length)return{result:pt.error(pt.RESULT_NO_STREAMING_URL_FOUND),redirectedURL:"",nanoCDNDescr:void 0,errors:r};var o=s[i];return t.nanoCDNDescr=o,o===t.nanoCDNDescrConfigured?this.requestNanoCDNList(e,t,i+1,n,r):this.requestNanoCDN(e,t,n).then((function(u){return r[o.hostIP]=u.getErrorCode(),u.isError()&&s.length>=2?i+1>=s.length?{result:u,redirectedURL:u.getURL(),nanoCDNDescr:o,errors:r}:a.requestNanoCDNList(e,t,i+1,n,r):{result:u,redirectedURL:u.getURL(),nanoCDNDescr:o,errors:r}}))}},{key:"processNanoCDNSession",value:function(e,t,i,n,r){var a=this;return this.requestNanoCDN(e,t,i).then((function(n){var r={};r[t.nanoCDNDescr.hostIP]=n.getErrorCode();var s=i.smartLib.nanoCDNHostManager.getNanoCDNDescrList();return n.isError()&&s.length>=2?a.requestNanoCDNList(e,t,0,i,r):{result:n,redirectedURL:n.getURL(),nanoCDNDescr:t.nanoCDNDescr,errors:r}})).then((function(a){if(P.d(ws,"nanoCDN error codes : "+JSON.stringify(a.errors),i.id),!a.result.isError())return i.smartLib.nanoCDNHostManager.setCurrentNanoCDNDescr(a.nanoCDNDescr),n&&!1===r?me.getInstance().requestBkM(e,t,a.nanoCDNDescr.hostIP,i).then((function(e){return e.isError()||-1===e.getURL().indexOf("://"+a.nanoCDNDescr.hostIP+":")||!0!==i.options.get(ze.ULTRA_LOW_LATENCY_SUPPORT)||(e.url=O.addOrReplaceParam(e.url,"ulls","1")),e})):a.result;var s=i.smartLib.nanoCDNHostManager.getNanoCDNDescrList(),o=s.length,u=yn.count(a.errors,(function(e,t){return t===pt.RESULT_NANOCDN_SESSION_LIMIT_REACHED})),l=yn.count(a.errors,(function(e,t){return t===pt.RESULT_NANOCDN_SERVICE_UNAVAILABLE})),d=a.result.getDetailedErrorMessage();if(a.result=u===o?pt.error(pt.RESULT_NANOCDN_SESSION_LIMIT_REACHED,d):l===o?pt.error(pt.RESULT_NANOCDN_SERVICE_UNAVAILABLE,d):u>=1?pt.error(pt.RESULT_NANOCDN_SESSION_LIMIT_REACHED_ON_REQUESTED_CHANNEL,d):0===u?pt.error(pt.RESULT_NANOCDN_CHANNEL_UNAVAILABLE,d):pt.error(pt.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN,d),n){if(l>=1){var c=s.find((function(e){return a.errors[e.hostIP]===pt.RESULT_NANOCDN_SERVICE_UNAVAILABLE}));return P.d(ws,"nanoCDN responded service unavailable, requesting the BkM...",i.id),me.getInstance().requestBkM(e,t,c.hostIP,i)}return P.d(ws,"nanoCDN responded an error, requesting the BkM...",i.id),me.getInstance().requestBkM(e,t,void 0,i)}return!0===r?a.result:pt.success(e)}))}}])&&As(t.prototype,i),n&&As(t,n),e}();Ns(Os,"NANOCDN_RR_PORT","8000"),Ns(Os,"NANOCDN_CORE_PORT","18081"),Ns(Os,"HEADER_NANO_CDN_DETAILED_ERROR_CODE","x-bpk-error"),Ns(Os,"NANOCDN_REQUEST_TIMEOUT",1e3);var Ls={writable:!0,value:void 0},Cs=__webpack_require__(831);function Is(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ms(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Bs=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ms(this,"hostIP",void 0),Ms(this,"nbSessions",void 0),Ms(this,"maxNbSessions",void 0),Ms(this,"ratio",void 0),Ms(this,"jsonAccountId",void 0),Ms(this,"profilePrefetched",void 0),Ms(this,"mcastFrame",void 0),this.hostIP="",this.nbSessions=0,this.maxNbSessions=e.NANOCDNDESCR_DEFAULT_MAX_SESSION,this.ratio=0,this.jsonAccountId="",this.profilePrefetched=-1,this.mcastFrame=-1}var t,i,n;return t=e,n=[{key:"parseNanoCDNStatusResponse",value:function(t,i){var n,r,a=(0,Cs.fromXML)(t);if(void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG]){if((n=new e).hostIP=i,void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_SESSIONS_TAG]&&(void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_SESSIONS_TAG][e.NANOCDNDESCR_SESSIONS_NUMBER_PARAM]&&(r=parseInt(a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_SESSIONS_TAG][e.NANOCDNDESCR_SESSIONS_NUMBER_PARAM],10),isNaN(r)||(n.nbSessions=r)),void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_SESSIONS_TAG][e.NANOCDNDESCR_SESSIONS_LIMIT_PARAM]&&(r=parseInt(a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_SESSIONS_TAG][e.NANOCDNDESCR_SESSIONS_LIMIT_PARAM],10),isNaN(r)||(n.maxNbSessions=r))),void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_ACCESSTOKEN_TAG]){var s={};for(var o in a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_ACCESSTOKEN_TAG])s[o.substring(1)]=a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_ACCESSTOKEN_TAG][o];n.jsonAccountId=JSON.stringify(s)}void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_TAG]&&(void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_PROFILE_PREFETCHED_PARAM]&&(r=parseInt(a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_PROFILE_PREFETCHED_PARAM],10),isNaN(r)||(n.profilePrefetched=r)),void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_MCAST_FRAME_PARAM]&&(r=parseInt(a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_MCAST_FRAME_PARAM],10),isNaN(r)||(n.mcastFrame=r))),n.processRatio()}return n}}],(i=[{key:"processRatio",value:function(){this.ratio=this.maxNbSessions/(this.nbSessions+1)}}])&&Is(t.prototype,i),n&&Is(t,n),e}();function Us(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function js(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Ms(Bs,"NANOCDNDESCR_NANOCDN_TAG","nanocdn"),Ms(Bs,"NANOCDNDESCR_SESSIONS_TAG","sessions"),Ms(Bs,"NANOCDNDESCR_SESSIONS_NUMBER_PARAM","@number"),Ms(Bs,"NANOCDNDESCR_SESSIONS_LIMIT_PARAM","@limit"),Ms(Bs,"NANOCDNDESCR_MULTICAST_TAG","multicasts"),Ms(Bs,"NANOCDNDESCR_ACCESSTOKEN_TAG","access-token"),Ms(Bs,"NANOCDNDESCR_CTRL_CHANNEL_TAG","ctrl-channel"),Ms(Bs,"NANOCDNDESCR_CTRL_CHANNEL_PROFILE_PREFETCHED_PARAM","@profile_prefetched"),Ms(Bs,"NANOCDNDESCR_CTRL_CHANNEL_MCAST_FRAME_PARAM","@mcast_frame"),Ms(Bs,"NANOCDNDESCR_DEFAULT_MAX_SESSION",50);var Fs="BpkHostResolvingAsyncTask",Vs=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),js(this,"nanoCDNHostManager",void 0),js(this,"nanoCDNHost",void 0),js(this,"retry",void 0),js(this,"retryDelay",void 0),js(this,"active",void 0),js(this,"waiting",void 0),js(this,"job",void 0),this.nanoCDNHostManager=t,this.nanoCDNHost=i,this.retry=0,this.retryDelay=6e4,this.active=!0,this.waiting=!1,this.job=void 0}var t,i,n;return t=e,(i=[{key:"start",value:function(){var e,t=this;P.d(Fs,"Starting resolving nanoCDN with host: '"+this.nanoCDNHost+"'"),null===(e=Jt.nanoCDNModule)||void 0===e||e.NanoCDNRequestManager.getInstance().requestNanoCDNStatus(this.nanoCDNHost).then((function(e){if(200===e.httpStatus){var i=Bs.parseNanoCDNStatusResponse(e.body,t.nanoCDNHost);if(void 0===i)throw new Error("Can't resolve nanoCDN:'"+t.nanoCDNHost+"' status:"+e.httpStatus);return P.d(Fs,"Checking nanoCDN result: host: "+i.hostIP+" session: "+i.nbSessions+" limit: "+i.maxNbSessions+" jsonid:"+i.jsonAccountId+" profile_prefetched:"+i.profilePrefetched+" mcast_frame:"+i.mcastFrame),i}throw new Error("Can't resolve nanoCDN:'"+t.nanoCDNHost+"' status:"+e.httpStatus)})).then((function(e){t.active&&(P.i(Fs,"Found nanoCDN with host: '"+t.nanoCDNHost+"'"),e.jsonAccountId.length>0&&P.i(Fs,"Found json account id: '"+e.jsonAccountId+"'"),t.nanoCDNHostManager.addNanoCDN(e),t.active=!1,t.nanoCDNHostManager.removeHostResolvingAsyncTask(t.nanoCDNHost))})).catch((function(e){t.active&&(t.nanoCDNHostManager.removeNanoCDN(t.nanoCDNHost),t.retry++,P.d(Fs,e.message+" retry:"+t.retry),-1===t.retryDelay?(P.i(Fs,"Can't found nanoCDN with host: '"+t.nanoCDNHost+"'"),t.active=!1,t.nanoCDNHostManager.removeHostResolvingAsyncTask(t.nanoCDNHost)):(t.waiting=!0,t.job=H.getInstance().asyncDelay(t.retryDelay,(function(){t.waiting=!1,t.active&&t.start()}))))}))}},{key:"stop",value:function(){this.active&&P.d(Fs,"Host resolving stopped for '"+this.nanoCDNHost+"'"),this.active=!1,H.getInstance().cancel(this.job)}},{key:"setResolvingRetryDelay",value:function(e){this.retryDelay=e}}])&&Us(t.prototype,i),n&&Us(t,n),e}();function xs(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Gs=function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),xs(this,"name",void 0),xs(this,"ipAddress",void 0),xs(this,"nanoCDNDescr",void 0),this.name=t,this.ipAddress=i,this.nanoCDNDescr=n};function Hs(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ws(e,t){return Xs(e,Ys(e,t,"get"))}function qs(e,t,i){return Ks(e,Ys(e,t,"set"),i),i}function Ys(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function Ks(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function Qs(e,t,i){return Js(e,t),zs(i,"get"),Xs(e,i)}function zs(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Js(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function Xs(e,t){return t.get?t.get.call(e):t.value}function Zs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function eo(e,t,i){return t&&$s(e.prototype,t),i&&$s(e,i),e}var to="BpkMdnsMgr",io=function(){function e(){Zs(this,e)}return eo(e,null,[{key:"start",value:function(e){}},{key:"stop",value:function(){}}]),e}(),no=new WeakMap,ro=new WeakMap,ao=new WeakMap,so=function(){function e(){Zs(this,e),no.set(this,{writable:!0,value:io}),Hs(this,"smartLib",void 0),ro.set(this,{writable:!0,value:void 0}),ao.set(this,{writable:!0,value:void 0}),qs(this,ro,!1),qs(this,ao,[])}return eo(e,[{key:"init",value:function(e){qs(this,no,e)}},{key:"release",value:function(){}},{key:"attachInstance",value:function(e){this.smartLib=e}},{key:"start",value:function(){Ws(this,no)===io?P.e(to,"Exception: nanoCDN discovery is not available for that platform"):Ws(this,ro)?P.v(to,"mDNS discovery already started"):(P.i(to,"mDNS discovery starting..."),Ws(this,no).start(e.MDNS_NANOCDN_SERVICE_TYPE),qs(this,ro,!0))}},{key:"stop",value:function(){!0===Ws(this,ro)&&(qs(this,ro,!1),Ws(this,no).stop(),P.i(to,"mDNS discovery stopped"))}},{key:"onServiceFound",value:function(e,t){var i,n=this;P.d(to,"Found service "+e+" ip:"+t),null===(i=Jt.nanoCDNModule)||void 0===i||i.NanoCDNRequestManager.getInstance().requestNanoCDNStatus(t).then((function(e){if(200===e.httpStatus){var i=Bs.parseNanoCDNStatusResponse(e.body,t);if(void 0===i)throw new Error("Can't resolve nanoCDN:'"+t+"' status:"+e.httpStatus);return P.d(to,"Checking nanoCDN result: host: "+i.hostIP+" session: "+i.nbSessions+" limit: "+i.maxNbSessions+" jsonid:"+i.jsonAccountId+" profile_prefetched:"+i.profilePrefetched+" mcast_frame:"+i.mcastFrame),i}throw new Error("Can't resolve nanoCDN:'"+t+"' status:"+e.httpStatus)})).then((function(i){P.i(to,"Found nanoCDN with host: '"+t+"'"),i.jsonAccountId.length>0&&P.i(to,"Found json account id: '"+i.jsonAccountId+"'"),n.smartLib.nanoCDNHostManager.addNanoCDN(i),void 0===n.getService(e,t)&&Ws(n,ao).push(new Gs(e,t,i)),P.i(to,"Registered nanoCDN with host: '"+t+"'")})).catch((function(e){P.i(to,e.message)}))}},{key:"onServiceLost",value:function(e,t){var i=this.getService(e,t);void 0===i&&this.removeService(i)}},{key:"getService",value:function(e,t){for(var i=0;i<Ws(this,ao).length;i++){var n=Ws(this,ao)[i];if(n.name===e&&n.ipAddress===t)return n}}},{key:"removeService",value:function(e){P.d(to,"Lost service "+e.name+" ip:"+e.ipAddress),this.smartLib.nanoCDNHostManager.removeNanoCDN(e.ipAddress);var t=Ws(this,ao).indexOf(e);-1!==t&&Ws(this,ao).splice(t,1)}}],[{key:"getInstance",value:function(){return Qs(e,e,oo)||function(e,t,i,n){Js(e,t),zs(i,"set"),Ks(e,i,n)}(e,e,oo,new e),Qs(e,e,oo)}}]),e}(),oo={writable:!0,value:void 0};function uo(e){return function(e){if(Array.isArray(e))return lo(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return lo(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return lo(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lo(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function co(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ho(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Hs(so,"MDNS_NANOCDN_SERVICE_TYPE","_nanocdn._tcp.local.");var fo="BpkNanoCDNHostMgr",vo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ho(this,"smartLib",void 0),ho(this,"state",void 0),ho(this,"nanoCDNHostResolvingTasks",void 0),ho(this,"nanoCDNHostConfigured",void 0),ho(this,"currentNanoCDNDescr",void 0),ho(this,"nanoCDNList",void 0),ho(this,"nanoCDNReceiver",void 0),ho(this,"nanoCDNResolvingRetryDelay",void 0),ho(this,"lastHostResolvingDate",void 0),this.state=e.STATE_NONE,this.nanoCDNHostResolvingTasks={},this.nanoCDNHostConfigured="",this.currentNanoCDNDescr=void 0,this.nanoCDNList=[],this.nanoCDNReceiver=void 0,this.nanoCDNResolvingRetryDelay=e.DEFAULT_NANOCDN_RESOLVING_RETRY_DELAY,this.lastHostResolvingDate=0}var t,i,n;return t=e,(i=[{key:"init",value:function(e,t){this.smartLib=e,null==t&&(t=""),-1!==t.indexOf("*")&&(t=t.replace("*","127.0.0.1,discover")),this.nanoCDNHostConfigured!==t&&(this.nanoCDNHostConfigured=t,this.clearHostResolution(),this.launchHostResolution())}},{key:"registerNanoCDNReceiver",value:function(e){this.nanoCDNReceiver=null==e?void 0:e}},{key:"setNanoCDNResolvingRetryDelay",value:function(e){var t=parseInt(e,10);for(var i in t>=0&&t<1e3?(this.nanoCDNResolvingRetryDelay=1e3,P.w(fo,"nanoCDN resolving retry delay has been increased to 1000ms (minimum delay)")):t<=-1?(this.nanoCDNResolvingRetryDelay=-1,P.d(fo,"nanoCDN resolving retry has been disabled")):this.nanoCDNResolvingRetryDelay=t,this.nanoCDNHostResolvingTasks)if(this.nanoCDNHostResolvingTasks[i].waiting){this.nanoCDNHostResolvingTasks[i].stop();var n=new Vs(this,i);n.setResolvingRetryDelay(this.nanoCDNResolvingRetryDelay),n.start(),this.nanoCDNHostResolvingTasks[i]=n}else this.nanoCDNHostResolvingTasks[i].setResolvingRetryDelay(this.nanoCDNResolvingRetryDelay)}},{key:"launchHostResolution",value:function(){if(void 0!==this.nanoCDNHostConfigured&&0!==this.nanoCDNHostConfigured.length){this.state=e.STATE_IDLING;for(var t=this.nanoCDNHostConfigured.split(","),i=0;i<t.length;i++){var n=t[i];n===e.NANOCDN_HOST_DISCOVER?(this.state=e.STATE_DISCOVERING,this.lastHostResolvingDate=Date.now(),so.getInstance().start()):Ot.getInstance().appInBackground||(this.state=e.STATE_RESOLVING,this.lastHostResolvingDate=Date.now(),this.resolveNanoCDNHost(n))}}}},{key:"refreshHostResolution",value:function(){var t=this;if(void 0!==this.nanoCDNHostConfigured&&0!==this.nanoCDNHostConfigured.length&&this.nanoCDNHostConfigured===e.NANOCDN_HOST_DISCOVER){var i=uo(this.nanoCDNList),n=[];this.state=e.STATE_DISCOVERING,this.lastHostResolvingDate=Date.now();for(var r=function(e){var r,a=i[e];n.push(null===(r=Jt.nanoCDNModule)||void 0===r?void 0:r.NanoCDNRequestManager.getInstance().requestNanoCDNStatus(a.hostIP).then((function(e){200!==e.httpStatus&&t.removeNanoCDN(a.hostIP)})))},a=0;a<i.length;a++)r(a);Promise.all(n).then((function(){so.getInstance().stop(),so.getInstance().start()}))}}},{key:"clearHostResolution",value:function(){for(var t in this.state=e.STATE_IDLING,this.nanoCDNHostResolvingTasks)this.nanoCDNHostResolvingTasks[t].stop(),delete this.nanoCDNHostResolvingTasks[t];so.getInstance().stop(),this.clearNanoCDNList(),this.lastHostResolvingDate=0}},{key:"resolveNanoCDNHost",value:function(e){if(P.i(fo,"Initializing nanoCDN resolving with '"+e+"'"),null!=e&&0!==e.length){void 0!==this.nanoCDNHostResolvingTasks[e]&&(this.nanoCDNHostResolvingTasks[e].stop(),delete this.nanoCDNHostResolvingTasks[e]);var t=new Vs(this,e);t.setResolvingRetryDelay(this.nanoCDNResolvingRetryDelay),t.start(),this.nanoCDNHostResolvingTasks[e]=t}else P.i(fo,"nanoCDN host resolving is not required for '"+e+"'")}},{key:"removeHostResolvingAsyncTask",value:function(e){void 0!==this.nanoCDNHostResolvingTasks[e]&&(this.nanoCDNHostResolvingTasks[e].stop(),delete this.nanoCDNHostResolvingTasks[e])}},{key:"getCurrentNanoCDNDescr",value:function(){return void 0===this.currentNanoCDNDescr&&this.nanoCDNList.length>0?this.nanoCDNList[0]:this.currentNanoCDNDescr}},{key:"setCurrentNanoCDNDescr",value:function(e){this.currentNanoCDNDescr=e}},{key:"addNanoCDN",value:function(e){for(var t=!1,i=0;i<this.nanoCDNList.length;i++)if(this.nanoCDNList[i].hostIP===e.hostIP){t=!0,this.nanoCDNList.splice(i,1);break}for(var n=!1,r=0,a=0===this.nanoCDNList.length,s=0;s<this.nanoCDNList.length&&!n;s++)e.ratio>this.nanoCDNList[s].ratio&&(n=!0,r=s);if(n?this.nanoCDNList.splice(r,0,e):this.nanoCDNList.push(e),a&&!t){var o=e.jsonAccountId;P.i(fo,"onNanoCDNFound '"+o+"'"+(void 0===this.nanoCDNReceiver?" (no receiver)":"")),void 0!==this.nanoCDNReceiver&&"function"==typeof this.nanoCDNReceiver.onNanoCDNFound&&this.nanoCDNReceiver.onNanoCDNFound(o)}}},{key:"removeNanoCDN",value:function(e){for(var t=!1,i=0;i<this.nanoCDNList.length&&!t;i++)if(this.nanoCDNList[i].hostIP===e){t=!0,this.nanoCDNList.splice(i,1);break}0===this.nanoCDNList.length&&t&&(P.i(fo,"onNanoCDNLost"+(void 0===this.nanoCDNReceiver?" (no receiver)":"")),void 0!==this.nanoCDNReceiver&&"function"==typeof this.nanoCDNReceiver.onNanoCDNLost&&this.nanoCDNReceiver.onNanoCDNLost());var n=this.getCurrentNanoCDNDescr();void 0!==n&&n.hostIP===e&&(this.currentNanoCDNDescr=void 0)}},{key:"getNanoCDNDescrList",value:function(){return this.nanoCDNList}},{key:"getNanoCDNWithHost",value:function(e){for(var t=0;t<this.nanoCDNList.length;t++)if(this.nanoCDNList[t].hostIP===e)return this.nanoCDNList[t]}},{key:"clearNanoCDNList",value:function(){0!==this.nanoCDNList.length&&(this.nanoCDNList=[],this.currentNanoCDNDescr=void 0,P.i(fo,"onNanoCDNLost"+(void 0===this.nanoCDNReceiver?" (no receiver)":"")),void 0!==this.nanoCDNReceiver&&"function"==typeof this.nanoCDNReceiver.onNanoCDNLost&&this.nanoCDNReceiver.onNanoCDNLost())}},{key:"release",value:function(){this.clearHostResolution(),this.nanoCDNHostConfigured=""}},{key:"onForeground",value:function(){if(Date.now()-this.lastHostResolvingDate>1e3){var t=this.nanoCDNHostConfigured.split(",").length;0!==this.nanoCDNList.length&&this.nanoCDNList.length===t||this.nanoCDNHostConfigured===e.NANOCDN_HOST_DISCOVER||!0!==Ot.getInstance().networkAvailable?this.nanoCDNHostConfigured===e.NANOCDN_HOST_DISCOVER&&!0===Ot.getInstance().networkAvailable&&this.refreshHostResolution():(this.clearHostResolution(),this.launchHostResolution())}else P.d(fo,"Received event onForeground but ignored")}},{key:"onBackground",value:function(){Object.keys(this.nanoCDNHostResolvingTasks).length>0&&(P.d(fo,"Host resolving will be resumed when the app will be restored"),this.clearHostResolution()),this.lastHostResolvingDate=0}},{key:"onNetworkAvailable",value:function(e){Date.now()-this.lastHostResolvingDate>1e3?(P.d(fo,"Received event onNetworkAvailable. networkType:"+e),this.clearHostResolution(),this.launchHostResolution()):P.d(fo,"Received event onNetworkAvailable but ignored")}},{key:"onNetworkLost",value:function(){P.d(fo,"Received event onNetworkLost"),this.clearHostResolution()}}])&&co(t.prototype,i),n&&co(t,n),e}();function po(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function yo(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}ho(vo,"DEFAULT_NANOCDN_RESOLVING_RETRY_DELAY",6e4),ho(vo,"NANOCDN_HOST_DISCOVER","discover"),ho(vo,"STATE_NONE",0),ho(vo,"STATE_IDLING",1),ho(vo,"STATE_DISCOVERING",2),ho(vo,"STATE_RESOLVING",3),Jt.nanoCDNModule={NanoCDNRequestManager:Os,HostResolvingTask:Vs,MdnsManager:so,NanoCDNDescr:Bs,NanoCDNHostManager:vo,NanoCDNService:Gs};var go=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),yo(this,"contentURL",void 0),yo(this,"redirectedURL",void 0),yo(this,"cdnList",void 0),yo(this,"cdnIndex",void 0),yo(this,"fallbackURLList",void 0),yo(this,"creationDate",void 0),this.contentURL=t,this.redirectedURL=i,this.cdnList=n,this.cdnIndex=0,this.creationDate=Date.now(),this.generateFallbackURLList()}var t,i,n;return t=e,n=[{key:"create",value:function(t,i){if(null!=i&&0===i.indexOf("http://127.0.0.1:18080/")){var n=O.getParam(i,"us"),r=O.getParam(i,"prio");if(""!==n&&""!==r){var a=n.split(","),s=r.split(",").map((function(e){return parseInt(e,10)})),o=new Array(a.length),u=[];if(a.length!==s.length)return;for(var l=0;l<a.length;l++){var d=a[l],c=s[l];void 0===o[c-1]?o[c-1]=[d]:o[c-1].push(d)}return o.forEach((function(e){e.forEach((function(e){u.push(e)}))})),new e(t,i,u)}}}}],(i=[{key:"generateFallbackURLList",value:function(){this.fallbackURLList=[];for(var e=0;e<this.cdnList.length;e++)e!==this.cdnIndex&&this.fallbackURLList.push(this.formatURL(e))}},{key:"formatURL",value:function(e){var t=O.parseURL(this.contentURL);return this.cdnList[e]+t.path+(t.query.length>0?"?"+t.query:"")}},{key:"selectNextCDN",value:function(){this.cdnIndex<this.cdnList.length?(this.cdnIndex++,this.generateFallbackURLList()):this.cdnIndex++}},{key:"isCDNValid",value:function(){return this.cdnIndex<this.cdnList.length}},{key:"getMainURL",value:function(){return this.formatURL(this.cdnIndex)}},{key:"getFallbackURLList",value:function(){return this.fallbackURLList}}])&&po(t.prototype,i),n&&po(t,n),e}();function Eo(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function So(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var bo="BpkDiversityFailoverCache",ko=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),So(this,"contentURL",void 0),So(this,"failoverSession",void 0),So(this,"handler",void 0)}var t,i,n;return t=e,(i=[{key:"getFailoverSession",value:function(t){var i;if(t===this.contentURL){if(void 0!==this.failoverSession&&void 0!==this.handler){var n=Date.now();if(0===this.handler.sessionReport.endSessionDate||n-this.handler.sessionReport.endSessionDate<e.CACHE_EXPIRATION_TIME)return this.failoverSession;P.v(bo,"Diversity failover cache expired",this.handler.id),this.clearCache()}}else P.v(bo,"New Diversity failover session",null===(i=this.handler)||void 0===i?void 0:i.id),this.clearCache()}},{key:"storeFailoverSession",value:function(e,t,i){P.i(bo,"Storing Diversity failover session in cache ("+t.cdnList.length+" CDNs)",null==i?void 0:i.id),this.contentURL=e,this.failoverSession=t,this.handler=i}},{key:"updateCache",value:function(e){P.i(bo,"Updating Diversity failover cache",null==e?void 0:e.id),this.handler=e}},{key:"clearCache",value:function(){var e;P.i(bo,"Clearing Diversity failover cache",null===(e=this.handler)||void 0===e?void 0:e.id),this.contentURL=void 0,this.failoverSession=void 0,this.handler=void 0}}])&&Eo(t.prototype,i),n&&Eo(t,n),e}();function mo(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _o(e,t){return wo(e,No(e,t,"get"))}function Ao(e,t,i){return Ro(e,No(e,t,"set"),i),i}function No(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function Ro(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function Do(e,t,i){return To(e,t),Po(i,"get"),wo(e,i)}function Po(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function To(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function wo(e,t){return t.get?t.get.call(e):t.value}function Oo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lo(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Co(e,t,i){return t&&Lo(e.prototype,t),i&&Lo(e,i),e}So(ko,"CACHE_EXPIRATION_TIME",6e4);var Io="BpkDiversity",Mo=function(){function e(){Oo(this,e)}return Co(e,null,[{key:"startLib",value:function(){}},{key:"stopLib",value:function(){}},{key:"setNbConnection",value:function(){}},{key:"setLogLevel",value:function(){}},{key:"getStats",value:function(){}},{key:"getJobStats",value:function(){}},{key:"getVersion",value:function(){}}]),e}(),Bo=new WeakMap,Uo=new WeakMap,jo=new WeakMap,Fo=new WeakMap,Vo=new WeakMap,xo=new WeakMap,Go=function(){function e(){Oo(this,e),mo(this,"smartLib",void 0),Bo.set(this,{writable:!0,value:void 0}),Uo.set(this,{writable:!0,value:void 0}),jo.set(this,{writable:!0,value:void 0}),Fo.set(this,{writable:!0,value:void 0}),Vo.set(this,{writable:!0,value:void 0}),xo.set(this,{writable:!0,value:void 0}),mo(this,"failoverCache",void 0),Ao(this,Uo,0),Ao(this,jo,2e3),Ao(this,Fo,0),Ao(this,xo,e.MULTIPATH_LOG_LEVEL_ERROR),this.failoverCache=new ko}return Co(e,[{key:"attachInstance",value:function(e){this.smartLib=e}},{key:"attachHandler",value:function(e){Ao(this,Bo,e)}},{key:"init",value:function(){if(_o(this,Uo)<=0){var e=this.getVersion();if(void 0===e&&(e="multipath get version not working"),_o(this,Bo).setNbConnection(_o(this,Fo)),P.i(Io,e),P.i(Io,"Connection number: "+_o(this,Fo)),Ao(this,Uo,_o(this,Bo).startLib("--log-level "+_o(this,xo)+" --blacklist_timeout_cdn 200 --rcv_timeout_cdn "+_o(this,jo))),_o(this,Uo)<=0){var t;switch(_o(this,Uo)){case-1:t="can't get a valid port";break;case-2:t="issues to launch modules";break;case-3:t="options parsing error";break;default:t=_o(this,Uo)}P.e(Io,"Init lib multipath failed, status:"+t)}else P.i(Io,"Init lib multipath Successfull, port:"+_o(this,Uo))}}},{key:"release",value:function(){var e;Ao(this,Uo,0),null===(e=_o(this,Bo))||void 0===e||e.stopLib(),this.failoverCache.clearCache()}},{key:"getVersion",value:function(){return _o(this,Bo).getVersion()}},{key:"isActive",value:function(){return _o(this,Bo)!==Mo&&_o(this,Uo)>0}},{key:"rewriteURL",value:function(e){if(_o(this,Uo)>0&&null!=e){var t=e.indexOf("["),i=e.indexOf("]"),n="/bpk-token/";t>=0&&i>=0||(t=e.indexOf(n))>=0&&(t+=n.length-1,i=e.indexOf("/",t+1)),t>=0&&i>=0&&Ao(this,Vo,e.substring(t+1,i)),""!==O.getParam(e,"us")&&(e=e.replace(":18080/",":"+_o(this,Uo)+"/"))}return e}},{key:"getFailoverSession",value:function(e,t){var i=this.failoverCache.getFailoverSession(e);if(void 0!==i){if(i.selectNextCDN(),!i.isCDNValid())return;this.failoverCache.updateCache(t)}return i}},{key:"createFailoverSession",value:function(e,t,i){var n;P.i(Io,"Parsing Diversity failover response...",i.id);try{n=go.create(e,t)}catch(e){P.d(Io,"Diversity failover response unreadable (try catch)",i.id)}return void 0!==n?(this.failoverCache.storeFailoverSession(e,n,i),P.i(Io,"Diversity failover session starting",i.id)):P.i(Io,"Diversity failover response unreadable (parsing), falling back to default workflow",i.id),n}},{key:"getNbConnection",value:function(){return _o(this,Fo)}},{key:"setNbConnection",value:function(e){Ao(this,Fo,e),_o(this,Bo).setNbConnection(e)}},{key:"setRcvTimeoutMs",value:function(e){Ao(this,jo,e)}},{key:"setLogLevel",value:function(e){Ao(this,xo,e),_o(this,Bo).setLogLevel(e)}},{key:"getStats",value:function(e,t){var i="";return _o(this,Uo)>0?i=_o(this,Bo).getStats(e,t):P.d(Io,"No diversity metrics"),i}},{key:"getJobStats",value:function(e,t){var i="";return _o(this,Uo)>0&&(""!==e&&null!=e||void 0===_o(this,Vo)||(e=_o(this,Vo)),i=_o(this,Bo).getJobStats(e,t)),""!==i&&void 0!==i||(i='{"id":"'+t+'","Bytes":0,"DurationMs":0,"Bitratebps":0,"ResponseTimeMs":0,"Cdn":[]}'),i}},{key:"saveDiversityStats",value:function(e){}},{key:"getDiversityStats",value:function(){}}],[{key:"getInstance",value:function(){return Do(e,e,Ho)||function(e,t,i,n){To(e,t),Po(i,"set"),Ro(e,i,n)}(e,e,Ho,new e),Do(e,e,Ho)}}]),e}();mo(Go,"MULTIPATH_STATS_PERIODIC",0),mo(Go,"MULTIPATH_STATS_SINCE_START",1),mo(Go,"MULTIPATH_LOG_LEVEL_PANIC",1),mo(Go,"MULTIPATH_LOG_LEVEL_FATAL",2),mo(Go,"MULTIPATH_LOG_LEVEL_ERROR",3),mo(Go,"MULTIPATH_LOG_LEVEL_WARN",4),mo(Go,"MULTIPATH_LOG_LEVEL_NOTICE",5),mo(Go,"MULTIPATH_LOG_LEVEL_INFO",6),mo(Go,"MULTIPATH_LOG_LEVEL_DEBUG",7);var Ho={writable:!0,value:void 0};function Wo(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qo(e,t,i,n){return Qo(e,t),Ko(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n),n}function Yo(e,t,i){return Qo(e,t),Ko(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}function Ko(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Qo(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}var zo="BpkDiversityRequestMgr",Jo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){return Yo(e,e,Xo)||qo(e,e,Xo,new e),Yo(e,e,Xo)}}],(i=[{key:"processFailoverSession",value:function(e,t,i){var n,r=!0===i.options.get(ze.REQUEST_DIVERSITY_DYNAMIC_FAILOVER);return r?void 0!==(n=Jt.diversityModule.DiversityManager.getInstance().getFailoverSession(e,i))&&(P.i(zo,"Session in Diversity failover cache, using URL "+n.getMainURL(),i.id),e=n.getMainURL()):Jt.diversityModule.DiversityManager.getInstance().failoverCache.clearCache(),me.getInstance().getURL(e,t,i).then((function(a){if(r){var s=n||Jt.diversityModule.DiversityManager.getInstance().createFailoverSession(e,a.getURL(),i);if(void 0!==s){if(i.diversityFailoverSession=s,void 0===n)return P.i(zo,"Diversity failover session main URL: "+s.getMainURL(),i.id),me.getInstance().getURL(s.getMainURL(),t,i).then((function(e){return e.diversityFailoverSession=s,e}));P.i(zo,"Applying Diversity failover session...",i.id),a.diversityFailoverSession=s}}return a}))}}])&&Wo(t.prototype,i),n&&Wo(t,n),e}(),Xo={writable:!0,value:void 0};function Zo(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Jt.diversityModule={DiversityManager:Go,DiversityFailoverSession:go,DiversityFailoverCache:ko,DiversityRequestManager:Jo};var eu=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$o(this,"playerAdapter",void 0),$o(this,"listener",void 0),$o(this,"pollPeriod",void 0),$o(this,"pollLastDate",void 0),$o(this,"pollPlayerInterval",void 0),$o(this,"lastPosition",void 0),$o(this,"expectedPosition",void 0),this.playerAdapter=t,this.listener=i,this.pollPeriod=e.POLLING_PERIOD,this.pollPlayerInterval=null,this.expectedPosition=0,this.pollLastDate=0}var t,i,n;return t=e,(i=[{key:"start",value:function(){var e=this;this.expectedPosition=this.playerAdapter.getPosition(),this.pollLastDate=Date.now(),null!==this.pollPlayerInterval&&clearInterval(this.pollPlayerInterval),this.pollPlayerInterval=setInterval((function(){e.pollPlayerPosition()}),this.pollPeriod)}},{key:"stop",value:function(){null!==this.pollPlayerInterval&&(clearInterval(this.pollPlayerInterval),this.pollPlayerInterval=null)}},{key:"forcePollPlayerPosition",value:function(){this.expectedPosition=this.expectedPosition-this.pollPeriod+(Date.now()-this.pollLastDate),this.pollPlayerPosition()}},{key:"pollPlayerPosition",value:function(){this.lastPosition=this.playerAdapter.getPosition();var e=this.expectedPosition+2*this.pollPeriod,t=this.expectedPosition-2*this.pollPeriod;(this.lastPosition<t||this.lastPosition>e)&&void 0!==this.listener&&"function"==typeof this.listener.handleSeek&&!0===this.listener.handleSeek(this.expectedPosition,this.lastPosition)&&P.d("BpkPlayerStateManager","Player is seeking ("+ai.formatTime(this.expectedPosition)+" to "+ai.formatTime(this.lastPosition)+")"),this.expectedPosition=this.lastPosition+this.pollPeriod,void 0!==this.listener&&"function"==typeof this.listener.handlePoll&&this.listener.handlePoll(),this.pollLastDate=Date.now()}},{key:"getPositionBeforeSeek",value:function(){return this.lastPosition}}])&&Zo(t.prototype,i),n&&Zo(t,n),e}();function tu(e){return(tu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function iu(e,t){return(iu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=su(e);if(t){var r=su(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return ru(this,i)}}function ru(e,t){return!t||"object"!==tu(t)&&"function"!=typeof t?au(e):t}function au(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function su(e){return(su=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ou(e,t,i,n){return du(e,t),lu(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n),n}function uu(e,t,i){return du(e,t),lu(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}function lu(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function du(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function cu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hu(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fu(e,t,i){return t&&hu(e.prototype,t),i&&hu(e,i),e}function vu(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}$o(eu,"POLLING_PERIOD",500);var pu="BpkAVPlayAdapter",yu=function(){function e(t){cu(this,e),vu(this,"adapter",void 0),vu(this,"listener",void 0),vu(this,"lastPosition",void 0),vu(this,"waitToStartTask",void 0),this.adapter=t,this.listener=t.listener,this.waitToStartTask=void 0}return fu(e,[{key:"onEvent",value:function(e,t,i){void 0!==this.listener&&"function"==typeof this.listener[e]&&this.listener[e](t,i)}},{key:"onbufferingstart",value:function(){this.onEvent("onbufferingstart"),this.adapter.started&&!this.adapter.stalling&&this.adapter.notifyStallStart(),this.adapter.buffering=!0}},{key:"onbufferingprogress",value:function(e){this.onEvent("onbufferingprogress",e)}},{key:"tryToStart",value:function(){this.adapter.player.getDuration(),this.adapter.player.getCurrentStreamInfo(),this.adapter.player.getCurrentTime(),this.adapter.player.getStreamingProperty("IS_LIVE"),P.d(pu,"Player fully initialized, starting the session..."),this.adapter.playerStateManager.start(),this.adapter.started=!0,this.adapter.notifyFirstImage()}},{key:"onbufferingcomplete",value:function(){var e=this;if(this.onEvent("onbufferingcomplete"),this.adapter.started)this.adapter.stalling=!1,this.adapter.playerStateManager.forcePollPlayerPosition(),this.adapter.notifyStallEnd();else if(void 0===this.waitToStartTask){this.waitToStartTask={};try{this.tryToStart()}catch(t){this.waitToStartTask=setInterval((function(){try{e.tryToStart(),clearInterval(e.waitToStartTask)}catch(e){}}),100)}}this.adapter.buffering=!1}},{key:"oncurrentplaytime",value:function(e){this.onEvent("oncurrentplaytime",e),this.adapter.started&&(this.adapter.paused||(this.lastPosition===e?this.adapter.stalling||(this.adapter.stalling=!0,this.adapter.notifyStallStart()):(this.adapter.stalling=!1,this.adapter.buffering||this.adapter.notifyStallEnd(!this.adapter.paused)),this.lastPosition=e))}},{key:"onstreamcompleted",value:function(){this.onEvent("onstreamcompleted")}},{key:"onevent",value:function(e,t){switch(this.onEvent("onevent",e,t),e){case"PLAYER_MSG_BITRATE_CHANGE":if("string"==typeof t&&-1!==t.indexOf("BITRATE:")){var i=t.split(":")[1],n=Math.round(Number.parseInt(i,10)/1e3);n<=256?(this.adapter.nextBitrate=-1,P.w(pu,"Ignoring current bitrate "+n+"kbps because it is too low to be a video layer.")):(this.adapter.nextBitrate=Math.round(Number.parseInt(i,10)/1e3),this.adapter.appliedBitrate=this.adapter.nextBitrate,this.adapter.notifyLayerSwitch())}else{var r=JSON.parse(this.adapter.player.getCurrentStreamInfo()[0].extra_info),a=Math.round(Number.parseInt(r.Bit_rate,10)/1e3);this.adapter.nextBitrate=a,-1===this.adapter.appliedBitrate&&(this.adapter.appliedBitrate=this.adapter.nextBitrate)}break;case"PLAYER_MSG_RESOLUTION_CHANGED":if(-1===this.adapter.nextBitrate){var s=JSON.parse(this.adapter.player.getCurrentStreamInfo()[0].extra_info),o=Math.round(Number.parseInt(s.Bit_rate,10)/1e3);this.adapter.nextBitrate=o}this.adapter.appliedBitrate=this.adapter.nextBitrate,this.adapter.notifyLayerSwitch()}}},{key:"onerror",value:function(e){if(this.onEvent("onerror",e),this.adapter.setStatusCode(this.adapter.getErrorCode(e)),e.indexOf("PLAYER_ERROR_")>=0){var t=e.substr(13);this.adapter.setPlayerErrorCode(t)}P.w(pu,"Player error: "+e)}},{key:"ondrmevent",value:function(e,t){this.onEvent("ondrmevent",e,t)}},{key:"onsubtitlechange",value:function(){this.onEvent("onsubtitlechange")}}]),e}(),gu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&iu(e,t)}(i,e);var t=nu(i);function i(){var e;cu(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return vu(au(e=t.call.apply(t,[this].concat(r))),"player",void 0),vu(au(e),"listener",void 0),vu(au(e),"started",void 0),vu(au(e),"paused",void 0),vu(au(e),"stalling",void 0),vu(au(e),"buffering",void 0),vu(au(e),"nextBitrate",void 0),vu(au(e),"appliedBitrate",void 0),vu(au(e),"playerStateManager",void 0),vu(au(e),"playerListener",void 0),e}return fu(i,[{key:"onPlayEvent",value:function(){this.started&&(this.notifyResume(),this.paused=!1)}},{key:"onPauseEvent",value:function(){this.started&&(this.notifyPause(),this.paused=!0)}},{key:"onSeekToEvent",value:function(){var e=this;this.playerStateManager.forcePollPlayerPosition(),this.playerListener.oncurrentplaytime(this.getPosition()),setTimeout((function(){e.playerListener.oncurrentplaytime(e.getPosition())}),2)}},{key:"onJumpForwardEvent",value:function(){this.onSeekToEvent()}},{key:"onJumpBackwardEvent",value:function(){this.onSeekToEvent()}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"getName",value:function(){return"AVPlay"}},{key:"getVersion",value:function(){return void 0!==this.player?this.player.getVersion():""}},{key:"getDeviceType",value:function(){return"tv"}},{key:"getBitrate",value:function(){return this.appliedBitrate}},{key:"getPosition",value:function(){if(void 0!==this.player)try{return this.player.getCurrentTime()}catch(e){return P.d(pu,"getPosition error : "+JSON.stringify(e)),0}return 0}},{key:"getDuration",value:function(){if(void 0!==this.player&&!this.isLive())try{return this.player.getDuration()}catch(e){return P.d(pu,"getDuration error : "+JSON.stringify(e)),0}return 0}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"isLive",value:function(){try{return void 0!==this.player&&"1"===this.player.getStreamingProperty("IS_LIVE")}catch(e){return P.d(pu,"isLive error : "+JSON.stringify(e)),!0}}},{key:"getErrorCode",value:function(e){switch(e){case"PLAYER_ERROR_NONE":return Jt.BPSessionEndsNormally;case"PLAYER_ERROR_NO_SUCH_FILE":case"PLAYER_ERROR_INVALID_URI":case"PLAYER_ERROR_CONNECTION_FAILED":return Jt.BPNetworkingError;case"PLAYER_ERROR_NOT_SUPPORTED_FILE":return Jt.BPFormatNotSupportedError}return Jt.BPUnspecifiedError}},{key:"initSessionPlayerObjects",value:function(){var e=this;this.started=!1,this.paused=!1,this.buffering=!0,this.stalling=!1,this.nextBitrate=-1,this.appliedBitrate=-1,void 0!==this.player&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new eu(this,this),void 0===uu(i,i,Eu)&&(ou(i,i,Eu,{}),uu(i,i,Eu).play=this.player.play,uu(i,i,Eu).pause=this.player.pause,uu(i,i,Eu).seekTo=this.player.seekTo,uu(i,i,Eu).jumpForward=this.player.jumpForward,uu(i,i,Eu).jumpBackward=this.player.jumpBackward),this.playerListener=new yu(this),this.player.setListener(this.playerListener),this.player.play=function(){uu(i,i,Eu).play(),e.onPlayEvent()},this.player.pause=function(){uu(i,i,Eu).pause(),e.onPauseEvent()},this.player.seekTo=function(t,n,r){void 0===n&&void 0===r?uu(i,i,Eu).seekTo(t):void 0!==n&&void 0===r?uu(i,i,Eu).seekTo(t,n):uu(i,i,Eu).seekTo(t,n,r),e.onSeekToEvent(t)},this.player.jumpForward=function(t,n,r){void 0===n&&void 0===r?uu(i,i,Eu).jumpForward(t):void 0!==n&&void 0===r?uu(i,i,Eu).jumpForward(t,n):uu(i,i,Eu).jumpForward(t,n,r),e.onJumpForwardEvent(t)},this.player.jumpBackward=function(t,n,r){void 0===n&&void 0===r?uu(i,i,Eu).jumpBackward(t):void 0!==n&&void 0===r?uu(i,i,Eu).jumpBackward(t,n):uu(i,i,Eu).jumpBackward(t,n,r),e.onJumpBackwardEvent(t)})}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==this.player&&(void 0!==this.playerListener&&clearInterval(this.playerListener.waitToStartTask),this.player.setListener(this.listener),void 0!==uu(i,i,Eu)&&(this.player.play=uu(i,i,Eu).play,this.player.pause=uu(i,i,Eu).pause,this.player.seekTo=uu(i,i,Eu).seekTo,this.player.jumpForward=uu(i,i,Eu).jumpForward,this.player.jumpBackward=uu(i,i,Eu).jumpBackward))}},{key:"attachPlayer",value:function(e,t){return!!i.checkPlayer(e,t)&&(this.player=e,this.listener=t,!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),this.player=void 0,this.listener=void 0}}],[{key:"checkPlayer",value:function(e,t){return"function"==typeof e.getTotalTrackInfo&&"function"==typeof e.getCurrentStreamInfo}}]),i}(vn),Eu={writable:!0,value:void 0};function Su(e){return(Su="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ku(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function mu(e,t,i){return(mu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Du(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function _u(e,t){return(_u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Au(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Du(e);if(t){var r=Du(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Nu(this,i)}}function Nu(e,t){return!t||"object"!==Su(t)&&"function"!=typeof t?Ru(e):t}function Ru(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Du(e){return(Du=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pu(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Tu(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Ou(e,t,"set"),i),i}function wu(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Ou(e,t,"get"))}function Ou(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}un.avplayModule={AVPlayAdapter:gu};var Lu="BpkConnectPlayerAdapter",Cu=new WeakMap,Iu=new WeakMap,Mu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_u(e,t)}(a,e);var t,i,n,r=Au(a);function a(){var e;bu(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),Cu.set(Ru(e),{writable:!0,value:void 0}),Iu.set(Ru(e),{writable:!0,value:void 0}),Pu(Ru(e),"started",void 0),Pu(Ru(e),"paused",void 0),Pu(Ru(e),"waiting",void 0),Pu(Ru(e),"seeking",void 0),Pu(Ru(e),"bitrate",void 0),Pu(Ru(e),"playerStateManager",void 0),Pu(Ru(e),"playerListeners",void 0),e}return t=a,n=[{key:"attachLibrary",value:function(e){void 0!==e.conax&&void 0!==e.eventTimelineAnalyzer?(P.d(Lu,"CONNECT Player library attached"),a.library=e):P.e(Lu,"Try to attach a library, but it is not recognized")}},{key:"checkPlayer",value:function(e,t){return"undefined"!=typeof window&&void 0!==window.OTV&&(a.library=window.OTV),"object"===Su(e.activePlugins_)&&"object"===Su(e.player_)&&"boolean"==typeof e.userActive_}}],(i=[{key:"onPlayingEvent",value:function(){this.started?(this.paused&&this.notifyResume(),this.seeking&&(this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(),this.waiting=!1),this.waiting&&this.notifyStallEnd()):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage()),this.paused=!1,this.waiting=!1,this.seeking=!1}},{key:"onPlayEvent",value:function(){this.paused&&this.notifyResume(),this.paused=!1}},{key:"onPauseEvent",value:function(){(!wu(this,Cu).seeking()||wu(this,Cu).seeking()&&this.seeking)&&(this.notifyPause(),this.paused=!0)}},{key:"onWaitingEvent",value:function(){wu(this,Cu).seeking()||this.waiting||this.seeking||(this.notifyStallStart(),this.waiting=!0)}},{key:"onSeekingEvent",value:function(){this.seeking||(this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition(),this.seeking=!0)}},{key:"onProgressEvent",value:function(){this.paused&&(this.seeking&&(this.notifyStallEnd(!1),this.seeking=!1,this.waiting=!1),this.waiting&&(this.notifyStallEnd(!1),this.waiting=!1))}},{key:"onErrorEvent",value:function(){var e=wu(this,Cu).error();this.setStatusCode(this.getErrorCode(e)),this.setPlayerErrorCode(e.code),P.w(Lu,"Player error:"+e.message+" (code: "+e.code+")")}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"handlePoll",value:function(){var e=this.getBitrate();e>0&&this.bitrate!==e&&(this.bitrate=e,this.notifyLayerSwitch(this.bitrate))}},{key:"getName",value:function(){return"CONNECT Player"}},{key:"getVersion",value:function(){return a.library.versions.product}},{key:"getDeviceType",value:function(){var e=mu(Du(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){var e,t=null===(e=wu(this,Cu).otvtoolkit().networkStatistics)||void 0===e?void 0:e.impl;return void 0!==t&&void 0!==t.availableBitrates?Math.floor(t.availableBitrates[t.requestQualityIdx]/1e3):0}},{key:"getPosition",value:function(){if(void 0!==wu(this,Cu)){if(wu(this,Cu).isDynamic){var e,t=null===(e=wu(this,Cu).dashjs)||void 0===e?void 0:e.timeAsUTC();if(void 0!==t)return Math.round(1e3*t)}return Math.round(1e3*wu(this,Cu).currentTime())}return 0}},{key:"getDuration",value:function(){return void 0!==wu(this,Cu)&&isFinite(wu(this,Cu).duration())?Math.round(1e3*wu(this,Cu).duration()):0}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){switch(e.code){case 0:case 1:return Jt.BPUnspecifiedError;case 2:return Jt.BPNetworkingError;case 3:return Jt.BPDecodingError;case 4:return Jt.BPFormatNotSupportedError;case 5:return Jt.BPAccessRightError;default:return Jt.BPUnspecifiedError}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.waiting=!1,this.seeking=!1,this.bitrate=0,this.handlePoll(),void 0!==wu(this,Cu)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new eu(this,this),this.playerListeners=[this.onPlayingEvent.bind(this),this.onPlayEvent.bind(this),this.onPauseEvent.bind(this),this.onWaitingEvent.bind(this),this.onSeekingEvent.bind(this),this.onProgressEvent.bind(this),this.onErrorEvent.bind(this)],wu(this,Cu).on("playing",this.playerListeners[0]),wu(this,Cu).on("play",this.playerListeners[1]),wu(this,Cu).on("pause",this.playerListeners[2]),wu(this,Cu).on("waiting",this.playerListeners[3]),wu(this,Cu).on("seeking",this.playerListeners[4]),wu(this,Cu).on("progress",this.playerListeners[5]),wu(this,Cu).on("error",this.playerListeners[6]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==wu(this,Cu)&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(wu(this,Cu).off("playing",this.playerListeners[0]),wu(this,Cu).off("play",this.playerListeners[1]),wu(this,Cu).off("pause",this.playerListeners[2]),wu(this,Cu).off("waiting",this.playerListeners[3]),wu(this,Cu).off("seeking",this.playerListeners[4]),wu(this,Cu).off("progress",this.playerListeners[5]),wu(this,Cu).off("error",this.playerListeners[6]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(void 0===a.library&&P.e(Lu,"Player library not attached to the adapter, please call ConnectPlayerAdapter.attachLibrary(OTV) before attachPlayer"),Tu(this,Cu,e),Tu(this,Iu,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),Tu(this,Cu,void 0),Tu(this,Iu,void 0)}}])&&ku(t.prototype,i),n&&ku(t,n),a}(vn);function Bu(e){return(Bu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Uu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ju(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fu(e,t,i){return(Fu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Wu(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function Vu(e,t){return(Vu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Wu(e);if(t){var r=Wu(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Gu(this,i)}}function Gu(e,t){return!t||"object"!==Bu(t)&&"function"!=typeof t?Hu(e):t}function Hu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wu(e){return(Wu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qu(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Yu(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Qu(e,t,"set"),i),i}function Ku(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Qu(e,t,"get"))}function Qu(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}Pu(Mu,"library",void 0),un.connectplayerModule={ConnectPlayerAdapter:Mu};var zu="BpkDashJsPlayerAdapter",Ju=new WeakMap,Xu=new WeakMap,Zu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vu(e,t)}(a,e);var t,i,n,r=xu(a);function a(){var e;Uu(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),Ju.set(Hu(e),{writable:!0,value:void 0}),Xu.set(Hu(e),{writable:!0,value:void 0}),qu(Hu(e),"started",void 0),qu(Hu(e),"paused",void 0),qu(Hu(e),"buffering",void 0),qu(Hu(e),"seeking",void 0),qu(Hu(e),"seekBeginPosition",void 0),qu(Hu(e),"lastLayer",void 0),qu(Hu(e),"playerStateManager",void 0),qu(Hu(e),"playerListener",void 0),qu(Hu(e),"position",void 0),e}return t=a,n=[{key:"attachLibrary",value:function(e){void 0!==e.MediaPlayer&&void 0!==e.Version?(P.d(zu,"Dash.js library attached"),a.library=e):P.e(zu,"Try to attach a library, but it is not recognized")}},{key:"checkPlayer",value:function(e,t){return"undefined"!=typeof window&&void 0!==window.dashjs&&(a.library=window.dashjs),"object"===Bu(a.library)&&"function"==typeof e.getDashMetrics&&"function"==typeof e.getClassName&&"MediaPlayer"===e.getClassName()}}],(i=[{key:"handleEvent",value:function(e){if("playbackPlaying"===e.type)this.started?(this.buffering&&(this.notifyStallEnd(),this.setStatusCode(Jt.BPSessionEndsNormally),this.buffering=!1,this.seeking=!1),this.paused&&(this.notifyResume(),this.paused=!1)):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage());else if("playbackPaused"===e.type)this.started&&(!this.buffering&&Ku(this,Ju).isSeeking()?(this.seeking=!0,this.buffering=!0,this.seekBeginPosition=this.playerStateManager.getPositionBeforeSeek(),this.notifyStallStart(),this.seeking&&this.notifySeek(this.seekBeginPosition,this.getPosition())):this.buffering&&Ku(this,Ju).isSeeking()&&!this.seeking?(this.seeking=!0,this.seekBeginPosition=this.playerStateManager.getPositionBeforeSeek(),this.notifySeek(this.seekBeginPosition,this.getPosition())):Ku(this,Ju).isPaused()&&!this.paused&&(this.paused=!0,this.notifyPause()));else if("playbackWaiting"===e.type||"bufferStalled"===e.type&&"video"===e.mediaType)this.started&&!this.buffering&&(Ku(this,Ju).isSeeking()&&(this.seeking=!0,this.seekBeginPosition=this.playerStateManager.getPositionBeforeSeek()),this.buffering=!0,this.notifyStallStart(),this.seeking&&this.notifySeek(this.seekBeginPosition,this.getPosition()));else if("bufferLoaded"===e.type&&"video"===e.mediaType)this.started&&this.paused&&(this.notifyStallEnd(),this.setStatusCode(Jt.BPSessionEndsNormally),this.buffering=!1,this.seeking=!1);else if("qualityChangeRendered"===e.type){var t=this.getBitrate();t!==this.lastLayer&&(this.lastLayer=t,this.notifyLayerSwitch(t))}else"error"===e.type&&"object"===Bu(e.error)&&"DashJSError"===e.error.constructor.name&&(P.e(zu,"Player encountered an error : "+e.error.code),this.setStatusCode(this.getErrorCode(e.error)),this.setPlayerErrorCode(e.error.code))}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"getName",value:function(){return"Dash.js"}},{key:"getVersion",value:function(){return a.library.Version.substring(0,32)}},{key:"getDeviceType",value:function(){var e=Fu(Wu(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){if(void 0!==Ku(this,Ju)&&Ku(this,Ju).isReady()){var e=Ku(this,Ju).getQualityFor("video"),t=Ku(this,Ju).getQualityFor("audio"),i=Ku(this,Ju).getBitrateInfoListFor("video"),n=Ku(this,Ju).getBitrateInfoListFor("audio"),r=0;return e<i.length&&(r=Math.round(i[e].bitrate/1e3)),t<n.length&&(r+=Math.round(n[t].bitrate/1e3)),r}return 0}},{key:"getPosition",value:function(){return void 0!==Ku(this,Ju)?Ku(this,Ju).isDynamic()&&(isNaN(Ku(this,Ju).timeAsUTC())||(this.position=Math.round(1e3*Ku(this,Ju).timeAsUTC())),0!==this.position)?this.position:Math.round(1e3*Ku(this,Ju).time()):0}},{key:"getDuration",value:function(){return void 0===Ku(this,Ju)||Ku(this,Ju).isDynamic()?0:Math.round(1e3*Ku(this,Ju).duration())}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){var t=a.library.MediaPlayer.errors;switch(e.code){case t.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE:return Jt.BPFormatNotSupportedError;case t.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE:case t.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE:case t.SEGMENTS_UPDATE_FAILED_ERROR_CODE:case t.SEGMENTS_UNAVAILABLE_ERROR_CODE:case t.SEGMENT_BASE_LOADER_ERROR_CODE:case t.TIME_SYNC_FAILED_ERROR_CODE:case t.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE:case t.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE:case t.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE:case t.APPEND_ERROR_CODE:case t.REMOVE_ERROR_CODE:case t.DATA_UPDATE_FAILED_ERROR_CODE:return Jt.BPDecodingError;case t.CAPABILITY_MEDIASOURCE_ERROR_CODE:return Jt.BPFormatNotSupportedError;case t.CAPABILITY_MEDIAKEYS_ERROR_CODE:return Jt.BPAccessRightError;case t.DOWNLOAD_ERROR_ID_MANIFEST_CODE:case t.DOWNLOAD_ERROR_ID_SIDX_CODE:case t.DOWNLOAD_ERROR_ID_CONTENT_CODE:case t.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE:case t.DOWNLOAD_ERROR_ID_XLINK_CODE:return Jt.BPNetworkingError;case t.MANIFEST_ERROR_ID_CODEC_CODE:case t.MANIFEST_ERROR_ID_PARSE_CODE:case t.MANIFEST_ERROR_ID_NOSTREAMS_CODE:case t.TIMED_TEXT_ERROR_ID_PARSE_CODE:return Jt.BPDecodingError;case t.MANIFEST_ERROR_ID_MULTIPLEXED_CODE:case t.MEDIASOURCE_TYPE_UNSUPPORTED_CODE:return Jt.BPFormatNotSupportedError}return e.code>=t.MEDIA_KEYERR_CODE?Jt.BPAccessRightError:Jt.BPUnspecifiedError}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.buffering=!1,this.seeking=!1,this.seekBeginPosition=0,this.lastLayer=0,this.position=0,void 0!==Ku(this,Ju)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new eu(this,this),this.playerListener=this.handleEvent.bind(this),Ku(this,Ju).on(a.library.MediaPlayer.events.PLAYBACK_PLAYING,this.playerListener,this),Ku(this,Ju).on(a.library.MediaPlayer.events.PLAYBACK_PAUSED,this.playerListener,this),Ku(this,Ju).on(a.library.MediaPlayer.events.BUFFER_EMPTY,this.playerListener,this),Ku(this,Ju).on(a.library.MediaPlayer.events.QUALITY_CHANGE_RENDERED,this.playerListener,this),Ku(this,Ju).on(a.library.MediaPlayer.events.ERROR,this.playerListener,this),Ku(this,Ju).on(a.library.MediaPlayer.events.PLAYBACK_WAITING,this.playerListener,this),Ku(this,Ju).on(a.library.MediaPlayer.events.BUFFER_LOADED,this.playerListener,this))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==Ku(this,Ju)&&void 0!==this.playerListener&&(Ku(this,Ju).off(a.library.MediaPlayer.events.PLAYBACK_PLAYING,this.playerListener,this),Ku(this,Ju).off(a.library.MediaPlayer.events.PLAYBACK_PAUSED,this.playerListener,this),Ku(this,Ju).off(a.library.MediaPlayer.events.BUFFER_EMPTY,this.playerListener,this),Ku(this,Ju).off(a.library.MediaPlayer.events.QUALITY_CHANGE_RENDERED,this.playerListener,this),Ku(this,Ju).off(a.library.MediaPlayer.events.ERROR,this.playerListener,this),Ku(this,Ju).off(a.library.MediaPlayer.events.PLAYBACK_WAITING,this.playerListener,this),Ku(this,Ju).off(a.library.MediaPlayer.events.BUFFER_LOADED,this.playerListener,this))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(void 0===a.library&&P.e(zu,"Player library not attached to the adapter, please call DashJsPlayerAdapter.attachLibrary(dashjs) before attachPlayer"),Yu(this,Ju,e),Yu(this,Xu,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),Yu(this,Ju,void 0),Yu(this,Xu,void 0)}}])&&ju(t.prototype,i),n&&ju(t,n),a}(vn);function $u(e){return($u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function el(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tl(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function il(e,t,i){return(il="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ol(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function nl(e,t){return(nl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ol(e);if(t){var r=ol(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return al(this,i)}}function al(e,t){return!t||"object"!==$u(t)&&"function"!=typeof t?sl(e):t}function sl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ol(e){return(ol=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ul(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ll(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,cl(e,t,"set"),i),i}function dl(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,cl(e,t,"get"))}function cl(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}qu(Zu,"library",void 0),un.dashjsModule={DashJsPlayerAdapter:Zu};var hl=new WeakMap,fl=new WeakMap,vl=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nl(e,t)}(a,e);var t,i,n,r=rl(a);function a(){var e;el(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),hl.set(sl(e),{writable:!0,value:void 0}),fl.set(sl(e),{writable:!0,value:void 0}),ul(sl(e),"started",void 0),ul(sl(e),"buffering",void 0),ul(sl(e),"playerStateManager",void 0),ul(sl(e),"playerListener",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return"number"==typeof e.playPosition&&"number"==typeof e.playState}}],(i=[{key:"onPlayStateChange",value:function(e){switch(e){case 0:break;case 1:this.started?(!0===this.buffering&&(this.buffering=!1,this.notifyStallEnd(!0)),this.notifyResume(),this.setStatusCode(Jt.BPSessionEndsNormally),this.setPlayerErrorCode("")):(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage());break;case 2:!0===this.buffering&&(this.buffering=!1,this.notifyStallEnd(!0)),this.notifyPause();break;case 3:break;case 4:this.started&&(void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition(),this.buffering=!0,this.notifyStallStart());break;case 5:break;case 6:P.e("BpkHbbTV1PlayerAdapter","On player error : "+dl(this,hl).error),this.setStatusCode(this.getErrorCode(dl(this,hl).error)),this.setPlayerErrorCode(dl(this,hl).error)}}},{key:"handleSeek",value:function(e,t){!1===this.buffering&&(this.buffering=!0,this.notifyStallStart()),this.notifySeek(e,t)}},{key:"getName",value:function(){return"HbbTV"}},{key:"getVersion",value:function(){if("object"===("undefined"==typeof navigator?"undefined":$u(navigator))&&void 0!==navigator.userAgent){var e=navigator.userAgent.match("HbbTV/([0-9.]*)");if(null!==e)return e[1]}return"1.X"}},{key:"getDeviceType",value:function(){var e=il(ol(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="tv"),e}},{key:"getBitrate",value:function(){return-1}},{key:"getPosition",value:function(){return void 0!==dl(this,hl)?Math.round(dl(this,hl).playPosition):0}},{key:"getDuration",value:function(){return void 0!==dl(this,hl)&&0!==dl(this,hl).playTime&&dl(this,hl).playTime!==1/0?Math.round(dl(this,hl).playTime):0}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){switch(e){case 0:return Jt.BPFormatNotSupportedError;case 1:return Jt.BPNetworkingError;case 2:return Jt.BPUnspecifiedError;case 3:case 4:return Jt.BPDecodingError;case 5:case 6:return Jt.BPNetworkingError}return Jt.BPUnspecifiedError}},{key:"initSessionPlayerObjects",value:function(){var e=this;this.started=!1,this.buffering=!1,void 0!==dl(this,hl)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new eu(this,this),this.playerListener=dl(this,hl).onPlayStateChange,dl(this,hl).onPlayStateChange=function(t){e.onPlayStateChange(t),"function"==typeof e.playerListener&&e.playerListener(t)})}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==dl(this,hl)&&(dl(this,hl).onPlayStateChange=this.playerListener)}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(ll(this,hl,e),ll(this,fl,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),ll(this,hl,void 0),ll(this,fl,void 0)}}])&&tl(t.prototype,i),n&&tl(t,n),a}(vn);function pl(e){return(pl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yl(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function gl(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function El(e,t,i){return(El="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_l(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function Sl(e,t){return(Sl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=_l(e);if(t){var r=_l(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return kl(this,i)}}function kl(e,t){return!t||"object"!==pl(t)&&"function"!=typeof t?ml(e):t}function ml(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _l(e){return(_l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Al(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Nl(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Dl(e,t,"set"),i),i}function Rl(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Dl(e,t,"get"))}function Dl(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}un.hbbtv1Module={HbbTV1PlayerAdapter:vl};var Pl=new WeakMap,Tl=new WeakMap,wl=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sl(e,t)}(a,e);var t,i,n,r=bl(a);function a(){var e;yl(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),Pl.set(ml(e),{writable:!0,value:void 0}),Tl.set(ml(e),{writable:!0,value:void 0}),Al(ml(e),"started",void 0),Al(ml(e),"paused",void 0),Al(ml(e),"waiting",void 0),Al(ml(e),"seeking",void 0),Al(ml(e),"playerStateManager",void 0),Al(ml(e),"playerListeners",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return"object"===pl(e.seekable)&&"function"==typeof e.play}}],(i=[{key:"onPlayingEvent",value:function(){this.started?(this.paused&&this.notifyResume(),this.seeking&&(this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(),this.waiting=!1),this.waiting&&this.notifyStallEnd()):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage()),this.paused=!1,this.waiting=!1,this.seeking=!1}},{key:"onPlayEvent",value:function(){this.paused&&this.notifyResume(),this.paused=!1}},{key:"onPauseEvent",value:function(){(!Rl(this,Pl).seeking||Rl(this,Pl).seeking&&this.seeking)&&(this.notifyPause(),this.paused=!0)}},{key:"onWaitingEvent",value:function(){Rl(this,Pl).seeking||this.waiting||this.seeking||(this.notifyStallStart(),this.waiting=!0)}},{key:"onSeekingEvent",value:function(){this.seeking||(this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition(),this.seeking=!0)}},{key:"onProgressEvent",value:function(){this.paused&&(this.seeking&&(this.notifyStallEnd(!1),this.seeking=!1,this.waiting=!1),this.waiting&&(this.notifyStallEnd(!1),this.waiting=!1))}},{key:"onErrorEvent",value:function(){var e=Rl(this,Pl).error;this.setStatusCode(this.getErrorCode(e)),this.setPlayerErrorCode(e.code),P.w("BpkHTML5PlayerAdapter","Player error:"+e.message+" (code: "+e.code+")")}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"getName",value:function(){return"HTML5"}},{key:"getVersion",value:function(){return""}},{key:"getDeviceType",value:function(){var e=El(_l(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){return-1}},{key:"getPosition",value:function(){return void 0!==Rl(this,Pl)?Math.round(1e3*Rl(this,Pl).currentTime):0}},{key:"getDuration",value:function(){return void 0!==Rl(this,Pl)&&isFinite(Rl(this,Pl).duration)?Math.round(1e3*Rl(this,Pl).duration):0}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){switch(e.code){case 1:return Jt.BPUnspecifiedError;case 2:return Jt.BPNetworkingError;case 3:return Jt.BPDecodingError;case 4:return Jt.BPFormatNotSupportedError;default:return Jt.BPUnspecifiedError}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.waiting=!1,this.seeking=!1,void 0!==Rl(this,Pl)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new eu(this,this),this.playerListeners=[this.onPlayingEvent.bind(this),this.onPlayEvent.bind(this),this.onPauseEvent.bind(this),this.onWaitingEvent.bind(this),this.onSeekingEvent.bind(this),this.onProgressEvent.bind(this),this.onErrorEvent.bind(this)],Rl(this,Pl).addEventListener("playing",this.playerListeners[0]),Rl(this,Pl).addEventListener("play",this.playerListeners[1]),Rl(this,Pl).addEventListener("pause",this.playerListeners[2]),Rl(this,Pl).addEventListener("waiting",this.playerListeners[3]),Rl(this,Pl).addEventListener("seeking",this.playerListeners[4]),Rl(this,Pl).addEventListener("progress",this.playerListeners[5]),Rl(this,Pl).addEventListener("error",this.playerListeners[6]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==Rl(this,Pl)&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(Rl(this,Pl).removeEventListener("playing",this.playerListeners[0]),Rl(this,Pl).removeEventListener("play",this.playerListeners[1]),Rl(this,Pl).removeEventListener("pause",this.playerListeners[2]),Rl(this,Pl).removeEventListener("waiting",this.playerListeners[3]),Rl(this,Pl).removeEventListener("seeking",this.playerListeners[4]),Rl(this,Pl).removeEventListener("progress",this.playerListeners[5]),Rl(this,Pl).removeEventListener("error",this.playerListeners[6]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(Nl(this,Pl,e),Nl(this,Tl,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),Nl(this,Pl,void 0),Nl(this,Tl,void 0)}}])&&gl(t.prototype,i),n&&gl(t,n),a}(vn);function Ol(e){return(Ol="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ll(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cl(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Il(e,t,i){return(Il="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Fl(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function Ml(e,t){return(Ml=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Bl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Fl(e);if(t){var r=Fl(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Ul(this,i)}}function Ul(e,t){return!t||"object"!==Ol(t)&&"function"!=typeof t?jl(e):t}function jl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fl(e){return(Fl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}un.html5Module={HTML5PlayerAdapter:wl};var xl=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ml(e,t)}(a,e);var t,i,n,r=Bl(a);function a(){var e;Ll(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return Vl(jl(e=r.call.apply(r,[this].concat(i))),"player",void 0),Vl(jl(e),"listener",void 0),Vl(jl(e),"started",void 0),Vl(jl(e),"paused",void 0),Vl(jl(e),"buffering",void 0),Vl(jl(e),"seeking",void 0),Vl(jl(e),"bitrate",void 0),Vl(jl(e),"seekStart",void 0),Vl(jl(e),"seekEnd",void 0),Vl(jl(e),"playerStateManager",void 0),Vl(jl(e),"playerListeners",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){var i;return void 0!==(null===(i=e.Event)||void 0===i?void 0:i.Core)}}],(i=[{key:"handleSeek",value:function(e,t){return!0===this.seeking?(this.notifySeek(e,t),!0):(!1===this.seeking&&(this.seekStart=e,this.seekEnd=t),!1)}},{key:"onSeekingEvent",value:function(){this.seeking=!0,void 0!==this.seekStart&&void 0!==this.seekEnd&&(this.notifySeek(this.seekStart,this.seekEnd),this.seekStart=void 0,this.seekEnd=void 0)}},{key:"onSeekedEvent",value:function(){this.seeking=!1}},{key:"onPlayheadUpdated",value:function(e){}},{key:"onPlaybackInfoUpdated",value:function(e){var t=Math.floor(e.payload.selectedVideoTrack.bandwidth/1e3);t>0&&t!==this.bitrate&&(this.bitrate=t,this.notifyLayerSwitch(t))}},{key:"onPlayingEvent",value:function(e){!1===this.started?(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage()):(!0===this.paused&&(this.paused=!1,this.notifyResume()),this.onStallEndEvent())}},{key:"onPlayEvent",value:function(e){!0===this.started&&!0===this.paused&&(this.paused=!1,this.notifyResume())}},{key:"onPauseEvent",value:function(e){!0===this.started&&!1===this.paused&&(this.paused=!0,this.notifyPause())}},{key:"onStallStartEvent",value:function(e){!0===this.started&&!1===this.buffering&&(this.buffering=!0,this.notifyStallStart(),void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition())}},{key:"onStallEndEvent",value:function(e){!0===this.started&&!0===this.buffering&&(this.buffering=!1,void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(!this.paused),this.setStatusCode(Jt.BPSessionEndsNormally),this.setPlayerErrorCode(""))}},{key:"onErrorEvent",value:function(e){e.payload.severity===this.player.Error.Severity.CRITICAL&&(P.e("BpkKalturaPlayerAdapter","On player error "+e.payload.code),this.setStatusCode(this.getErrorCode(e.payload)),this.setPlayerErrorCode(e.payload.code))}},{key:"getName",value:function(){return"Kaltura"}},{key:"getVersion",value:function(){var e,t;return void 0!==(null===(e=this.player)||void 0===e||null===(t=e._provider)||void 0===t?void 0:t._playerVersion)?this.player._provider._playerVersion:"Unknown"}},{key:"getDeviceType",value:function(){var e=Il(Fl(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){return this.bitrate}},{key:"getPosition",value:function(){return void 0!==this.player?Math.round(1e3*this.player.currentTime):0}},{key:"getDuration",value:function(){return void 0===this.player||this.player.isLive()?0:Math.round(1e3*this.player.duration)}},{key:"getCapabilities",value:function(){return{adTracking:!1}}},{key:"getErrorCode",value:function(e){var t=this.player.Error.Category;switch(e.category){case t.NETWORK:return Jt.BPNetworkingError;case t.TEXT:case t.MEDIA:case t.MANIFEST:return Jt.BPFormatNotSupportedError;case t.STREAMING:return Jt.BPDecodingError;case t.DRM:return Jt.BPAccessRightError;case t.PLAYER:case t.ADS:case t.STORAGE:case t.CAST:case t.VR:return Jt.BPUnspecifiedError}return Jt.BPUnspecifiedError}},{key:"initSessionPlayerObjects",value:function(){var e=this;this.started=!1,this.paused=!1,this.buffering=!1,this.seeking=!1,this.bitrate=-1,this.seekStart=void 0,this.seekEnd=void 0,void 0!==this.player&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new eu(this,this),this.playerListeners=[function(t){e.onPlayheadUpdated(t)},function(t){e.onPlaybackInfoUpdated(t)},function(t){e.onPlayingEvent(t)},function(t){e.onPlayEvent(t)},function(t){e.onPauseEvent(t)},function(t){e.onSeekingEvent(),e.onStallStartEvent(t)},function(t){e.onStallStartEvent(t)},function(t){e.onStallEndEvent(t)},function(t){e.onSeekedEvent(),e.onStallEndEvent(t)},function(t){e.onErrorEvent(t)}],this.player.addEventListener(this.player.Event.Core.VIDEO_TRACK_CHANGED,this.playerListeners[1]),this.player.addEventListener(this.player.Event.Core.PLAYING,this.playerListeners[2]),this.player.addEventListener(this.player.Event.Core.PLAY,this.playerListeners[3]),this.player.addEventListener(this.player.Event.Core.PAUSE,this.playerListeners[4]),this.player.addEventListener(this.player.Event.Core.SEEKING,this.playerListeners[5]),this.player.addEventListener(this.player.Event.Core.WAITING,this.playerListeners[6]),this.player.addEventListener(this.player.Event.Core.STALLED,this.playerListeners[7]),this.player.addEventListener(this.player.Event.Core.SEEKED,this.playerListeners[8]),this.player.addEventListener(this.player.Event.Core.ERROR,this.playerListeners[9]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==this.player&&void 0!==this.playerListeners&&10===this.playerListeners.length&&(this.player.removeEventListener(this.player.Event.Core.VIDEO_TRACK_CHANGED,this.playerListeners[1]),this.player.removeEventListener(this.player.Event.Core.PLAYING,this.playerListeners[2]),this.player.removeEventListener(this.player.Event.Core.PLAY,this.playerListeners[3]),this.player.removeEventListener(this.player.Event.Core.PAUSE,this.playerListeners[4]),this.player.removeEventListener(this.player.Event.Core.SEEKING,this.playerListeners[5]),this.player.removeEventListener(this.player.Event.Core.WAITING,this.playerListeners[6]),this.player.removeEventListener(this.player.Event.Core.STALLED,this.playerListeners[7]),this.player.removeEventListener(this.player.Event.Core.SEEKED,this.playerListeners[8]),this.player.removeEventListener(this.player.Event.Core.ERROR,this.playerListeners[9]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(this.player=e,this.listener=t,!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),this.player=void 0,this.listener=void 0}}])&&Cl(t.prototype,i),n&&Cl(t,n),a}(vn);function Gl(e){return(Gl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hl(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Wl(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ql(e,t){return(ql=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Yl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=zl(e);if(t){var r=zl(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Kl(this,i)}}function Kl(e,t){return!t||"object"!==Gl(t)&&"function"!=typeof t?Ql(e):t}function Ql(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zl(e){return(zl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Xl(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,$l(e,t,"set"),i),i}function Zl(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,$l(e,t,"get"))}function $l(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}un.kalturaModule={KalturaPlayerAdapter:xl};var ed="BpkSagemcomDIW387Adapter",td=new WeakMap,id=new WeakMap,nd=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ql(e,t)}(a,e);var t,i,n,r=Yl(a);function a(){var e;Hl(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),td.set(Ql(e),{writable:!0,value:void 0}),id.set(Ql(e),{writable:!0,value:void 0}),Jl(Ql(e),"mediaStartTime",0),Jl(Ql(e),"mediaDuration",0),Jl(Ql(e),"started",void 0),Jl(Ql(e),"paused",void 0),Jl(Ql(e),"playerStateManager",void 0),Jl(Ql(e),"playerListener",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return void 0!==e.Get&&void 0!==e.session&&void 0!==e.event}}],(i=[{key:"handlePlayerEvent",value:function(e){switch(e){case 36896:case 4162:!1===this.started&&(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage());break;case 4096:case 36865:case 36898:case 4114:this.setMediaInfo(0,0);break;case 38401:case 4168:this.paused=!0,this.notifyPause();break;case 38400:case 4169:this.paused=!1,this.notifyResume();break;case 37376:case 37377:case 37378:case 37379:case 37380:case 37392:this.setStatusCode(Jt.BPDecodingError),this.setPlayerErrorCode(e),this.setMediaInfo(0,0);break;case 37381:this.setStatusCode(Jt.BPFormatNotSupportedError),this.setPlayerErrorCode(e),this.setMediaInfo(0,0);break;case 37382:case 38721:case 38722:this.setStatusCode(Jt.BPAccessRightError),this.setPlayerErrorCode(e),this.setMediaInfo(0,0);break;case 37120:case 37121:case 37122:case 37123:case 37124:this.setStatusCode(Jt.BPNetworkingError),this.setPlayerErrorCode(e),this.setMediaInfo(0,0);break;case 4196:void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition(),this.notifyStallStart();break;case 4197:this.notifyStallEnd(!this.paused);break;case 38704:case 4307:this.notifyLayerSwitch();break;case 2415972357:case 2415972358:this.handleNetwork()}}},{key:"handleEvent",value:function(e){if(void 0!==Zl(this,td)){var t=Zl(this,td).event.getSource(e.keyCodeVal).split(":");if(t.length>=2){var i=parseInt(t[1],10);"live_livePlayerWidget"!==t[0]&&(P.d(ed,"Processing event 0x"+i.toString(16)),this.handlePlayerEvent(i))}else parseInt(e,10)}}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"handleNetwork",value:function(){var e=this.executeSystemCommand("NETWORK","INTERFACE","LIST"),t=this.executeSystemCommand("NETWORK","INTERFACE");P.d(ed,"Interface list: "+e),P.d(ed,"Interface index: "+t);for(var i=e.split(";"),n=0;n<i.length;n++){var r=i[n].split(":");if(r.length>=2){var a=this.transformResult(r[0]),s=r[1];if(t===a){var o=-1!==s.indexOf("wlan")||-1!==s.indexOf("wifi");return void(!0==(-1!==s.indexOf("eth"))?Ot.getInstance().notifyNetworkAvailable(30):!0===o&&Ot.getInstance().notifyNetworkAvailable(10))}}}Ot.getInstance().notifyNetworkLost()}},{key:"getName",value:function(){var e=this.executeSystemCommand("INFO","LOADER_VERSION");return-1!==e.indexOf("DIW387")?"Sagemcom DIW387":-1!==e.indexOf("DIW384")?"Sagemcom DIW384":-1!==e.indexOf("DIW393")?"Sagemcom DIW393":"Sagemcom DIW387"}},{key:"getVersion",value:function(){return this.executeSystemCommand("INFO","SOFTWARE_VERSION")}},{key:"getDeviceType",value:function(){return"stb"}},{key:"getBitrate",value:function(){if(void 0!==Zl(this,td)&&void 0!==a.handle){var e=this.executeSessionCommand("VARIANT","CURRENT"),t=-1;if("string"==typeof e&&""!==e){if(!(a.handle.indexOf("avplayer")>-1)){var i=e.split(":");return null!==i&&i.length>0&&(t=i[2]),isNaN(t)?-1:Math.round(parseInt(t,10)/1e3)}for(var n=e.split(","),r=0;r<n.length;r++)if(n[r].indexOf("bandwidth:")>-1){var s=n[r].split(":");if(s.length>=2)return isNaN(s[1])?-1:Math.round(parseInt(s[1],10)/1e3)}}return-1}return-1}},{key:"getPosition",value:function(){if(void 0!==Zl(this,td)){var e=this.executeSessionCommand("POSITION","SEC");return""===e?-1:e>=946684800&&this.mediaStartTime>0?e-this.mediaStartTime:1e3*e}return 0}},{key:"getDuration",value:function(){if(void 0!==Zl(this,td)){var e=this.executeSessionCommand("DURATION","SEC");return""===e?-1:e>=9007199254740991?this.mediaDuration:1e3*e}return 0}},{key:"getCapabilities",value:function(){return{adTracking:!1}}},{key:"transformResult",value:function(e){return isNaN(e)?e:parseInt(e,10)}},{key:"executeSystemCommand",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;try{var n;return n=void 0===i?Zl(this,td).Get(e,t).toString():Zl(this,td).Get(e,t,i).toString(),this.transformResult(n)}catch(e){return console.log(e),""}}},{key:"executeSessionCommand",value:function(e,t){try{var i=Zl(this,td).session.Get(a.handle,e,t).toString().split(";");return 1===i.length?this.transformResult(i[0]):i.length>=2&&"0"===i[0]?this.transformResult(i[1]):""}catch(e){return console.log(e),""}}},{key:"setInstanceName",value:function(e){P.d(ed,"Setting instance name to "+e),a.handle="string"==typeof e?e:""}},{key:"onPlayerEvent",value:function(e){if(P.d(ed,"Processing "+e.session_name+" "+e.event_hex),void 0!==Zl(this,td)){var t=e.session_name;if(("avplayerSession"===t||"HLS_VOD"===t)&&void 0!==e.event_hex){var i=String(e.event_hex);if(i.length>=5&&"5"===i[0]){var n=parseInt(i.substr(1,4),16);this.handlePlayerEvent(n)}}if(void 0!==e.event_hex){var r=String(e.event_hex);if(r.length>=8&&"9"===r[0]){var a=parseInt(r,16);this.handlePlayerEvent(a)}}}else P.w(ed,"Cannot handle event if no player attached")}},{key:"setMediaInfo",value:function(e,t){this.mediaStartTime=e,this.mediaDuration=t}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.mediaStartTime=0,this.mediaDuration=0,void 0!==Zl(this,td)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new eu(this,this))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0)}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(Xl(this,td,e),this.playerListener=this.handleEvent.bind(this),document.addEventListener("keypress",this.playerListener,!1),this.handleNetwork(),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),void 0!==Zl(this,td)&&(document.removeEventListener("keypress",this.playerListener),this.playerListener=void 0,Xl(this,td,void 0)),Xl(this,id,void 0)}}])&&Wl(t.prototype,i),n&&Wl(t,n),a}(vn);function rd(e){return(rd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ad(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sd(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function od(e,t,i){return(od="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=hd(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function ud(e,t){return(ud=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ld(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=hd(e);if(t){var r=hd(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return dd(this,i)}}function dd(e,t){return!t||"object"!==rd(t)&&"function"!=typeof t?cd(e):t}function cd(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hd(e){return(hd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fd(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function vd(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,yd(e,t,"set"),i),i}function pd(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,yd(e,t,"get"))}function yd(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}Jl(nd,"handle",void 0),un.diw387Module={SagemcomDIW387Adapter:nd};var gd="BpkShakaPlayerAdapter",Ed=new WeakMap,Sd=new WeakMap,bd=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ud(e,t)}(a,e);var t,i,n,r=ld(a);function a(){var e;ad(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),Ed.set(cd(e),{writable:!0,value:void 0}),Sd.set(cd(e),{writable:!0,value:void 0}),fd(cd(e),"started",void 0),fd(cd(e),"bitrate",void 0),fd(cd(e),"playingEventReceived",void 0),fd(cd(e),"playerStateManager",void 0),fd(cd(e),"playerListeners",void 0),e}return t=a,n=[{key:"attachLibrary",value:function(e){void 0!==e.util&&void 0!==e.Player?(P.d(gd,"Shaka Player library attached"),a.library=e):P.e(gd,"Try to attach a library, but it is not recognized")}},{key:"checkPlayer",value:function(e,t){if("undefined"!=typeof window&&void 0!==window.shaka&&(a.library=window.shaka),"function"==typeof e.getConfiguration){var i=e.getConfiguration();if(void 0!==i.manifest&&void 0!==i.streaming)return!0}return!1}}],(i=[{key:"onPlayEvent",value:function(){this.started&&this.notifyResume()}},{key:"onPlayingEvent",value:function(){this.playingEventReceived=!0,this.started||(pd(this,Ed).isBuffering()?P.d(gd,"Player is still buffering, first image event not yet triggered"):(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage()))}},{key:"onPauseEvent",value:function(){this.notifyPause()}},{key:"onBuffering",value:function(){var e=pd(this,Ed).isBuffering();this.started?e?(void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition(),this.notifyStallStart()):(this.notifyStallEnd(),this.setStatusCode(Jt.BPSessionEndsNormally),this.setPlayerErrorCode("")):!e&&this.playingEventReceived&&(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage())}},{key:"onLayerSwitchEvent",value:function(){var e=this.getBitrate();e!==this.bitrate&&(this.bitrate=e,this.notifyLayerSwitch(e))}},{key:"onVariantChanged",value:function(){this.onLayerSwitchEvent()}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"onErrorEvent",value:function(e){e.detail.severity===a.library.util.Error.Severity.CRITICAL&&(this.setStatusCode(this.getErrorCode(e.detail)),this.setPlayerErrorCode(e.detail.code))}},{key:"getName",value:function(){return"Shaka Player"}},{key:"getVersion",value:function(){var e=a.library.Player.version.substring(0,32),t=e.indexOf(" ");return t>=0?e.substring(0,t):e}},{key:"getDeviceType",value:function(){var e=od(hd(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){if(void 0!==pd(this,Ed))for(var e=pd(this,Ed).getVariantTracks(),t=0;t<e.length;t++){var i=e[t];if(!0===i.active)return Math.round(i.bandwidth/1e3)}return 0}},{key:"getPosition",value:function(){if(void 0!==pd(this,Ed)){var e=0;return pd(this,Ed).isLive()&&(e=pd(this,Ed).getPresentationStartTimeAsDate().getTime()),e+Math.round(1e3*pd(this,Ed).getMediaElement().currentTime)}return 0}},{key:"getDuration",value:function(){return void 0===pd(this,Ed)||pd(this,Ed).isLive()?0:Math.round(1e3*pd(this,Ed).getMediaElement().duration)}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){switch(e.category){case a.library.util.Error.Category.NETWORK:return Jt.BPNetworkingError;case a.library.util.Error.Category.TEXT:case a.library.util.Error.Category.MEDIA:case a.library.util.Error.Category.MANIFEST:return Jt.BPFormatNotSupportedError;case a.library.util.Error.Category.STREAMING:return Jt.BPDecodingError;case a.library.util.Error.Category.DRM:return Jt.BPAccessRightError;case a.library.util.Error.Category.PLAYER:case a.library.util.Error.Category.CAST:case a.library.util.Error.Category.STORAGE:default:return Jt.BPUnspecifiedError}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.bitrate=0,this.playingEventReceived=!1,void 0!==pd(this,Ed)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new eu(this,this),this.playerListeners=[this.onPlayEvent.bind(this),this.onPauseEvent.bind(this),this.onBuffering.bind(this),this.onLayerSwitchEvent.bind(this),this.onErrorEvent.bind(this),this.onPlayingEvent.bind(this),this.onVariantChanged.bind(this)],pd(this,Ed).getMediaElement().addEventListener("play",this.playerListeners[0]),pd(this,Ed).getMediaElement().addEventListener("pause",this.playerListeners[1]),pd(this,Ed).addEventListener("buffering",this.playerListeners[2]),pd(this,Ed).addEventListener("adaptation",this.playerListeners[3]),pd(this,Ed).addEventListener("error",this.playerListeners[4]),pd(this,Ed).getMediaElement().addEventListener("playing",this.playerListeners[5]),pd(this,Ed).addEventListener("variantchanged",this.playerListeners[6]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==pd(this,Ed)&&void 0!==this.playerListeners&&7===this.playerListeners.length&&(pd(this,Ed).getMediaElement().removeEventListener("play",this.playerListeners[0]),pd(this,Ed).getMediaElement().removeEventListener("pause",this.playerListeners[1]),pd(this,Ed).removeEventListener("buffering",this.playerListeners[2]),pd(this,Ed).removeEventListener("adaptation",this.playerListeners[3]),pd(this,Ed).removeEventListener("error",this.playerListeners[4]),pd(this,Ed).getMediaElement().removeEventListener("playing",this.playerListeners[5]),pd(this,Ed).removeEventListener("variantchanged",this.playerListeners[6]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(void 0===a.library&&P.e(gd,"Player library not attached to the adapter, please call ShakaPlayerAdapter.attachLibrary(shaka) before attachPlayer"),vd(this,Ed,e),vd(this,Sd,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),vd(this,Ed,void 0),vd(this,Sd,void 0)}}])&&sd(t.prototype,i),n&&sd(t,n),a}(vn);function kd(e){return(kd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function md(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _d(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ad(e,t,i){return(Ad="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Td(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function Nd(e,t){return(Nd=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Rd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Td(e);if(t){var r=Td(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Dd(this,i)}}function Dd(e,t){return!t||"object"!==kd(t)&&"function"!=typeof t?Pd(e):t}function Pd(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Td(e){return(Td=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wd(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Od(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Cd(e,t,"set"),i),i}function Ld(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Cd(e,t,"get"))}function Cd(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}fd(bd,"library",void 0),un.shakaModule={ShakaPlayerAdapter:bd};var Id=new WeakMap,Md=new WeakMap,Bd=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nd(e,t)}(a,e);var t,i,n,r=Rd(a);function a(){var e;md(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),Id.set(Pd(e),{writable:!0,value:void 0}),Md.set(Pd(e),{writable:!0,value:void 0}),wd(Pd(e),"started",void 0),wd(Pd(e),"bitrate",void 0),wd(Pd(e),"lastState",void 0),wd(Pd(e),"playerStateManager",void 0),wd(Pd(e),"playerListeners",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return"object"===kd(e.log)&&"function"==typeof e.setWantedBufferAhead&&"function"==typeof e.getWallClockTime}}],(i=[{key:"onPlayerStateChangeEvent",value:function(e){switch(e){case"PLAYING":this.started?(this.notifyResume(),this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(),this.setStatusCode(Jt.BPSessionEndsNormally),this.setPlayerErrorCode("")):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage());break;case"PAUSED":this.started&&("SEEKING"===this.lastState||"BUFFERING"===this.lastState?(this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd()):!1===Ld(this,Id).videoElement.seeking&&this.notifyPause());break;case"BUFFERING":case"SEEKING":this.started&&(this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition())}this.lastState=e}},{key:"onPauseEvent",value:function(){this.started&&!1===Ld(this,Id).videoElement.seeking&&this.notifyPause()}},{key:"onPlayEvent",value:function(){this.started&&this.notifyResume()}},{key:"onVideoBitrateChangeEvent",value:function(){var e=this.getBitrate();e!==this.bitrate&&(this.bitrate=e,this.notifyLayerSwitch(e))}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"onErrorEvent",value:function(e){switch(P.e("BpkRxPlayerAdapter","On player error: "+e.type+" ("+e.code+")"),e.type){case"NETWORK_ERROR":this.setStatusCode(Jt.BPNetworkingError);break;case"MEDIA_ERROR":switch(e.code){case"BUFFER_APPEND_ERROR":case"BUFFER_FULL_ERROR":case"BUFFER_TYPE_UNKNOWN":case"MANIFEST_INCOMPATIBLE_CODECS_ERROR":case"MANIFEST_PARSE_ERROR":case"MANIFEST_UNSUPPORTED_ADAPTATION_TYPE":case"MEDIA_ERR_ABORTED":case"MEDIA_ERR_NOT_LOADED_METADATA":case"MEDIA_ERR_DECODE":this.setStatusCode(Jt.BPDecodingError);break;case"MEDIA_ERR_BLOCKED_AUTOPLAY":case"MEDIA_ERR_PLAY_NOT_ALLOWED":case"MEDIA_SOURCE_NOT_SUPPORTED":case"MEDIA_STARTING_TIME_NOT_FOUND":case"MEDIA_TIME_BEFORE_MANIFEST":case"MEDIA_TIME_AFTER_MANIFEST":case"DISCONTINUITY_ENCOUNTERED":case"MANIFEST_UPDATE_ERROR":case"MEDIA_TIME_NOT_FOUND":this.setStatusCode(Jt.BPUnspecifiedError);break;case"MEDIA_ERR_NETWORK":this.setStatusCode(Jt.BPNetworkingError);break;case"MEDIA_ERR_SRC_NOT_SUPPORTED":case"MEDIA_ERR_UNKNOWN":this.setStatusCode(Jt.BPFormatNotSupportedError);break;case"MEDIA_KEYS_NOT_SUPPORTED":case"NO_PLAYABLE_REPRESENTATION":this.setStatusCode(Jt.BPAccessRightError);break;default:this.setStatusCode(Jt.BPUnspecifiedError)}break;case"ENCRYPTED_MEDIA_ERROR":this.setStatusCode(Jt.BPAccessRightError);break;case"OTHER_ERROR":"PIPELINE_PARSE_ERROR"===e.code?this.setStatusCode(Jt.BPDecodingError):this.setStatusCode(Jt.BPUnspecifiedError);break;default:this.setStatusCode(Jt.BPUnspecifiedError)}"string"==typeof e.code&&this.setPlayerErrorCode(e.code)}},{key:"getName",value:function(){return"RxPlayer"}},{key:"getVersion",value:function(){return void 0!==Ld(this,Id)?Ld(this,Id).version:"Unknown"}},{key:"getDeviceType",value:function(){var e=Ad(Td(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){return void 0!==Ld(this,Id)?Math.round((Ld(this,Id).getAudioBitrate()+Ld(this,Id).getVideoBitrate())/1e3):0}},{key:"getPosition",value:function(){return void 0!==Ld(this,Id)?Math.round(1e3*Ld(this,Id).getPosition()):0}},{key:"getDuration",value:function(){return void 0===Ld(this,Id)||Ld(this,Id).isLive()?0:Math.round(1e3*Ld(this,Id).getVideoDuration())}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.lastState="",this.bitrate=0,void 0!==Ld(this,Id)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new eu(this,this),this.playerListeners=[this.onPlayerStateChangeEvent.bind(this),this.onVideoBitrateChangeEvent.bind(this),this.onPauseEvent.bind(this),this.onPlayEvent.bind(this),this.onErrorEvent.bind(this)],Ld(this,Id).addEventListener("playerStateChange",this.playerListeners[0]),Ld(this,Id).addEventListener("videoBitrateChange",this.playerListeners[1]),Ld(this,Id).videoElement.addEventListener("pause",this.playerListeners[2]),Ld(this,Id).videoElement.addEventListener("play",this.playerListeners[3]),Ld(this,Id).addEventListener("error",this.playerListeners[4]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==Ld(this,Id)&&void 0!==this.playerListeners&&5===this.playerListeners.length&&(Ld(this,Id).removeEventListener("playerStateChange",this.playerListeners[0]),Ld(this,Id).removeEventListener("videoBitrateChange",this.playerListeners[1]),Ld(this,Id).videoElement.removeEventListener("pause",this.playerListeners[2]),Ld(this,Id).videoElement.removeEventListener("play",this.playerListeners[3]),Ld(this,Id).removeEventListener("error",this.playerListeners[4]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(Od(this,Id,e),Od(this,Md,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),Od(this,Id,void 0),Od(this,Md,void 0)}}])&&_d(t.prototype,i),n&&_d(t,n),a}(vn);function Ud(e){return(Ud="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jd(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fd(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Vd(e,t,i){return(Vd="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qd(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function xd(e,t){return(xd=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Gd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=qd(e);if(t){var r=qd(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Hd(this,i)}}function Hd(e,t){return!t||"object"!==Ud(t)&&"function"!=typeof t?Wd(e):t}function Wd(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qd(e){return(qd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yd(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}un.rxplayerModule={RxPlayerAdapter:Bd};var Kd="BpkHlsJsPlayerAdapter",Qd=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xd(e,t)}(a,e);var t,i,n,r=Gd(a);function a(){var e;jd(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return Yd(Wd(e=r.call.apply(r,[this].concat(i))),"player",void 0),Yd(Wd(e),"listener",void 0),Yd(Wd(e),"started",void 0),Yd(Wd(e),"paused",void 0),Yd(Wd(e),"waiting",void 0),Yd(Wd(e),"seeking",void 0),Yd(Wd(e),"playerStateManager",void 0),Yd(Wd(e),"playerListeners",void 0),Yd(Wd(e),"mediaEventsBound",void 0),Yd(Wd(e),"currentPresentationTime",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return"number"==typeof e.nextLoadLevel&&"function"==typeof e.swapAudioCodec}}],(i=[{key:"onPlayingEvent",value:function(){this.started?(this.paused&&this.notifyResume(),this.seeking&&(this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(),this.waiting=!1),this.waiting&&this.notifyStallEnd(),this.setStatusCode(Jt.BPSessionEndsNormally),this.setPlayerErrorCode("")):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage()),this.paused=!1,this.waiting=!1,this.seeking=!1}},{key:"onPlayEvent",value:function(){this.paused&&this.notifyResume(),this.paused=!1}},{key:"onPauseEvent",value:function(){null!=this.player&&null!=this.player.media&&(!this.player.media.seeking||this.player.media.seeking&&this.seeking)&&(this.notifyPause(),this.paused=!0)}},{key:"onWaitingEvent",value:function(){null!=this.player&&null!=this.player.media&&(this.player.media.seeking||this.waiting||this.seeking||(this.notifyStallStart(),this.waiting=!0))}},{key:"onSeekingEvent",value:function(){this.started&&!this.seeking&&(this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition(),this.seeking=!0)}},{key:"onProgressEvent",value:function(){this.paused&&(this.seeking&&(this.notifyStallEnd(!1),this.setStatusCode(Jt.BPSessionEndsNormally),this.setPlayerErrorCode(""),this.seeking=!1,this.waiting=!1),this.waiting&&(this.notifyStallEnd(!1),this.setStatusCode(Jt.BPSessionEndsNormally),this.setPlayerErrorCode(""),this.waiting=!1))}},{key:"onLayerSwitchEvent",value:function(){var e=this.getBitrate();e!==this.bitrate&&(this.bitrate=e,this.notifyLayerSwitch(e))}},{key:"onErrorEvent",value:function(){if(null!=this.player&&null!=this.player.media){var e=this.player.media.error;this.setStatusCode(this.getErrorCode(e)),this.setPlayerErrorCode(e.code),P.w(Kd,"Player error:"+e.message+" (code: "+e.code+")")}}},{key:"onHlsErrorEvent",value:function(e,t){!0===t.fatal&&(this.setStatusCode(this.getHlsErrorCode(t)),this.setPlayerErrorCode(t.details)),P.w(Kd,"HLS.js error:"+t.details+" (type: "+t.type+")")}},{key:"onLevelLoadedEvent",value:function(e,t){}},{key:"onFragmentChangedEvent",value:function(e,t){t&&t.frag&&t.frag.programDateTime&&(this.currentPresentationTime=Math.round(t.frag.programDateTime-1e3*t.frag.start))}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"getName",value:function(){return"HLS.js"}},{key:"getVersion",value:function(){return void 0!==this.player?this.player.constructor.version:""}},{key:"getDeviceType",value:function(){var e=Vd(qd(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){return void 0!==this.player&&this.player.currentLevel>=0&&this.player.currentLevel<this.player.levels.length?Math.round(this.player.levels[this.player.currentLevel].bitrate/1e3):-1}},{key:"getPosition",value:function(){return void 0!==this.player&&this.player.media?this.currentPresentationTime+Math.round(1e3*this.player.media.currentTime):0}},{key:"getDuration",value:function(){return void 0!==this.player&&this.player.media&&isFinite(this.player.media.duration)?Math.round(1e3*this.player.media.duration):0}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){switch(e.code){case 1:return Jt.BPUnspecifiedError;case 2:return Jt.BPNetworkingError;case 3:return Jt.BPDecodingError;case 4:return Jt.BPFormatNotSupportedError;default:return Jt.BPUnspecifiedError}}},{key:"getHlsErrorCode",value:function(e){switch(e.details){case"manifestLoadError":case"manifestLoadTimeOut":case"levelLoadError":case"fragLoadError":case"fragLoadTimeOut":case"bufferNudgeOnStall":return Jt.BPNetworkingError;case"manifestParsingError":case"fragDecryptError":case"fragParsingError":case"bufferAppendError":case"bufferStalledError":return Jt.BPDecodingError;case"manifestIncompatibleCodecsError":return Jt.BPFormatNotSupportedError;case"keyLoadError":case"keyLoadTimeOut":return Jt.BPAccessRightError;case"internalException":default:return Jt.BPUnspecifiedError}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.waiting=!1,this.seeking=!1,this.bitrate=-1,this.mediaEventsBound=!1,this.currentPresentationTime=0,void 0!==this.player&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new eu(this,this),this.playerListeners=[this.onMediaAttachedEvent.bind(this),this.onLevelLoadedEvent.bind(this),this.onFragmentChangedEvent.bind(this),this.onHlsErrorEvent.bind(this),this.onPlayingEvent.bind(this),this.onPlayEvent.bind(this),this.onPauseEvent.bind(this),this.onWaitingEvent.bind(this),this.onSeekingEvent.bind(this),this.onProgressEvent.bind(this),this.onErrorEvent.bind(this),this.onLayerSwitchEvent.bind(this)],this.player.on("hlsMediaAttached",this.playerListeners[0],this),this.player.on("hlsLevelLoaded",this.playerListeners[1],this),this.player.on("hlsFragChanged",this.playerListeners[2],this),this.player.on("hlsError",this.playerListeners[3],this),this.player.on("hlsLevelSwitched",this.playerListeners[11],this))}},{key:"onMediaAttachedEvent",value:function(){!1===this.mediaEventsBound&&void 0!==this.player&&this.player.media&&(this.player.media.addEventListener("playing",this.playerListeners[4]),this.player.media.addEventListener("play",this.playerListeners[5]),this.player.media.addEventListener("pause",this.playerListeners[6]),this.player.media.addEventListener("waiting",this.playerListeners[7]),this.player.media.addEventListener("seeking",this.playerListeners[8]),this.player.media.addEventListener("progress",this.playerListeners[9]),this.player.media.addEventListener("error",this.playerListeners[10]),this.mediaEventsBound=!0)}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==this.player&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(this.player.off("hlsMediaAttached",this.playerListeners[0],this),this.player.off("hlsLevelLoaded",this.playerListeners[1],this),this.player.off("hlsFragChanged",this.playerListeners[2],this),this.player.off("hlsError",this.playerListeners[3],this),this.player.off("hlsLevelSwitched",this.playerListeners[11],this)),void 0!==this.player&&this.player.media&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(this.mediaEventsBound=!1,this.player.media.removeEventListener("playing",this.playerListeners[4]),this.player.media.removeEventListener("play",this.playerListeners[5]),this.player.media.removeEventListener("pause",this.playerListeners[6]),this.player.media.removeEventListener("waiting",this.playerListeners[7]),this.player.media.removeEventListener("seeking",this.playerListeners[8]),this.player.media.removeEventListener("progress",this.playerListeners[9]),this.player.media.removeEventListener("error",this.playerListeners[10]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(this.player=e,this.listener=t,!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),this.player=void 0,this.listener=void 0}}])&&Fd(t.prototype,i),n&&Fd(t,n),a}(vn);function zd(e){return(zd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jd(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xd(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Zd(e,t,i){return(Zd="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nc(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function $d(e,t){return($d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ec(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=nc(e);if(t){var r=nc(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return tc(this,i)}}function tc(e,t){return!t||"object"!==zd(t)&&"function"!=typeof t?ic(e):t}function ic(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nc(e){return(nc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}un.hlsjsModule={HlsJsPlayerAdapter:Qd};var ac="BpkBitmovinPlayerAdapter",sc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$d(e,t)}(a,e);var t,i,n,r=ec(a);function a(){var e;Jd(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return rc(ic(e=r.call.apply(r,[this].concat(i))),"player",void 0),rc(ic(e),"listener",void 0),rc(ic(e),"started",void 0),rc(ic(e),"paused",void 0),rc(ic(e),"waiting",void 0),rc(ic(e),"seeking",void 0),rc(ic(e),"bitrate",void 0),rc(ic(e),"lastProgramDateTime",void 0),rc(ic(e),"lastPositionAtProgramDateTime",void 0),rc(ic(e),"lastDiscontinuitySequenceNumber",void 0),rc(ic(e),"playerStateManager",void 0),rc(ic(e),"playerListeners",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return"function"==typeof e.getSupportedTech&&"function"==typeof e.castStop&&"object"===zd(e.buffer)}}],(i=[{key:"onPlayEvent",value:function(){this.started&&this.notifyResume(),this.paused=!1}},{key:"onPlayingEvent",value:function(){this.started?(this.paused&&this.notifyResume(),this.waiting&&this.notifyStallEnd(),this.setStatusCode(Jt.BPSessionEndsNormally),this.setPlayerErrorCode("")):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage()),this.paused=!1}},{key:"onPausedEvent",value:function(e){-1===e.issuer.indexOf("seek")&&!1===this.paused?(this.notifyPause(),this.paused=!0):-1!==e.issuer.indexOf("seek")&&(this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition(),this.seeking=!0)}},{key:"onStallStartedEvent",value:function(){this.notifyStallStart(),this.waiting=!0}},{key:"onStallEndedEvent",value:function(){(!0!==this.waiting&&!0!==this.seeking||!this.player.isPaused()||!1!==this.paused)&&(this.notifyStallEnd(!this.paused),this.waiting=!1,this.setStatusCode(Jt.BPSessionEndsNormally),this.setPlayerErrorCode(""))}},{key:"onSeekEvent",value:function(){this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition(),this.seeking=!0}},{key:"onSeekedEvent",value:function(){this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(!this.paused),this.seeking=!1,this.setStatusCode(Jt.BPSessionEndsNormally),this.setPlayerErrorCode("")}},{key:"onSegmentRequestFinished",value:function(e){!0===e.success&&this.paused&&this.waiting&&(this.notifyStallEnd(!1),this.setStatusCode(Jt.BPSessionEndsNormally),this.setPlayerErrorCode(""),this.waiting=!1)}},{key:"onVideoPlaybackQualityChangedEvent",value:function(){var e=this.getBitrate();e!==this.bitrate&&(this.bitrate=e,this.notifyLayerSwitch(e))}},{key:"onSegmentPlaybackEvent",value:function(e){if(void 0!==e.dateTime){var t=Math.round(1e3*this.player.getCurrentTime());void 0!==e.discontinuitySequenceNumber&&this.lastDiscontinuitySequenceNumber!==e.discontinuitySequenceNumber&&(this.lastProgramDateTime=e.dateTime.getTime(),this.lastPositionAtProgramDateTime=t,this.lastDiscontinuitySequenceNumber=e.discontinuitySequenceNumber,P.d(ac,"Program date time updated")),console.log(e)}}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"onErrorEvent",value:function(e){P.e(ac,"On player error: "+e.name+" ("+e.code+")");var t=e.code;t>=1e3&&t<=1099||t>=1100&&t<=1199?this.setStatusCode(Jt.BPUnspecifiedError):t>=1200&&t<=1299?this.setStatusCode(Jt.BPFormatNotSupportedError):t>=1300&&t<=1399?this.setStatusCode(Jt.BPDecodingError):t>=1400&&t<=1499?this.setStatusCode(Jt.BPNetworkingError):t>=2e3&&t<=2099?this.setStatusCode(Jt.BPAccessRightError):this.setStatusCode(Jt.BPUnspecifiedError),this.setPlayerErrorCode(t)}},{key:"getName",value:function(){return"Bitmovin"}},{key:"getVersion",value:function(){return void 0!==this.player?this.player.version:"Unknown"}},{key:"getDeviceType",value:function(){var e=Zd(nc(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){if(void 0!==this.player){var e=this.player.getPlaybackAudioData().bitrate,t=this.player.getPlaybackVideoData().bitrate,i=0;return isNaN(e)||(i+=Math.round(e/1e3)),isNaN(t)||(i+=Math.round(t/1e3)),i}return 0}},{key:"getPosition",value:function(){if(void 0!==this.player){var e=Math.round(1e3*this.player.getCurrentTime());return 0!==this.lastProgramDateTime?this.lastProgramDateTime+(e-this.lastPositionAtProgramDateTime):e}return 0}},{key:"getDuration",value:function(){return void 0===this.player||this.player.isLive()?0:Math.round(1e3*this.player.getDuration())}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.waiting=!1,this.seeking=!1,this.bitrate=0,this.lastProgramDateTime=0,this.lastPositionAtProgramDateTime=0,this.lastDiscontinuitySequenceNumber=-1,void 0!==this.player&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new eu(this,this),this.playerListeners=[this.onPlayEvent.bind(this),this.onPlayingEvent.bind(this),this.onPausedEvent.bind(this),this.onStallStartedEvent.bind(this),this.onStallEndedEvent.bind(this),this.onVideoPlaybackQualityChangedEvent.bind(this),this.onSegmentPlaybackEvent.bind(this),this.onSegmentRequestFinished.bind(this),this.onSeekEvent.bind(this),this.onSeekedEvent.bind(this),this.onErrorEvent.bind(this)],this.player.on("play",this.playerListeners[0]),this.player.on("playing",this.playerListeners[1]),this.player.on("paused",this.playerListeners[2]),this.player.on("stallstarted",this.playerListeners[3]),this.player.on("stallended",this.playerListeners[4]),this.player.on("videoplaybackqualitychanged",this.playerListeners[5]),this.player.on("segmentplayback",this.playerListeners[6]),this.player.on("segmentrequestfinished",this.playerListeners[7]),this.player.on("seek",this.playerListeners[8]),this.player.on("seeked",this.playerListeners[9]),this.player.on("error",this.playerListeners[10]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==this.player&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(this.player.off("play",this.playerListeners[0]),this.player.off("playing",this.playerListeners[1]),this.player.off("paused",this.playerListeners[2]),this.player.off("stallstarted",this.playerListeners[3]),this.player.off("stallended",this.playerListeners[4]),this.player.off("videoplaybackqualitychanged",this.playerListeners[5]),this.player.off("segmentplayback",this.playerListeners[6]),this.player.off("segmentrequestfinished",this.playerListeners[7]),this.player.off("seek",this.playerListeners[8]),this.player.off("seeked",this.playerListeners[9]),this.player.off("error",this.playerListeners[10]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(this.player=e,this.listener=t,!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),this.player=void 0,this.listener=void 0}}])&&Xd(t.prototype,i),n&&Xd(t,n),a}(vn);un.bitmovinModule={BitmovinPlayerAdapter:sc},Jt.analyticsModule={PlayerManager:zn,PlayerAdapter:vn,GenericPlayerAdapter:Rn,PlayerEventListener:Ln,GenericPlayerApi:$n,AnalyticsRequestManager:or,SessionTrackerTimeline:qr,SessionTrackerEvent:Cr,SessionTrackerEvents:_r,Metrics:pr,MetricsManager:br},Jt.adModule={AdMetrics:ia,AdMetricsBuilder:na,AdMetricsManager:os,AdEvent:Ja,AdJSONEvent:Za,AdDashEvent:Xa,AdEventFactory:$a,AdSmartLibLegacyTracker:pa,AdTracker:Ta,AdThirdPartyTracker:wa,AdSmartLibTracker:Oa,AdBreakDataTracker:La,AdBreakBeginTracker:Ca,AdBreakEndTracker:Ia,AdDataTracker:Ma,AdProgressTracker:Ba,AdBeginProgressTracker:Ua,AdSkippableTracker:ja,AdTrackerFactory:Fa,AdTrackingManager:ns,AdManager:ne,AdViewState:ee,AdFriendlyObstructionPurpose:te,AdSession:oe,InternalAdManager:ce,OMSDKManager:ys,OMSessionHandler:_s},Jt.nanoCDNModule={NanoCDNRequestManager:Os,HostResolvingTask:Vs,MdnsManager:so,NanoCDNDescr:Bs,NanoCDNHostManager:vo,NanoCDNService:Gs},Jt.diversityModule={DiversityManager:Go,DiversityFailoverSession:go,DiversityFailoverCache:ko,DiversityRequestManager:Jo},un.modular=!1,un.getInstance().init(),Jt.analyticsModule=e,Jt.adModule=t,Jt.nanoCDNModule=i,Jt.diversityModule=n,un.shakaModule=c,un.dashjsModule=s,un.html5Module=u,un.avplayModule=r,un.diw387Module=d,un.hbbtv1Module=o,un.kalturaModule=l,un.connectplayerModule=a,un.rxplayerModule=h,un.hlsjsModule=f,un.bitmovinModule=v}(),__webpack_exports__}()}));