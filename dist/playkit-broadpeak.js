var KalturaPlayer="object"==typeof KalturaPlayer?KalturaPlayer:{};KalturaPlayer.plugins=KalturaPlayer.plugins||{},KalturaPlayer.plugins.broadpeak=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=83)}([function(e,t,i){(function(t){var i=function(e){return e&&e.Math==Math&&e};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,i(26))},function(module,exports,__webpack_require__){(function(global){var t;"undefined"!=typeof self&&self,t=function(){return function(){var __webpack_modules__={665:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";function nativeRequire(lib){return eval("require")(lib)}function nativeMainRequire(lib){return eval("require").main.require(lib)}__webpack_require__.d(__webpack_exports__,{A:function(){return nativeRequire},W:function(){return nativeMainRequire}})},831:function(e,t){!function(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&apos;":"'","&quot;":'"'};function i(e){return e&&e.replace(/^\s+|\s+$/g,"")}function n(e){return e.replace(/(&(?:lt|gt|amp|apos|quot|#(?:\d{1,6}|x[0-9a-fA-F]{1,5}));)/g,(function(e){if("#"===e[1]){var i="x"===e[2]?parseInt(e.substr(3),16):parseInt(e.substr(2),10);if(i>-1)return String.fromCharCode(i)}return t[e]||e}))}function r(e,t,i){if(void 0!==i){var n=e[t];n instanceof Array?n.push(i):e[t]=t in e?[n,i]:i}}e.fromXML=function(e,t){return function e(t,a){if("string"==typeof t)return t;var s=t.r;if(s)return s;var o,u=function(e,t){if(e.t){for(var a,s,o=e.t.split(/([^\s='"]+(?:\s*=\s*(?:'[\S\s]*?'|"[\S\s]*?"|[^\s'"]*))?)/),u=o.length,l=0;l<u;l++){var c=i(o[l]);if(c){a||(a={});var d=c.indexOf("=");if(d<0)c="@"+c,s=null;else{s=c.substr(d+1).replace(/^\s+/,""),c="@"+c.substr(0,d).replace(/\s+$/,"");var h=s[0];h!==s[s.length-1]||"'"!==h&&'"'!==h||(s=s.substr(1,s.length-2)),s=n(s)}t&&(s=t(c,s)),r(a,c,s)}}return a}}(t,a),l=t.f,c=l.length;if(u||c>1)o=u||{},l.forEach((function(t){"string"==typeof t?r(o,"#",t):r(o,t.n,e(t,a))}));else if(c){var d=l[0];if(o=e(d,a),d.n){var h={};h[d.n]=o,o=h}}else o=t.c?null:"";return a&&(o=a(t.n||"",o)),o}(function(e){for(var t=String.prototype.split.call(e,/<([^!<>?](?:'[\S\s]*?'|"[\S\s]*?"|[^'"<>])*|!(?:--[\S\s]*?--|\[[^\[\]'"<>]+\[[\S\s]*?]]|DOCTYPE[^\[<>]*?\[[\S\s]*?]|(?:ENTITY[^"<>]*?"[\S\s]*?")?[\S\s]*?)|\?[\S\s]*?\?)>/),r=t.length,a={f:[]},s=a,o=[],u=0;u<r;){var l=t[u++];l&&f(l);var c=t[u++];c&&d(c)}return a;function d(e){var t=e.length,i=e[0];if("/"===i)for(var n=e.replace(/^\/|[\s\/].*$/g,"").toLowerCase();o.length;){var r=s.n&&s.n.toLowerCase();if(s=o.pop(),r===n)break}else if("?"===i)h({n:"?",r:e.substr(1,t-2)});else if("!"===i)"[CDATA["===e.substr(1,7)&&"]]"===e.substr(-2)?f(e.substr(8,t-10)):h({n:"!",r:e.substr(1)});else{var a=function(e){var t={f:[]},i=(e=e.replace(/\s*\/?$/,"")).search(/[\s='"\/]/);return i<0?t.n=e:(t.n=e.substr(0,i),t.t=e.substr(i)),t}(e);h(a),"/"===e[t-1]?a.c=1:(o.push(s),s=a)}}function h(e){s.f.push(e)}function f(e){(e=i(e))&&h(n(e))}}(e),t)}}(t||{})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](i,i.exports,__webpack_require__),i.exports}__webpack_require__.d=function(e,t){for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return function(){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AdInteractionType:function(){return Bi},AdManager:function(){return ie},AnalyticsRequestManager:function(){return $n},GenericPlayerAdapter:function(){return Sn},GenericPlayerApi:function(){return Yn},LoggerManager:function(){return P},Metrics:function(){return or},MetricsManager:function(){return hr},PlayerAdapter:function(){return un},PlayerEventListener:function(){return Nn},PlayerManager:function(){return Gn},RequestManager:function(){return be},SessionTrackerEvent:function(){return Nr},SessionTrackerEvents:function(){return pr},SessionTrackerTimeline:function(){return Ur},SmartLib:function(){return Yt},StreamingSession:function(){return yt},StreamingSessionOptions:function(){return Ke},StreamingSessionResult:function(){return ht},adSmartLibModule:function(){return t},analyticsSmartLibModule:function(){return e},avplaySmartLibModule:function(){return r},bitmovinSmartLibModule:function(){return v},connectplayerSmartLibModule:function(){return a},dashjsSmartLibModule:function(){return s},diversitySmartLibModule:function(){return n},diw387SmartLibModule:function(){return c},hbbtv1SmartLibModule:function(){return o},hlsjsSmartLibModule:function(){return f},html5SmartLibModule:function(){return u},kalturaSmartLibModule:function(){return l},nanocdnSmartLibModule:function(){return i},rxplayerSmartLibModule:function(){return h},shakaSmartLibModule:function(){return d}});var e={};__webpack_require__.r(e),__webpack_require__.d(e,{AnalyticsRequestManager:function(){return $n},GenericPlayerAdapter:function(){return Sn},GenericPlayerApi:function(){return Yn},Metrics:function(){return or},MetricsManager:function(){return hr},PlayerAdapter:function(){return un},PlayerEventListener:function(){return Nn},PlayerManager:function(){return Gn},SessionTrackerEvent:function(){return Nr},SessionTrackerEvents:function(){return pr},SessionTrackerTimeline:function(){return Ur}});var t={};__webpack_require__.r(t),__webpack_require__.d(t,{AdBeginProgressTracker:function(){return Ra},AdBreakBeginTracker:function(){return ma},AdBreakDataTracker:function(){return ka},AdBreakEndTracker:function(){return _a},AdDashEvent:function(){return Fa},AdDataTracker:function(){return Aa},AdEvent:function(){return ja},AdEventFactory:function(){return Va},AdFriendlyObstructionPurpose:function(){return ee},AdJSONEvent:function(){return xa},AdManager:function(){return ie},AdMetrics:function(){return Kr},AdMetricsBuilder:function(){return Qr},AdMetricsManager:function(){return za},AdProgressTracker:function(){return Na},AdSession:function(){return se},AdSkippableTracker:function(){return Da},AdSmartLibLegacyTracker:function(){return aa},AdSmartLibTracker:function(){return ba},AdThirdPartyTracker:function(){return Sa},AdTracker:function(){return Ea},AdTrackerFactory:function(){return Pa},AdTrackingManager:function(){return qa},AdViewState:function(){return $},InternalAdManager:function(){return ce},OMSDKManager:function(){return ts},OMSessionHandler:function(){return os}});var i={};__webpack_require__.r(i),__webpack_require__.d(i,{HostResolvingTask:function(){return _s},MdnsManager:function(){return Hs},NanoCDNDescr:function(){return Ss},NanoCDNHostManager:function(){return zs},NanoCDNRequestManager:function(){return vs},NanoCDNService:function(){return Ns}});var n={};__webpack_require__.r(n),__webpack_require__.d(n,{DiversityFailoverCache:function(){return io},DiversityFailoverSession:function(){return Zs},DiversityManager:function(){return Ao},DiversityRequestManager:function(){return Oo}});var r={};__webpack_require__.r(r),__webpack_require__.d(r,{AVPlayAdapter:function(){return Jo}});var a={};__webpack_require__.r(a),__webpack_require__.d(a,{ConnectPlayerAdapter:function(){return fu}});var s={};__webpack_require__.r(s),__webpack_require__.d(s,{DashJsPlayerAdapter:function(){return Tu}});var o={};__webpack_require__.r(o),__webpack_require__.d(o,{HbbTV1PlayerAdapter:function(){return Wu}});var u={};__webpack_require__.r(u),__webpack_require__.d(u,{HTML5PlayerAdapter:function(){return al}});var l={};__webpack_require__.r(l),__webpack_require__.d(l,{KalturaPlayerAdapter:function(){return pl}});var c={};__webpack_require__.r(c),__webpack_require__.d(c,{SagemcomDIW387Adapter:function(){return wl}});var d={};__webpack_require__.r(d),__webpack_require__.d(d,{ShakaPlayerAdapter:function(){return Yl}});var h={};__webpack_require__.r(h),__webpack_require__.d(h,{RxPlayerAdapter:function(){return oc}});var f={};__webpack_require__.r(f),__webpack_require__.d(f,{HlsJsPlayerAdapter:function(){return Ec}});var v={};function p(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,g(e,t,"get"))}function y(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,g(e,t,"set"),i),i}function g(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function E(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k(e,t,i){return t&&b(e.prototype,t),i&&b(e,i),e}__webpack_require__.r(v),__webpack_require__.d(v,{BitmovinPlayerAdapter:function(){return Tc}});var m=function(){function e(){S(this,e)}return k(e,null,[{key:"log",value:function(e,t,i){}}]),e}(),_=function e(){S(this,e)};E(_,"VERBOSE",0),E(_,"DEBUG",1),E(_,"INFO",2),E(_,"WARN",3),E(_,"ERROR",4);var A=function e(){S(this,e)};E(A,"NONE",-1),E(A,"BASIC",0),E(A,"VERBOSE",1);var N=new WeakMap,R=new WeakMap,D=new WeakMap,P=function(){function e(){S(this,e),N.set(this,{writable:!0,value:m}),R.set(this,{writable:!0,value:void 0}),D.set(this,{writable:!0,value:void 0}),y(this,R,[]),y(this,D,A.VERBOSE)}return k(e,[{key:"init",value:function(e){y(this,N,e)}},{key:"release",value:function(){y(this,N,void 0)}},{key:"printLogs",value:function(e,t,i,n){p(this,R).length>100&&y(this,R,[]),void 0!==n&&(i="["+n+"] "+i),p(this,R).push(t+": "+i),p(this,N).log(e,t,i,n)}},{key:"printVerboseLogs",value:function(e,t,i){p(this,D)<A.VERBOSE||this.printLogs(_.VERBOSE,e,t,i)}},{key:"printDebugLogs",value:function(e,t,i){p(this,D)<A.VERBOSE||this.printLogs(_.DEBUG,e,t,i)}},{key:"printInfoLogs",value:function(e,t,i){p(this,D)<=A.NONE||this.printLogs(_.INFO,e,t,i)}},{key:"printWarnLogs",value:function(e,t,i){p(this,D)<=A.NONE||this.printLogs(_.WARN,e,t,i)}},{key:"printErrorLogs",value:function(e,t,i){p(this,D)<=A.NONE||this.printLogs(_.ERROR,e,t,i)}},{key:"getLogs",value:function(){return p(this,R).join("\n")}},{key:"resetLogs",value:function(){y(this,R,[])}},{key:"getLogLevel",value:function(e){return p(this,D)}},{key:"setLogLevel",value:function(e){y(this,D,e)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}},{key:"v",value:function(t,i,n){e.getInstance().printVerboseLogs(t,i,n)}},{key:"d",value:function(t,i,n){e.getInstance().printDebugLogs(t,i,n)}},{key:"i",value:function(t,i,n){e.getInstance().printInfoLogs(t,i,n)}},{key:"w",value:function(t,i,n){e.getInstance().printWarnLogs(t,i,n)}},{key:"e",value:function(t,i,n){e.getInstance().printErrorLogs(t,i,n)}}]),e}();function T(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function w(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}E(P,"instance",void 0);var O=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"parseURL",value:function(e){if(null===e||""===e)return null;var t=e.match("^(https?)\\:\\/\\/(([^:\\/?#]*)(?:\\:([0-9]+))?)([\\/]{0,1}[^?#]*)(\\?[^#]*|)(#.*|)$"),i=t&&{href:e,protocol:t[1],host:t[2],hostname:t[3],port:t[4],path:t[5],query:t[6],hash:t[7]};return null!==i&&null!==i.query&&i.query.length>0&&(i.query=i.query.substring(1)),i}},{key:"getParam",value:function(e,t){if("string"!=typeof e)return"";t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i&&i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):""}},{key:"addOrReplaceParam",value:function(e,t,i){var n=e.indexOf("?"+t+"=");if(n<0&&(n=e.indexOf("&"+t+"=")),n>=0){var r=e.substring(0,e.indexOf(t)),a=e.substring(e.indexOf(t));return r+t+"="+i+(a.indexOf("&")>=0?a.substring(a.indexOf("&")):"")}return(e.indexOf("?")<0?e+"?":e+"&")+t+"="+i}},{key:"extractHostnamePort",value:function(e){return null===e||""===e?"":(e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0]).split("?")[0]}}])&&T(t,i),e}();w(O,"REGEX_IP","^(?:[0-9]{1,3}\\.){3}[0-9]{1,3}(:[0-9]+)?$"),w(O,"REGEX_HOSTNAME","^([A-Za-z0-9\\_\\-\\.]+)(:[0-9]+)?$"),w(O,"REGEX_TICKET","^[0-5a-z]{30,50}$"),w(O,"REGEX_TICKET_TRANSCODED","^.*@[0-5a-z]{30,50}$");var L="03.03.04.3756";function C(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var I=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"randomIntFromInterval",value:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}},{key:"bufferToBase64Lookup",value:function(e){return e<26?String.fromCharCode(e+"A".charCodeAt(0)):e<52?String.fromCharCode(e-26+"a".charCodeAt(0)):e<62?String.fromCharCode(e-52+"0".charCodeAt(0)):62===e?"-":63===e?"_":""}},{key:"bufferToBase64",value:function(t){var i,n=t.data(),r=t.length(),a="";for(i=0;i<r;i+=3){var s=[void 0,void 0,void 0,void 0];s[0]=n[i]>>2,s[1]=(3&n[i])<<4,r>i+1&&(s[1]|=n[i+1]>>4,s[2]=(15&n[i+1])<<2),r>i+2&&(s[2]|=n[i+2]>>6,s[3]=63&n[i+2]);for(var o=0;o<s.length;o++)void 0===s[o]||(a+=e.bufferToBase64Lookup(s[o]))}return a}},{key:"stringToBase64Lookup",value:function(e){return e<26?String.fromCharCode(e+"A".charCodeAt(0)):e<52?String.fromCharCode(e-26+"a".charCodeAt(0)):e<62?String.fromCharCode(e-52+"0".charCodeAt(0)):62===e?"+":63===e?"/":""}},{key:"stringToBase64",value:function(t){var i;for(t=String(t),i=0;i<t.length;i++)if(t.charCodeAt(i)>255)return null;var n="";for(i=0;i<t.length;i+=3){var r=[void 0,void 0,void 0,void 0];r[0]=t.charCodeAt(i)>>2,r[1]=(3&t.charCodeAt(i))<<4,t.length>i+1&&(r[1]|=t.charCodeAt(i+1)>>4,r[2]=(15&t.charCodeAt(i+1))<<2),t.length>i+2&&(r[2]|=t.charCodeAt(i+2)>>6,r[3]=63&t.charCodeAt(i+2));for(var a=0;a<r.length;a++)void 0===r[a]?n+="=":n+=e.stringToBase64Lookup(r[a])}return n}},{key:"floor",value:function(e){return e>>>0}},{key:"bufferToString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,i="[0x",n=0;n<t;n++){var r=e[n];i+=("00"+Number(r).toString(16)).slice(-2),n<t-1&&(i+=",0x")}return i+"] (capacity:"+e.length+")"}}])&&C(t,i),e}();function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function U(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function j(e,t,i){return x(e,t),F(i,"get"),function(e,t){return t.get?t.get.call(e):t.value}(e,i)}function F(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function x(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}var V="BpkJobMgr",G=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),U(this,"worker",void 0),U(this,"jobs",void 0),this.jobs={}}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){return j(e,e,H)||function(e,t,i,n){x(e,t),F(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n)}(e,e,H,new e),j(e,e,H)}}],(i=[{key:"async",value:function(e,t,i,n){return this.start(e,0,-1,t,i,n)}},{key:"asyncGet",value:function(e,t,i,n){return this.start("get",0,-1,(function(){be.getInstance().requestHandler.get(e,t,i,n)}),(function(){return{url:e,headers:t,timeout:i}}),n)}},{key:"asyncPost",value:function(e,t,i,n,r){return this.start("post",0,-1,(function(){be.getInstance().requestHandler.post(e,t,i,n,r)}),(function(){return{url:e,headers:t,body:i,timeout:n}}),r)}},{key:"asyncDelay",value:function(e,t){var i,n=this.start("delay",e,-1,(function(t){i=setTimeout(t,e)}),void 0,t);return n.task=i,n}},{key:"asyncNonce",value:function(e,t,i){var n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;void 0===r&&(r=function(){P.d(V,"ios async nonce"),n=setTimeout(i,e)});var a=this.start("waitNonce",0,e,r,void 0,t,i,!0);return a.task=n,a}},{key:"waitNonce",value:function(e,t,i){var n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;void 0===r&&(r=function(){P.d(V,"ios wait nonce"),n=setTimeout(i,e)});var a=this.start("waitNonce",0,e,r,void 0,t,i,!1);return a.task=n,a}},{key:"start",value:function(e,t,i,n,r,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:function(){},o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(void 0===this.worker&&("function"==typeof CoreWorker?this.worker=new CoreWorker:"object"===("undefined"==typeof CoreWorker?"undefined":M(CoreWorker))&&(this.worker=CoreWorker)),void 0!==this.worker){var u=this.createJob();return u.active=!0,u.command=e,u.startDelay=t,u.timeoutDelay=i,u.requestInfo=r,u.result=a,u.timeout=s,u.async=o,P.v(V,'Starting job "'+e+'"...'),o?this.worker.async(u.id,u.command,u.startDelay,u.timeoutDelay):this.worker.sync(u.id,u.command,u.startDelay,u.timeoutDelay),u}return n(a),{command:e}}},{key:"interrupt",value:function(e){void 0!==e&&void 0!==this.worker&&(P.v(V,'Interrupting job "'+e.command+'"...'),this.worker.interrupt(e.id))}},{key:"cancel",value:function(e){void 0!==e&&(void 0!==this.worker&&(P.v(V,'Cancelling job "'+e.command+'"...'),e.active=!1,this.worker.cancel(e.id),delete this.jobs[e.id]),void 0!==e.task&&clearTimeout(e.task))}},{key:"requestInfo",value:function(e){var t=this.jobs[e];return void 0!==t&&"function"==typeof t.requestInfo?t.requestInfo():{}}},{key:"result",value:function(e,t){var i=this.jobs[e];void 0!==i&&"function"==typeof i.result&&!0===i.active&&(i.active=!1,i.result(t)),delete this.jobs[e]}},{key:"timeout",value:function(e){var t=this.jobs[e];void 0!==t&&"function"==typeof t.timeout&&!0===t.active&&(P.v(V,'Job "'+t.command+'" timeout...'),t.active=!1,t.timeout()),delete this.jobs[e]}},{key:"createJob",value:function(){for(var e=I.randomIntFromInterval(1e6,9999999);void 0!==this.jobs[e];)e=I.randomIntFromInterval(1e6,9999999);return this.jobs[e]={id:e},this.jobs[e]}}])&&B(t.prototype,i),n&&B(t,n),e}(),H={writable:!0,value:void 0};function W(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function q(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Y="BpkAdPalSessionRequest",K=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),q(this,"active",void 0),q(this,"timeout",void 0),q(this,"adPalManager",void 0),q(this,"adPalSession",void 0),q(this,"generatingAdPalSession",void 0),q(this,"waitNonceResolveCallback",void 0),this.active=!0,this.timeout=!1,this.adPalManager=t,this.generatingAdPalSession=!1}var t,i;return t=e,(i=[{key:"setAdPalSession",value:function(e){this.adPalSession=e,this.active=!1}},{key:"generateAdPalSession",value:function(){var t=this,i=function(){P.d(Y,"Nonce generation timeout"),t.timeout=!0,void 0!==t.waitNonceResolveCallback&&(t.setAdPalSession(void 0),t.waitNonceResolveCallback(void 0))};G.getInstance().asyncNonce(e.TIMEOUT_DELAY,(function(e){var i=e.adPalSession;P.d(Y,"AdPalSession async nonce="+(null==i?void 0:i.getNonce())),t.setAdPalSession(i)}),i,(function(){t.generatingAdPalSession=!0;var n=setTimeout(i,e.TIMEOUT_DELAY);t.adPalManager.generateAdPalSession((function(e){clearTimeout(n),P.d(Y,"AdPalSession nonce="+(null==e?void 0:e.getNonce())),t.setAdPalSession(e),void 0!==t.waitNonceResolveCallback&&!1===t.timeout?t.waitNonceResolveCallback(e):void 0!==t.waitNonceResolveCallback&&!0===t.timeout&&t.waitNonceResolveCallback(void 0)}))}))}},{key:"getAdPalSession",value:function(){var t=this;return void 0===this.adPalSession&&!0===this.active?new Promise((function(i,n){G.getInstance().waitNonce(e.TIMEOUT_DELAY,(function(e){var n=e.adPalSession;P.d(Y,"AdPalSession nonce="+(null==n?void 0:n.getNonce())),t.setAdPalSession(n),i(t.adPalSession)}),(function(){t.active=!1,t.timeout=!0,t.waitNonceResolveCallback=void 0,i(t.adPalSession)}),(function(){!0===t.generatingAdPalSession?t.waitNonceResolveCallback=i:(t.waitNonceResolveCallback=i,t.generateAdPalSession())}))})):new Promise((function(e,i){e(t.adPalSession)}))}}])&&W(t.prototype,i),e}();function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function X(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Z(e,t,i){return t&&X(e.prototype,t),i&&X(e,i),e}q(K,"TIMEOUT_DELAY",5e3);var $=function(){function e(){J(this,e)}return Z(e,null,[{key:"isAdViewState",value:function(t){switch(t){case e.MINIMIZED:case e.COLLAPSED:case e.NORMAL:case e.EXPANDED:case e.FULLSCREEN:return!0}return!1}}]),e}();z($,"MINIMIZED","minimized"),z($,"COLLAPSED","collapsed"),z($,"NORMAL","normal"),z($,"EXPANDED","expanded"),z($,"FULLSCREEN","fullscreen");var ee=function(){function e(){J(this,e)}return Z(e,null,[{key:"isAdFriendlyObstructionPurpose",value:function(e){return e>=0&&e<=3}}]),e}();z(ee,"VIDEO_CONTROLS",0),z(ee,"CLOSE_AD",1),z(ee,"NOT_VISIBLE",2),z(ee,"OTHER",3);var te="BpkAdMgr",ie=function(){function e(){J(this,e),z(this,"smartLib",void 0),z(this,"palSDK",void 0),"undefined"==typeof goog||Q(goog)}return Z(e,[{key:"init",value:function(e){this.smartLib=e}},{key:"release",value:function(){}},{key:"attachPALSDK",value:function(e){"object"===Q(e.pal)?(P.d(te,"PAL SDK attached"),this.palSDK=e):P.e(te,"Try to attach PAL SDK, but it is not recognized")}},{key:"setConsentSettings",value:function(e){this.smartLib.internalAdManager.setConsentSettings(e)}},{key:"setPalParameters",value:function(e,t,i,n,r,a,s,o,u,l,c){this.smartLib.internalAdManager.setPalParameters(e,t,i,n,r,a,s,o,u,l,c)}},{key:"setPartner",value:function(e,t){this.smartLib.internalAdManager.setPartner(e,t)}},{key:"activateAdvertising",value:function(){this.smartLib.internalAdManager.adSession.activateAdvertising()}},{key:"setAdParameter",value:function(e,t){this.smartLib.internalAdManager.adSession.setAdParameter(e,t)}},{key:"setEventCallbackEnabled",value:function(e){this.smartLib.internalAdManager.eventCallbackEnabled=e,this.smartLib.internalAdManager.adSession.setEventCallbackEnabled(e)}},{key:"setAdEventsListener",value:function(e){this.smartLib.internalAdManager.adEventsListener=e,this.smartLib.internalAdManager.adSession.setAdEventsListener(e)}}],[{key:"getInstance",value:function(){return Yt.getInstance().adManager}}]),e}();function ne(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function re(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ae="BpkAdSession",se=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),re(this,"session",void 0),re(this,"adEventsListener",void 0),re(this,"adActivated",void 0),re(this,"adParameters",void 0),re(this,"eventCallbackEnabled",void 0),re(this,"adView",void 0),re(this,"adViewState",void 0),re(this,"adFriendlyObstructionViews",void 0),re(this,"adCustomReference",void 0),re(this,"adVerificationData",void 0),re(this,"adPalSession",void 0),this.adEventsListener=void 0,this.adActivated=!1,this.adParameters={},this.eventCallbackEnabled=!0,this.adView=void 0,this.adViewState=$.NORMAL,this.adFriendlyObstructionViews=[],this.adCustomReference="",this.adVerificationData=[]}var t,i;return t=e,(i=[{key:"setAdEventsListener",value:function(e){this.adEventsListener=e}},{key:"activateAdvertising",value:function(){var e;!0!==this.adActivated&&(this.adActivated=!0,P.d(ae,"Ad session activated",null===(e=this.session)||void 0===e?void 0:e.id))}},{key:"setAdParameter",value:function(e,t){var i;this.activateAdvertising(),this.adParameters[e]=t,P.d(ae,"Adding parameter "+e+"="+t,null===(i=this.session)||void 0===i?void 0:i.id)}},{key:"setEventCallbackEnabled",value:function(e){this.eventCallbackEnabled=e}},{key:"isAdActivated",value:function(){return!0===this.adActivated}},{key:"resetAdParameters",value:function(){this.adParameters={}}},{key:"hasAdParameters",value:function(){return Object.keys(this.adParameters).length>0}},{key:"onDashEvent",value:function(e){var t;if(this.isAdActivated())if(this.eventCallbackEnabled)if(!1===(null===(t=this.session.adTrackingManager)||void 0===t?void 0:t.bkYouSession)){var i=e;-1!==i.indexOf("<![CDATA[")&&-1!==i.indexOf("]]>")&&(i=i.trim().replace(/^(\/\/\s*)?<!\[CDATA\[|(\/\/\s*)?\]\]>$/g,"")),i=i.replace(/&&;/g,"&").trim(),void 0!==Yt.adModule?Yt.adModule.AdEventFactory.parseDashEvent(this.session,i).tracker.process():P.d(ae,"Event received but ad module not loaded",this.session.id)}else P.d(ae,"Event received but legacy mode not enabled",this.session.id);else P.d(ae,"Event received but callbacks are disabled",this.session.id);else P.d(ae,"Event received but ad not enabled (advertising not activated)",this.session.id)}}])&&ne(t.prototype,i),e}();function oe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ue(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var le="BpkAdMgr",ce=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ue(this,"smartLib",void 0),ue(this,"initialized",void 0),ue(this,"adPalManager",void 0),ue(this,"omPartnerName",void 0),ue(this,"omPartnerVersion",void 0),ue(this,"firstAdPalSessionRequest",void 0),ue(this,"palSessionEnabled",!1),ue(this,"adSession",void 0),ue(this,"eventCallbackEnabled",void 0),ue(this,"adEventsListener",void 0),this.initialized=!1,this.palSessionEnabled=!1,this.adSession=new se,this.eventCallbackEnabled=!0,this.adEventsListener=void 0}var t,i;return t=e,(i=[{key:"init",value:function(e){this.smartLib=e,this.initialized||(this.initialized=!0,this.adSession=new se,this.eventCallbackEnabled=!0,this.adEventsListener=void 0,P.d(le,"Ad manager loaded"))}},{key:"setPalManager",value:function(e){P.d(le,"Native PAL manager registered"),this.adPalManager=e}},{key:"requestAdPalSession",value:function(){var e=this.firstAdPalSessionRequest;return void 0!==e&&void 0===e.adPalSession&&!0===e.active&&!1===e.timeout?(P.d(le,"Using first nonce request..."),this.firstAdPalSessionRequest=void 0,e):(this.firstAdPalSessionRequest=void 0,e=new K(this.adPalManager),this.initialized&&this.palSessionEnabled?(P.d(le,"Generating nonce..."),e.generateAdPalSession(),void 0===this.adPalManager&&e.setAdPalSession(void 0)):e.setAdPalSession(void 0),e)}},{key:"release",value:function(){this.initialized=!1,this.palSessionEnabled=!1,this.adSession=new se,this.eventCallbackEnabled=!0,this.adEventsListener=void 0,void 0!==this.firstAdPalSessionRequest&&(this.firstAdPalSessionRequest.setAdPalSession(void 0),this.firstAdPalSessionRequest=void 0),void 0!==this.adPalManager&&this.adPalManager.reset()}},{key:"setConsentSettings",value:function(e){var t;null===(t=this.adPalManager)||void 0===t||t.setConsentSettings(e)}},{key:"setPalParameters",value:function(e,t,i,n,r,a,s,o,u,l,c){void 0!==this.adPalManager&&(void 0!==e&&this.adPalManager.setDescriptionURL(e),void 0!==t&&void 0!==i&&this.adPalManager.setOmidPartner(t,i),void 0!==n&&this.adPalManager.setOmidVersion(n),void 0!==r&&this.adPalManager.setPlayerType(r),void 0!==a&&this.adPalManager.setPlayerVersion(a),void 0!==s&&this.adPalManager.setPpid(s),0!==o&&this.adPalManager.setVideoPlayerHeight(o),0!==u&&this.adPalManager.setVideoPlayerWidth(u),this.adPalManager.setWillAdAutoPlay(l),this.adPalManager.setWillAdPlayMuted(c),this.palSessionEnabled||(this.palSessionEnabled=!0,P.d(le,"Generating first nonce..."),this.firstAdPalSessionRequest=new K(this.adPalManager),this.firstAdPalSessionRequest.generateAdPalSession()))}},{key:"setPartner",value:function(e,t){this.omPartnerName=e,this.omPartnerVersion=t}}])&&oe(t.prototype,i),e}();function de(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function he(e,t,i){return ve(e,t),fe(i,"get"),function(e,t){return t.get?t.get.call(e):t.value}(e,i)}function fe(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function ve(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function pe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ye(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ge(e,t,i){return t&&ye(e.prototype,t),i&&ye(e,i),e}ue(ce,"AD_NONCE_QUERY_PARAMETER","paln");var Ee="BpkRequestMgr",Se=function(){function e(){pe(this,e)}return ge(e,null,[{key:"get",value:function(e,t,i,n){n({body:void 0,headers:void 0,statusCode:-1})}},{key:"post",value:function(e,t,i,n,r){r({body:void 0,headers:void 0,statusCode:-1})}}]),e}(),be=function(){function e(){pe(this,e),de(this,"requestHandler",Se),de(this,"smartLib",void 0)}return ge(e,[{key:"init",value:function(e){this.requestHandler=e}},{key:"attachInstance",value:function(e){this.smartLib=e}},{key:"release",value:function(){}},{key:"getURL",value:function(t,i,n){var r,a,s=this,o=n.options,u=void 0!==i.nanoCDNDescr&&!0===o.get(Ke.REQUEST_NANO_CDN),l=e.isBroadpeakDomainName(t,i.broadpeakDomainNames)&&!0===o.get(Ke.REQUEST_BROADPEAK_CDN),c=!0===o.get(Ke.MULTICAST_ONLY)||!0===o.get(Ke.LEGACY_MULTICAST_ONLY);if(u?"*"===i.broadpeakDomainNames?P.i(Ee,"Workflow 5.2 (v"+L+")",n.id):""===i.broadpeakDomainNames?P.i(Ee,"Workflow 5.4 (v"+L+")",n.id):l?P.i(Ee,"Workflow 5.6 => 5.2 (v"+L+")",n.id):P.i(Ee,"Workflow 5.6 => 5.4 (v"+L+")",n.id):"*"===i.broadpeakDomainNames?P.i(Ee,"Workflow 5.1 (v"+L+")",n.id):""===i.broadpeakDomainNames?P.i(Ee,"Workflow 5.3 (v"+L+")",n.id):l?P.i(Ee,"Workflow 5.5 => 5.1 (v"+L+")",n.id):P.i(Ee,"Workflow 5.5 => 5.3 (v"+L+")",n.id),P.i(Ee,"   Parameters",n.id),P.i(Ee,"      analyticsAddress="+i.analyticsAddress,n.id),P.i(Ee,"      nanoCDNHost="+(void 0===i.nanoCDNDescr?"":i.nanoCDNDescr.hostIP),n.id),P.i(Ee,"      broadpeakDomainNames="+i.broadpeakDomainNames,n.id),o.print(Ee,"   ",n.id),u)return null===(r=Yt.nanoCDNModule)||void 0===r?void 0:r.NanoCDNRequestManager.getInstance().processNanoCDNSession(t,i,n,l,c);if(!0===c)return Promise.resolve(ht.error(ht.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN));if(void 0===n.adSession||!n.adSession.isAdActivated())return this.requestBkM(t,i,void 0,n);var d=this.smartLib.internalAdManager.requestAdPalSession();return this.requestBkM(t,i,void 0,n).then((function(e){return a=e,d.getAdPalSession()})).then((function(e){if(!a.isError()){if(void 0!==n.adSession&&n.adSession.isAdActivated()){var t=n.adSession.adParameters;for(var r in t)a.url=O.addOrReplaceParam(a.url,r,t[r]);void 0!==e&&(n.adSession.adPalSession=e,e.setAdView(n.adSession.adView))}return s.requestBkYou(a,i,n,e)}return a}))}},{key:"requestBkM",value:function(t,i,n,r){var a=this,s=r.options;if(e.isBroadpeakDomainName(t,i.broadpeakDomainNames)&&!0===s.get(Ke.REQUEST_BROADPEAK_CDN)||!0===s.get(Ke.REQUEST_REDIRECT_THIRD_PARTY_CDN)){var o=O.addOrReplaceParam(t,"response","200");return o=O.addOrReplaceParam(o,"bk-ml","1"),"string"==typeof n&&0!==n.length?o=O.addOrReplaceParam(o,"nanocdnhost",n):!0===s.get(Ke.REQUEST_DIVERSITY_DYNAMIC_FAILOVER)?o=O.addOrReplaceParam(o,"diversityfailover","1"):!0===s.get(Ke.REQUEST_DIVERSITY)&&(o=O.addOrReplaceParam(o,"diversityhost","127.0.0.1:18080")),e.isBroadpeakDomainName(t,i.broadpeakDomainNames)?P.d(Ee,"Sending request to the BkM/umbrella: "+o,r.id):P.d(Ee,"Sending request to third party CDN: "+o,r.id),this.getRedirectionLocation(o,e.CDN_REQUEST_TIMEOUT,i,r).then((function(n){return e.isBroadpeakDomainName(t,i.broadpeakDomainNames)?P.d(Ee,"BkM/umbrella responded with status code "+n.httpStatus,r.id):P.d(Ee,"Third party CDN responded with status code "+n.httpStatus,r.id),r.sessionReport.cdnStatusCode=n.httpStatus,n.httpStatus>=200&&n.httpStatus<400&&""!==n.redirectedURL?ht.success(n.redirectedURL):n.httpStatus<=0?ht.error(ht.RESULT_CDN_RESPONSE_UNREADABLE):n.httpStatus>=400&&n.httpStatus<500?ht.error(ht.RESULT_REQUESTED_URL_NOT_FOUND_ON_CDN,a.getBkMDetailedErrorMessage(n,r)):n.httpStatus>=500&&n.httpStatus<600?ht.error(ht.RESULT_REQUESTED_URL_CDN_ERROR,a.getBkMDetailedErrorMessage(n,r)):ht.error(ht.RESULT_NO_STREAMING_URL_FOUND,a.getBkMDetailedErrorMessage(n,r))})).then((function(e){return e.isError()&&(r.sessionReport.cdnStatusCode=e.getDetailedErrorCode()),e}))}return Promise.resolve(ht.success(t))}},{key:"getBkMDetailedErrorMessage",value:function(t,i){if(!0===t.headers.hasOwnProperty(e.HEADER_CDN_DETAILED_ERROR_CODE)){var n=t.headers[e.HEADER_CDN_DETAILED_ERROR_CODE];return P.d(Ee,"Reading detailed error code from header: "+n,i.id),n}return P.d(Ee,"Reading detailed error code from http status: "+t.httpStatus+" "+t.httpMessage,i.id),String(t.httpStatus+" "+t.httpMessage)}},{key:"requestBkYou",value:function(e,t,i,n){var r,a=O.addOrReplaceParam(e.getURL(),"bk-ml","1"),s=a;return void 0!==n&&(r=n.getNonce(),s=O.addOrReplaceParam(s,ce.AD_NONCE_QUERY_PARAMETER,r)),this.adTracking(i,t,s,!1).then((function(t){if(!(t.httpStatus>=200&&t.httpStatus<300))return P.d(Ee,"BkYou response unreadable (status code), falling back to legacy mode",i.id),void 0!==r&&(e.url=O.addOrReplaceParam(e.url,ce.AD_NONCE_QUERY_PARAMETER,r)),e;var s,o;try{o=JSON.parse(t.content)}catch(t){return P.d(Ee,"BkYou file unreadable (parsing), falling back to legacy mode",i.id),void 0!==r&&(e.url=O.addOrReplaceParam(e.url,ce.AD_NONCE_QUERY_PARAMETER,r)),e}var u=o.sessiontoken;if(void 0===u)return e;P.d(Ee,"BkYou session token: "+u,i.id);var l=o.playbackqueries;return Array.isArray(l)&&l.forEach((function(t){if(-1!==t.indexOf("=")){var i=t.split("=");e.url=O.addOrReplaceParam(e.url,i[0],i[1]),a=O.addOrReplaceParam(a,i[0],i[1])}})),null===(s=i.adTrackingManager)||void 0===s||s.initBkYouSession(a,u,o,n,r),e}))}},{key:"getRedirectionLocation",value:function(e,t,i,n){return new Promise((function(r,a){var s={Connection:"close"};void 0!==i.userAgent&&(s["User-Agent"]=i.userAgent);var o=G.getInstance().asyncGet(e,s,t,(function(e){var t=0,i="";void 0!==e.statusCode&&(t=parseInt(e.statusCode,10)),void 0!==e.headers&&void 0!==e.headers.location?i=e.headers.location:t>=200&&t<400&&P.e(Ee,'Location header cannot be read, please ensure "Access-Control-Expose-Headers: Location" is configured.',n.id),r({httpStatus:t,httpMessage:e.message,headers:e.headers,redirectedURL:i})}));n.jobs.push(o)}))}},{key:"keepalive",value:function(t,i){var n=t.sessionReport,r=n.redirectedURL,a=r.indexOf("?");a>0&&(r=r.substring(0,a)),r.endsWith("/")||(r+="/"),r+=e.KEEPALIVE_PATH;var s=t.options.get(Ke.SESSION_REPORTING_MODE);return s===Ke.SESSION_REPORTING_MODE_DEFAULT||s===Ke.SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN?(r+="?",void 0!==n.timeline&&(r+=e.TEARDOWN_TIMELINE_QUERY+n.timeline.data().base64()+"&"),r+=e.TEARDOWN_METRICS_QUERY+n.toQuery(),P.i(Ee,"Sending keepalive with metrics to "+r,t.id)):P.i(Ee,"Sending keepalive without metrics to "+r,t.id),new Promise((function(n,a){var s={Connection:"close"};void 0!==i.userAgent&&(s["User-Agent"]=i.userAgent),G.getInstance().asyncGet(r,s,e.BKS_REQUEST_TIMEOUT,(function(e){P.i(Ee,"Send keepalive ends with status code: "+e.statusCode,t.id),n(e.statusCode)}))}))}},{key:"teardown",value:function(t,i){var n=t.sessionReport,r=n.redirectedURL,a=r.indexOf("?");a>0&&(r=r.substring(0,a)),r.endsWith("/")||(r+="/"),r+=e.TEARDOWN_PATH,r+=n.statusCode;var s=t.options.get(Ke.SESSION_REPORTING_MODE);return s===Ke.SESSION_REPORTING_MODE_DEFAULT||s===Ke.SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN?(r+="?",void 0!==n.timeline&&(r+=e.TEARDOWN_TIMELINE_QUERY+n.timeline.data().base64()+"&"),r+=e.TEARDOWN_METRICS_QUERY+n.toQuery(),P.i(Ee,"Sending teardown with metrics to "+r,t.id)):P.i(Ee,"Sending teardown without metrics to "+r,t.id),new Promise((function(n,a){var s={Connection:"close"};void 0!==i.userAgent&&(s["User-Agent"]=i.userAgent),G.getInstance().asyncGet(r,s,e.BKS_REQUEST_TIMEOUT,(function(e){P.i(Ee,"Send teardown ends with status code: "+e.statusCode,t.id)}))}))}},{key:"adEvent",value:function(e,t){var i=this.smartLib.getParameters(),n={Connection:"close"};void 0!==i.userAgent&&(n["User-Agent"]=i.userAgent);var r=e.options.get(Ke.USERAGENT_AD_EVENT);void 0!==r&&(n["User-Agent"]=r),G.getInstance().asyncGet(t,n,2e4,(function(e){P.i(Ee,"Ad event request ends with status code: "+e.statusCode)}))}},{key:"adTracking",value:function(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return P.d(Ee,"Sending request to the BkYou: "+n,t.id),new Promise((function(a,s){var o={Connection:"close"};if(void 0!==i.userAgent&&(o["User-Agent"]=i.userAgent),!1===r){var u=G.getInstance().asyncGet(n,o,e.BKS_REQUEST_TIMEOUT,(function(e){P.d(Ee,"BkYou responded with status code "+e.statusCode,t.id),a({httpStatus:e.statusCode,content:e.body})}));t.jobs.push(u)}else G.getInstance().asyncGet(n,o,e.BKS_REQUEST_TIMEOUT,(function(e){P.d(Ee,"BkYou responded with status code "+e.statusCode,t.id),a({httpStatus:e.statusCode,content:e.body})}))}))}}],[{key:"getInstance",value:function(){return he(e,e,ke)||function(e,t,i,n){ve(e,t),fe(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n)}(e,e,ke,new e),he(e,e,ke)}},{key:"isBroadpeakDomainName",value:function(e,t){if(null===t||""===t)return!1;if("*"===t)return!0;var i=O.parseURL(e);return null!==i&&null!==i.hostname&&t.split(",").indexOf(i.hostname)>=0}}]),e}();de(be,"TEARDOWN_PATH","teardown/"),de(be,"TEARDOWN_METRICS_QUERY","metrics="),de(be,"TEARDOWN_TIMELINE_QUERY","metricsTL="),de(be,"KEEPALIVE_PATH","keepalive"),de(be,"QUERY_PARAMETER_SESSION_ID","bk-session_id"),de(be,"QUERY_PARAMETER_SESSION_CREATED","bk-session"),de(be,"HEADER_CDN_DETAILED_ERROR_CODE","x-bpk-error"),de(be,"CDN_REQUEST_TIMEOUT",2e4),de(be,"BKS_REQUEST_TIMEOUT",5e3),de(be,"KEEPALIVE_REQUEST_INTERVAL",5e3);var ke={writable:!0,value:void 0};function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ae="BpkValidator",Ne=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"typeParameter",value:function(e,t,i){return me(e)===t||(P.e(Ae,i),!1)}},{key:"typeOrUndefinedParameter",value:function(e,t,i){return me(e)===t||void 0===e||(P.e(Ae,i),!1)}},{key:"typeOrNullParameter",value:function(e,t,i){return me(e)===t||null===e||(P.e(Ae,i),!1)}},{key:"stringNonEmpty",value:function(e,t){return"string"==typeof e&&e.length>0||(P.e(Ae,t),!1)}},{key:"toBkAString",value:function(e){return void 0!==e&&"string"==typeof e?e.replace(/\n/g,"").replace(/\t/g,"").replace(/\r/g,""):e}}])&&_e(t,i),e}();function Re(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function De(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),De(this,"requestedURL",void 0),De(this,"redirectedURL",void 0),De(this,"sessionRunning",void 0),De(this,"sessionCreated",void 0),De(this,"sessionId",void 0),De(this,"teardownActivated",void 0),De(this,"smartLibParameters",void 0),De(this,"customParameters",void 0),De(this,"playerName",void 0),De(this,"playerVersion",void 0),De(this,"osName",void 0),De(this,"osVersion",void 0),De(this,"deviceType",void 0),De(this,"smartLibVersion",void 0),De(this,"networkTypeList",void 0),De(this,"nanoCDNStatus",void 0),De(this,"statusCode",void 0),De(this,"cdnStatusCode",void 0),De(this,"nanoCDNStatusCode",void 0),De(this,"playerErrorCode",void 0),De(this,"metrics",void 0),De(this,"adMetrics",void 0),De(this,"timeline",void 0),De(this,"diversity",void 0),De(this,"endSessionDate",void 0),De(this,"startSessionRequestDate",void 0),De(this,"keepaliveRequestDate",void 0),De(this,"teardownRequestDate",void 0),De(this,"endSessionRequestDate",void 0),this.requestedURL="",this.redirectedURL="",this.sessionRunning=!1,this.sessionCreated=!1,this.sessionId="",this.teardownActivated=!1,this.smartLibParameters={},this.customParameters={},this.playerName="",this.playerVersion="",this.osName="",this.osVersion="",this.deviceType="",this.smartLibVersion=L,this.networkTypeList=[],this.nanoCDNStatus=Ze.NANOCDN_STATUS_UNAVAILABLE,this.statusCode=Yt.BPSessionEndsNormally,this.cdnStatusCode=-1,this.nanoCDNStatusCode=-1,this.playerErrorCode="",void 0!==Yt.analyticsModule&&(this.timeline=new Yt.analyticsModule.SessionTrackerTimeline),this.endSessionDate=0,this.startSessionRequestDate=0,this.keepaliveRequestDate=0,this.teardownRequestDate=0,this.endSessionRequestDate=0}var t,i;return t=e,(i=[{key:"toQuery",value:function(){var e,t=""===this.playerName?"Generic":this.playerName,i=this.customParameters.pre_startup_time;if(e=void 0===this.metrics?"-1+"+encodeURIComponent(t)+"+"+encodeURIComponent(this.playerVersion)+"+"+encodeURIComponent(this.osName)+"+"+encodeURIComponent(this.osVersion)+"+"+(""!==this.smartLibParameters.deviceType?encodeURIComponent(this.smartLibParameters.deviceType):encodeURIComponent(this.deviceType))+"+-1+-1+-1++-1+-1+-1+-1+-1+-1+-1+-1+-1+-1+-1++":this.metrics.redirectionTime+"+"+encodeURIComponent(t)+"+"+encodeURIComponent(this.playerVersion)+"+"+encodeURIComponent(this.osName)+"+"+encodeURIComponent(this.osVersion)+"+"+(""!==this.smartLibParameters.deviceType?encodeURIComponent(this.smartLibParameters.deviceType):encodeURIComponent(this.deviceType))+"+"+this.metrics.startupTime+"+"+this.metrics.completion+"+"+Math.round(this.metrics.playbackDuration/1e3)+"+"+this.metrics.playbackType+"+"+this.metrics.stallsNumber+"+"+this.metrics.maxStallDuration+"+"+this.metrics.totalStallsDuration+"+"+this.metrics.rebufferingsNumber+"+"+this.metrics.maxRebufferingDuration+"+"+this.metrics.totalRebufferingDuration+"+"+Math.round(this.metrics.maxBitrate)+"+"+Math.round(this.metrics.minBitrate)+"+"+Math.round(this.metrics.averageBitrate)+"+"+this.metrics.layerSwitchesNumber+"+"+Math.round(this.metrics.sessionDuration/1e3)+"+"+this.getTimeSpentPerLayerQuery()+"+",e+=encodeURIComponent(this.smartLibParameters.uuid)+"+"+this.nanoCDNStatus+"+"+(void 0!==i?encodeURIComponent(i):"")+"+"+encodeURIComponent(this.smartLibVersion)+"+",void 0!==Yt.adModule&&void 0!==this.adMetrics&&this.adMetrics.length>0){var n=Yt.adModule.AdMetrics.merge(this.adMetrics);e+=(n.adSkippable?1:0)+"+"+(n.adSkipped?1:0)+"+"+(n.adProgress>=0?n.adProgress/25:n.adProgress)+"+"+Math.round(n.adDuration/1e3)+"+"+n.stallsNumber+"+"+Math.round(n.stallsDuration/1e3)+"+"+n.layerSwitchesNumber+"+"+n.averageBitrate}else e+="+++++++";return(e+="+"+this.getNetworkTypeListStr()+"+"+encodeURIComponent(this.playerErrorCode))+"+"+(this.cdnStatusCode>=0?this.cdnStatusCode:"")+"+"+(this.nanoCDNStatusCode>=0?this.nanoCDNStatusCode:"")}},{key:"toStartSessionJSON",value:function(){var t={};return t[e.IS_START_TAG]=!0,t[e.SESSION_ID_TAG]=this.sessionId,void 0!==this.metrics&&(t[e.STARTUP_TIME_TAG]=this.metrics.startupTime),t}},{key:"toEndSessionJSON",value:function(){var t={};if(t[e.IS_START_TAG]=!1,t[e.SESSION_ID_TAG]=this.sessionId,t[e.STATUS_CODE_TAG]=this.statusCode,t[e.CONTENT_URL_TAG]=Ne.toBkAString(this.requestedURL),this.redirectedURL.includes(ce.AD_NONCE_QUERY_PARAMETER)?t[e.REDIRECT_URL_TAG]=Ne.toBkAString(O.addOrReplaceParam(this.redirectedURL,ce.AD_NONCE_QUERY_PARAMETER,"ignored")):t[e.REDIRECT_URL_TAG]=Ne.toBkAString(this.redirectedURL),void 0!==this.metrics?(t[e.REDIRECTION_TIME_TAG]=this.metrics.redirectionTime,t[e.STARTUP_TIME_TAG]=this.metrics.startupTime,t[e.COMPLETION_TAG]=this.metrics.completion,t[e.PLAYED_TIME_TAG]=Math.round(this.metrics.playbackDuration/1e3),t[e.DURATION_TAG]=Math.round(this.metrics.sessionDuration/1e3),t[e.PLAYBACK_TYPE_TAG]=this.metrics.playbackType,t[e.NUMBER_OF_STALLS_TAG]=this.metrics.stallsNumber,t[e.MAX_STALL_TIME_TAG]=this.metrics.maxStallDuration,t[e.TOTAL_STALL_TIME_TAG]=this.metrics.totalStallsDuration,t[e.NUMBER_OF_REBUFFERING_TAG]=this.metrics.rebufferingsNumber,t[e.MAX_REBUFFERING_TIME_TAG]=this.metrics.maxRebufferingDuration,t[e.TOTAL_REBUFFERING_TIME_TAG]=this.metrics.totalRebufferingDuration,t[e.MIN_BITRATE_TAG]=Math.round(this.metrics.minBitrate),t[e.MAX_BITRATE_TAG]=Math.round(this.metrics.maxBitrate),t[e.AVERAGE_BITRATE_TAG]=Math.round(this.metrics.averageBitrate),t[e.NUMBER_OF_LAYER_SWITCH_TAG]=this.metrics.layerSwitchesNumber,t[e.TIME_SPENT_PER_LAYER_TAG]=this.metrics.timeSpentPerLayer):(t[e.REDIRECTION_TIME_TAG]=-1,t[e.STARTUP_TIME_TAG]=-1,t[e.COMPLETION_TAG]=-1,t[e.PLAYED_TIME_TAG]=-1,t[e.DURATION_TAG]=-1,t[e.PLAYBACK_TYPE_TAG]="",t[e.NUMBER_OF_STALLS_TAG]=-1,t[e.MAX_STALL_TIME_TAG]=-1,t[e.TOTAL_STALL_TIME_TAG]=-1,t[e.NUMBER_OF_REBUFFERING_TAG]=-1,t[e.MAX_REBUFFERING_TIME_TAG]=-1,t[e.TOTAL_REBUFFERING_TIME_TAG]=-1,t[e.MIN_BITRATE_TAG]=-1,t[e.MAX_BITRATE_TAG]=-1,t[e.AVERAGE_BITRATE_TAG]=-1,t[e.NUMBER_OF_LAYER_SWITCH_TAG]=-1,t[e.TIME_SPENT_PER_LAYER_TAG]={}),t[e.PLAYER_NAME_TAG]=Ne.toBkAString(this.playerName),t[e.PLAYER_VERSION_TAG]=Ne.toBkAString(this.playerVersion),t[e.DEVICE_OS_TAG]=Ne.toBkAString(this.osName),t[e.DEVICE_VERSION_TAG]=Ne.toBkAString(this.osVersion),""!==this.smartLibParameters.deviceType?t[e.DEVICE_TYPE]=Ne.toBkAString(this.smartLibParameters.deviceType):t[e.DEVICE_TYPE]=Ne.toBkAString(this.deviceType),t[e.UUID_TAG]=Ne.toBkAString(this.smartLibParameters.uuid),t[e.NANOCDN_STATUS_TAG]=this.nanoCDNStatus,t[e.CUSTOM_PARAMETERS_TAG]=this.customParameters,void 0!==this.timeline?t[e.TIMELINE_TAG]=this.timeline.data().base64():t[e.TIMELINE_TAG]="",t[e.SMARTLIB_VERSION_TAG]=Ne.toBkAString(this.smartLibVersion),t[e.MULTIPATH_TAG]=this.diversity,t[e.PLAYER_ERROR_CODE_TAG]=Ne.toBkAString(this.playerErrorCode),t[e.AD_METRICS_TAG]=[],void 0!==this.adMetrics&&this.adMetrics.length>0)for(var i=0;i<this.adMetrics.length;i++){var n=this.adMetrics[i];t[e.AD_METRICS_TAG].push({ad_skippable:n.adSkippable?1:0,ad_skipped:n.adSkipped?1:0,ad_progress:n.adProgress>=0?n.adProgress/25:n.adProgress,ad_duration:Math.round(n.adDuration/1e3),stalls_number:n.stallsNumber,stalls_duration:Math.round(n.stallsDuration/1e3),layer_switches_number:n.layerSwitchesNumber,average_bitrate:n.averageBitrate,session_token:n.sessionToken,creative_id:n.creativeId,ad_id:n.adId})}return t[e.NETWORK_TYPE_TAG]=this.getNetworkTypeListStr(),t[e.CDN_STATUS_CODE]=this.cdnStatusCode>=0?this.cdnStatusCode:"",t[e.NANOCDN_STATUS_CODE]=this.nanoCDNStatusCode>=0?this.nanoCDNStatusCode:"",t}},{key:"getTimeSpentPerLayerQuery",value:function(){var e="";for(var t in this.metrics.timeSpentPerLayer)""!==e&&(e+=","),e+=t+":"+this.metrics.timeSpentPerLayer[t];return e}},{key:"addNetworkType",value:function(e){this.networkTypeList.includes(e)||this.networkTypeList.push(e)}},{key:"getNetworkTypeListStr",value:function(){return this.networkTypeList.length>0?this.networkTypeList.sort().join("-"):""}},{key:"toString",value:function(){return JSON.stringify(this,(function(e,t){return"timeline"===e&&void 0!==Yt.analyticsModule&&t instanceof Yt.analyticsModule.SessionTrackerTimeline?t.toString():void 0===t?"undefined":t}),"  ")}}])&&Re(t.prototype,i),e}();function Te(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function we(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,Le(e,t,"get"))}function Oe(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Le(e,t,"set"),i),i}function Le(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}De(Pe,"SESSION_ID_TAG","session_id"),De(Pe,"IS_START_TAG","start"),De(Pe,"STATUS_CODE_TAG","status_code"),De(Pe,"STARTUP_TIME_TAG","startup_time"),De(Pe,"REDIRECTION_TIME_TAG","redirection_time"),De(Pe,"COMPLETION_TAG","completion"),De(Pe,"PLAYED_TIME_TAG","played_time"),De(Pe,"DURATION_TAG","duration"),De(Pe,"PLAYBACK_TYPE_TAG","playback_type"),De(Pe,"NUMBER_OF_STALLS_TAG","cnt_stall"),De(Pe,"TOTAL_STALL_TIME_TAG","total_stall_time"),De(Pe,"MAX_STALL_TIME_TAG","max_stall_time"),De(Pe,"NUMBER_OF_REBUFFERING_TAG","cnt_rebuffering"),De(Pe,"TOTAL_REBUFFERING_TIME_TAG","total_rebuffering_time"),De(Pe,"MAX_REBUFFERING_TIME_TAG","max_rebuffering_time"),De(Pe,"REDIRECT_URL_TAG","redirect_url"),De(Pe,"CONTENT_URL_TAG","content_url"),De(Pe,"MAX_BITRATE_TAG","max_bitrate"),De(Pe,"MIN_BITRATE_TAG","min_bitrate"),De(Pe,"AVERAGE_BITRATE_TAG","average_bitrate"),De(Pe,"NUMBER_OF_LAYER_SWITCH_TAG","cnt_layer_switch"),De(Pe,"TIME_SPENT_PER_LAYER_TAG","time_spent_per_layer"),De(Pe,"PLAYER_NAME_TAG","player_name"),De(Pe,"PLAYER_VERSION_TAG","player_version"),De(Pe,"DEVICE_OS_TAG","device_os"),De(Pe,"DEVICE_VERSION_TAG","device_version"),De(Pe,"DEVICE_TYPE","device_type"),De(Pe,"MULTIPATH_TAG","multipath"),De(Pe,"UUID_TAG","uuid"),De(Pe,"NANOCDN_STATUS_TAG","nano_status"),De(Pe,"CUSTOM_PARAMETERS_TAG","custom_parameters"),De(Pe,"TIMELINE_TAG","timeline"),De(Pe,"SMARTLIB_VERSION_TAG","smartlib_version"),De(Pe,"AD_METRICS_TAG","ad_metrics"),De(Pe,"NETWORK_TYPE_TAG","network_type_list"),De(Pe,"PLAYER_ERROR_CODE_TAG","player_error_code"),De(Pe,"CDN_STATUS_CODE","cdn_status_code"),De(Pe,"NANOCDN_STATUS_CODE","nanocdn_status_code");var Ce=new WeakMap,Ie=new WeakMap,Me=new WeakMap,Be=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ce.set(this,{writable:!0,value:void 0}),Ie.set(this,{writable:!0,value:void 0}),Me.set(this,{writable:!0,value:void 0}),Oe(this,Ce,t),Oe(this,Ie,!0)}var t,i;return t=e,(i=[{key:"start",value:function(){var e=this;Oe(this,Me,G.getInstance().asyncDelay(be.KEEPALIVE_REQUEST_INTERVAL,(function(){e.process()})))}},{key:"process",value:function(){var e=this;if(we(this,Ie)){we(this,Ce).notifyKeepaliveSessionReportRequested(we(this,Ce).sessionReport),we(this,Ce).sessionReport.keepaliveRequestDate=Date.now();var t={userAgent:we(this,Ce).smartLib.getParameters().userAgent};be.getInstance().keepalive(we(this,Ce),t).then((function(t){t>0&&(t<200||t>=300)?(P.d("BpkKeepAliveMgr","Stopping keepalive...",we(e,Ce).id),e.stop()):Oe(e,Me,G.getInstance().asyncDelay(be.KEEPALIVE_REQUEST_INTERVAL,(function(){e.process()})))}))}}},{key:"stop",value:function(){Oe(this,Ie,!1),G.getInstance().cancel(we(this,Me))}},{key:"isActive",value:function(){return we(this,Ie)}}])&&Te(t.prototype,i),e}();function Ue(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function je(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(i),!0).forEach((function(t){xe(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ue(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Fe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xe(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ve(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,He(e,t,"get"))}function Ge(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,He(e,t,"set"),i),i}function He(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}var We="BpkStreamingSessionOptions",qe=new WeakMap,Ye=new WeakMap,Ke=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),qe.set(this,{writable:!0,value:void 0}),Ye.set(this,{writable:!0,value:void 0}),Ge(this,qe,{}),Ve(this,qe)[e.MULTICAST_ONLY]=!1,Ve(this,qe)[e.ULTRA_LOW_LATENCY_SUPPORT]=!1,Ve(this,qe)[e.PIP_SESSION]=!1,Ve(this,qe)[e.REQUEST_REDIRECT_THIRD_PARTY_CDN]=!1,Ve(this,qe)[e.REQUEST_DIVERSITY]=!1,Ve(this,qe)[e.REQUEST_NANO_CDN]=!0,Ve(this,qe)[e.REQUEST_BROADPEAK_CDN]=!0,Ve(this,qe)[e.REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI]=!1,Ve(this,qe)[e.REQUEST_DIVERSITY_DYNAMIC_FAILOVER]=!1,Ve(this,qe)[e.SESSION_KEEPALIVE]=e.SESSION_ENABLED_IF_BROADPEAK_DOMAIN,Ve(this,qe)[e.SESSION_TEARDOWN]=e.SESSION_ENABLED_IF_BROADPEAK_DOMAIN,Ve(this,qe)[e.SESSION_REPORTING_MODE]=e.SESSION_REPORTING_MODE_DEFAULT,Ve(this,qe)[e.USERAGENT_AD_EVENT]=void 0,Ve(this,qe)[e.EXPERIMENTAL_METRICS_LATENCY]=!1,Ve(this,qe)[e.LEGACY_MULTICAST_ONLY]=!1,Ge(this,Ye,[])}var t,i,n;return t=e,n=[{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new e;return t instanceof e&&Ge(n,qe,je({},Ve(t,qe))),void 0!==i&&Ve(i,Ye).forEach((function(e){Ve(n,qe)[e]=Ve(i,qe)[e]})),n}},{key:"optionToString",value:function(e){switch(e){case this.MULTICAST_ONLY:return"MULTICAST_ONLY";case this.PIP_SESSION:return"PIP_SESSION";case this.ULTRA_LOW_LATENCY_SUPPORT:return"ULTRA_LOW_LATENCY_SUPPORT";case this.REQUEST_REDIRECT_THIRD_PARTY_CDN:return"REQUEST_REDIRECT_THIRD_PARTY_CDN";case this.REQUEST_DIVERSITY:return"REQUEST_DIVERSITY";case this.REQUEST_NANO_CDN:return"REQUEST_NANO_CDN";case this.REQUEST_BROADPEAK_CDN:return"REQUEST_BROADPEAK_CDN";case this.REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI:return"REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI";case this.REQUEST_DIVERSITY_DYNAMIC_FAILOVER:return"REQUEST_DIVERSITY_DYNAMIC_FAILOVER";case this.SESSION_KEEPALIVE:return"SESSION_KEEPALIVE";case this.SESSION_TEARDOWN:return"SESSION_TEARDOWN";case this.SESSION_REPORTING_MODE:return"SESSION_REPORTING_MODE";case this.USERAGENT_AD_EVENT:return"USERAGENT_AD_EVENT";case this.LEGACY_MULTICAST_ONLY:return"LEGACY_MULTICAST_ONLY"}return"unknown"}},{key:"valueToString",value:function(e,t){switch(e){case this.SESSION_KEEPALIVE:case this.SESSION_TEARDOWN:return this.stateToString(t);case this.SESSION_REPORTING_MODE:return this.reportingModeToString(t)}return String(t)}},{key:"stateToString",value:function(t){switch(t){case e.SESSION_DISABLED:return"disabled";case e.SESSION_ENABLED_IF_BROADPEAK_DOMAIN:return"enabled if broadpeak domain name";case e.SESSION_ENABLED:return"enabled"}return"unknown"}},{key:"reportingModeToString",value:function(t){switch(t){case e.SESSION_REPORTING_MODE_DEFAULT:return"default";case e.SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN:return"keepalive/teardown";case e.SESSION_REPORTING_MODE_METRICS_RECEIVER:return"metricsReceiver";case e.SESSION_REPORTING_MODE_DISABLED:return"disabled"}return"unknown"}}],(i=[{key:"option",value:function(t,i){return this.validate(t,i)&&(Ve(this,qe)[t]=i,t===e.PIP_SESSION&&!0===i&&this.option(e.REQUEST_NANO_CDN,!1),-1===Ve(this,Ye).indexOf(t)&&Ve(this,Ye).push(t)),this}},{key:"get",value:function(t){var i=[e.USERAGENT_AD_EVENT];return void 0===Ve(this,qe)[t]&&-1===i.indexOf(t)&&P.w(We,"Warning: get option "+t+" not found"),Ve(this,qe)[t]}},{key:"set",value:function(e,t){this.option(e,t)}},{key:"validate",value:function(t,i){if(t===e.SESSION_REPORTING_MODE)return i===e.SESSION_REPORTING_MODE_DEFAULT||i===e.SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN||i===e.SESSION_REPORTING_MODE_METRICS_RECEIVER||i===e.SESSION_REPORTING_MODE_DISABLED||(P.e(We,"Error: SESSION_REPORTING_MODE should be SESSION_REPORTING_MODE_DEFAULT, SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN, SESSION_REPORTING_MODE_METRICS_RECEIVER or SESSION_REPORTING_MODE_DISABLED"),!1);if(t===e.SESSION_KEEPALIVE||t===e.SESSION_TEARDOWN)return i===e.SESSION_DISABLED||i===e.SESSION_ENABLED_IF_BROADPEAK_DOMAIN||i===e.SESSION_ENABLED||(P.e(We,"Error: "+e.optionToString(t)+" value should be SESSION_ENABLED_IF_BROADPEAK_DOMAIN, SESSION_DISABLED or SESSION_ENABLED"),!1);if(t===e.USERAGENT_AD_EVENT)return"string"==typeof i||void 0===i||(P.e(We,"Error: "+e.optionToString(t)+" value should be a string or undefined"),!1);var n="boolean"==typeof i;return n||P.e(We,"Error: "+e.optionToString(t)+" value should be a boolean"),n}},{key:"print",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:We,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;P.i(t,i+"Options",n),P.i(t,i+"   MULTICAST_ONLY="+this.get(e.MULTICAST_ONLY),n),P.i(t,i+"   REQUEST_REDIRECT_THIRD_PARTY_CDN="+this.get(e.REQUEST_REDIRECT_THIRD_PARTY_CDN),n),P.i(t,i+"   REQUEST_DIVERSITY="+this.get(e.REQUEST_DIVERSITY),n),P.i(t,i+"   REQUEST_NANO_CDN="+this.get(e.REQUEST_NANO_CDN),n),P.i(t,i+"   REQUEST_BROADPEAK_CDN="+this.get(e.REQUEST_BROADPEAK_CDN),n),P.i(t,i+"   REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI="+this.get(e.REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI),n),P.i(t,i+"   REQUEST_DIVERSITY_DYNAMIC_FAILOVER="+this.get(e.REQUEST_DIVERSITY_DYNAMIC_FAILOVER),n),P.i(t,i+"   SESSION_KEEPALIVE="+e.stateToString(this.get(e.SESSION_KEEPALIVE)),n),P.i(t,i+"   SESSION_TEARDOWN="+e.stateToString(this.get(e.SESSION_TEARDOWN)),n),P.i(t,i+"   SESSION_REPORTING_MODE="+e.reportingModeToString(this.get(e.SESSION_REPORTING_MODE)),n),void 0!==this.get(e.USERAGENT_AD_EVENT)&&P.i(t,i+"   USERAGENT_AD_EVENT="+this.get(e.USERAGENT_AD_EVENT),n),P.i(t,i+"   PIP_SESSION="+this.get(e.PIP_SESSION),n),P.i(t,i+"   ULTRA_LOW_LATENCY_SUPPORT="+this.get(e.ULTRA_LOW_LATENCY_SUPPORT),n)}},{key:"printUpdates",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:We,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;Ve(this,Ye).forEach((function(a){P.i(i,n+"   "+e.optionToString(a)+"="+e.valueToString(a,t.get(a)),r)}))}}])&&Fe(t.prototype,i),n&&Fe(t,n),e}();function Qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ze(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Je(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}xe(Ke,"MULTICAST_ONLY",0),xe(Ke,"ULTRA_LOW_LATENCY_SUPPORT",1),xe(Ke,"PIP_SESSION",2),xe(Ke,"REQUEST_REDIRECT_THIRD_PARTY_CDN",100),xe(Ke,"REQUEST_DIVERSITY",101),xe(Ke,"REQUEST_NANO_CDN",102),xe(Ke,"REQUEST_BROADPEAK_CDN",103),xe(Ke,"REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI",104),xe(Ke,"REQUEST_DIVERSITY_DYNAMIC_FAILOVER",105),xe(Ke,"SESSION_KEEPALIVE",200),xe(Ke,"SESSION_TEARDOWN",201),xe(Ke,"SESSION_REPORTING_MODE",202),xe(Ke,"USERAGENT_AD_EVENT",300),xe(Ke,"EXPERIMENTAL_METRICS_LATENCY",900),xe(Ke,"LEGACY_MULTICAST_ONLY",1e3),xe(Ke,"SESSION_DISABLED",-1),xe(Ke,"SESSION_ENABLED_IF_BROADPEAK_DOMAIN",0),xe(Ke,"SESSION_ENABLED",1),xe(Ke,"SESSION_REPORTING_MODE_DEFAULT",0),xe(Ke,"SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN",1),xe(Ke,"SESSION_REPORTING_MODE_METRICS_RECEIVER",2),xe(Ke,"SESSION_REPORTING_MODE_DISABLED",-1);var Xe="BpkSession",Ze=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;Qe(this,e),Je(this,"smartLib",void 0),Je(this,"streamingSession",void 0),Je(this,"options",void 0),Je(this,"adSession",void 0),Je(this,"diversityFailoverSession",void 0),Je(this,"omSessionHandler",void 0),Je(this,"id",void 0),Je(this,"listeners",void 0),Je(this,"playerAdapter",void 0),Je(this,"metricsManager",void 0),Je(this,"keepAliveManager",void 0),Je(this,"adMetricsManager",void 0),Je(this,"adTrackingManager",void 0),Je(this,"sessionReport",void 0),Je(this,"firstImageCalled",void 0),Je(this,"stopped",void 0),Je(this,"jobs",void 0),Je(this,"deviceInitDate",void 0),Je(this,"manifestInitDate",void 0),this.smartLib=t,this.streamingSession=i,this.adSession=void 0,this.listeners=[],this.sessionReport=new Pe,this.firstImageCalled=!1,this.stopped=!1,this.jobs=[],this.sessionReport.smartLibParameters=t.getParameters(),this.sessionReport.customParameters=this.getCustomParameters()}var t,i;return t=e,(i=[{key:"initPlayerAdapter",value:function(){void 0!==this.playerAdapter?(P.i(Xe,"Player:name="+this.playerAdapter.getName()+", version="+this.playerAdapter.getVersion(),this.id),P.i(Xe,"Player:capabilities="+JSON.stringify(this.playerAdapter.getCapabilities()),this.id),this.playerAdapter.attachSession(this),this.playerAdapter.initSessionPlayerObjects()):P.i(Xe,"Player:no player attached",this.id)}},{key:"initManagers",value:function(){var e,t,i;void 0!==Yt.analyticsModule&&(this.metricsManager=new Yt.analyticsModule.MetricsManager(this,this.playerAdapter)),void 0!==Yt.adModule&&(this.adMetricsManager=new Yt.adModule.AdMetricsManager(this),this.adTrackingManager=new Yt.adModule.AdTrackingManager(this,this.playerAdapter)),void 0!==this.playerAdapter&&(this.addListener(this.metricsManager),this.addListener(this.playerAdapter)),this.addListener(this.sessionReport.timeline),this.addListener(this.adMetricsManager),null===(e=this.adTrackingManager)||void 0===e||e.addListener(this.adMetricsManager),void 0!==this.adSession&&this.adSession.isAdActivated()&&null!==(t=Yt.adModule)&&void 0!==t&&t.OMSDKManager.getInstance().isEnabled()&&(this.omSessionHandler=new Yt.adModule.OMSessionHandler(this,this.playerAdapter),this.addListener(this.omSessionHandler),null===(i=this.adTrackingManager)||void 0===i||i.addListener(this.omSessionHandler)),this.addListener(this),Dt.getInstance().addListener(this.sessionReport.timeline),Dt.getInstance().addListener(this)}},{key:"start",value:function(t){var i,n,r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};P.i(Xe,"Starting streaming session with redirect...",this.id),this.sessionReport.requestedURL=t,this.initPlayerAdapter(),this.initManagers(),this.notifyStart();var s=this.smartLib.getParameters(),o={analyticsAddress:s.analyticsAddress,nanoCDNDescr:null===(i=this.smartLib.nanoCDNHostManager)||void 0===i?void 0:i.getCurrentNanoCDNDescr(),nanoCDNDescrConfigured:null===(n=this.smartLib.nanoCDNHostManager)||void 0===n?void 0:n.getCurrentNanoCDNDescr(),broadpeakDomainNames:s.broadpeakDomainNames,forceTeardown:s.forceTeardown,userAgent:s.userAgent},u=be.isBroadpeakDomainName(t,o.broadpeakDomainNames)&&!0===this.options.get(Ke.REQUEST_BROADPEAK_CDN);return void 0!==o.nanoCDNDescr&&(this.sessionReport.nanoCDNStatus=e.NANOCDN_STATUS_DETECTED_NOT_USED),Promise.resolve().then((function(){return void 0!==Yt.diversityModule&&!0===r.options.get(Ke.REQUEST_DIVERSITY_DYNAMIC_FAILOVER)&&u?Yt.diversityModule.DiversityRequestManager.getInstance().processFailoverSession(t,o,r):be.getInstance().getURL(t,o,r)})).then((function(e){return e.isError()&&(r.sessionReport.statusCode=e.getErrorCode()),r.sessionReport.redirectedURL=r.patchBkmResult(e.getURL()),r.handleRedirectedURL(o),e.url=r.sessionReport.redirectedURL,r.stopped?(P.d(Xe,"The session has been stopped while creating it.",r.id),r.stop(),e=ht.error(ht.RESULT_SESSION_HAS_BEEN_STOPPED_DURING_REQUEST),P.i(Xe,"getURL error code: "+e.getErrorMessage()+" (code "+e.getErrorCode()+", detail "+e.getDetailedErrorMessage()+")",r.id),P.i(Xe,"getURL result:",r.id),a(""),e):(P.i(Xe,"getURL status: "+e.getErrorMessage()+" (code "+e.getErrorCode()+", detail "+e.getDetailedErrorMessage()+")",r.id),P.i(Xe,"getURL result: "+r.sessionReport.redirectedURL,r.id),a(r.sessionReport.redirectedURL),e)}))}},{key:"handleRedirectedURL",value:function(t){var i;this.isNanoCDNUsed()&&(this.sessionReport.nanoCDNStatus=e.NANOCDN_STATUS_USED),0!==this.sessionReport.redirectedURL.length&&(this.sessionReport.sessionRunning=!0),this.sessionReport.sessionCreated=!0,this.sessionReport.sessionRunning&&(this.sessionReport.teardownActivated=this.isTeardownActivated(t)),this.sessionReport.redirectedURL=this.removeBroadpeakParameters(this.sessionReport.redirectedURL),this.sessionReport.sessionId=this.getTicket(),this.sessionReport.teardownActivated||null===(i=this.sessionReport.timeline)||void 0===i||i.encoder.extend(),this.notifyRedirectionEnd(),void 0===this.playerAdapter&&this.sessionReport.sessionRunning&&this.notifyFirstImage(0,0)}},{key:"stop",value:function(e){if(Dt.getInstance().removeListener(this.sessionReport.timeline),Dt.getInstance().removeListener(this),void 0===e||isNaN(e)||(this.sessionReport.statusCode=e),this.sessionReport.endSessionDate=Date.now(),this.notifyStop(this.sessionReport.statusCode),void 0!==this.keepAliveManager&&this.keepAliveManager.stop(),this.sessionReport.sessionCreated){P.d(Xe,"Session ends with status code: "+this.sessionReport.statusCode,this.id);var t=this.smartLib.getParameters();this.sessionReport.sessionRunning=!1,this.sessionReport.sessionCreated=!1;try{var i,n=null===(i=Yt.diversityModule)||void 0===i?void 0:i.DiversityManager.getInstance().getStats(this.sessionReport.sessionId,1);null!=n&&0!==n.length?this.sessionReport.diversity=JSON.parse(n):this.sessionReport.diversity={}}catch(e){P.w(Xe,"Invalid Diversity metrics",this.id)}this.sessionReport.smartLibParameters=JSON.parse(JSON.stringify(this.sessionReport.smartLibParameters)),this.sessionReport.customParameters=JSON.parse(JSON.stringify(this.getCustomParameters())),this.notifyEndSessionReportUpdateRequested(this.sessionReport),P.d(Xe,"SessionReport: "+this.sessionReport.toString(),this.id),this.resetCustomParameters();var r,a={analyticsAddress:t.analyticsAddress,userAgent:t.userAgent},s=this.options.get(Ke.SESSION_TEARDOWN),o=this.options.get(Ke.SESSION_REPORTING_MODE);if(s===Ke.SESSION_ENABLED)this.sessionReport.teardownRequestDate=Date.now(),be.getInstance().teardown(this,a),o===Ke.SESSION_REPORTING_MODE_METRICS_RECEIVER&&(this.sessionReport.endSessionRequestDate=Date.now(),null===(r=Yt.analyticsModule)||void 0===r||r.AnalyticsRequestManager.getInstance().endSession(this,a));else if(s===Ke.SESSION_ENABLED_IF_BROADPEAK_DOMAIN){var u,l;this.sessionReport.teardownActivated?(this.sessionReport.teardownRequestDate=Date.now(),be.getInstance().teardown(this,a),o===Ke.SESSION_REPORTING_MODE_METRICS_RECEIVER&&(this.sessionReport.endSessionRequestDate=Date.now(),null===(u=Yt.analyticsModule)||void 0===u||u.AnalyticsRequestManager.getInstance().endSession(this,a))):o!==Ke.SESSION_REPORTING_MODE_DEFAULT&&o!==Ke.SESSION_REPORTING_MODE_METRICS_RECEIVER||(this.sessionReport.endSessionRequestDate=Date.now(),null===(l=Yt.analyticsModule)||void 0===l||l.AnalyticsRequestManager.getInstance().endSession(this,a))}else if(s===Ke.SESSION_DISABLED){var c;o!==Ke.SESSION_REPORTING_MODE_DEFAULT&&o!==Ke.SESSION_REPORTING_MODE_METRICS_RECEIVER||(this.sessionReport.endSessionRequestDate=Date.now(),null===(c=Yt.analyticsModule)||void 0===c||c.AnalyticsRequestManager.getInstance().endSession(this,a))}}void 0!==this.playerAdapter&&(this.playerAdapter.releaseSessionPlayerObjects(),this.playerAdapter.detachSession());for(var d=0,h=0;h<this.jobs.length;h++)!0===this.jobs[h].active&&d++,G.getInstance().interrupt(this.jobs[h]);P.d(Xe,d+" active job(s)",this.id),this.jobs=[],this.listeners=[],this.stopped=!0}},{key:"onFirstImage",value:function(e,t){if(!this.isSessionCreated(this.sessionReport.requestedURL)){var i=this.options.get(Ke.SESSION_TEARDOWN),n=this.options.get(Ke.SESSION_REPORTING_MODE),r=i===Ke.SESSION_ENABLED_IF_BROADPEAK_DOMAIN&&!this.sessionReport.teardownActivated||i===Ke.SESSION_DISABLED;if(n===Ke.SESSION_REPORTING_MODE_DEFAULT&&r||n===Ke.SESSION_REPORTING_MODE_METRICS_RECEIVER){var a;this.sessionReport.startSessionRequestDate=Date.now(),this.notifyStartSessionReportUpdateRequested(this.sessionReport);var s=this.smartLib.getParameters(),o={analyticsAddress:s.analyticsAddress,userAgent:s.userAgent};null===(a=Yt.analyticsModule)||void 0===a||a.AnalyticsRequestManager.getInstance().startSession(this,o)}}var u=this.options.get(Ke.SESSION_KEEPALIVE);u===Ke.SESSION_ENABLED?(P.i(Xe,"Keepalive is enabled (SESSION_KEEPALIVE=SESSION_ENABLED)",this.id),this.keepAliveManager=new Be(this),this.keepAliveManager.start()):u===Ke.SESSION_ENABLED_IF_BROADPEAK_DOMAIN?this.sessionReport.teardownActivated&&(this.keepAliveManager=new Be(this),this.keepAliveManager.start()):u===Ke.SESSION_DISABLED&&this.sessionReport.teardownActivated&&P.i(Xe,"Keepalive is disabled (SESSION_KEEPALIVE=SESSION_DISABLED)",this.id)}},{key:"isNanoCDNUsed",value:function(){var e,t=this,i=!1;return void 0!==Yt.nanoCDNModule&&("string"==typeof this.sessionReport.redirectedURL&&0!==this.sessionReport.redirectedURL.length&&(null===(e=this.smartLib.nanoCDNHostManager)||void 0===e?void 0:e.getNanoCDNDescrList()).forEach((function(e){t.sessionReport.redirectedURL.indexOf(e.hostIP)>0&&(i=!0)})),i)}},{key:"patchBkmResult",value:function(e){var t=O.parseURL(e);if(null!==t){var i=e,n=t.query.split("&");return n.length>=2&&-1===n[0].indexOf("bk-teardown=")&&(i=i.replace("?bk-teardown=","&bk-teardown=")),-1!==i.indexOf("//bpk-token")&&(i=i.replace("//bpk-token","/bpk-token")),i}return e}},{key:"getTicket",value:function(){var e,t="";if(void 0!==this.adTrackingManager&&!0===this.adTrackingManager.bkYouSession&&void 0!==this.adTrackingManager.bkYouSessionToken&&this.adTrackingManager.bkYouSessionToken.length>0&&(t=this.adTrackingManager.bkYouSessionToken),""===t&&(t=O.getParam(this.sessionReport.redirectedURL,be.QUERY_PARAMETER_SESSION_ID)),""===t&&(e=this.sessionReport.redirectedURL.split("/")).length>=4&&(e[3].match("\\[(.*)\\]")?t=e[3].substring(1,e[3].length-1):e[3].match("\\%5B(.*)\\%5D")&&(t=e[3].substring(3,e[3].length-3))),""===t){var i=this.sessionReport.redirectedURL.split("//");(e=i[i.length-1].split("/")).length>=3&&(e[0].match(O.REGEX_IP)||e[0].match(O.REGEX_HOSTNAME))&&"bpk-token"===e[1]&&(e[2].match(O.REGEX_TICKET)||e[2].match(O.REGEX_TICKET_TRANSCODED))&&(t=e[2],P.v(Xe,"Ticket detected: "+t,this.id))}if(""===t){var n=this.sessionReport.redirectedURL.split("//");(e=n[n.length-1].split("/")).length>=2&&(e[0].match(O.REGEX_IP)||e[0].match(O.REGEX_HOSTNAME))&&(e[1].match(O.REGEX_TICKET)||e[1].match(O.REGEX_TICKET_TRANSCODED))&&(t=e[1],P.v(Xe,"Ticket detected: "+t,this.id))}return""===t&&(t=this.generateTicket()),""===t&&(P.w(Xe,"Failed getting ticket",this.id),P.w(Xe,"SmartLib won't be able to post metrics",this.id)),t}},{key:"generateTicket",value:function(){var e=Date.now(),t=I.randomIntFromInterval(1e6,9999999),i=I.stringToBase64(t+e);return null===i?(P.w(Xe,"Cannot encode base 64 ticket",this.id),""):(P.v(Xe,"Ticket generated: "+i,this.id),i)}},{key:"getTeardown",value:function(){var e=O.getParam(this.sessionReport.redirectedURL,"bk-teardown");return e.startsWith("T")||e.startsWith("t")||e.startsWith("1")}},{key:"isTeardownActivated",value:function(t){if(t.forceTeardown===Yt.FORCE_TEARDOWN_ENABLED)return P.i(Xe,"Session will start with keepalives/teardown (forceTeardown)",this.id),!0;if(t.forceTeardown===Yt.FORCE_TEARDOWN_DISABLED)return P.i(Xe,"Session will start without keepalives/teardown (forceTeardown)",this.id),!1;if(null!==this.sessionReport.redirectedURL&&"0"===O.getParam(this.sessionReport.redirectedURL,"bk-teardown"))return P.i(Xe,"Session will start without keepalives/teardown (bk-teardown=0)",this.id),!1;if(null!==this.sessionReport.redirectedURL&&this.getTeardown())return P.i(Xe,"Session will start with keepalives/teardown (bk-teardown=1)",this.id),!0;if(this.sessionReport.nanoCDNStatus===e.NANOCDN_STATUS_USED)return P.i(Xe,"Session will start with keepalives/teardown (nanoCDN used)",this.id),!0;if(!1===this.options.get(Ke.REQUEST_BROADPEAK_CDN))return P.i(Xe,"Session will start without keepalives/teardown (REQUEST_BROADPEAK_CDN=false)",this.id),!1;if(void 0===this.diversityFailoverSession){if(null!==this.sessionReport.requestedURL&&be.isBroadpeakDomainName(this.sessionReport.requestedURL,t.broadpeakDomainNames))return P.i(Xe,"Session will start with keepalives/teardown (in broadpeak domains list)",this.id),!0}else if(be.isBroadpeakDomainName(this.diversityFailoverSession.getMainURL(),t.broadpeakDomainNames))return P.i(Xe,"Diversity session will start with keepalives/teardown (in broadpeak domains list)",this.id),!0;return P.i(Xe,"Session will start without keepalives/teardown",this.id),!1}},{key:"removeBroadpeakParameters",value:function(e){var t=O.parseURL(e);if(null!==t){for(var i="",n=t.query.split("&"),r=1,a=0;a<n.length;a++){var s=n[a];s.startsWith("bk-")||s.startsWith("bpk-")?P.d(Xe,"Remove query parameter '"+s+"' from url",this.id):(r||(i+="&"),i+=s,r=0)}return""===i?e.replace("?"+t.query,""):e.replace(t.query,i)}return e}},{key:"isSessionCreated",value:function(e){if(null===e)return!1;var t=O.getParam(e,be.QUERY_PARAMETER_SESSION_ID);return 0!==t.length||(t=O.getParam(e,be.QUERY_PARAMETER_SESSION_CREATED)).startsWith("T")||t.startsWith("t")||t.startsWith("1")}},{key:"getCustomParameters",value:function(){return void 0!==this.streamingSession?this.streamingSession.customParameters:this.smartLib.getParameters().customParameters}},{key:"resetCustomParameters",value:function(){void 0!==this.streamingSession||this.smartLib.resetCustomParameters()}},{key:"addListener",value:function(e){void 0===e||this.listeners.includes(e)||this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}},{key:"notifyEvent",value:function(e,t,i,n){"function"==typeof e[t]&&e[t](i,n)}},{key:"notifyStart",value:function(){var e,t,i=this;e=Dt.getInstance().networkType,this.sessionReport.addNetworkType(e),t=Dt.getInstance().mute,this.listeners.forEach((function(n){i.notifyEvent(n,"onStart",e,t)}))}},{key:"notifyRedirectionEnd",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onRedirectionEnd")}))}},{key:"notifyFirstImage",value:function(e,t){var i=this;this.firstImageCalled?P.e(Xe,"Implementation error: PlayerEventListener.onSessionStart() already called. If you don't attach any player, please remove this call, SmartLib is now handling it automatically.",this.id):(this.firstImageCalled=!0,void 0!==this.adSession&&this.adSession.isAdActivated()?void 0!==this.playerAdapter?!0===this.playerAdapter.getCapabilities().adTracking?(P.d(Xe,"Ad tracking enabled",this.id),this.addListener(this.adTrackingManager)):P.d(Xe,"Ad tracking disabled (player not compatible)",this.id):P.d(Xe,"Ad tracking disabled (no player attached)",this.id):P.d(Xe,"Ad tracking disabled (advertising not activated)",this.id),this.listeners.forEach((function(n){i.notifyEvent(n,"onFirstImage",e,t)})))}},{key:"notifyLayerSwitch",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onLayerSwitch",e)}))}},{key:"notifyPause",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onPause")}))}},{key:"notifyResume",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onResume")}))}},{key:"notifyBufferingStart",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onBufferingStart")}))}},{key:"notifyBufferingEnd",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onBufferingEnd",e)}))}},{key:"notifyStallEnd",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onStallEnd")}))}},{key:"notifyRebufferingEnd",value:function(){var e=this;this.listeners.forEach((function(t){e.notifyEvent(t,"onRebufferingEnd")}))}},{key:"notifySeek",value:function(e,t){var i=this;this.listeners.forEach((function(n){i.notifyEvent(n,"onSeek",e,t)}))}},{key:"notifyStop",value:function(e){var t,i,n=this;null===(t=this.adSession)||void 0===t||null===(i=t.adPalSession)||void 0===i||i.setAdView(void 0),this.listeners.forEach((function(t){n.notifyEvent(t,"onStop",e)}))}},{key:"notifyStartSessionReportUpdateRequested",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onStartSessionReportUpdateRequested",e)}))}},{key:"notifyKeepaliveSessionReportRequested",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onKeepaliveSessionReportUpdateRequested",e)}))}},{key:"notifyEndSessionReportUpdateRequested",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onEndSessionReportUpdateRequested",e)}))}},{key:"notifyVolumeChanged",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onVolumeChanged",e)}))}},{key:"notifyPlayerError",value:function(e,t){var i=this;this.listeners.forEach((function(n){i.notifyEvent(n,"onPlayerError",e,t)}))}},{key:"onNetworkAvailable",value:function(e){P.v(Xe,"Received event onNetworkAvailable type:"+e),this.sessionReport.addNetworkType(e)}}])&&ze(t.prototype,i),e}();function $e(e){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function it(e,t){return(it=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nt(e,t){return!t||"object"!==$e(t)&&"function"!=typeof t?rt(e):t}function rt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function at(e){return(at=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function st(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Je(Ze,"NANOCDN_STATUS_UNAVAILABLE",1),Je(Ze,"NANOCDN_STATUS_DETECTED_NOT_USED",2),Je(Ze,"NANOCDN_STATUS_USED",3);var ot="BpkProxySession",ut=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&it(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=at(e);if(t){var r=at(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return nt(this,i)}}(r);function r(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return et(this,r),st(rt(t=n.call(this,e,i)),"startCalled",void 0),t.startCalled=!1,t}return t=r,(i=[{key:"getQuery",value:function(){var e,t=null===(e=this.smartLib.nanoCDNHostManager)||void 0===e?void 0:e.getCurrentNanoCDNDescr(),i=void 0!==t?"nanoCDN host: "+t.hostIP:"No nanoCDN found";P.i(ot,i+" ("+L+")"),this.initPlayerAdapter(),this.initManagers(),this.notifyStart();var n="bk-ml=1";return void 0!==t&&(n+="&nanocdnhost="+t.hostIP,this.sessionReport.nanoCDNStatus=Ze.NANOCDN_STATUS_DETECTED_NOT_USED),P.i(ot,"getQuery result : "+n),n}},{key:"start",value:function(e,t){if(this.startCalled)P.e(ot,"Implementation error: SmartLib.startStreamingSession(...) already called.");else{P.i(ot,"Starting streaming session..."),this.startCalled=!0,this.sessionReport.requestedURL=e,this.sessionReport.redirectedURL=t;var i=this.smartLib.getParameters(),n={broadpeakDomainNames:i.broadpeakDomainNames,forceTeardown:i.forceTeardown};this.handleRedirectedURL(n)}}}])&&tt(t.prototype,i),r}(Ze);function lt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ct(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function dt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ht=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";lt(this,e),dt(this,"url",void 0),dt(this,"diversityFailoverSession",void 0),dt(this,"errorCode",void 0),dt(this,"detailedErrorCode",void 0),dt(this,"detailedErrorMessage",void 0),this.url=t,this.errorCode=i,this.detailedErrorMessage=n.trim();var r=n.match("^([0-9]+).*");null!==r&&void 0!==r[1]?this.detailedErrorCode=parseInt(r[1],10):""===this.detailedErrorMessage?this.detailedErrorCode=e.RESULT_NO_DETAILED_ERROR:this.detailedErrorCode=e.RESULT_DETAILED_ERROR_PARSING_ERROR}var t,i,n;return t=e,n=[{key:"success",value:function(t){return new e(t,e.RESULT_NO_ERROR)}},{key:"error",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new e("",t,i)}},{key:"getErrorMessage",value:function(t){switch(t){case e.RESULT_NO_ERROR:return"Result success. A streaming session has been created.";case e.RESULT_NO_STREAMING_URL_FOUND:return"Request error. No streaming URL has been found. Default error when requesting the CDN (BkM/uCDN).";case e.RESULT_CDN_RESPONSE_UNREADABLE:return"Request error. The CDN response is unreadable (timeout error, CORS error, connection error).";case e.RESULT_REQUESTED_URL_NOT_FOUND_ON_CDN:return"Request error. Content not found on the CDN (error 4XX).";case e.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN:return"Request error. Content not found on the nanoCDN (error 404, timeout error, CORS error or connection error).";case e.RESULT_REQUESTED_URL_CDN_ERROR:return"Request error. The CDN returned an unknown error (error 5XX).";case e.RESULT_NANOCDN_SESSION_LIMIT_REACHED:return"nanoCDN error. All nanoCDN on the network responded with session limit reached error.";case e.RESULT_NANOCDN_SESSION_LIMIT_REACHED_ON_REQUESTED_CHANNEL:return"nanoCDN error. All nanoCDN on the network responded with session limit reached error for the requested channel.";case e.RESULT_NANOCDN_SERVICE_UNAVAILABLE:return"nanoCDN error. All nanoCDN on the network have their service unavailable.";case e.RESULT_NANOCDN_CHANNEL_UNAVAILABLE:return"nanoCDN error. The requested channel is unavailable on all nanoCDN of the network.";case e.RESULT_NANOCDN_REQUEST_LOCAL_IF_CONNECTED_TO_WIFI_NOT_ALLOWED:return"nanoCDN error. A nanoCDN on 127.0.0.1 has been found and is connected to Wi-Fi but it is not allowed.";case e.RESULT_API_PARAMETER_FORMAT_ERROR:return"Api error. A method parameter does not have the right format.";case e.RESULT_API_NOT_INITIALIZED:return"Api error. SmartLib init not called";case e.RESULT_SESSION_HAS_BEEN_STOPPED_DURING_REQUEST:return"Workflow error. The session has been stopped during request.";case e.RESULT_REQUEST_ALREADY_DONE:return"Workflow error. The request has already been done for that session."}return"No error message for the error code "+t}}],(i=[{key:"getURL",value:function(){return this.url}},{key:"getFallbackURLList",value:function(){return void 0!==this.diversityFailoverSession?this.diversityFailoverSession.getFallbackURLList():[]}},{key:"isError",value:function(){return this.errorCode!==e.RESULT_NO_ERROR}},{key:"getErrorCode",value:function(){return this.errorCode}},{key:"getErrorMessage",value:function(){return e.getErrorMessage(this.errorCode)}},{key:"getDetailedErrorCode",value:function(){return this.detailedErrorCode}},{key:"getDetailedErrorMessage",value:function(){return this.detailedErrorMessage}}])&&ct(t.prototype,i),n&&ct(t,n),e}();function ft(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}dt(ht,"RESULT_NO_ERROR",0),dt(ht,"RESULT_NO_STREAMING_URL_FOUND",3100),dt(ht,"RESULT_CDN_RESPONSE_UNREADABLE",3101),dt(ht,"RESULT_REQUESTED_URL_NOT_FOUND_ON_CDN",3102),dt(ht,"RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN",3103),dt(ht,"RESULT_REQUESTED_URL_CDN_ERROR",3104),dt(ht,"RESULT_NANOCDN_SESSION_LIMIT_REACHED",3201),dt(ht,"RESULT_NANOCDN_SESSION_LIMIT_REACHED_ON_REQUESTED_CHANNEL",3202),dt(ht,"RESULT_NANOCDN_SERVICE_UNAVAILABLE",3203),dt(ht,"RESULT_NANOCDN_CHANNEL_UNAVAILABLE",3204),dt(ht,"RESULT_NANOCDN_REQUEST_LOCAL_IF_CONNECTED_TO_WIFI_NOT_ALLOWED",3205),dt(ht,"RESULT_NANOCDN_RESPONSE_UNREADABLE",3206),dt(ht,"RESULT_API_PARAMETER_FORMAT_ERROR",3400),dt(ht,"RESULT_API_NOT_INITIALIZED",3401),dt(ht,"RESULT_SESSION_HAS_BEEN_STOPPED_DURING_REQUEST",3500),dt(ht,"RESULT_REQUEST_ALREADY_DONE",3501),dt(ht,"RESULT_NO_DETAILED_ERROR",0),dt(ht,"RESULT_DETAILED_ERROR_PARSING_ERROR",-1);var pt="BpkStreamingSession",yt=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),vt(this,"smartLib",void 0),vt(this,"options",void 0),vt(this,"customParameters",void 0),vt(this,"adSession",void 0),vt(this,"id",void 0),vt(this,"date",void 0),vt(this,"handler",void 0),vt(this,"playerAdapter",void 0),vt(this,"stopped",void 0),this.smartLib=t,this.options=i,this.customParameters={},this.id=I.randomIntFromInterval(1e4,99999),this.date=Date.now(),this.stopped=!1}var t,i;return t=e,(i=[{key:"attachPlayer",value:function(e,t){void 0!==e?void 0===this.handler?(this.playerAdapter=e,P.i(pt,"Player "+this.playerAdapter.getName()+" attached",this.id)):P.e(pt,"Exception: attachPlayer error, you cannot attach a player when a session is running.",this.id):void 0===Yt.analyticsModule?P.w(pt,"Try to attach a player, but analytics module not loaded",this.id):P.w(pt,"Try to attach a player, but it is not recognized",this.id)}},{key:"setOption",value:function(e,t){void 0===this.handler?(P.d(pt,"Setting session option "+Ke.optionToString(e)+" to "+Ke.valueToString(e,t),this.id),this.options.set(e,t)):P.e(pt,"Exception: setOption error, you cannot set an option when a session is running.",this.id)}},{key:"setAdEventsListener",value:function(e){void 0===this.adSession&&(this.adSession=new se(this.smartLib)),this.adSession.setAdEventsListener(e)}},{key:"activateAdvertising",value:function(){void 0===this.adSession&&(this.adSession=new se(this.smartLib)),this.adSession.activateAdvertising()}},{key:"setAdParameter",value:function(e,t){void 0===this.adSession&&(this.adSession=new se(this.smartLib)),this.adSession.setAdParameter(e,t)}},{key:"setAdView",value:function(e){var t,i,n;void 0===this.adSession&&(this.adSession=new se(this.smartLib)),this.adSession.adView=e,null===(t=this.handler)||void 0===t||null===(i=t.omSessionHandler)||void 0===i||null===(n=i.omAdSession)||void 0===n||n.setAdView(e)}},{key:"setAdViewState",value:function(e){var t,i,n;void 0===this.adSession&&(this.adSession=new se(this.smartLib)),!0===$.isAdViewState(e)?(this.adSession.adViewState=e,null===(t=this.handler)||void 0===t||null===(i=t.omSessionHandler)||void 0===i||null===(n=i.omAdSession)||void 0===n||n.setAdViewState(e)):P.e(pt,"Please use a defined state within the AdViewState enum.",this.id)}},{key:"registerAdFriendlyObstructionView",value:function(e,t,i){var n,r,a;void 0===this.adSession&&(this.adSession=new se(this.smartLib)),ee.isAdFriendlyObstructionPurpose(t)&&"string"==typeof i?(this.adSession.adFriendlyObstructionViews.push({view:e,purpose:t,reason:i}),null===(n=this.handler)||void 0===n||null===(r=n.omSessionHandler)||void 0===r||null===(a=r.omAdSession)||void 0===a||a.registerAdFriendlyObstructionView(e,t,i)):P.e(pt,"Ad friendly objection view not registered, please check arguments types: purpose -> state within the AdFriendlyObstructionPurpose enum, reason -> string",this.id)}},{key:"unregisterFriendlyObstruction",value:function(e){var t,i,n;void 0!==this.adSession&&(this.adSession.adFriendlyObstructionViews=this.adSession.adFriendlyObstructionViews.filter((function(t){return t.view!==e})),null===(t=this.handler)||void 0===t||null===(i=t.omSessionHandler)||void 0===i||null===(n=i.omAdSession)||void 0===n||n.unregisterFriendlyObstruction(e))}},{key:"unregisterAllFriendlyObstructions",value:function(){var e,t,i;void 0!==this.adSession&&(this.adSession.adFriendlyObstructionViews=[],null===(e=this.handler)||void 0===e||null===(t=e.omSessionHandler)||void 0===t||null===(i=t.omAdSession)||void 0===i||i.unregisterAllFriendlyObstructions())}},{key:"setAdCustomReference",value:function(e){var t,i;void 0===this.adSession&&(this.adSession=new se(this.smartLib)),"string"==typeof e?(this.adSession.adCustomReference=e,void 0!==(null===(t=this.handler)||void 0===t||null===(i=t.omSessionHandler)||void 0===i?void 0:i.omAdSession)&&P.w(pt,'An ad is already playing, the ad custom reference "'+e+'" will be set for the next ad',this.id)):P.e(pt,"Ad custom reference not set, reference argument has to be a string",this.id)}},{key:"registerAdVerificationData",value:function(e){var t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;void 0===this.adSession&&(this.adSession=new se(this.smartLib));var a={verificationVendor:n,verificationURL:e,verificationParameters:r};this.adSession.adVerificationData.push(a),void 0!==(null===(t=this.handler)||void 0===t||null===(i=t.omSessionHandler)||void 0===i?void 0:i.omAdSession)&&P.w(pt,'An ad is already playing, the ad verification data "'+JSON.stringify(a)+'" will be set for the next ad',this.id)}},{key:"adUserInteraction",value:function(e){var t,i,n,r,a;void 0===this.adSession&&(this.adSession=new se(this.smartLib)),"string"==typeof e?(P.d(pt,"Ad interaction: "+e,this.id),null===(t=this.handler)||void 0===t||null===(i=t.adTrackingManager)||void 0===i||i.adUserInteraction(e),null===(n=this.adSession.adPalSession)||void 0===n||n.sendAdClick(),void 0!==(null===(r=this.handler)||void 0===r||null===(a=r.omSessionHandler)||void 0===a?void 0:a.omAdSession)&&this.handler.omSessionHandler.omAdSession.adUserInteraction(e)):P.e(pt,"Ad interaction type not triggered, interactionType argument has to be a string",this.id)}},{key:"adTouch",value:function(e){var t;void 0===this.adSession&&(this.adSession=new se(this.smartLib)),P.d(pt,"Ad touch",this.id),null===(t=this.adSession.adPalSession)||void 0===t||t.sendTouch(e)}},{key:"setCustomParameter",value:function(e,t){"string"==typeof e&&"string"==typeof t?this.customParameters[e]=Ne.toBkAString(t):P.e(pt,"Error: Only string values are accepted for custom parameters",this.id)}},{key:"setEventCallbackEnabled",value:function(e){void 0===this.adSession&&(this.adSession=new se(this.smartLib)),this.adSession.setEventCallbackEnabled(e)}},{key:"getURL",value:function(e){return P.i(pt,"getURL with "+e,this.id),void 0===this.handler?Ne.typeParameter(e,"string","Error: requestedURL should be a string")&&Ne.stringNonEmpty(e,"Error: requestedURL is empty")?(this.handler=this.smartLib.sessionManager.createSessionHandler(this),this.handler.adSession=this.adSession,void 0!==this.adSession&&(this.adSession.session=this.handler),this.handler.start(e)):Promise.resolve(ht.error(ht.RESULT_API_PARAMETER_FORMAT_ERROR)):(P.e(pt,"Exception: getURL error, the session is already running.",this.id),Promise.resolve(ht.error(ht.RESULT_REQUEST_ALREADY_DONE)))}},{key:"getQuery",value:function(){return P.i(pt,"getQuery",this.id),void 0===this.handler?(this.handler=this.smartLib.sessionManager.createProxySessionHandler(this),this.handler.getQuery()):(P.e(pt,"Exception: getQuery error, the session is already running.",this.id),"")}},{key:"startStreamingSession",value:function(e,t){return P.i(pt,"startStreamingSession with "+e+" and "+t,this.id),!(!Ne.typeParameter(e,"string","Error: requestedURL should be a string")||!Ne.typeParameter(t,"string","Error: redirectedURL should be a string")||(void 0===this.handler?(P.e(pt,"Exception: startSteamingSession error, getQuery() should be called prior to startStreamingSession(...)"),1):this.handler instanceof ut?(this.handler.start(e,t),0):(P.e(pt,"Exception: startSteamingSession error, startStreamingSession(...) cannot be called once getURL(...) has been called"),1)))}},{key:"stopStreamingSession",value:function(e){return void 0!==e?P.i(pt,"Stopping streaming session with statusCode "+e+"...",this.id):P.i(pt,"Stopping streaming session...",this.id),void 0!==this.handler&&this.handler.stop(e),void 0!==this.playerAdapter&&this.playerAdapter.detachPlayer(),this.stopped=!0,this.handler}}])&&ft(t.prototype,i),e}();function gt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Et(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var St="BpkSessionMgr",bt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Et(this,"smartLib",void 0),Et(this,"sessions",void 0)}var t,i;return t=e,(i=[{key:"init",value:function(e){this.smartLib=e,this.sessions=[]}},{key:"createStreamingSession",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.cleanFinishedSessions();var i=new yt(this.smartLib,Ke.create(e,t));return this.sessions.push(i),this.sessions.length>10&&P.w(St,"There are "+this.sessions.length+" active sessions. Use session.stopStreamingSession() to free up memory."),i}},{key:"cleanFinishedSessions",value:function(){for(var t=this.sessions.length-1;t>=0;t--){var i,n,r=this.sessions[t];void 0===r.handler&&Date.now()-r.date>e.UNSTARTED_SESSION_MAX_DURATION?(null===(n=r.playerAdapter)||void 0===n||n.detachPlayer(),this.sessions.splice(t,1)):(!0===(null===(i=r.handler)||void 0===i?void 0:i.stopped)||!0===r.stopped)&&this.sessions.splice(t,1)}}},{key:"createSessionHandler",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=new Ze(this.smartLib,e);return void 0!==e?(t.id=e.id,t.options=e.options,t.playerAdapter=e.playerAdapter):(t.id="main-"+I.randomIntFromInterval(10,99),t.options=new Ke),t}},{key:"createProxySessionHandler",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=new ut(this.smartLib,e);return void 0!==e?(t.id=e.id,t.options=e.options,t.playerAdapter=e.playerAdapter):(t.id="main-"+I.randomIntFromInterval(10,99),t.options=new Ke),t}},{key:"release",value:function(){this.cleanFinishedSessions(),this.sessions.forEach((function(e){e.stopStreamingSession()})),this.sessions=[]}}])&&gt(t.prototype,i),e}();function kt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function mt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _t(e,t,i){return Nt(e,t),At(i,"get"),function(e,t){return t.get?t.get.call(e):t.value}(e,i)}function At(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Nt(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}Et(bt,"UNSTARTED_SESSION_MAX_DURATION",36e4);var Rt="BpkAppStateMgr",Dt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),mt(this,"smartLib",void 0),mt(this,"listeners",void 0),mt(this,"bound",void 0),mt(this,"networkAvailable",void 0),mt(this,"appInBackground",void 0),mt(this,"networkType",99),mt(this,"mute",0),this.bound=!1,this.release()}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){return _t(e,e,Pt)||function(e,t,i,n){Nt(e,t),At(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n)}(e,e,Pt,new e),_t(e,e,Pt)}}],(i=[{key:"init",value:function(e){P.d(Rt,"Initializing core app state manager..."),this.smartLib=e,!1===this.bound?(this.networkAvailable=!0,this.appInBackground=!1):P.d(Rt,"Core app state manager is bound to the target, skipping default values..."),this.release()}},{key:"release",value:function(){this.listeners=[]}},{key:"bind",value:function(){this.bound=!0}},{key:"isConnectedToWifi",value:function(){return this.networkType>=10&&this.networkType<=12}},{key:"addListener",value:function(e){void 0===e||this.listeners.includes(e)||this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}},{key:"notifyEvent",value:function(e,t,i,n){"function"==typeof e[t]&&e[t](i,n)}},{key:"notifyForeground",value:function(){var e=this;P.d(Rt,"App is in foreground"),this.appInBackground=!1,this.listeners.forEach((function(t){e.notifyEvent(t,"onForeground")}))}},{key:"notifyBackground",value:function(){var e=this;P.d(Rt,"App is in background"),this.appInBackground=!0,this.listeners.forEach((function(t){e.notifyEvent(t,"onBackground")}))}},{key:"notifyNetworkAvailable",value:function(e){var t=this;void 0===e?(P.d(Rt,"Network is available (networkType:"+e+")"),this.networkAvailable=!0,this.listeners.forEach((function(e){t.notifyEvent(e,"onNetworkAvailable",99)}))):this.networkType!==e&&(P.d(Rt,"Network is available (networkType:"+e+")"),this.networkAvailable=!0,this.networkType=e,this.listeners.forEach((function(i){t.notifyEvent(i,"onNetworkAvailable",e)})))}},{key:"notifyNetworkLost",value:function(){var e=this;!1!==this.networkAvailable&&(P.d(Rt,"Network is unavailable"),this.networkAvailable=!1,this.networkType=0,this.listeners.forEach((function(t){e.notifyEvent(t,"onNetworkLost")})))}},{key:"notifyMute",value:function(){var e=this;P.d(Rt,"Volume is muted"),this.mute=1,this.listeners.forEach((function(t){e.notifyEvent(t,"onMute")}))}},{key:"notifyUnmute",value:function(){var e=this;P.d(Rt,"Volume is unmuted"),this.mute=0,this.listeners.forEach((function(t){e.notifyEvent(t,"onUnmute")}))}}])&&kt(t.prototype,i),n&&kt(t,n),e}(),Pt={writable:!0,value:void 0};function Tt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ot(e,t){return jt(e,Ct(e,t,"get"))}function Lt(e,t,i){return It(e,Ct(e,t,"set"),i),i}function Ct(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function It(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function Mt(e,t,i){return Ut(e,t),Bt(i,"get"),jt(e,i)}function Bt(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Ut(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function jt(e,t){return t.get?t.get.call(e):t.value}var Ft="BpkSmartLib",xt=new WeakMap,Vt=new WeakMap,Gt=new WeakMap,Ht=new WeakMap,Wt=new WeakMap,qt=new WeakMap,Yt=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),xt.set(this,{writable:!0,value:void 0}),Vt.set(this,{writable:!0,value:void 0}),Gt.set(this,{writable:!0,value:void 0}),wt(this,"sessionManager",void 0),wt(this,"nanoCDNHostManager",void 0),wt(this,"adManager",void 0),wt(this,"internalAdManager",void 0),wt(this,"session",void 0),wt(this,"nanoCDNReceiver",void 0),Ht.set(this,{writable:!0,value:function(e){null!=e&&0!==e.length?Ot(t,Vt).analyticsAddress=e:Ot(t,Vt).analyticsAddress=""}}),Wt.set(this,{writable:!0,value:function(i){null!=i&&0!==i.length?(void 0===e.nanoCDNModule&&P.w(Ft,"Warning: nanoCDNHost is set while the module is not loaded."),Ot(t,Vt).nanoCDNHost=i.replace(/\s/g,"")):Ot(t,Vt).nanoCDNHost=""}}),qt.set(this,{writable:!0,value:function(e){null!=e&&0!==e.length?Ot(t,Vt).broadpeakDomainNames=e.replace(/\s/g,""):Ot(t,Vt).broadpeakDomainNames=""}}),Lt(this,xt,!1),Lt(this,Vt,{analyticsAddress:"",nanoCDNHost:"",broadpeakDomainNames:"",forceTeardown:e.FORCE_TEARDOWN_DEFAULT,uuid:"",userAgent:void 0,deviceType:"",customParameters:{}}),Lt(this,Gt,new Ke),this.sessionManager=new bt,this.adManager=new ie,this.internalAdManager=new ce}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){var t,i,n,r;return Mt(e,e,Kt)||(t=e,i=e,n=Kt,r=new e,Ut(t,i),Bt(n,"set"),It(t,n,r)),Mt(e,e,Kt)}}],(i=[{key:"init",value:function(t,i,n,r){var a,s,o,u,l;return P.i(Ft,"Init SmartLib..."),P.i(Ft,"Version: "+L),Ot(this,xt)?(P.e(Ft,"Error: SmartLib already initialized, please use SmartLib.release() before initializing."),!1):void 0!==r?(P.e(Ft,"Error: this init method has been removed, please use SmartLib.init(analyticsAddress, nanoCDNHost, broadpeakDomainNames) instead."),!1):Ne.typeOrNullParameter(t,"string","Error: analyticsAddress should be a string or null")&&Ne.typeOrNullParameter(i,"string","Error: nanoCDNHost should be a string or null")&&Ne.typeOrNullParameter(n,"string","Error: broadpeakDomainNames should be a string or null")?(Ot(this,Ht).call(this,t),Ot(this,Wt).call(this,i),Ot(this,qt).call(this,n),this.setForceTeardown(e.FORCE_TEARDOWN_DEFAULT),Lt(this,Gt,new Ke),P.i(Ft,"Parameters:analyticsAddress="+t+", nanoCDNHost="+i+", broadpeakDomainNames="+n),void 0!==e.nanoCDNModule&&void 0===this.nanoCDNHostManager&&(this.nanoCDNHostManager=new e.nanoCDNModule.NanoCDNHostManager),void 0!==this.nanoCDNReceiver&&void 0!==this.nanoCDNHostManager&&(this.nanoCDNHostManager.registerNanoCDNReceiver(this.nanoCDNReceiver),this.nanoCDNReceiver=void 0),this.sessionManager.init(this),null===(a=this.nanoCDNHostManager)||void 0===a||a.init(this,i),this.adManager.init(this),this.internalAdManager.init(this),be.getInstance().attachInstance(this),null===(s=e.analyticsModule)||void 0===s||s.PlayerManager.getInstance().attachInstance(this),null===(o=e.nanoCDNModule)||void 0===o||o.MdnsManager.getInstance().attachInstance(this),null===(u=e.diversityModule)||void 0===u||u.DiversityManager.getInstance().attachInstance(this),null===(l=e.adModule)||void 0===l||l.OMSDKManager.getInstance().attachInstance(this),Dt.getInstance().init(this),Dt.getInstance().addListener(this.nanoCDNHostManager),Lt(this,xt,!0),!0):(P.e(Ft,"Error: initialization aborted"),!1)}},{key:"getURL",value:function(t,i){var n,r,a;return void 0!==this.session&&(P.e(Ft,"Exception: A session is already running, please use SmartLib.stopStreamingSession(...) before. Stopping the current one...",this.session.id),this.stopStreamingSession()),P.i(Ft,"getURL with "+t,null===(n=this.session)||void 0===n?void 0:n.id),void 0===i&&(i=function(){}),Ne.typeParameter(i,"function","Error: callback should be a function")?Ot(this,xt)?Ne.typeParameter(t,"string","Error: requestedURL should be a string")&&Ne.stringNonEmpty(t,"Error: requestedURL is empty")?(this.session=this.sessionManager.createSessionHandler(),this.session.options=Ke.create(Ot(this,Gt)),this.session.playerAdapter=null===(r=e.analyticsModule)||void 0===r?void 0:r.PlayerManager.getInstance().getPlayerAdapter(),this.session.adSession=this.internalAdManager.adSession,void 0!==this.internalAdManager.adSession&&(this.internalAdManager.adSession.session=this.session),this.internalAdManager.adSession=new se,this.internalAdManager.adSession.setEventCallbackEnabled(this.internalAdManager.eventCallbackEnabled),this.internalAdManager.adSession.setAdEventsListener(this.internalAdManager.adEventsListener),this.session.start(t,i)):(i(""),Promise.resolve("")):(P.e(Ft,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.getURL(...)",null===(a=this.session)||void 0===a?void 0:a.id),i(""),Promise.resolve("")):Promise.resolve("")}},{key:"getQuery",value:function(){var t;return void 0!==this.session&&(P.e(Ft,"Exception: A session is already running, please use SmartLib.stopStreamingSession(...) before. Stopping the current one..."),this.stopStreamingSession()),P.i(Ft,"getQuery"),Ot(this,xt)?(this.session=this.sessionManager.createProxySessionHandler(),this.session.options=Ke.create(Ot(this,Gt)),this.session.playerAdapter=null===(t=e.analyticsModule)||void 0===t?void 0:t.PlayerManager.getInstance().getPlayerAdapter(),this.session.getQuery()):(P.e(Ft,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.getQuery(...)"),"")}},{key:"startStreamingSession",value:function(e,t){var i,n,r,a;return P.i(Ft,"startStreamingSession with "+e+" and "+t,null===(i=this.session)||void 0===i?void 0:i.id),Ot(this,xt)?!(!Ne.typeParameter(e,"string","Error: contentURL should be a string")||!Ne.typeParameter(t,"string","Error: redirectedURL should be a string")||(void 0===this.session?(P.e(Ft,"Exception: Implementation error, SmartLib.getQuery() should be called prior to SmartLib.startStreamingSession(...)",null===(r=this.session)||void 0===r?void 0:r.id),1):this.session instanceof ut?(this.session.start(e,t),0):(P.e(Ft,"Exception: Implementation error, SmartLib.startStreamingSession(...) cannot be called with SmartLib.getURL(...)",null===(a=this.session)||void 0===a?void 0:a.id),1))):(P.e(Ft,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.startStreamingSession(...)",null===(n=this.session)||void 0===n?void 0:n.id),!1)}},{key:"stopStreamingSession",value:function(e){var t,i;void 0!==e?P.i(Ft,"Stopping streaming session with statusCode "+e+"...",null===(t=this.session)||void 0===t?void 0:t.id):P.i(Ft,"Stopping streaming session...",null===(i=this.session)||void 0===i?void 0:i.id);var n=this.session;return void 0!==this.session?(this.session.stop(e),this.session=void 0):P.d(Ft,"Stopping streaming session aborted, no session started"),n}},{key:"createStreamingSession",value:function(e){if(Ot(this,xt)){var t=void 0===e;t&&(e=Ot(this,Gt));var i=this.sessionManager.createStreamingSession(Ot(this,Gt),e);return t?P.i(Ft,"Creating streaming session...",i.id):(P.i(Ft,"Creating streaming session with options...",i.id),e.printUpdates(Ft,"",i.id)),i}P.e(Ft,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.createStreamingSession(...)")}},{key:"release",value:function(){var t,i,n,r,a;Ot(this,xt)&&(P.i(Ft,"Releasing SmartLib..."),this.stopStreamingSession(),this.internalAdManager.release(),this.adManager.release(),null===(t=this.nanoCDNHostManager)||void 0===t||t.release(),this.sessionManager.release(),Dt.getInstance().release(),null===(i=e.diversityModule)||void 0===i||i.DiversityManager.getInstance().release(),null===(n=e.nanoCDNModule)||void 0===n||n.MdnsManager.getInstance().release(),null===(r=e.analyticsModule)||void 0===r||r.PlayerManager.getInstance().release(),be.getInstance().release(),null===(a=e.adModule)||void 0===a||a.OMSDKManager.getInstance().release(this),Lt(this,xt,!1))}},{key:"attachPlayer",value:function(t,i){var n,r,a;void 0!==t?(null===(n=e.analyticsModule)||void 0===n||n.PlayerManager.getInstance().setPlayerAdapter(t),void 0!==this.session&&P.e(Ft,"Exception: You cannot attach a player when a session is running, this player will be used for the next session.",this.session.id)):void 0===e.analyticsModule?P.w(Ft,"Try to attach a player, but analytics module not loaded",null===(r=this.session)||void 0===r?void 0:r.id):P.w(Ft,"Try to attach a player, but it is not recognized",null===(a=this.session)||void 0===a?void 0:a.id)}},{key:"detachPlayer",value:function(){var t;return void 0!==this.session?(P.e(Ft,"Exception: You cannot detach the player when a session is running",this.session.id),!1):(null===(t=e.analyticsModule)||void 0===t||t.PlayerManager.getInstance().setPlayerAdapter(void 0),!0)}},{key:"getMetricsManager",value:function(){if(void 0!==this.session)return this.session.metricsManager}},{key:"getListener",value:function(){var t;return null===(t=e.analyticsModule)||void 0===t?void 0:t.PlayerManager.getInstance().getPlayerAdapter()}},{key:"getVersion",value:function(){return L}},{key:"getParameters",value:function(){return Ot(this,Vt)}},{key:"setUUID",value:function(e){Ne.typeParameter(e,"string","Error: uuid should be a string")&&(e.length>32?Ot(this,Vt).uuid=e.substring(0,32):Ot(this,Vt).uuid=e)}},{key:"setUserAgent",value:function(e){Ne.typeOrUndefinedParameter(e,"string","Error: userAgent should be a string")&&(Ot(this,Vt).userAgent=e)}},{key:"setDeviceType",value:function(e){Ne.typeParameter(e,"string","Error: deviceType should be a string")&&(Ot(this,Vt).deviceType=e)}},{key:"setCustomParameter",value:function(e,t){"string"==typeof e&&"string"==typeof t?Ot(this,Vt).customParameters[e]=Ne.toBkAString(t):P.e(Ft,"Error: Only string values are accepted for custom parameters")}},{key:"resetCustomParameters",value:function(){Ot(this,Vt).customParameters={}}},{key:"setForceTeardown",value:function(t){"number"==typeof t?Ot(this,Vt).forceTeardown=t>=1?e.FORCE_TEARDOWN_ENABLED:t<=-1?e.FORCE_TEARDOWN_DISABLED:e.FORCE_TEARDOWN_DEFAULT:P.e(Ft,"Exception: parameter forceTeardown must be SmartLib.FORCE_TEARDOWN_DISABLED, SmartLib.FORCE_TEARDOWN_DEFAULT or SmartLib.FORCE_TEARDOWN_ENABLED")}},{key:"setNanoCDNResolvingRetryDelay",value:function(e){var t;void 0!==this.nanoCDNHostManager?(P.v(Ft,"Updating nanoCDN resolving retry asyncDelay to "+e+"ms"),null===(t=this.nanoCDNHostManager)||void 0===t||t.setNanoCDNResolvingRetryDelay(e)):P.e(Ft,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.setNanoCDNResolvingRetryDelay(...)")}},{key:"registerNanoCDNReceiver",value:function(e){void 0!==this.nanoCDNHostManager?(this.nanoCDNReceiver=void 0,this.nanoCDNHostManager.registerNanoCDNReceiver(e)):this.nanoCDNReceiver=e}},{key:"setOption",value:function(e,t){P.d(Ft,"Setting global option "+Ke.optionToString(e)+" to "+Ke.valueToString(e,t)),Ot(this,Gt).set(e,t)}}])&&Tt(t.prototype,i),n&&Tt(t,n),e}(),Kt={writable:!0,value:void 0};function Qt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}wt(Yt,"FORCE_TEARDOWN_DISABLED",-1),wt(Yt,"FORCE_TEARDOWN_DEFAULT",0),wt(Yt,"FORCE_TEARDOWN_ENABLED",1),wt(Yt,"BPSessionEndsNormally",200),wt(Yt,"BPFormatNotSupportedError",3001),wt(Yt,"BPDecodingError",3002),wt(Yt,"BPNetworkingError",3003),wt(Yt,"BPAccessRightError",3004),wt(Yt,"BPUnspecifiedError",3005),wt(Yt,"analyticsModule",void 0),wt(Yt,"adModule",void 0),wt(Yt,"nanoCDNModule",void 0),wt(Yt,"diversityModule",void 0);var zt="BpkAdPalMgr",Jt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"setConsentSettings",value:function(e){P.e(zt,"setConsentSettings not implemented")}},{key:"registerPalManagerCallback",value:function(e){P.e(zt,"registerPalManagerCallback not implemented")}},{key:"unregisterPalManagerCallback",value:function(){P.e(zt,"unregisterPalManagerCallback not implemented")}},{key:"generateAdPalSession",value:function(e){P.e(zt,"generateAdPalSession not implemented")}},{key:"reset",value:function(){P.e(zt,"reset not implemented")}},{key:"release",value:function(){}},{key:"setValue",value:function(e,t,i){P.e(zt,"setValue not implemented")}},{key:"setDescriptionURL",value:function(e){this.setValue("setDescriptionURL",e)}},{key:"setOmidPartner",value:function(e,t){this.setValue("setOmidPartner",e,t)}},{key:"setOmidVersion",value:function(e){this.setValue("setOmidVersion",e)}},{key:"setPlayerType",value:function(e){this.setValue("setPlayerType",e)}},{key:"setPlayerVersion",value:function(e){this.setValue("setPlayerVersion",e)}},{key:"setPpid",value:function(e){this.setValue("setPpid",e)}},{key:"setVideoPlayerHeight",value:function(e){this.setValue("setVideoPlayerHeight",e)}},{key:"setVideoPlayerWidth",value:function(e){this.setValue("setVideoPlayerWidth",e)}},{key:"setWillAdAutoPlay",value:function(e){this.setValue("setWillAdAutoPlay",e)}},{key:"setWillAdPlayMuted",value:function(e){this.setValue("setWillAdPlayMuted",e)}}])&&Qt(t.prototype,i),e}();function Xt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Zt="BpkAdPalSession",$t=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"getNonce",value:function(){return P.e(Zt,"getNonce not implemented"),""}},{key:"sendAdClick",value:function(){P.e(Zt,"sendAdClick not implemented")}},{key:"sendAdImpression",value:function(){P.e(Zt,"sendAdImpression not implemented")}},{key:"sendTouch",value:function(e){P.e(Zt,"sendTouch not implemented")}},{key:"setAdView",value:function(e){}}])&&Xt(t.prototype,i),e}();function ei(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ti=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"formatDate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t="";e<0&&(e*=-1,t="-");var i=e.getDate()<=9?"0"+e.getDate():e.getDate(),n=e.getMonth()+1<=9?"0"+(e.getMonth()+1):e.getMonth()+1,r=e.getHours()<=9?"0"+e.getHours():e.getHours(),a=e.getMinutes()<=9?"0"+e.getMinutes():e.getMinutes(),s=e.getSeconds()<=9?"0"+e.getSeconds():e.getSeconds(),o=String(e.getMilliseconds());return 1===o.length?o="00"+o:2===o.length&&(o="0"+o),t+n+"-"+i+" "+r+":"+a+":"+s+"."+o}},{key:"formatTime",value:function(e){var t="";e<0&&(e*=-1,t="-");var i=e%1e3,n=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),a=Math.floor(e/36e5%24),s=a<=9?"0"+a:a,o=r<=9?"0"+r:r,u=n<=9?"0"+n:n,l=String(i);return 1===l.length?l="00"+l:2===l.length&&(l="0"+l),t+s+":"+o+":"+u+"."+l}}])&&ei(t,i),e}();function ii(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ni=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"log",value:function(e,t,i){var n=ti.formatDate();switch(e){case 0:console.log(n+" V/"+t+": "+i);break;case 1:console.log(n+" D/"+t+": "+i);break;case 2:console.log(n+" I/"+t+": "+i);break;case 3:console.log(n+" W/"+t+": "+i);break;case 4:console.log(n+" E/"+t+": "+i);break;default:console.log(n+" ?/"+t+": "+i)}}}])&&ii(t.prototype,i),e}();function ri(e){return(ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ai(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var si=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"get",value:function(e,t,i,n){var r=new XMLHttpRequest,a=!1,s={};for(var o in r.onreadystatechange=function(){r.readyState===r.DONE&&(r.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((function(e){var t=e.split(": "),i=t.shift().toLowerCase();s[i]=t.join(": ")})),r.status>=200&&r.status<300?n({body:r.responseText,headers:s,statusCode:r.status,message:r.statusText}):0!==r.status&&n({body:"",headers:s,statusCode:r.status,message:r.statusText}))},r.onerror=function(){a||n({body:"",headers:s,statusCode:r.status,message:r.statusText})},r.ontimeout=function(){n({body:"",headers:s,statusCode:r.status,message:r.statusText})},r.open("GET",e,!0),r.timeout=i,this.deleteUnsafeHeaders(t),t)r.setRequestHeader(o,t[o]);r.send(),setTimeout((function(){r.readyState!==r.DONE&&(a=!0,r.abort(),n({body:"",headers:s,statusCode:r.status,message:r.statusText}))}),i+100)}},{key:"post",value:function(e,t,i,n,r){var a=new XMLHttpRequest,s=!1,o={};for(var u in a.onreadystatechange=function(){a.readyState===a.DONE&&(a.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((function(e){var t=e.split(": "),i=t.shift().toLowerCase();o[i]=t.join(": ")})),a.status>=200&&a.status<300?r({body:a.responseText,headers:o,statusCode:a.status,message:a.statusText}):0!==a.status&&r({body:"",headers:o,statusCode:a.status,message:a.statusText}))},a.onerror=function(){s||r({body:"",headers:o,statusCode:a.status,message:a.statusText})},a.ontimeout=function(){r({body:"",headers:o,statusCode:a.status,message:a.statusText})},a.open("POST",e,!0),a.timeout=n,this.deleteUnsafeHeaders(t),t)a.setRequestHeader(u,t[u]);a.send(i),setTimeout((function(){a.readyState!==a.DONE&&(s=!0,a.abort(),r({body:"",headers:o,statusCode:a.status,message:a.statusText}))}),n+100)}},{key:"deleteUnsafeHeaders",value:function(e){"object"!==("undefined"==typeof window?"undefined":ri(window))&&"function"!=typeof XMLHttpRequest||(delete e["User-Agent"],delete e["Accept-Charset"],delete e["Accept-Encoding"],delete e["Access-Control-Request-Headers"],delete e["Access-Control-Request-Method"],delete e.Connection,delete e["Content-Length"],delete e.Cookie,delete e.Cookie2,delete e.Date,delete e.DNT,delete e.Expect,delete e.Host,delete e["Keep-Alive"],delete e.Origin,delete e.Referer,delete e.TE,delete e.Trailer,delete e["Transfer-Encoding"],delete e.Upgrade,delete e.Via)}}])&&ai(t.prototype,i),e}(),oi=__webpack_require__(665);function ui(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function li(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ci=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),li(this,"initialized",void 0),li(this,"listeners",void 0)}var t,i;return t=e,(i=[{key:"init",value:function(){P.d("BpkBrowserAppStateMgr","Initializing browser app state manager..."),this.initialized||(Dt.getInstance().bind(),this.listeners={},this.registerNetworkObserver(),this.initialized=!0)}},{key:"release",value:function(){this.initialized&&(this.unregisterNetworkObserver(),this.initialized=!1)}},{key:"registerNetworkObserver",value:function(){this.listeners[0]=this.onNetworkOnline.bind(this),this.listeners[1]=this.onNetworkOffline.bind(this),"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.onLine&&(!0===window.navigator.onLine?Dt.getInstance().notifyNetworkAvailable(1):Dt.getInstance().notifyNetworkLost()),window.addEventListener("online",this.listeners[0]),window.addEventListener("offline",this.listeners[1])}},{key:"unregisterNetworkObserver",value:function(){window.removeEventListener("online",this.listeners[0]),window.removeEventListener("offline",this.listeners[1]),this.listeners[0]=void 0,this.listeners[1]=void 0}},{key:"onNetworkOnline",value:function(){Dt.getInstance().notifyNetworkAvailable(1)}},{key:"onNetworkOffline",value:function(){Dt.getInstance().notifyNetworkLost()}},{key:"registerLifecycleEvents",value:function(){this.listeners[2]=this.onMoveToForeground.bind(this),this.listeners[3]=this.onMoveToBackground.bind(this),window.addEventListener("focus",this.listeners[2]),window.addEventListener("blur",this.listeners[3])}},{key:"unregisterLifecycleEvents",value:function(){window.removeEventListener("focus",this.listeners[2]),window.removeEventListener("blur",this.listeners[3]),this.listeners[2]=void 0,this.listeners[3]=void 0}},{key:"onMoveToForeground",value:function(){Dt.getInstance().notifyForeground()}},{key:"onMoveToBackground",value:function(){Dt.getInstance().notifyBackground()}}])&&ui(t.prototype,i),e}();function di(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function hi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var fi="BpkWebOSAppStateMgr",vi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),hi(this,"initialized",void 0),hi(this,"subscriptionHandle",void 0),hi(this,"webOSVersion",void 0)}var t,i;return t=e,(i=[{key:"init",value:function(){var e=this;P.d(fi,"Initializing webOS app state manager..."),this.initialized||(this.webOSVersion="",webOS.deviceInfo((function(t){e.webOSVersion=t.sdkVersion,e.registerNetworkObserver()})),Dt.getInstance().bind(),this.initialized=!0)}},{key:"release",value:function(){this.initialized&&(this.unregisterNetworkObserver(),this.initialized=!1)}},{key:"updateNetworkState",value:function(e){var t,i,n="yes"===(null===(t=e.wifi)||void 0===t?void 0:t.onInternet);1==("yes"===(null===(i=e.wired)||void 0===i?void 0:i.onInternet))?Dt.getInstance().notifyNetworkAvailable(30):!0===n?Dt.getInstance().notifyNetworkAvailable(10):Dt.getInstance().notifyNetworkLost()}},{key:"registerNetworkObserver",value:function(){var e=this.webOSVersion.startsWith("3")?"luna://com.webos.service.connectionmanager":"luna://com.palm.connectionmanager",t=this;webOS.service.request(e,{method:"getStatus",onSuccess:function(e){t.updateNetworkState(e)},onFailure:function(e){P.e(fi,"Failed to get network state"),P.e(fi,"["+e.errorCode+"]: "+e.errorText)}}),this.subscriptionHandle=webOS.service.request(e,{method:"getStatus",parameters:{subscribe:!0},onSuccess:function(e){void 0===e.subscribed||e.subscribed?t.updateNetworkState(e):P.e(fi,"Failed to subscribe network state")},onFailure:function(e){P.e(fi,"Failed to get network state"),P.e(fi,"["+e.errorCode+"]: "+e.errorText)}})}},{key:"unregisterNetworkObserver",value:function(){void 0!==this.subscriptionHandle&&(this.subscriptionHandle.cancel(),this.subscriptionHandle=void 0)}}])&&di(t.prototype,i),e}();function pi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function yi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var gi="BpkTizenAppStateMgr",Ei=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),yi(this,"initialized",void 0),yi(this,"networkInitializer",void 0),yi(this,"networkInitializerNumber",void 0),yi(this,"listeners",void 0)}var t,i;return t=e,(i=[{key:"init",value:function(){P.d(gi,"Initializing tizen app state manager..."),this.initialized||(Dt.getInstance().bind(),this.listeners={},this.startNetworkInitializer(),this.initialized=!0)}},{key:"release",value:function(){this.initialized&&(this.unregisterNetworkObserver(),this.initialized=!1)}},{key:"onNetworkChange",value:function(e){var t=null;try{t=webapis.network.getActiveConnectionType()}catch(e){P.e(gi,"getActiveConnectionType exception ["+e.code+"] message: "+e.message)}if(null!=t){switch(t){case webapis.network.NetworkActiveConnectionType.DISCONNECTED:Dt.getInstance().notifyNetworkLost();break;case webapis.network.NetworkActiveConnectionType.WIFI:Dt.getInstance().notifyNetworkAvailable(10);break;case webapis.network.NetworkActiveConnectionType.ETHERNET:Dt.getInstance().notifyNetworkAvailable(30)}P.d(gi,"Active connection type: "+t)}}},{key:"startNetworkInitializer",value:function(){var e=this;void 0!==this.networkInitializer&&clearInterval(this.networkInitializer),this.networkInitializerNumber=0,this.networkInitializer=setInterval((function(){void 0!==webapis.network?(P.d(gi,"Network API is now available"),clearInterval(e.networkInitializer),e.networkInitializer=void 0,e.registerNetworkObserver()):e.networkInitializerNumber>30?(P.e(gi,"The webapis.js script is required in order to get the network type."),clearInterval(e.networkInitializer),e.networkInitializer=void 0):e.networkInitializerNumber++}),100)}},{key:"registerNetworkObserver",value:function(){void 0===webapis.network&&P.e(gi,"The webapis.js script is required in order to get the network type."),this.onNetworkChange(void 0);try{this.listeners[0]=webapis.network.addNetworkStateChangeListener(this.onNetworkChange)}catch(e){P.e(gi,"addNetworkStateChangeListener exception ["+e.code+"] name: "+e.name+" message: "+e.message)}}},{key:"unregisterNetworkObserver",value:function(){try{webapis.network.removeNetworkStateChangeListener(this.listeners[0])}catch(e){P.e(gi,"removeNetworkStateChangeListener exception ["+e.code+"] name: "+e.name+" message: "+e.message)}this.listeners[0]=void 0}}])&&pi(t.prototype,i),e}();function Si(e){return(Si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ki(e,t){return(ki=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mi(e,t){return!t||"object"!==Si(t)&&"function"!=typeof t?_i(e):t}function _i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ai(e){return(Ai=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ni=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ki(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ai(e);if(t){var r=Ai(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return mi(this,i)}}(r);function r(e){var t,i,a,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),s=void 0,(a="nonceManager")in(i=_i(t=n.call(this)))?Object.defineProperty(i,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[a]=s,t.nonceManager=e,t}return t=r,(i=[{key:"getNonce",value:function(){return this.nonceManager.getNonce()}},{key:"sendAdClick",value:function(){this.nonceManager.sendAdClick()}},{key:"sendAdImpression",value:function(){this.nonceManager.sendAdImpression()}}])&&bi(t.prototype,i),r}($t);function Ri(e){return(Ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Di(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pi(e,t){return(Pi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ti(e,t){return!t||"object"!==Ri(t)&&"function"!=typeof t?wi(e):t}function wi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Oi(e){return(Oi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Li(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Ci="BpkBrowserAdPalManager",Ii=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pi(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Oi(e);if(t){var r=Oi(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Ti(this,i)}}(r);function r(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),Li(wi(e=n.call(this)),"palSDK",void 0),Li(wi(e),"consentSettings",void 0),Li(wi(e),"nonceLoader",void 0),Li(wi(e),"descriptionURL",void 0),Li(wi(e),"partnerName",void 0),Li(wi(e),"partnerVersion",void 0),Li(wi(e),"omidVersion",void 0),Li(wi(e),"playerType",void 0),Li(wi(e),"playerVersion",void 0),Li(wi(e),"ppid",void 0),Li(wi(e),"videoPlayerHeight",void 0),Li(wi(e),"videoPlayerWidth",void 0),Li(wi(e),"willAdAutoPlay",void 0),Li(wi(e),"willAdPlayMuted",void 0),e}return t=r,(i=[{key:"loadPALSDK",value:function(){this.palSDK=ie.getInstance().palSDK}},{key:"setConsentSettings",value:function(e){this.loadPALSDK(),void 0!==this.palSDK?(this.consentSettings=e,this.nonceLoader=new this.palSDK.pal.NonceLoader(e)):P.e(Ci,"PAL SDK not attached, please set it through AdManager.getInstance().attachPALSDK(...)")}},{key:"generateAdPalSession",value:function(e){if(void 0===this.nonceLoader||void 0===this.consentSettings)return P.e(Ci,"Cannot generate a nonce, please set a ConsentSettings through AdManager.getInstance().setConsentSettings(...)"),void e(void 0);var t=new this.palSDK.pal.NonceRequest;void 0!==this.descriptionURL&&(t.descriptionUrl=this.descriptionURL),void 0!==this.partnerName&&(t.omidPartnerName=this.partnerName),void 0!==this.partnerVersion&&(t.omidPartnerVersion=this.partnerVersion),void 0!==this.omidVersion&&(t.omidVersion=this.omidVersion),void 0!==this.playerType&&(t.playerType=this.playerType),void 0!==this.playerVersion&&(t.playerVersion=this.playerVersion),void 0!==this.ppid&&(t.ppid=this.ppid),void 0!==this.videoPlayerHeight&&(t.videoHeight=this.videoPlayerHeight),void 0!==this.videoPlayerWidth&&(t.videoWidth=this.videoPlayerWidth),void 0!==this.willAdAutoPlay&&(t.adWillAutoPlay=this.willAdAutoPlay),void 0!==this.willAdPlayMuted&&(t.adWillPlayMuted=this.willAdPlayMuted),this.nonceLoader.loadNonceManager(t).then((function(t){var i=new Ni(t);e(i)})).catch((function(t){P.e(Ci,"Error when generating the nonce"),console.log(t),e(void 0)}))}},{key:"reset",value:function(){}},{key:"release",value:function(){this.consentSettings=void 0,this.nonceLoader=void 0}},{key:"setDescriptionURL",value:function(e){this.descriptionURL=e}},{key:"setOmidPartner",value:function(e,t){this.partnerName=e,this.partnerVersion=t}},{key:"setOmidVersion",value:function(e){this.omidVersion=e}},{key:"setPlayerType",value:function(e){this.playerType=e}},{key:"setPlayerVersion",value:function(e){this.playerVersion=e}},{key:"setPpid",value:function(e){this.ppid=e}},{key:"setVideoPlayerHeight",value:function(e){this.videoPlayerHeight=e}},{key:"setVideoPlayerWidth",value:function(e){this.videoPlayerWidth=e}},{key:"setWillAdAutoPlay",value:function(e){this.willAdAutoPlay=e}},{key:"setWillAdPlayMuted",value:function(e){this.willAdPlayMuted=e}}])&&Di(t.prototype,i),r}(Jt);function Mi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Bi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};function Ui(e){return(Ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ji(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function xi(e,t){return Ki(e,Gi(e,t,"get"))}function Vi(e,t,i){return Hi(e,Gi(e,t,"set"),i),i}function Gi(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function Hi(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function Wi(e,t,i){return Yi(e,t),qi(i,"get"),Ki(e,i)}function qi(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Yi(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function Ki(e,t){return t.get?t.get.call(e):t.value}Mi(Bi,"CLICK","click"),Mi(Bi,"INVITATION_ACCEPTED","invitationAccept");var Qi="BpkCoreEngine",zi=new WeakMap,Ji=new WeakMap,Xi=new WeakMap,Zi=new WeakMap,$i=new WeakMap,en=new WeakMap,tn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),zi.set(this,{writable:!0,value:void 0}),Ji.set(this,{writable:!0,value:void 0}),Xi.set(this,{writable:!0,value:void 0}),Zi.set(this,{writable:!0,value:void 0}),$i.set(this,{writable:!0,value:void 0}),en.set(this,{writable:!0,value:void 0}),Vi(this,zi,!1),Vi(this,Ji,new ni)}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){var t,i,n,r;return Wi(e,e,nn)||(t=e,i=e,n=nn,r=new e,Yi(t,i),qi(n,"set"),Hi(t,n,r)),Wi(e,e,nn)}}],(i=[{key:"init",value:function(){if(!xi(this,zi)){Vi(this,zi,!0);var e=Date.now();this.log(_.VERBOSE,Qi,"Loading engine..."),this.log(_.VERBOSE,Qi,"Version: 3756"),this.registerSystemFunctions(),"object"===("undefined"==typeof window?"undefined":Ui(window))?this.registerSmartLibFunctions(window):(this.registerSmartLibFunctions(),"undefined"==typeof XMLHttpRequest&&(__webpack_require__.g.XMLHttpRequest=(0,oi.A)("xmlhttprequest").XMLHttpRequest)),this.log(_.VERBOSE,Qi,"Took "+(Date.now()-e)+"ms to load")}}},{key:"registerSystemFunctions",value:function(){this.log(_.VERBOSE,Qi,"Registering system functions..."),P.getInstance().init(xi(this,Ji)),be.getInstance().init(new si),Yt.getInstance().internalAdManager.setPalManager(new Ii)}},{key:"registerPlayerAdapters",value:function(){void 0!==e.analyticsModule&&(Vi(this,Xi,new e.analyticsModule.PlayerManagerHandler),"object"===("undefined"==typeof window?"undefined":Ui(window))&&(window.PlayerEventListener=e.analyticsModule.PlayerEventListener,window.GenericPlayerApi=e.analyticsModule.GenericPlayerApi))}},{key:"loadModules",value:function(){"object"===("undefined"==typeof window?"undefined":Ui(window))?(Yt.analyticsModule=this.getBrowserModule("analyticsSmartLibModule","Analytics",Yt.analyticsModule),Yt.adModule=this.getBrowserModule("adSmartLibModule","Ad",Yt.adModule),Yt.nanoCDNModule=this.getBrowserModule("nanocdnSmartLibModule","nanoCDN",Yt.nanoCDNModule),Yt.diversityModule=this.getBrowserModule("diversitySmartLibModule","Diversity",Yt.diversityModule),e.shakaModule=this.getBrowserModule("shakaSmartLibModule","Shaka Player",e.shakaModule),void 0!==e.shakaModule&&(window.ShakaPlayerAdapter=e.shakaModule.ShakaPlayerAdapter),e.dashjsModule=this.getBrowserModule("dashjsSmartLibModule","Dash.js",e.dashjsModule),void 0!==e.dashjsModule&&(window.DashJsPlayerAdapter=e.dashjsModule.DashJsPlayerAdapter),e.html5Module=this.getBrowserModule("html5SmartLibModule","HTML5 player",e.html5Module),e.avplayModule=this.getBrowserModule("avplaySmartLibModule","AVPlay",e.avplayModule),e.diw387Module=this.getBrowserModule("diw387SmartLibModule","Sagemcom",e.diw387Module),e.hbbtv1Module=this.getBrowserModule("hbbtv1SmartLibModule","HbbTV1",e.hbbtv1Module),e.kalturaModule=this.getBrowserModule("kalturaSmartLibModule","Kaltura",e.kalturaModule),e.connectplayerModule=this.getBrowserModule("connectplayerSmartLibModule","CONNECT Player",e.connectplayerModule),void 0!==e.connectplayerModule&&(window.ConnectPlayerAdapter=e.connectplayerModule.ConnectPlayerAdapter),e.rxplayerModule=this.getBrowserModule("rxplayerSmartLibModule","RxPlayer",e.rxplayerModule),e.hlsjsModule=this.getBrowserModule("hlsjsModule","HLS.js",e.hlsjsModule),e.bitmovinModule=this.getBrowserModule("bitmovinModule","Bitmovin",e.bitmovinModule)):!0===e.modular&&(Yt.analyticsModule=this.getNodeModule("analytics","Analytics"),Yt.adModule=this.getNodeModule("ad","Ad"),Yt.nanoCDNModule=this.getNodeModule("nanocdn","nanoCDN"),Yt.diversityModule=this.getNodeModule("diversity","Diversity"),e.shakaModule=this.getNodeModule("shaka","Shaka Player"),e.dashjsModule=this.getNodeModule("dashjs","Dash.js"),e.html5Module=this.getNodeModule("html5","HTML5 player"),e.avplayModule=this.getNodeModule("avplay","AVPlay"),e.diw387Module=this.getNodeModule("diw387","Sagemcom"),e.hbbtv1Module=this.getNodeModule("hbbtv1","HbbTV1"),e.kalturaModule=this.getNodeModule("kaltura","Kaltura"),e.connectplayerModule=this.getNodeModule("connectplayer","CONNECT Player"),e.rxplayerModule=this.getNodeModule("rxplayer","RxPlayer"),e.hlsjsModule=this.getNodeModule("hlsjs","HLS.js"),e.bitmovinModule=this.getNodeModule("bitmovin","Bitmovin"))}},{key:"getBrowserModule",value:function(e,t,i){if(void 0!==i)return P.i(Qi,t+" module loaded (from index)"),i;P.i(Qi,t+" module not loaded")}},{key:"getNodeModule",value:function(e,t){try{var i=(0,oi.W)("@broadpeak/smartlib-"+e);return P.i(Qi,t+" module loaded"),i}catch(i){try{var n=(0,oi.A)("./"+e+".smartlib.browser");return P.i(Qi,t+" module loaded"),n}catch(e){P.i(Qi,t+" module not loaded")}}}},{key:"registerSmartLibFunctions",value:function(t){var i,n,r=this;Yt.prototype.defaultInit=Yt.prototype.init,Yt.prototype.init=function(e,t,i,n){"undefined"!=typeof webOS?(void 0===xi(r,$i)&&Vi(r,$i,new vi),xi(r,$i).init()):"undefined"!=typeof tizen&&"undefined"!=typeof webapis?(void 0===xi(r,en)&&Vi(r,en,new Ei),xi(r,en).init()):"undefined"!=typeof sagem||"undefined"!=typeof window&&(void 0===xi(r,Zi)&&Vi(r,Zi,new ci),xi(r,Zi).init()),r.loadModules(),this.defaultInit(e,t,i,n)},Yt.prototype.defaultAttachPlayer=Yt.prototype.attachPlayer,Yt.prototype.attachPlayer=function(e,t){var i,n;null===(i=Yt.analyticsModule)||void 0===i||i.PlayerManager.getInstance().init(xi(r,Xi));var a=null===(n=xi(r,Xi))||void 0===n?void 0:n.attachPlayer(e,t);this.defaultAttachPlayer(a)},Yt.prototype.defaultRelease=Yt.prototype.release,Yt.prototype.release=function(){this.defaultRelease(),void 0!==xi(r,Zi)&&(xi(r,Zi).release(),Vi(r,Zi,void 0)),void 0!==xi(r,$i)&&(xi(r,$i).release(),Vi(r,$i,void 0)),void 0!==xi(r,en)&&(xi(r,en).release(),Vi(r,en,void 0))},yt.prototype.defaultAttachPlayer=yt.prototype.attachPlayer,yt.prototype.attachPlayer=function(e,t){var i,n;null===(i=Yt.analyticsModule)||void 0===i||i.PlayerManager.getInstance().init(xi(r,Xi));var a=null===(n=xi(r,Xi))||void 0===n?void 0:n.attachPlayer(e,t);this.defaultAttachPlayer(a)},"object"===Ui(t)&&(t.SmartLib=Object.assign(Yt.getInstance(),Yt),t.SmartLib.getInstance=function(){return Yt.getInstance()},t.LoggerManager=P,t.PlayerEventListener=null===(i=e.analyticsModule)||void 0===i?void 0:i.PlayerEventListener,t.GenericPlayerApi=null===(n=e.analyticsModule)||void 0===n?void 0:n.GenericPlayerApi,t.PlayerApiImp={getVersion:function(){var e,t=null===(e=Yt.analyticsModule)||void 0===e?void 0:e.PlayerManager.getInstance().getPlayerAdapter();return void 0!==t&&"function"==typeof t.getVersion?t.getVersion():"undefined"},getErrorCode:function(e){var t,i=null===(t=Yt.analyticsModule)||void 0===t?void 0:t.PlayerManager.getInstance().getPlayerAdapter();return void 0!==i&&"function"==typeof i.getErrorCode?i.getErrorCode(e):Yt.BPUnspecifiedError}},t.StreamingSession=yt,t.StreamingSessionOptions=Ke,t.StreamingSessionResult=ht,t.AdManager=ie,t.AdInteractionType=Bi)}},{key:"log",value:function(e,t,i){xi(this,Ji).log(e,t,i)}}])&&ji(t.prototype,i),n&&ji(t,n),e}(),nn={writable:!0,value:void 0};function rn(e){return(rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function an(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function sn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Fi(tn,"modular",!0),Fi(tn,"analyticsModule",void 0),Fi(tn,"shakaModule",void 0),Fi(tn,"dashjsModule",void 0),Fi(tn,"html5Module",void 0),Fi(tn,"avplayModule",void 0),Fi(tn,"diw387Module",void 0),Fi(tn,"hbbtv1Module",void 0),Fi(tn,"kalturaModule",void 0),Fi(tn,"connectplayerModule",void 0),Fi(tn,"rxplayerModule",void 0),Fi(tn,"hlsjsModule",void 0),Fi(tn,"bitmovinModule",void 0);var on="BpkPlayerAdapter",un=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),sn(this,"session",void 0),sn(this,"webOSVersion",void 0),"undefined"!=typeof webOS&&webOS.deviceInfo((function(e){t.webOSVersion=e.sdkVersion}))}var t,i,n;return t=e,n=[{key:"checkPlayer",value:function(e,t){return P.e(on,"Implementation error: static checkPlayer not implemented for this adapter."),!1}}],(i=[{key:"getName",value:function(){return""}},{key:"getVersion",value:function(){return""}},{key:"getOSName",value:function(){return"undefined"!=typeof device&&void 0!==device.platform?device.platform:"undefined"!=typeof webOS||"object"===("undefined"==typeof navigator?"undefined":rn(navigator))&&void 0!==navigator.userAgent&&-1!==navigator.userAgent.indexOf("Web0S")?"webOS":"undefined"!=typeof tizen||"object"===("undefined"==typeof navigator?"undefined":rn(navigator))&&void 0!==navigator.userAgent&&-1!==navigator.userAgent.indexOf("Tizen")?"Tizen":"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.platform?window.navigator.platform:"NA"}},{key:"getOSVersion",value:function(){var e;if("undefined"!=typeof device&&void 0!==device.version)e=device.version;else if("undefined"!=typeof webOS)e=this.webOSVersion;else{if("undefined"!=typeof tizen&&void 0!==tizen.systeminfo)return tizen.systeminfo.getCapability("http://tizen.org/feature/platform.version");"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.appVersion&&(e=window.navigator.appVersion)}void 0===e&&(e="");var t=e.replace(/ /g,"_").replace(/;/g,"_");return t.length>=30?t.substring(0,30):0===t.length?"NA":t}},{key:"getDeviceType",value:function(){return"undefined"!=typeof cast&&void 0!==cast.receiver?"chromecast":"undefined"!=typeof tizen&&void 0!==tizen.systeminfo||"undefined"!=typeof webOS||"object"===("undefined"==typeof navigator?"undefined":rn(navigator))&&void 0!==navigator.userAgent&&-1!==navigator.userAgent.indexOf("Web0S")?"tv":""}},{key:"getBitrate",value:function(){return-1}},{key:"getPosition",value:function(){return 0}},{key:"getDuration",value:function(){return 0}},{key:"getVolume",value:function(){return 1}},{key:"getCapabilities",value:function(){return{adTracking:!1}}},{key:"initSessionPlayerObjects",value:function(){}},{key:"releaseSessionPlayerObjects",value:function(){}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(e){e.playerName=this.getName(),e.playerVersion=this.getVersion(),e.osName=this.getOSName(),e.osVersion=this.getOSVersion(),e.deviceType=this.getDeviceType()}},{key:"onEndSessionReportUpdateRequested",value:function(e){e.playerName=this.getName(),e.playerVersion=this.getVersion(),e.osName=this.getOSName(),e.osVersion=this.getOSVersion(),e.deviceType=this.getDeviceType()}},{key:"notifyFirstImage",value:function(){void 0!==this.session?this.session.notifyFirstImage(this.getBitrate(),this.getPosition()):P.e(on,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onSessionStart event. This event is called when the first image is displayed.")}},{key:"notifyPause",value:function(){void 0!==this.session?this.session.notifyPause():P.e(on,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onSessionPause event.")}},{key:"notifyResume",value:function(){void 0!==this.session?this.session.notifyResume():P.e(on,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onSessionResume event.")}},{key:"notifyLayerSwitch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getBitrate();void 0!==this.session?this.session.notifyLayerSwitch(e):P.e(on,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onLayerSwitch event.")}},{key:"notifySeek",value:function(e,t){void 0!==this.session?this.session.notifySeek(e,t):P.e(on,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onSeek event.")}},{key:"notifyStallStart",value:function(){void 0!==this.session?this.session.notifyBufferingStart():P.e(on,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onStallStart event.")}},{key:"notifyStallEnd",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];void 0!==this.session?this.session.notifyBufferingEnd(e):P.e(on,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onStallEnd event.")}},{key:"notifyVolumeChanged",value:function(e){void 0!==this.session?this.session.notifyVolumeChanged(e):P.e(on,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onVolumeChanged event.")}},{key:"notifyPlayerError",value:function(e,t){void 0!==this.session?this.session.notifyPlayerError(e,t):P.e(on,"Implementation error: session.getURL(...) or session.getQuery()/session.startStreamingSession(...) should be called prior to onPlayerError event.")}},{key:"attachPlayer",value:function(e,t){return P.e(on,"Implementation error: attachPlayer not implemented for this adapter."),!1}},{key:"detachPlayer",value:function(){P.e(on,"Implementation error: detachPlayer not implemented for this adapter.")}},{key:"attachSession",value:function(e){this.session=e}},{key:"detachSession",value:function(){this.session=void 0}},{key:"setStatusCode",value:function(e){void 0!==this.session&&(this.session.sessionReport.statusCode=e)}},{key:"setPlayerErrorCode",value:function(e){void 0!==this.session&&(this.session.sessionReport.playerErrorCode=String(e))}}])&&an(t.prototype,i),n&&an(t,n),e}();function ln(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var cn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"hasMethods",value:function(e,t){var i=!0;return void 0!==e&&(t.forEach((function(t){"function"!=typeof e[t]&&(i=!1)})),i)}},{key:"count",value:function(e,t){var i=0;for(var n in e)!0===t(n,e[n])&&i++;return i}}])&&ln(t,i),e}();function dn(e){return(dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fn(e,t,i){return(fn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=gn(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function vn(e,t){return(vn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pn(e,t){return!t||"object"!==dn(t)&&"function"!=typeof t?yn(e):t}function yn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gn(e){return(gn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function En(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Sn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vn(e,t)}(a,e);var t,i,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=gn(e);if(t){var r=gn(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return pn(this,i)}}(a);function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),En(yn(e=r.call(this)),"player",void 0),En(yn(e),"listener",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return cn.hasMethods(e,["getPlayerName","getVersion","getOSName","getDeviceVersion","getDeviceType","getCurrentPosition","getTotalDuration","getCurrentBitrate"])}}],(i=[{key:"getName",value:function(){return this.player.getPlayerName()}},{key:"getVersion",value:function(){return this.player.getVersion()}},{key:"getOSName",value:function(){return this.player.getOSName()}},{key:"getOSVersion",value:function(){return this.player.getDeviceVersion()}},{key:"getDeviceType",value:function(){return this.player.getDeviceType()}},{key:"getBitrate",value:function(){return this.player.getCurrentBitrate()}},{key:"getPosition",value:function(){return this.player.getCurrentPosition()}},{key:"getDuration",value:function(){return this.player.getTotalDuration()}},{key:"getCapabilities",value:function(){return"function"==typeof this.player.getCapabilities?this.player.getCapabilities():fn(gn(a.prototype),"getCapabilities",this).call(this)}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(this.player=e,this.listener=t,this.player.playerAdapter=this,!0)}},{key:"detachPlayer",value:function(){void 0!==this.player&&(this.player.playerAdapter=void 0),this.player=void 0,this.listener=void 0}}])&&hn(t.prototype,i),n&&hn(t,n),a}(un);function bn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var kn,mn,_n,An="BpkPlayerEventListener",Nn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"addPlayerAdapter",value:function(t){-1===e.playerAdapters.indexOf(t)&&e.playerAdapters.push(t)}},{key:"removePlayerAdapter",value:function(t){var i=e.playerAdapters.indexOf(t);-1!==i&&e.playerAdapters.splice(i,1)}},{key:"isStarted",value:function(){var t=e.playerAdapters;return t.length>0&&void 0!==t[t.length-1].session&&t[t.length-1].session.metricsManager.started}},{key:"isPlaying",value:function(){var t=e.playerAdapters;return t.length>0&&void 0!==t[t.length-1].session&&t[t.length-1].session.metricsManager.playing}},{key:"isBuffering",value:function(){var t=e.playerAdapters;return t.length>0&&void 0!==t[t.length-1].session&&t[t.length-1].session.metricsManager.buffering}},{key:"onSessionStart",value:function(){var t=e.playerAdapters;t.length>0?t.forEach((function(e){return e.notifyFirstImage()})):P.e(An,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onSessionStart event. If you don't attach any player, please remove this call, SmartLib is now handling it automatically.")}},{key:"onSessionPause",value:function(){var t=e.playerAdapters;t.length>0?t.forEach((function(e){return e.notifyPause()})):P.e(An,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onSessionPause event.")}},{key:"onSessionResume",value:function(){var t=e.playerAdapters;t.length>0?t.forEach((function(e){return e.notifyResume()})):P.e(An,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onSessionResume event.")}},{key:"onLayerSwitch",value:function(t){var i=e.playerAdapters;i.length>0?i.forEach((function(e){return e.notifyLayerSwitch(t)})):P.e(An,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onLayerSwitch event.")}},{key:"onSeek",value:function(t,i){var n=e.playerAdapters;n.length>0?n.forEach((function(e){return e.notifySeek(t,i)})):P.e(An,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onSeek event.")}},{key:"onStallStart",value:function(){var t=e.playerAdapters;t.length>0?t.forEach((function(e){return e.notifyStallStart()})):P.e(An,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onStallStart event.")}},{key:"onStallEnd",value:function(t){var i=e.playerAdapters;i.length>0?i.forEach((function(e){return e.notifyStallEnd(t)})):P.e(An,"Implementation error: SmartLib.attachPlayer(...) should be called prior to onStallEnd event.")}}])&&bn(t,i),e}();function Rn(e,t,i){return Tn(e,Pn(e,t,"set"),i),i}function Dn(e,t){return Cn(e,Pn(e,t,"get"))}function Pn(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function Tn(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function wn(e,t,i){return Ln(e,t),On(i,"get"),Cn(e,i)}function On(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Ln(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function Cn(e,t){return t.get?t.get.call(e):t.value}function In(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Bn(e,t,i){return t&&Mn(e.prototype,t),i&&Mn(e,i),e}_n=[],(mn="playerAdapters")in(kn=Nn)?Object.defineProperty(kn,mn,{value:_n,enumerable:!0,configurable:!0,writable:!0}):kn[mn]=_n;var Un="BpkPlayerMgr",jn=function(){function e(){In(this,e)}return Bn(e,null,[{key:"loadPlayerAdapters",value:function(){return{}}}]),e}(),Fn=new WeakMap,xn=new WeakMap,Vn=new WeakMap,Gn=function(){function e(){In(this,e),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"smartLib",void 0),Fn.set(this,{writable:!0,value:jn}),xn.set(this,{writable:!0,value:{}}),Vn.set(this,{writable:!0,value:void 0})}return Bn(e,[{key:"init",value:function(e){Dn(this,Fn)===jn&&(Rn(this,Fn,e),Rn(this,xn,Dn(this,Fn).loadPlayerAdapters()),P.v(Un,"Compatible players: "+Object.keys(Dn(this,xn))))}},{key:"release",value:function(){this.setPlayerAdapter(void 0)}},{key:"attachInstance",value:function(e){this.smartLib=e}},{key:"getAdapters",value:function(){return Dn(this,xn)}},{key:"setPlayerAdapter",value:function(e){void 0!==Dn(this,Vn)&&Dn(this,Vn)!==e&&(P.i(Un,"Player "+Dn(this,Vn).getName()+" detached"),Dn(this,Vn).detachPlayer()),Dn(this,Vn)!==e&&void 0!==e?e instanceof Sn&&(P.d(Un,"Attaching generic player to SmartLib singleton"),Nn.addPlayerAdapter(e)):Dn(this,Vn)!==e&&void 0===e&&Dn(this,Vn)instanceof Sn&&(P.d(Un,"Detaching generic player from SmartLib singleton"),Nn.removePlayerAdapter(Dn(this,Vn))),Dn(this,Vn)!==e?Rn(this,Vn,e):void 0!==e&&P.i(Un,"Player "+Dn(this,Vn).getName()+" already attached"),void 0!==e&&P.i(Un,"Player "+e.getName()+" attached")}},{key:"getPlayerAdapter",value:function(){return Dn(this,Vn)}}],[{key:"getInstance",value:function(){return wn(e,e,Hn)||function(e,t,i,n){Ln(e,t),On(i,"set"),Tn(e,i,n)}(e,e,Hn,new e),wn(e,e,Hn)}}]),e}(),Hn={writable:!0,value:void 0};function Wn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var qn="BpkGenericPlayerApi",Yn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"playerAdapter",void 0)}var t,i;return t=e,(i=[{key:"getPlayerName",value:function(){return""}},{key:"getVersion",value:function(){return""}},{key:"getOSName",value:function(){return""}},{key:"getDeviceVersion",value:function(){return""}},{key:"getDeviceType",value:function(){return""}},{key:"getCurrentPosition",value:function(){return 0}},{key:"getTotalDuration",value:function(){return 0}},{key:"getCurrentBitrate",value:function(){return 0}},{key:"notifyFirstImage",value:function(){void 0!==this.playerAdapter?this.playerAdapter.notifyFirstImage():P.e(qn,"Implementation error: session.attachPlayer(...) should be called prior to notifyFirstImage. This event is called when the first image is displayed.")}},{key:"notifyPause",value:function(){void 0!==this.playerAdapter?this.playerAdapter.notifyPause():P.e(qn,"Implementation error: session.attachPlayer(...) should be called prior to notifyPause.")}},{key:"notifyResume",value:function(){void 0!==this.playerAdapter?this.playerAdapter.notifyResume():P.e(qn,"Implementation error: session.attachPlayer(...) should be called prior to notifyResume.")}},{key:"notifyLayerSwitch",value:function(e){void 0!==this.playerAdapter?this.playerAdapter.notifyLayerSwitch(e):P.e(qn,"Implementation error: session.attachPlayer(...) should be called prior to notifyLayerSwitch.")}},{key:"notifyStallStart",value:function(){void 0!==this.playerAdapter?this.playerAdapter.notifyStallStart():P.e(qn,"Implementation error: session.attachPlayer(...) should be called prior to notifyStallStart.")}},{key:"notifyStallEnd",value:function(e){void 0!==this.playerAdapter?this.playerAdapter.notifyStallEnd(e):P.e(qn,"Implementation error: session.attachPlayer(...) should be called prior to notifyStallEnd.")}},{key:"notifySeek",value:function(e,t){void 0!==this.playerAdapter?this.playerAdapter.notifySeek(e,t):P.e(qn,"Implementation error: session.attachPlayer(...) should be called prior to notifySeek.")}},{key:"setPlayerErrorCode",value:function(e){void 0!==this.playerAdapter?this.playerAdapter.setPlayerErrorCode(e):P.e(qn,"Implementation error: session.attachPlayer(...) should be called prior to setPlayerErrorCode. This has to be called before stopStreamingSession when the player error code as a string.")}}])&&Wn(t.prototype,i),e}();function Kn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function zn(e,t,i){return Xn(e,t),Jn(i,"get"),function(e,t){return t.get?t.get.call(e):t.value}(e,i)}function Jn(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Xn(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}var Zn="BpkAnalyticsRequestMgr",$n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){return zn(e,e,er)||function(e,t,i,n){Xn(e,t),Jn(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n)}(e,e,er,new e),zn(e,e,er)}}],(i=[{key:"startSession",value:function(t,i){var n=this,r=t.sessionReport;if(0!==i.analyticsAddress.length){var a=i.analyticsAddress.split(","),s=[];return a.forEach((function(a){(a=a.trim()).endsWith("/")||(a+="/"),a+=e.METRICS_RECEIVER_PATH,P.i(Zn,"Posting metrics to "+a,t.id);var o=n.postSession(a,r.toStartSessionJSON(),i).then((function(e){return P.i(Zn,"Send creation session metrics ended with with status code "+e.httpStatus+" ("+a+")",t.id),e.httpStatus>=200&&e.httpStatus<300||(503===e.httpStatus&&P.d(Zn,"Request execution failed",t.id),!1)}));s.push(o)})),Promise.all(s).then((function(){P.d(Zn,"Send creation session metrics done",t.id)}))}return P.w(Zn,"Metrics platform URL is null, creation metrics won't be posted anywhere.",t.id),Promise.resolve(!1)}},{key:"endSession",value:function(t,i){var n=this,r=t.sessionReport;if(0!==i.analyticsAddress.length){var a=i.analyticsAddress.split(","),s=[];return a.forEach((function(a){(a=a.trim()).endsWith("/")||(a+="/"),a+=e.METRICS_RECEIVER_PATH,P.i(Zn,"Posting metrics to "+a,t.id);var o=n.postSession(a,r.toEndSessionJSON(),i).then((function(e){return P.i(Zn,"Send session metrics ended with with status code "+e.httpStatus+" ("+a+")",t.id),e.httpStatus>=200&&e.httpStatus<300||(503===e.httpStatus&&P.d(Zn,"Request execution failed",t.id),!1)}));s.push(o)})),Promise.all(s).then((function(){P.d(Zn,"Send session metrics done",t.id)}))}return P.w(Zn,"Metrics platform URL is null, metrics won't be posted anywhere.",t.id),Promise.resolve(!1)}},{key:"postSession",value:function(t,i,n){return new Promise((function(r,a){var s={Connection:"close"};void 0!==n.userAgent&&(s["User-Agent"]=n.userAgent);var o=JSON.stringify(i);P.v(Zn,"Executing POST request with body: "+o),G.getInstance().asyncPost(t,s,o,e.POST_SESSION_REQUEST_TIMEOUT,(function(e){var t=0;void 0!==e.statusCode&&(t=parseInt(e.statusCode,10)),r({httpStatus:t})}))}))}}])&&Kn(t.prototype,i),n&&Kn(t,n),e}();Qn($n,"METRICS_RECEIVER_PATH","fservices/metricsReceiver"),Qn($n,"POST_SESSION_REQUEST_TIMEOUT",5e3);var er={writable:!0,value:void 0};function tr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ir(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var nr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ir(this,"index",void 0),ir(this,"buffer",void 0),this.index=0,this.buffer=new Uint8Array(t)}var t,i;return t=e,(i=[{key:"put",value:function(e){return this.buffer[this.index++]=e,this}},{key:"putChar",value:function(e){return this.buffer[this.index++]=(65280&e)>>8,this.buffer[this.index++]=255&e,this}},{key:"putTimestamp",value:function(e){return this.buffer[this.index++]=(16711680&e)>>16,this.buffer[this.index++]=(65280&e)>>8,this.buffer[this.index++]=255&e,this}},{key:"putArray",value:function(e){return this.buffer.length>=this.index+e.length&&(this.buffer.set(e,this.index),this.index+=e.length),this}},{key:"putByteBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.buffer.length,i=e.buffer;return this.buffer.length>=this.index+t&&(this.buffer.set(i,this.index,t),this.index+=t),this}},{key:"increment",value:function(e){return this.buffer[e]++,this}},{key:"set",value:function(e,t){return this.buffer[t]=e,this}},{key:"setChar",value:function(e,t){return this.buffer[t]=(65280&e)>>8,this.buffer[t+1]=255&e,this}},{key:"setTimestamp",value:function(e,t){return this.buffer[t]=(16711680&e)>>16,this.buffer[t+1]=(65280&e)>>8,this.buffer[t+2]=255&e,this}},{key:"shift",value:function(e){return this.buffer.copyWithin(e+1,e),this.index++,this}},{key:"data",value:function(){return this.buffer}},{key:"base64",value:function(){return I.bufferToBase64(this)}},{key:"length",value:function(){return this.index}},{key:"capacity",value:function(){return this.buffer.length}},{key:"remaining",value:function(){return this.capacity()-this.length()}},{key:"toString",value:function(){return I.bufferToString(this.buffer,this.index)+"(length:"+this.length()+")"}}])&&tr(t.prototype,i),e}();function rr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ar(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}ir(nr,"EMPTY",new nr(0));var or=function e(t){ar(this,e),sr(this,"redirectionTime",void 0),sr(this,"startupTime",void 0),sr(this,"completion",void 0),sr(this,"playbackType",void 0),sr(this,"playbackDuration",void 0),sr(this,"sessionDuration",void 0),sr(this,"contentDuration",void 0),sr(this,"stallsNumber",void 0),sr(this,"maxStallDuration",void 0),sr(this,"totalStallsDuration",void 0),sr(this,"rebufferingsNumber",void 0),sr(this,"maxRebufferingDuration",void 0),sr(this,"totalRebufferingDuration",void 0),sr(this,"minBitrate",void 0),sr(this,"maxBitrate",void 0),sr(this,"averageBitrate",void 0),sr(this,"layerSwitchesNumber",void 0),sr(this,"timeSpentPerLayer",void 0),sr(this,"preStartupTime",void 0),void 0!==t?(this.redirectionTime=t.redirectionTime,this.startupTime=t.startupTime,this.completion=t.completion,this.playbackType=t.playbackType,this.playbackDuration=t.playbackDuration,this.sessionDuration=t.sessionDuration,this.contentDuration=t.contentDuration,this.stallsNumber=t.stallsNumber,this.maxStallDuration=t.maxStallDuration,this.totalStallsDuration=t.totalStallsDuration,this.rebufferingsNumber=t.rebufferingsNumber,this.maxRebufferingDuration=t.maxRebufferingDuration,this.totalRebufferingDuration=t.totalRebufferingDuration,this.minBitrate=t.minBitrate,this.maxBitrate=t.maxBitrate,this.averageBitrate=t.averageBitrate,this.layerSwitchesNumber=t.layerSwitchesNumber,this.timeSpentPerLayer=JSON.parse(JSON.stringify(t.timeSpentPerLayer)),this.preStartupTime=t.preStartupTime):(this.redirectionTime=0,this.startupTime=0,this.completion=0,this.playbackType="",this.playbackDuration=0,this.sessionDuration=0,this.contentDuration=0,this.stallsNumber=0,this.maxStallDuration=0,this.totalStallsDuration=0,this.rebufferingsNumber=0,this.maxRebufferingDuration=0,this.totalRebufferingDuration=0,this.minBitrate=0,this.maxBitrate=0,this.averageBitrate=0,this.layerSwitchesNumber=0,this.timeSpentPerLayer={},this.preStartupTime=0)};sr(or,"PLAYBACK_TYPE_LIVE","LIVE"),sr(or,"PLAYBACK_TYPE_VOD","VOD");var ur=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new or;ar(this,e),sr(this,"metrics",void 0),sr(this,"watchingRanges",void 0),this.metrics=t,this.reset()}var t,i;return t=e,(i=[{key:"setRedirectionTime",value:function(e){return this.metrics.redirectionTime=e,this}},{key:"setStartupTime",value:function(e){return this.metrics.startupTime=e,this}},{key:"setSessionDuration",value:function(e){return this.metrics.sessionDuration=e,this}},{key:"setContentDuration",value:function(e){return this.metrics.contentDuration=e,this}},{key:"setPlaybackType",value:function(e){return this.metrics.playbackType=e,this}},{key:"setFirstLayer",value:function(e){return e>0&&(this.metrics.maxBitrate=e,this.metrics.minBitrate=e),this}},{key:"setPreStartupTime",value:function(e){return this.metrics.preStartupTime=e,this}},{key:"addTimeSpentPerLayer",value:function(e,t){if((e=Math.round(e))>0){var i=this.metrics.timeSpentPerLayer[e];void 0===i&&(i=0),i+=t,this.metrics.timeSpentPerLayer[e]=i,this.metrics.maxBitrate<e&&(this.metrics.maxBitrate=e),(this.metrics.minBitrate>e||0===this.metrics.minBitrate)&&(this.metrics.minBitrate=e)}return this}},{key:"addLayerSwitch",value:function(){return this.metrics.layerSwitchesNumber++,this}},{key:"addPlaybackDuration",value:function(e){return this.metrics.playbackDuration+=e,this}},{key:"addWatchingRange",value:function(e,t){return e<t&&(P.v("BpkMetrics","Add watching range, duration "+(t-e)+"ms"),this.watchingRanges.push({start:e,end:t,duration:t-e})),this}},{key:"addStall",value:function(e){return this.metrics.stallsNumber++,this.metrics.totalStallsDuration+=e,this.metrics.maxStallDuration<e&&(this.metrics.maxStallDuration=e),this}},{key:"addRebuffering",value:function(e){return this.metrics.rebufferingsNumber++,this.metrics.totalRebufferingDuration+=e,this.metrics.maxRebufferingDuration<e&&(this.metrics.maxRebufferingDuration=e),this}},{key:"clone",value:function(){var t=new e(new or(this.metrics));return t.watchingRanges=JSON.parse(JSON.stringify(this.watchingRanges)),t}},{key:"computeCompletion",value:function(){if(this.metrics.playbackType===or.PLAYBACK_TYPE_LIVE||0===this.metrics.contentDuration)return 1e3;var e=JSON.parse(JSON.stringify(this.watchingRanges)),t=e.slice(0);if(1===e.length)return Math.floor(1e3*t[0].duration/this.metrics.contentDuration);if(0===e.length)return 0;var i=[],n=null;t=t.sort((function(e,t){return parseInt(e.start,10)>parseInt(t.start,10)?1:parseInt(e.start,10)<parseInt(t.start,10)?-1:0})),i.push(t[0]);for(var r=1;r<t.length;r++)n=i[i.length-1],parseInt(n.end,10)<parseInt(t[r].start,10)?i.push(t[r]):parseInt(n.end,10)<parseInt(t[r].end,10)&&(n.end=parseInt(t[r].end,10),n.duration=n.end-n.start,i.pop(),i.push(n));for(var a=0,s=0;s<i.length;s++)i[s].duration=parseInt(i[s].end,10)-parseInt(i[s].start,10),a+=parseInt(i[s].duration,10);this.watchingRanges=i;var o=Math.floor(1e3*a/this.metrics.contentDuration);return o>1e3?1e3:o}},{key:"build",value:function(){var e=0,t=0;for(var i in this.metrics.timeSpentPerLayer){var n=this.metrics.timeSpentPerLayer[i];e+=i*n,t+=n}return 0!==t&&(this.metrics.averageBitrate=Math.round(e/t)),this.metrics.completion=this.computeCompletion(),this.metrics.startupTime+=this.metrics.preStartupTime,this.metrics}},{key:"reset",value:function(){return this.watchingRanges=[],this}}])&&rr(t.prototype,i),e}();function lr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function cr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var dr="BpkMetricsMgr",hr=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),cr(this,"session",void 0),cr(this,"builder",void 0),cr(this,"playerAdapter",void 0),cr(this,"timeline",void 0),cr(this,"started",void 0),cr(this,"playing",void 0),cr(this,"buffering",void 0),cr(this,"seeking",void 0),cr(this,"bitrate",void 0),cr(this,"redirectionStartDate",void 0),cr(this,"playingStartDate",void 0),cr(this,"bufferingStartDate",void 0),cr(this,"lastLayerSwitchDate",void 0),cr(this,"lastSeekDate",void 0),cr(this,"playOnNextBufferingEnd",void 0),cr(this,"startPosition",void 0),this.session=t,this.builder=new ur,this.playerAdapter=i,this.timeline=this.session.sessionReport.timeline,this.started=!1,this.playing=!1,this.buffering=!1,this.seeking=!1,this.bitrate=-1,this.redirectionStartDate=0,this.playingStartDate=0,this.bufferingStartDate=0,this.lastLayerSwitchDate=0,this.lastSeekDate=0,this.playOnNextBufferingEnd=!1,this.startPosition=0}var t,i;return t=e,(i=[{key:"onStart",value:function(){this.redirectionStartDate=Date.now()}},{key:"onRedirectionEnd",value:function(){this.builder.setRedirectionTime(Date.now()-this.redirectionStartDate),this.playingStartDate=Date.now()}},{key:"onFirstImage",value:function(e,t){P.i(dr,"Streaming session started ("+e+"kpbs,"+ti.formatTime(t)+")",this.session.id),this.started=!0,this.playing=!0,this.startPosition=t,this.builder.setContentDuration(this.playerAdapter.getDuration()).setPlaybackType(this.playerAdapter.getDuration()<=0?or.PLAYBACK_TYPE_LIVE:or.PLAYBACK_TYPE_VOD),this.builder.setStartupTime(Date.now()-this.redirectionStartDate),this.playingStartDate=Date.now(),this.builder.setFirstLayer(e),this.bitrate=e,this.lastLayerSwitchDate=Date.now()}},{key:"onLayerSwitch",value:function(e){var t;P.d(dr,"Player changed layer to "+e+"kbps",this.session.id),this.started&&(this.builder.addTimeSpentPerLayer(this.bitrate,Date.now()-this.lastLayerSwitchDate),this.lastLayerSwitchDate=Date.now(),this.bitrate!==e&&this.bitrate>0&&(P.d(dr,"Player changed layer, before: "+this.bitrate+"kbps, now: "+e+"kbps",this.session.id),null===(t=this.timeline)||void 0===t||t.pushEventBitrate(pr.LayerSwitch,e),this.builder.addLayerSwitch())),this.bitrate=e}},{key:"onPause",value:function(){var e;this.playing&&(P.d(dr,"Player is paused",this.session.id),null===(e=this.timeline)||void 0===e||e.pushEvent(pr.Pause),this.playing=!1,this.buffering||this.builder.addPlaybackDuration(Date.now()-this.playingStartDate),this.builder.addWatchingRange(this.startPosition,this.playerAdapter.getPosition()))}},{key:"onResume",value:function(){var e;this.started&&!this.playing&&(P.d(dr,"Player is resumed",this.session.id),null===(e=this.timeline)||void 0===e||e.pushEvent(pr.Resume),this.playing=!0,this.buffering=!1,this.playingStartDate=Date.now())}},{key:"onBufferingStart",value:function(){if(!this.buffering&&this.started){var t;P.d(dr,"Player is buffering",this.session.id),null===(t=this.timeline)||void 0===t||t.pushEvent(pr.BufferingStart);var i=Date.now();this.buffering=!0,this.seeking&&i-this.lastSeekDate>e.MAX_TIME_BETWEEN_SEEK_AND_REBUFFERING&&(this.seeking=!1),this.bufferingStartDate=i,this.playOnNextBufferingEnd=!1,this.playing&&this.builder.addPlaybackDuration(i-this.playingStartDate)}}},{key:"onBufferingEnd",value:function(e){var t=Date.now();e&&this.playOnNextBufferingEnd&&!this.buffering&&(this.playingStartDate=t,this.playOnNextBufferingEnd=!1),this.started&&this.bufferingStartDate>0&&(this.buffering=!1,e?this.playingStartDate=t:this.playOnNextBufferingEnd=!0,this.seeking?(this.seeking=!1,this.session.notifyRebufferingEnd()):this.session.notifyStallEnd(),this.bufferingStartDate=0)}},{key:"onStallEnd",value:function(){var e,t=Date.now()-this.bufferingStartDate;this.builder.addStall(t),null===(e=this.timeline)||void 0===e||e.pushEvent(pr.StallStop),P.d(dr,"Player stalled for "+t+"ms",this.session.id)}},{key:"onRebufferingEnd",value:function(){var e,t=Date.now()-this.bufferingStartDate;this.builder.addRebuffering(t),null===(e=this.timeline)||void 0===e||e.pushEvent(pr.RebufferingStop),P.d(dr,"Player buffered for "+t+"ms",this.session.id)}},{key:"onSeek",value:function(e,t){var i;P.d(dr,"Player seeked from "+ti.formatTime(e)+" to "+ti.formatTime(t),this.session.id),null===(i=this.timeline)||void 0===i||i.pushEventPositionStartEnd(pr.Seek,e,t),this.builder.addWatchingRange(this.startPosition,e),this.startPosition=t,this.seeking=!0,this.lastSeekDate=Date.now()}},{key:"onStop",value:function(e){if(this.started){var t=Date.now();this.playing&&!this.buffering&&this.builder.addPlaybackDuration(t-this.playingStartDate),this.buffering&&this.onBufferingEnd(!1),this.playing&&(this.builder.addWatchingRange(this.startPosition,this.playerAdapter.getPosition()),this.playing=!1),this.builder.setSessionDuration(t-this.redirectionStartDate).addTimeSpentPerLayer(this.bitrate,t-this.lastLayerSwitchDate),this.started=!1}}},{key:"onStartSessionReportUpdateRequested",value:function(e){e.metrics=this.builder.build()}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(e){var t=Date.now(),i=this.builder.clone();if(this.playing&&!this.buffering&&i.addPlaybackDuration(t-this.playingStartDate),this.started&&this.bufferingStartDate>0){var n=Date.now()-this.bufferingStartDate;this.seeking?i.addRebuffering(n):i.addStall(n)}this.playing&&i.addWatchingRange(this.startPosition,this.playerAdapter.getPosition()),i.setSessionDuration(t-this.redirectionStartDate).addTimeSpentPerLayer(this.bitrate,t-this.lastLayerSwitchDate);var r=this.session.getCustomParameters().pre_startup_time,a=0;void 0===r||isNaN(r)||(a=parseInt(r,10)),i.setPreStartupTime(a),e.metrics=i.build()}},{key:"onEndSessionReportUpdateRequested",value:function(e){var t=Date.now();this.builder.setSessionDuration(t-this.redirectionStartDate);var i=this.session.getCustomParameters().pre_startup_time,n=0;void 0===i||isNaN(i)||(n=parseInt(i,10)),this.builder.setPreStartupTime(n),e.metrics=this.builder.build()}}])&&lr(t.prototype,i),e}();function fr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}cr(hr,"MAX_TIME_BETWEEN_SEEK_AND_REBUFFERING",1e3);var pr={None:0,Start:1,Stop:2,RedirectionEnd:3,FirstImage:4,Pause:5,Resume:6,BufferingStart:7,StallStart:8,StallStop:9,RebufferingStart:10,RebufferingStop:11,Seek:12,LayerSwitch:13,AdBreakStart:14,AdBreakStop:15,NetworkAvailable:16,NetworkLost:17,Mute:18,Unmute:19,DataSummary:144,EmptySummary:145},yr=[pr.RedirectionEnd,pr.Pause,pr.Resume,pr.BufferingStart,pr.StallStart,pr.StallStop,pr.RebufferingStart,pr.RebufferingStop,pr.AdBreakStart,pr.NetworkLost,pr.Mute,pr.Unmute],gr=[pr.Start],Er=[pr.LayerSwitch],Sr=[pr.FirstImage],br=[pr.Seek],kr=[pr.Stop],mr=[pr.AdBreakStop],_r=[pr.NetworkAvailable],Ar="BpkSessionTrackerEvent",Nr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),vr(this,"eventId",void 0),vr(this,"eventDate",void 0),vr(this,"eventData",void 0),vr(this,"startStopEvent",void 0),vr(this,"startEventId",void 0),vr(this,"stopEventId",void 0),vr(this,"triggerStartEventId",void 0),vr(this,"keepLastOnly",void 0),vr(this,"attachEventId",void 0),vr(this,"attachMaxDurationBeforeStart",void 0),vr(this,"startEvent",void 0),vr(this,"stopEvent",void 0),vr(this,"attachedEvent",void 0),vr(this,"compressed",void 0),vr(this,"compressedData",void 0),this.eventId=t,this.eventDate=Date.now(),this.eventData={},this.startStopEvent=!1,this.startEventId=0,this.stopEventId=0,this.triggerStartEventId=0,this.keepLastOnly=!1,this.attachEventId=0,this.attachMaxDurationBeforeStart=-1,this.startEvent=null,this.stopEvent=null,this.attachedEvent=null,this.addDataSizeInTimeline=!1,this.compressed=!1,this.compressedData=void 0,this.updateMetadata()}var t,i;return t=e,(i=[{key:"updateMetadata",value:function(){switch(this.startStopEvent=!1,this.startEventId=pr.None,this.stopEventId=pr.None,this.triggerStartEventId=pr.None,this.keepLastOnly=!1,this.attachEventId=pr.None,this.attachMaxDurationBeforeStart=-1,this.eventId){case pr.None:break;case pr.Start:this.startStopEvent=!0,this.startEventId=pr.Start,this.stopEventId=pr.Stop,this.addDataSizeInTimeline=!0;break;case pr.Stop:this.startStopEvent=!0,this.startEventId=pr.Start,this.stopEventId=pr.Stop;break;case pr.RedirectionEnd:this.startStopEvent=!1,this.attachEventId=pr.Start;break;case pr.FirstImage:this.startStopEvent=!1,this.keepLastOnly=!0,this.attachEventId=pr.RedirectionEnd;break;case pr.Pause:case pr.Resume:this.startStopEvent=!0,this.startEventId=pr.Pause,this.stopEventId=pr.Resume;break;case pr.BufferingStart:this.startStopEvent=!1;break;case pr.StallStart:this.startStopEvent=!0,this.startEventId=pr.StallStart,this.stopEventId=pr.StallStop;break;case pr.StallStop:this.startStopEvent=!0,this.startEventId=pr.StallStart,this.stopEventId=pr.StallStop,this.triggerStartEventId=pr.BufferingStart;break;case pr.RebufferingStart:this.startStopEvent=!0,this.startEventId=pr.RebufferingStart,this.stopEventId=pr.RebufferingStop;break;case pr.RebufferingStop:this.startStopEvent=!0,this.startEventId=pr.RebufferingStart,this.stopEventId=pr.RebufferingStop,this.triggerStartEventId=pr.BufferingStart,this.attachEventId=pr.Seek,this.attachMaxDurationBeforeStart=hr.MAX_TIME_BETWEEN_SEEK_AND_REBUFFERING;break;case pr.Seek:case pr.LayerSwitch:this.startStopEvent=!1;break;case pr.AdBreakStart:this.startStopEvent=!0,this.startEventId=pr.AdBreakStart,this.stopEventId=pr.AdBreakStop;break;case pr.AdBreakStop:this.startStopEvent=!0,this.startEventId=pr.AdBreakStart,this.stopEventId=pr.AdBreakStop,this.attachEventId=pr.Seek,this.attachMaxDurationBeforeStart=0;break;case pr.NetworkAvailable:case pr.NetworkLost:this.startStopEvent=!1;break;case pr.Mute:case pr.Unmute:this.startStopEvent=!1,this.addDataSizeInTimeline=!0}}},{key:"getEventName",value:function(){switch(this.eventId){case pr.None:return"None";case pr.Start:return"Start";case pr.Stop:return"Stop";case pr.RedirectionEnd:return"RedirectionEnd";case pr.FirstImage:return"FirstImage";case pr.Pause:return"Pause";case pr.Resume:return"Resume";case pr.BufferingStart:return"BufferingStart";case pr.StallStart:return"StallStart";case pr.StallStop:return"StallStop";case pr.RebufferingStart:return"RebufferingStart";case pr.RebufferingStop:return"RebufferingStop";case pr.Seek:return"Seek";case pr.LayerSwitch:return"LayerSwitch";case pr.AdBreakStart:return"AdBreakStart";case pr.AdBreakStop:return"AdBreakStop";case pr.NetworkAvailable:return"NetworkAvailable";case pr.NetworkLost:return"NetworkLost";case pr.Mute:return"Mute";case pr.Unmute:return"Unmute"}return""}},{key:"isStartEvent",value:function(){return this.startStopEvent&&this.eventId===this.startEventId}},{key:"isStopEvent",value:function(){return this.startStopEvent&&this.eventId===this.stopEventId}},{key:"addEventData",value:function(e,t){"string"==typeof e&&(this.eventData[e]=t)}},{key:"toData",value:function(e){for(var t=Math.abs(this.eventDate-e)/100,i=I.floor(t/65535),n=t%65535,r=Object.keys(this.eventData).length,a=3*i+1+2+2*r+(this.addDataSizeInTimeline?1:0),s=new nr(a),o=0;o<i;o++)s.put(pr.None),s.put(255),s.put(255);switch(s.put(this.eventId),s.putChar(n),this.addDataSizeInTimeline&&s.put(2*r),this.eventId){case pr.Start:var u=parseInt(this.eventData.networkType,10),l=parseInt(this.eventData.muteState,10);s.putChar(u),s.putChar(l);break;case pr.Stop:var c=parseInt(this.eventData.statusCode,10);s.putChar(c);break;case pr.FirstImage:var d=parseInt(this.eventData.bitrate,10),h=parseInt(this.eventData.position,10);s.putChar(d),s.putChar(h);break;case pr.Seek:var f=parseInt(this.eventData.positionStart,10),v=parseInt(this.eventData.positionEnd,10);s.putChar(f),s.putChar(v);break;case pr.LayerSwitch:var p=parseInt(this.eventData.bitrate,10);s.putChar(p);break;case pr.AdBreakStop:var y=parseInt(this.eventData.progress,10);s.putChar(y);break;case pr.NetworkAvailable:var g=parseInt(this.eventData.state,10);s.putChar(g)}return s}},{key:"formatDate",value:function(e){return ti.formatDate(new Date(e))}},{key:"print",value:function(){for(var e in P.v(Ar,"   |"),P.v(Ar,"   ├--\x3e "+this.getEventName()+" -> "+(!0===this.compressed?"compressed":"not compressed")+" -> "+this.eventDate),P.v(Ar,"   |      date: "+this.formatDate(this.eventDate)),this.eventData)P.v(Ar,"   |      "+e+": "+this.eventData[e]);this.isStartEvent()&&null!==this.stopEvent&&P.v(Ar,"   |      stop event: "+this.stopEvent.getEventName()+" "+this.stopEvent.eventDate),this.isStopEvent()&&null!==this.startEvent&&P.v(Ar,"   |      start event: "+this.startEvent.getEventName()+" "+this.startEvent.eventDate),null!==this.attachedEvent&&P.v(Ar,"   |      attached event: "+this.attachedEvent.getEventName()+" "+this.attachedEvent.eventDate)}},{key:"toString",value:function(){return this.getEventName()+" ("+this.formatDate(this.eventDate)+")"}}])&&fr(t.prototype,i),e}();function Rr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Dr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Pr=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Dr(this,"timeline",void 0),Dr(this,"minIndex",void 0),Dr(this,"initialBitrate",void 0),Dr(this,"builder",void 0),Dr(this,"summaryDuration",void 0),Dr(this,"pauseDuration",void 0),Dr(this,"nbNetworkDisconnected",void 0),Dr(this,"nbNetworkWifi",void 0),Dr(this,"nbNetworkMobile",void 0),Dr(this,"nbNetworkEthernet",void 0),Dr(this,"lastNetworkState",void 0),Dr(this,"muteDuration",void 0),Dr(this,"lastMuteState",void 0),this.timeline=t,this.minIndex=i,this.initialBitrate=void 0,this.builder=void 0,this.summaryDuration=0,this.pauseDuration=0,this.nbNetworkDisconnected=0,this.nbNetworkWifi=0,this.nbNetworkMobile=0,this.nbNetworkEthernet=0,this.lastNetworkState=void 0,this.muteDuration=0,this.lastMuteState=void 0,this.init()}var t,i;return t=e,(i=[{key:"init",value:function(){for(var e=this.minIndex;e>=0;e--){var t=this.timeline.events[e];switch(t.eventId){case pr.LayerSwitch:case pr.FirstImage:void 0===this.initialBitrate&&(this.initialBitrate=parseInt(t.eventData.bitrate,10));break;case pr.Start:void 0===this.lastNetworkState&&(this.lastNetworkState=parseInt(t.eventData.networkType,10)),void 0===this.lastMuteState&&(this.lastMuteState=parseInt(t.eventData.muteState,10));break;case pr.NetworkAvailable:void 0===this.lastNetworkState&&(this.lastNetworkState=parseInt(t.eventData.state,10));break;case pr.NetworkLost:void 0===this.lastNetworkState&&(this.lastNetworkState=0);break;case pr.Mute:void 0===this.lastMuteState&&(this.lastMuteState=1);break;case pr.Unmute:void 0===this.lastMuteState&&(this.lastMuteState=0)}}void 0!==this.initialBitrate&&0!==this.initialBitrate||(this.initialBitrate=-1),void 0===this.lastNetworkState&&(this.lastNetworkState=1),void 0===this.lastMuteState&&(this.lastMuteState=0)}},{key:"update",value:function(e){if(!(this.minIndex>=this.timeline.events.length||e>=this.timeline.events.length)){var t,i,n,r=this.timeline.events[this.minIndex],a=this.timeline.events[e],s=this.initialBitrate,o=r.eventDate,u=1===this.lastMuteState?r.eventDate:-1;this.builder=new ur,this.summaryDuration=a.eventDate-r.eventDate,this.pauseDuration=0,this.nbNetworkDisconnected=0,this.nbNetworkWifi=0,this.nbNetworkMobile=0,this.nbNetworkEthernet=0,this.muteDuration=0;for(var l=this.minIndex;l<=e;l++){var c=this.timeline.events[l];switch(c.eventId){case pr.Pause:!1!==t&&void 0!==t||(null!==c.stopEvent&&c.stopEvent.eventDate<=a.eventDate&&(this.pauseDuration+=c.stopEvent.eventDate-c.eventDate),t=!0);break;case pr.Resume:void 0===t&&(this.pauseDuration+=c.eventDate-r.eventDate),t=!1;break;case pr.StallStart:!1!==i&&void 0!==i||(null!==c.stopEvent&&c.stopEvent.eventDate<=a.eventDate&&this.builder.addStall(c.stopEvent.eventDate-c.eventDate),i=!0);break;case pr.StallStop:void 0===i&&this.builder.addStall(c.eventDate-r.eventDate),i=!1;break;case pr.RebufferingStart:!1!==n&&void 0!==n||(null!==c.stopEvent&&c.stopEvent.eventDate<=a.eventDate&&this.builder.addRebuffering(c.stopEvent.eventDate-c.eventDate),n=!0);break;case pr.RebufferingStop:void 0===n&&this.builder.addRebuffering(c.eventDate-r.eventDate),n=!1;break;case pr.LayerSwitch:this.builder.addLayerSwitch(),-1!==s&&this.builder.addTimeSpentPerLayer(s,c.eventDate-o),s=parseInt(c.eventData.bitrate,10),o=c.eventDate;break;case pr.NetworkAvailable:this.lastNetworkState=parseInt(c.eventData.state,10),this.lastNetworkState>=10&&this.lastNetworkState<20?this.nbNetworkWifi++:this.lastNetworkState>=20&&this.lastNetworkState<30?this.nbNetworkMobile++:this.lastNetworkState>=30&&this.lastNetworkState<40&&this.nbNetworkEthernet++;break;case pr.NetworkLost:this.lastNetworkState=0,this.nbNetworkDisconnected++;break;case pr.Mute:this.lastMuteState=1,u=c.eventDate;break;case pr.Unmute:this.lastMuteState=0,-1!==u&&(this.muteDuration+=c.eventDate-u,u=-1)}}-1!==s&&this.builder.addTimeSpentPerLayer(s,a.eventDate-o),-1!==u&&(this.muteDuration+=a.eventDate-u),this.builder.build()}}},{key:"data",value:function(){if(void 0===this.builder)return nr.EMPTY;var t=new nr(e.BUFFER_SIZE),i=this.builder.metrics;return t.put(pr.DataSummary).putChar(Math.round(this.summaryDuration/1e3)).put(e.BUFFER_SIZE-2-1-1).putChar(this.pauseDuration/100).put(i.stallsNumber).putChar(i.totalStallsDuration/100).put(i.rebufferingsNumber).putChar(i.totalRebufferingDuration/100).put(i.layerSwitchesNumber).putChar(i.minBitrate).putChar(i.maxBitrate).putChar(i.averageBitrate).put(this.nbNetworkDisconnected).put(this.nbNetworkWifi).put(this.nbNetworkMobile).put(this.nbNetworkEthernet).putChar(this.lastNetworkState).putChar(Math.round(this.muteDuration/1e3)).put(this.lastMuteState),t}},{key:"toString",value:function(){if(void 0===this.builder)return"no data";var e=this.builder.metrics;return this.summaryDuration+", "+this.pauseDuration+", "+e.minBitrate+", "+e.maxBitrate+", "+e.layerSwitchesNumber+", "+e.averageBitrate+", "+e.stallsNumber+", "+e.totalStallsDuration+", "+e.rebufferingsNumber+", "+e.totalRebufferingDuration+", "+this.nbNetworkDisconnected+", "+this.nbNetworkWifi+", "+this.nbNetworkMobile+", "+this.nbNetworkEthernet+", "+this.lastNetworkState+", "+this.muteDuration+", "+this.lastMuteState}}])&&Rr(t.prototype,i),e}();function Tr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Or(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Dr(Pr,"BUFFER_SIZE",28);var Lr="BpkSessionTrackerEncoder",Cr=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_BUFFER_SIZE,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.DEFAULT_END_EVENTS_DURATION,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DEFAULT_END_EVENTS_NUMBER;Tr(this,e),Or(this,"timeline",void 0),Or(this,"maxBufferSize",void 0),Or(this,"maxEndEventsDuration",void 0),Or(this,"maxEndEventsNumber",void 0),Or(this,"events",void 0),Or(this,"uncompressedData",void 0),Or(this,"uncompressedDataFull",void 0),Or(this,"compressedStartData",void 0),Or(this,"minSummaryIndex",void 0),Or(this,"maxEndBufferSize",void 0),Or(this,"summary",void 0),this.maxBufferSize=i,this.maxEndEventsDuration=n,this.maxEndEventsNumber=r,this.timeline=t,this.events=this.timeline.events,this.uncompressedData=new nr(this.maxBufferSize),this.uncompressedDataFull=!1,this.compressedStartData=void 0,this.minSummaryIndex=0,this.maxEndBufferSize=this.maxBufferSize,this.summary=void 0}var t,i;return t=e,(i=[{key:"onEventAdded",value:function(e){if(!this.uncompressedDataFull){var t=e;this.events.length>=2&&(t=this.events[this.events.length-2]),e.compressedData=e.toData(t.eventDate),e.compressed=!0,e.compressedData.capacity()<=this.uncompressedData.remaining()?this.uncompressedData.putByteBuffer(e.compressedData):(this.uncompressedDataFull=!0,this.compressedStartData=new nr(this.maxBufferSize))}}},{key:"onEventUpdated",value:function(){this.uncompressedData=new nr(this.maxBufferSize);for(var e=0;e<this.events.length;e++)void 0!==this.events[e].compressedData&&this.uncompressedData.putByteBuffer(this.events[e].compressedData)}},{key:"process",value:function(){var e=Date.now();if(!this.uncompressedDataFull)return P.d(Lr,"Timeline encoder generated uncompressed data ("+this.events.length+" events, "+this.uncompressedData.length()+" bytes)"),this.uncompressedData;for(var t,i="",n=[],r=0,a=this.events.length-1;a>=0;a--){var s=this.events[a];if(!(e-s.eventDate<this.maxEndEventsDuration&&n.length<this.maxEndEventsNumber)){t=a;break}var o=void 0;if(a<this.events.length-1){var u=this.events[a+1];o=s.toData(u.eventDate)}else o=s.toData(s.eventDate);if(!(r+o.length()<=this.maxEndBufferSize)){t=a;break}n.push(o),r+=o.length()}if(0===this.compressedStartData.length()){this.minSummaryIndex=t;for(var l=this.maxBufferSize-Pr.BUFFER_SIZE-r,c=0;c<t;c++){var d=this.events[c];if(this.compressedStartData.length()+d.compressedData.length()>l){this.minSummaryIndex=c;break}this.compressedStartData.putByteBuffer(d.compressedData)}this.maxEndBufferSize=this.compressedStartData.remaining()-Pr.BUFFER_SIZE,this.uncompressedData=void 0,i+="first iteration, "}var h=new nr(this.maxBufferSize);if(h.putByteBuffer(this.compressedStartData,this.compressedStartData.length()),this.minSummaryIndex===t)h.put(pr.EmptySummary),i+="no summary";else{void 0===this.summary&&(this.summary=new Pr(this.timeline,this.minSummaryIndex)),this.summary.update(t);var f=this.summary.data();h.putByteBuffer(f),i+="summary {"+this.summary.toString()+"}"}for(var v=0;v<n.length;v++)h.putByteBuffer(n[v]);return P.d(Lr,"Timeline encoder generated compressed data ("+this.events.length+" events before encoding, "+(this.minSummaryIndex+n.length)+" events after encoding, "+h.length()+" bytes, ~"+(Date.now()-e)+"ms, "+i+")"),h}},{key:"extend",value:function(){if(this.uncompressedDataFull)P.w(Lr,"Failed to extend size from "+e.DEFAULT_BUFFER_SIZE+" to 768");else{this.maxBufferSize=768,this.maxEndEventsDuration=4e4,this.maxEndEventsNumber=40;var t=this.uncompressedData;this.uncompressedData=new nr(this.maxBufferSize),this.uncompressedData.putByteBuffer(t,t.length()),P.v(Lr,"Extended size from "+e.DEFAULT_BUFFER_SIZE+" to 768")}}}])&&wr(t.prototype,i),e}();function Ir(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Mr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Or(Cr,"DEFAULT_BUFFER_SIZE",384),Or(Cr,"DEFAULT_END_EVENTS_DURATION",15e3),Or(Cr,"DEFAULT_END_EVENTS_NUMBER",20);var Br="BpkSessionTrackerTimeline",Ur=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Mr(this,"session",void 0),Mr(this,"startDate",void 0),Mr(this,"stopDate",void 0),Mr(this,"events",void 0),Mr(this,"firstImageWithoutBitrateEvent",void 0),Mr(this,"encoder",void 0),this.startDate=null,this.stopDate=null,this.events=[],this.firstImageWithoutBitrateEvent=null,this.encoder=new Cr(this)}var t,i;return t=e,(i=[{key:"pushEvent",value:function(e){if(this.checkType(e,yr)){var t=this.createEvent(e);this.encoder.onEventAdded(t)}}},{key:"pushEventStart",value:function(e,t,i){if(this.checkType(e,gr)){var n=this.createEvent(e);n.addEventData("networkType",t),n.addEventData("muteState",i),this.encoder.onEventAdded(n)}}},{key:"pushEventBitrate",value:function(e,t){if(this.checkType(e,Er)){var i=this.createEvent(e);i.addEventData("bitrate",t),null!==this.firstImageWithoutBitrateEvent&&(this.firstImageWithoutBitrateEvent.addEventData("bitrate",t),this.firstImageWithoutBitrateEvent=null),this.encoder.onEventAdded(i)}}},{key:"pushEventBitratePosition",value:function(e,t,i){if(this.checkType(e,Sr)){var n=this.createEvent(e);n.addEventData("bitrate",t),n.addEventData("position",i),e===pr.FirstImage&&t<=0&&(this.firstImageWithoutBitrateEvent=n),this.encoder.onEventAdded(n)}}},{key:"pushEventPositionStartEnd",value:function(e,t,i){if(this.checkType(e,br)){var n=this.createEvent(e);n.addEventData("positionStart",t),n.addEventData("positionEnd",i),this.encoder.onEventAdded(n)}}},{key:"pushEventStatusCode",value:function(e,t){if(this.checkType(e,kr)){var i=this.createEvent(e);i.addEventData("statusCode",t),this.encoder.onEventAdded(i)}}},{key:"pushEventProgress",value:function(e,t){if(this.checkType(e,mr)){var i=this.createEvent(e);i.addEventData("progress",t),this.encoder.onEventAdded(i)}}},{key:"pushEventState",value:function(e,t){if(this.checkType(e,_r)){var i=this.createEvent(e);i.addEventData("state",t),this.encoder.onEventAdded(i)}}},{key:"createEvent",value:function(e){var t=new Nr(e);return P.v(Br,"Creating event "+t.getEventName()+"..."),this.applyKeepLastOnly(t),this.events.push(t),this.updateTimelineProperties(t),this.reconciliateStopWithStartEvent(t),t}},{key:"checkType",value:function(e,t){return t.indexOf(e)>=0||(P.v(Br,"Can't push event '"+e+"' to timeline, invalid parameters"),!1)}},{key:"applyKeepLastOnly",value:function(e){if(e.keepLastOnly)for(var t=this.events.length-1;t>=0;t--)if(this.events[t].eventId===e.eventId)return this.events.splice(t,1),void this.encoder.onEventUpdated()}},{key:"attachEvent",value:function(e){if(e.attachEventId>pr.None){var t=-1;null!==e.startEvent&&-1!==e.attachMaxDurationBeforeStart&&(t=e.startEvent.eventDate-e.attachMaxDurationBeforeStart);for(var i=this.events.length-1;i>=0;i--){var n=this.events[i];if(n.eventId===e.attachEventId&&(-1===t||n.eventDate>=t))return void(e.attachedEvent=n)}}}},{key:"updateTimelineProperties",value:function(e){switch(e.eventId){case pr.Start:this.startDate=Date.now();break;case pr.Stop:this.stopDate=Date.now()}}},{key:"reconciliateStopWithStartEvent",value:function(e){if(e.isStopEvent())for(var t=this.events.length-1;t>=0;t--){var i=this.events[t];if(i.eventId===e.startEventId)return i.stopEvent=e,void(e.startEvent=i);if(i.eventId===e.triggerStartEventId)return i.eventId=e.startEventId,i.startStopEvent=!0,i.startEventId=e.startEventId,i.stopEventId=e.stopEventId,void 0!==i.compressedData&&(i.compressedData.set(i.eventId,0),this.encoder.onEventUpdated()),i.stopEvent=e,void(e.startEvent=i)}}},{key:"onStart",value:function(e,t){this.pushEventStart(pr.Start,e,t)}},{key:"onRedirectionEnd",value:function(){this.pushEvent(pr.RedirectionEnd)}},{key:"onFirstImage",value:function(e,t){this.pushEventBitratePosition(pr.FirstImage,e,t)}},{key:"onStop",value:function(e){this.pushEventStatusCode(pr.Stop,e)}},{key:"onForeground",value:function(){P.d(Br,"Received event onForeground but ignored")}},{key:"onBackground",value:function(){P.d(Br,"Received event onBackground but ignored")}},{key:"onNetworkAvailable",value:function(e){P.v(Br,"Received event onNetworkAvailable type:"+e),this.pushEventState(pr.NetworkAvailable,e)}},{key:"onNetworkLost",value:function(){P.d(Br,"Received event onNetworkLost"),this.pushEvent(pr.NetworkLost)}},{key:"onMute",value:function(){P.d(Br,"Received event onMute"),this.pushEvent(pr.Mute)}},{key:"onUnmute",value:function(){P.d(Br,"Received event onUnmute"),this.pushEvent(pr.Unmute)}},{key:"data",value:function(){return this.encoder.process()}},{key:"formatDate",value:function(e){return ti.formatDate(new Date(e))}},{key:"print",value:function(){P.v(Br,"Timeline (startDate:"+this.formatDate(this.startDate)+", stopDate:"+this.formatDate(this.stopDate)+")");for(var e=0;e<this.events.length;e++)this.events[e].print()}},{key:"toString",value:function(){for(var e=[],t=0;t<this.events.length;t++)e.push(this.events[t].toString());return e.join(", ")}}])&&Ir(t.prototype,i),e}();function jr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fr(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,xr(e,t,"get"))}function xr(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}Yt.analyticsModule={PlayerManager:Gn,PlayerAdapter:un,GenericPlayerAdapter:Sn,PlayerEventListener:Nn,GenericPlayerApi:Yn,AnalyticsRequestManager:$n,SessionTrackerTimeline:Ur,SessionTrackerEvent:Nr,SessionTrackerEvents:pr,Metrics:or,MetricsManager:hr};var Vr=new WeakMap,Gr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Vr.set(this,{writable:!0,value:void 0})}var t,i;return t=e,(i=[{key:"loadPlayerAdapters",value:function(){var e,t,i,n,r,a,s,o,u,l,c;return function(e,t,i){!function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,xr(e,t,"set"),i)}(this,Vr,{}),Fr(this,Vr).generic=Sn,this.addAdapter("shaka",null===(e=tn.shakaModule)||void 0===e?void 0:e.ShakaPlayerAdapter),this.addAdapter("dashjs",null===(t=tn.dashjsModule)||void 0===t?void 0:t.DashJsPlayerAdapter),this.addAdapter("html5",null===(i=tn.html5Module)||void 0===i?void 0:i.HTML5PlayerAdapter),this.addAdapter("avplay",null===(n=tn.avplayModule)||void 0===n?void 0:n.AVPlayAdapter),this.addAdapter("diw387",null===(r=tn.diw387Module)||void 0===r?void 0:r.SagemcomDIW387Adapter),this.addAdapter("hbbtv1",null===(a=tn.hbbtv1Module)||void 0===a?void 0:a.HbbTV1PlayerAdapter),this.addAdapter("kaltura",null===(s=tn.kalturaModule)||void 0===s?void 0:s.KalturaPlayerAdapter),this.addAdapter("connectplayer",null===(o=tn.connectplayerModule)||void 0===o?void 0:o.ConnectPlayerAdapter),this.addAdapter("rxplayer",null===(u=tn.rxplayerModule)||void 0===u?void 0:u.RxPlayerAdapter),this.addAdapter("hlsjs",null===(l=tn.hlsjsModule)||void 0===l?void 0:l.HlsJsPlayerAdapter),this.addAdapter("bitmovin",null===(c=tn.bitmovinModule)||void 0===c?void 0:c.BitmovinPlayerAdapter),Fr(this,Vr)}},{key:"addAdapter",value:function(e,t){void 0!==t&&(Fr(this,Vr)[e]=t)}},{key:"attachPlayer",value:function(e,t){for(var i in Fr(this,Vr))if(void 0!==Fr(this,Vr)[i]&&Fr(this,Vr)[i].checkPlayer(e,t)){var n=new(Fr(this,Vr)[i]);return n.attachPlayer(e,t),n}}}])&&jr(t.prototype,i),e}();function Hr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Wr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qr(e,t,i){return t&&Wr(e.prototype,t),i&&Wr(e,i),e}function Yr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}tn.analyticsModule={PlayerManagerHandler:Gr,PlayerEventListener:Nn,GenericPlayerApi:Yn},tn.getInstance().registerPlayerAdapters();var Kr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;Hr(this,e),Yr(this,"adSkippable",void 0),Yr(this,"adSkipped",void 0),Yr(this,"adProgress",void 0),Yr(this,"adDuration",void 0),Yr(this,"stallsNumber",void 0),Yr(this,"stallsDuration",void 0),Yr(this,"layerSwitchesNumber",void 0),Yr(this,"averageBitrate",void 0),Yr(this,"sessionToken",void 0),Yr(this,"creativeId",void 0),Yr(this,"adId",void 0),void 0===t?(this.adSkippable=!1,this.adSkipped=!1,this.adProgress=-1,this.adDuration=0,this.stallsNumber=0,this.stallsDuration=0,this.layerSwitchesNumber=0,this.averageBitrate=0,this.sessionToken="",this.creativeId="",this.adId=""):(this.adSkippable=t.adSkippable,this.adSkipped=t.adSkipped,this.adProgress=t.adProgress,this.adDuration=t.adDuration,this.stallsNumber=t.stallsNumber,this.stallsDuration=t.stallsDuration,this.layerSwitchesNumber=t.layerSwitchesNumber,this.averageBitrate=t.averageBitrate,this.sessionToken=t.sessionToken,this.creativeId=t.creativeId,this.adId=t.adId)}return qr(e,[{key:"toString",value:function(){return"\n{ adSkippable="+this.adSkippable+"\n  adSkipped="+this.adSkipped+"\n  adProgress="+this.adProgress+"\n  adDuration="+this.adDuration+"\n  stallsNumber="+this.stallsNumber+"\n  stallsDuration="+this.stallsDuration+"\n  layerSwitchesNumber="+this.layerSwitchesNumber+"\n  averageBitrate="+this.averageBitrate+"\n  sessionToken='"+this.sessionToken+"'\n  creativeId='"+this.creativeId+"'\n  adId='"+this.adId+"' }"}}],[{key:"merge",value:function(t){if(void 0!==t&&t.length>0){var i=new e,n=t[t.length-1];i.adSkippable=n.adSkippable,i.adSkipped=n.adSkipped,i.adProgress=n.adProgress,i.sessionToken=n.sessionToken,i.creativeId=n.creativeId,i.adId=n.adId;for(var r=0,a=0,s=0;s<t.length;s++){var o=t[s];i.adDuration+=o.adDuration,i.stallsNumber+=o.stallsNumber,i.stallsDuration+=o.stallsDuration,i.layerSwitchesNumber+=o.layerSwitchesNumber,r+=o.averageBitrate*o.adDuration,a+=o.adDuration}return 0!==a&&(i.averageBitrate=Math.round(r/a)),i}}}]),e}(),Qr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;Hr(this,e),Yr(this,"adMetrics",void 0),Yr(this,"timeSpentPerLayer",void 0),void 0===t&&void 0===i?(this.timeSpentPerLayer={},this.reset()):(this.adMetrics=t,this.timeSpentPerLayer=i)}return qr(e,[{key:"setAdSkippable",value:function(e){return this.adMetrics.adSkippable=e,this}},{key:"setAdSkipped",value:function(e){return this.adMetrics.adSkipped=e,this}},{key:"setAdProgress",value:function(e){return this.adMetrics.adProgress=e,this}},{key:"setSessionToken",value:function(e){return this.adMetrics.sessionToken=e,this}},{key:"setCreativeId",value:function(e){return this.adMetrics.creativeId=e,this}},{key:"setAdId",value:function(e){return this.adMetrics.adId=e,this}},{key:"addTimeSpentPerLayer",value:function(e,t){return(e=Math.round(e))>0&&(void 0!==this.timeSpentPerLayer[e]?this.timeSpentPerLayer[e]+=t:this.timeSpentPerLayer[e]=t),this}},{key:"addLayerSwitch",value:function(){return this.adMetrics.layerSwitchesNumber++,this}},{key:"addStall",value:function(e){return this.adMetrics.stallsNumber++,this.adMetrics.stallsDuration+=e,this}},{key:"reset",value:function(){return this.adMetrics=new Kr,this.timeSpentPerLayer={},this}},{key:"clone",value:function(){return new e(new Kr(this.adMetrics),Object.assign({},this.timeSpentPerLayer))}},{key:"build",value:function(){var e=0,t=0;for(var i in this.timeSpentPerLayer){var n=this.timeSpentPerLayer[i];e+=i*n,t+=n}return 0!==t&&(this.adMetrics.averageBitrate=Math.round(e/t)),this.adMetrics.adDuration=t,this.adMetrics}}]),e}();function zr(e){return(zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jr(e,t){return(Jr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xr(e,t){return!t||"object"!==zr(t)&&"function"!=typeof t?Zr(e):t}function Zr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $r(e){return($r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ea(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ta(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ia(e,t,i){return t&&ta(e.prototype,t),i&&ta(e,i),e}function na(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ra="BpkAdLegacyTracker",aa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jr(e,t)}(i,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=$r(e);if(t){var r=$r(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Xr(this,i)}}(i);function i(e,n){var r,a;return ea(this,i),na(Zr(a=t.call(this,n)),"session",void 0),na(Zr(a),"adTrackingManager",void 0),na(Zr(a),"adListener",void 0),a.session=e,a.adTrackingManager=e.adTrackingManager,a.adListener=null===(r=e.adSession)||void 0===r?void 0:r.adEventsListener,a}return ia(i,[{key:"process",value:function(){var e=this.url.substring(i.SMARTLIB_PREFIX.length).split("/");if(e[0]===i.AD_BREAKS_TYPE&&e.length>=3)return this.onAdBreak(e[1],e[2]);if(e[0]===i.AD_TRACKER_TYPE&&e.length>=5)return this.onAdTracker(e[1],e[2],e[3],e[4]);if(e[0]===i.AD_SKIP_TYPE&&e.length>=5){var t=parseInt(e[3],10),n=parseInt(e[4],10);if(Number.isInteger(t)&&Number.isInteger(n))return this.onAdSkip(e[1],e[2],t,n)}else P.d(ra,"Cannot parse event type with URL "+this.url);return!1}},{key:"onAdBreak",value:function(e,t){return e===i.AD_BREAKS_ACTION_BEGIN?(P.d(ra,"Ad breaks begin"),void 0!==this.adListener&&this.adListener.onAdBreakBegin(-1,-1),this.adTrackingManager.notifyAdBreakBegin(t),!0):e===i.AD_BREAKS_ACTION_END&&(P.d(ra,"Ad breaks ended"),void 0!==this.adListener&&this.adListener.onAdBreakEnd(),this.adTrackingManager.notifyAdBreakEnd(t),!0)}},{key:"onAdTracker",value:function(e,t,n,r){switch(e){case i.AD_TRACKER_ACTION_BEGIN:return P.d(ra,"Ad start"),void 0!==this.adListener&&this.adListener.onAdBegin(-1,-1,""),this.adTrackingManager.notifyAdBegin(t,n,r),this.adTrackingManager.notifyAdProgress(t,n,r,0),!0;case i.AD_TRACKER_ACTION_25:return P.d(ra,"Ad progress 25%"),this.adTrackingManager.notifyAdProgress(t,n,r,25),!0;case i.AD_TRACKER_ACTION_50:return P.d(ra,"Ad progress 50%"),this.adTrackingManager.notifyAdProgress(t,n,r,50),!0;case i.AD_TRACKER_ACTION_75:return P.d(ra,"Ad progress 75%"),this.adTrackingManager.notifyAdProgress(t,n,r,75),!0;case i.AD_TRACKER_ACTION_END:return P.d(ra,"Ad end"),void 0!==this.adListener&&this.adListener.onAdEnd(),this.adTrackingManager.notifyAdProgress(t,n,r,100),this.adTrackingManager.notifyAdEnd(t,n,r),!0}return!1}},{key:"onAdSkip",value:function(e,t,n,r){return e===i.AD_SKIP_ACTION_SKIPPABLE&&(P.d(ra,"Ad skippable"),void 0!==this.adListener&&this.adListener.onAdSkippable(n,r),this.adTrackingManager.notifyAdSkippable(t,n,r),!0)}}]),i}(function(){function e(t){ea(this,e),na(this,"url",void 0),this.url=t}return ia(e,[{key:"process",value:function(){throw new Error("AdTracker is an abstract class")}}]),e}());function sa(e){return(sa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oa(e,t,i){return(oa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ha(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function ua(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function la(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ha(e);if(t){var r=ha(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return ca(this,i)}}function ca(e,t){return!t||"object"!==sa(t)&&"function"!=typeof t?da(e):t}function da(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ha(e){return(ha=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function va(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function pa(e,t,i){return t&&va(e.prototype,t),i&&va(e,i),e}function ya(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}na(aa,"SMARTLIB_PREFIX","http://smartlib.broadpeak.tv/"),na(aa,"AD_BREAKS_TYPE","adbreaks"),na(aa,"AD_BREAKS_ACTION_BEGIN","begin"),na(aa,"AD_BREAKS_ACTION_END","end"),na(aa,"AD_TRACKER_TYPE","adtracker"),na(aa,"AD_TRACKER_ACTION_BEGIN","progress_begin"),na(aa,"AD_TRACKER_ACTION_25","progress_25"),na(aa,"AD_TRACKER_ACTION_50","progress_middle"),na(aa,"AD_TRACKER_ACTION_75","progress_75"),na(aa,"AD_TRACKER_ACTION_END","progress_end"),na(aa,"AD_SKIP_TYPE","adskip"),na(aa,"AD_SKIP_ACTION_SKIPPABLE","skippable");var ga="BpkAdTracker",Ea=function(){function e(){fa(this,e),ya(this,"processDate",void 0),this.processDate=0}return pa(e,[{key:"canProcess",value:function(){return Date.now()-this.processDate>qa.POSITION_SEEK_ERROR_DELTA}},{key:"process",value:function(){return!!this.canProcess()&&(this.processDate=Date.now(),!0)}}]),e}(),Sa=function(e){ua(i,e);var t=la(i);function i(e,n){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return fa(this,i),ya(da(r=t.call(this)),"session",void 0),ya(da(r),"url",void 0),ya(da(r),"sessionToken",void 0),ya(da(r),"adBreakId",void 0),ya(da(r),"adId",void 0),r.session=e,r.url=n,r.sessionToken=a,r.adBreakId=s,r.adId=o,r}return pa(i,[{key:"process",value:function(){return!!oa(ha(i.prototype),"process",this).call(this)&&(P.d(ga,"Requesting "+this.url,this.session.id),be.getInstance().adEvent(this.session,this.url),!0)}}]),i}(Ea),ba=function(e){ua(i,e);var t=la(i);function i(e,n,r){var a,s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return fa(this,i),ya(da(s=t.call(this)),"session",void 0),ya(da(s),"adTrackingManager",void 0),ya(da(s),"adListener",void 0),ya(da(s),"sessionToken",void 0),ya(da(s),"adBreakId",void 0),ya(da(s),"adId",void 0),s.session=e,s.adTrackingManager=e.adTrackingManager,s.adListener=null===(a=e.adSession)||void 0===a?void 0:a.adEventsListener,s.sessionToken=n,s.adBreakId=r,s.adId=o,s}return pa(i,[{key:"process",value:function(){return oa(ha(i.prototype),"process",this).call(this)}}]),i}(Ea),ka=function(e){ua(i,e);var t=la(i);function i(e,n,r,a){var s;return fa(this,i),ya(da(s=t.call(this,e,n,r)),"adBreakData",void 0),s.adBreakData=a,s}return pa(i,[{key:"process",value:function(){return!!oa(ha(i.prototype),"process",this).call(this)&&(P.d(ga,"Ad break data"),this.adTrackingManager.notifyAdBreakData(this.adBreakData),!0)}}]),i}(ba),ma=function(e){ua(i,e);var t=la(i);function i(e,n,r){var a;return fa(this,i),ya(da(a=t.call(this,e,n,r)),"adBreakEnd",void 0),ya(da(a),"adBreakData",void 0),ya(da(a),"position",void 0),a}return pa(i,[{key:"process",value:function(){if(!oa(ha(i.prototype),"process",this).call(this))return!1;if(P.d(ga,"Ad break begin"),void 0!==this.adListener){var e=this.adBreakData.tracker.adBreakData;this.adListener.onAdBreakBegin(this.position,e.duration)}return this.adTrackingManager.notifyAdBreakBegin(this.sessionToken),!0}}]),i}(ba),_a=function(e){ua(i,e);var t=la(i);function i(e,n,r){return fa(this,i),t.call(this,e,n,r)}return pa(i,[{key:"process",value:function(){return!!oa(ha(i.prototype),"process",this).call(this)&&(P.d(ga,"Ad break ended"),void 0!==this.adListener&&this.adListener.onAdBreakEnd(),this.adTrackingManager.notifyAdBreakEnd(this.sessionToken),!0)}}]),i}(ba),Aa=function(e){ua(i,e);var t=la(i);function i(e,n,r,a){var s;return fa(this,i),ya(da(s=t.call(this,e,n,r,a.adId)),"adData",void 0),s.adData=a,s}return pa(i,[{key:"process",value:function(){return!!oa(ha(i.prototype),"process",this).call(this)&&(P.d(ga,"Ad data"),this.adTrackingManager.notifyAdData(this.adData),!0)}}]),i}(ba),Na=function(e){ua(i,e);var t=la(i);function i(e,n,r,a,s,o){var u;return fa(this,i),ya(da(u=t.call(this,e,n,r,s)),"creativeId",void 0),ya(da(u),"adProgress",void 0),ya(da(u),"position",void 0),u.creativeId=a,u.adProgress=o,u}return pa(i,[{key:"process",value:function(){if(!oa(ha(i.prototype),"process",this).call(this))return!1;switch(this.adProgress){case 0:P.d(ga,"Ad start"),this.adTrackingManager.notifyAdBegin(this.sessionToken,this.creativeId,this.adId),this.adTrackingManager.notifyAdProgress(this.sessionToken,this.creativeId,this.adId,0);break;case 25:P.d(ga,"Ad progress 25%"),this.adTrackingManager.notifyAdProgress(this.sessionToken,this.creativeId,this.adId,25);break;case 50:P.d(ga,"Ad progress 50%"),this.adTrackingManager.notifyAdProgress(this.sessionToken,this.creativeId,this.adId,50);break;case 75:P.d(ga,"Ad progress 75%"),this.adTrackingManager.notifyAdProgress(this.sessionToken,this.creativeId,this.adId,75);break;case 100:P.d(ga,"Ad end"),void 0!==this.adListener&&this.adListener.onAdEnd(),this.adTrackingManager.notifyAdProgress(this.sessionToken,this.creativeId,this.adId,100),this.adTrackingManager.notifyAdEnd(this.sessionToken,this.creativeId,this.adId)}return!0}},{key:"skipped",value:function(){this.adTrackingManager.notifyAdSkipped(this.sessionToken,this.creativeId,this.adId)}}]),i}(ba),Ra=function(e){ua(i,e);var t=la(i);function i(e,n,r,a,s,o){var u;return fa(this,i),ya(da(u=t.call(this,e,n,r,a,s,o)),"adBreakBegin",void 0),ya(da(u),"adEnd",void 0),ya(da(u),"adData",void 0),ya(da(u),"adSkippable",void 0),u}return pa(i,[{key:"process",value:function(){if(!this.canProcess())return!1;if(void 0!==this.adListener){var e=this.adData.tracker.adData;this.adListener.onAdBegin(this.position,e.duration,e.clickable.uri)}return oa(ha(i.prototype),"process",this).call(this)}}]),i}(Na),Da=function(e){ua(i,e);var t=la(i);function i(e,n,r,a,s,o,u){var l;return fa(this,i),ya(da(l=t.call(this,e,n,r,s)),"creativeId",void 0),ya(da(l),"offset",void 0),ya(da(l),"limit",void 0),l.creativeId=a,l.offset=o,l.limit=u,l}return pa(i,[{key:"process",value:function(){return!!oa(ha(i.prototype),"process",this).call(this)&&(P.d(ga,"Ad skippable"),void 0!==this.adListener&&this.adListener.onAdSkippable(this.offset,this.limit),this.adTrackingManager.notifyAdSkippable(this.sessionToken,this.offset,this.limit),!0)}}]),i}(ba),Pa=function(){function e(){fa(this,e)}return pa(e,null,[{key:"parseLegacyTracker",value:function(t,i){return e.isSmartLibPrefix(i)?new aa(t,i):new Sa(t,i)}},{key:"isSmartLibPrefix",value:function(e){return e.startsWith(aa.SMARTLIB_PREFIX)}}]),e}();function Ta(e){return(Ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wa(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Oa(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function La(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ma(e);if(t){var r=Ma(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Ca(this,i)}}function Ca(e,t){return!t||"object"!==Ta(t)&&"function"!=typeof t?Ia(e):t}function Ia(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ma(e){return(Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ba(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ua(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ja=function e(){Ba(this,e),Ua(this,"tracker",void 0)},Fa=function(e){Oa(i,e);var t=La(i);function i(){return Ba(this,i),t.apply(this,arguments)}return i}(ja),xa=function(e){Oa(i,e);var t=La(i);function i(){var e;Ba(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return Ua(Ia(e=t.call.apply(t,[this].concat(r))),"position",void 0),e}return i}(ja),Va=function(){function e(){Ba(this,e)}var t,i;return t=e,(i=[{key:"parseDashEvent",value:function(e,t){var i=new Fa;return i.tracker=Pa.parseLegacyTracker(e,t),i}},{key:"parseJSONEvent",value:function(e,t){var i=new xa;return i.tracker=Pa.parseLegacyTracker(e,t.url),i.position=t.position,i}},{key:"createAdBreakData",value:function(e,t,i,n,r){var a=new xa;return a.tracker=new ka(e,t,i,n),a.position=r,a}},{key:"createAdBreakBegin",value:function(e,t,i,n){var r=new xa;return r.tracker=new ma(e,t,i),r.tracker.position=n,r.position=n,r}},{key:"createAdBreakEnd",value:function(e,t,i,n){var r=new xa;return r.tracker=new _a(e,t,i),r.position=n,r}},{key:"createAdData",value:function(e,t,i,n,r){var a=new xa;return a.tracker=new Aa(e,t,i,n),a.position=r,a}},{key:"createAdProgress",value:function(e,t,i,n,r,a,s){var o=new xa;return o.tracker=0===a?new Ra(e,t,i,n,r,a):new Na(e,t,i,n,r,a),o.tracker.position=s,o.position=s,o}},{key:"createAdSkippable",value:function(e,t,i,n,r,a,s,o){var u=new xa;return u.tracker=new Da(e,t,i,n,r,a,s),u.position=o,u}},{key:"createThirdParty",value:function(e,t,i,n,r,a){var s=new xa;return s.tracker=new Sa(e,i,n,r,a),s.position=t,s}}])&&wa(t,i),e}();function Ga(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ha(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Wa="BpkAdTrackingMgr",qa=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ha(this,"session",void 0),Ha(this,"playerAdapter",void 0),Ha(this,"listeners",void 0),Ha(this,"baseEvents",void 0),Ha(this,"currentEvents",void 0),Ha(this,"updatePositionJob",void 0),Ha(this,"updateBkYouSessionJob",void 0),Ha(this,"started",void 0),Ha(this,"paused",void 0),Ha(this,"buffering",void 0),Ha(this,"lastPosition",void 0),Ha(this,"lastPositionBeforePause",void 0),Ha(this,"lastPositionBeforeBuffering",void 0),Ha(this,"lastPositionAfterSeek",void 0),Ha(this,"firstImageDate",void 0),Ha(this,"currentAdBreakBegin",void 0),Ha(this,"currentAdBegin",void 0),Ha(this,"adPalSession",void 0),Ha(this,"bkYouSession",void 0),Ha(this,"bkYouSessionToken",void 0),Ha(this,"bkYouBaseURL",void 0),Ha(this,"bkYouNonce",void 0),Ha(this,"bkYouAdPalSessionRequest",void 0),Ha(this,"bkYouFirstFileReceived",void 0),Ha(this,"bkYouFirstFileProceeded",void 0),this.session=t,this.playerAdapter=i,this.listeners=[],this.baseEvents=[],this.currentEvents=[],this.updatePositionJob=void 0,this.updateBkYouSessionJob=void 0,this.started=!1,this.paused=!1,this.buffering=!1,this.lastPosition=0,this.lastPositionBeforePause=0,this.lastPositionBeforeBuffering=0,this.lastPositionAfterSeek=0,this.currentAdBreakBegin=void 0,this.bkYouSession=!1,this.bkYouBaseURL=void 0,this.bkYouNonce=void 0,this.bkYouAdPalSessionRequest=void 0,this.bkYouFirstFileReceived=!1,this.bkYouFirstFileProceeded=!1}var t,i;return t=e,(i=[{key:"initBkYouSession",value:function(e,t,i,n,r){this.bkYouBaseURL=e,this.bkYouSessionToken=t,this.bkYouSession=!0,void 0!==n&&(this.adPalSession=n,this.bkYouNonce=r),this.parseAdPods(i)}},{key:"updateBkYouSession",value:function(){var t=this;if(!0!==this.session.stopped&&!0===this.bkYouSession){P.d(Wa,"Updating ad tracking file...",this.session.id);var i=this.bkYouBaseURL;void 0!==this.bkYouNonce&&(i=O.addOrReplaceParam(i,ce.AD_NONCE_QUERY_PARAMETER,this.bkYouNonce));var n={userAgent:this.session.smartLib.getParameters().userAgent};be.getInstance().adTracking(this.session,n,i,!0).then((function(i){if(!0!==t.session.stopped){if(void 0!==t.updateBkYouSessionJob&&G.getInstance().cancel(t.updateBkYouSessionJob),i.httpStatus>=200&&i.httpStatus<300){var n;try{n=JSON.parse(i.content)}catch(i){return P.d(Wa,"Ad tracking updated file unreadable",t.session.id),void(!0===t.bkYouFirstFileReceived&&(t.updateBkYouSessionJob=G.getInstance().asyncDelay(e.SESSION_UPDATE_INTERVAL,(function(){t.updateBkYouSessionJob=void 0,t.updateBkYouSession()}))))}t.bkYouFirstFileReceived=!0,void 0!==t.currentAdBreakBegin?(t.baseEvents=t.baseEvents.filter((function(e){return e.tracker.adBreakId===t.currentAdBreakBegin.tracker.adBreakId})),t.currentEvents=t.currentEvents.filter((function(e){return e.tracker.adBreakId===t.currentAdBreakBegin.tracker.adBreakId}))):(t.baseEvents=[],t.currentEvents=[]),t.parseAdPods(n)}i.httpStatus>=200&&i.httpStatus<300?t.updateBkYouSessionJob=G.getInstance().asyncDelay(e.SESSION_UPDATE_INTERVAL,(function(){t.updateBkYouSessionJob=void 0,t.updateBkYouSession()})):P.d(Wa,"Stopping ad tracking file update (status code "+i.httpStatus+")",t.session.id)}}))}}},{key:"parseAdPods",value:function(e){var t=this,i=[],n=e.sessiontoken||"",r=e.timereference_ms||0,a=e.adpods;Array.isArray(a)&&a.forEach((function(e){var a=e.id,s=e.starttime_ms+r,o=e.duration_ms||0,u=e.ads;if(Array.isArray(u)){var l=0,c=0;if(u.forEach((function(e){var t=e.starttime_ms+r,i=e.duration_ms||0;t>l&&(l=t,c=i)})),l>0){var d=l+c-s;d!==o&&(P.d(Wa,"Updating ad break duration from "+o+" to "+d),o=d)}}var h=Va.createAdBreakData(t.session,n,a,{adBreakId:a,startTime:s,duration:o},s);i.push(h);var f=Va.createAdBreakBegin(t.session,n,a,s),v=Va.createAdBreakEnd(t.session,n,a,s+o);f.tracker.adBreakEnd=v,f.tracker.adBreakData=h,i.push(f),Array.isArray(u)&&u.forEach((function(e){var s,o,u,l=e.creativeid||"",c=e.starttime_ms+r,d=e.skippable_ms+r||0,h=e.duration_ms||0,v=e.adid+"-"+c||"",p=e.trackingevents,y=(null===(s=e.videoclicks)||void 0===s?void 0:s.clickthroughurl)||"",g=(null===(o=e.videoclicks)||void 0===o?void 0:o.clicktracking)||[],E=(null===(u=e.videoclicks)||void 0===u?void 0:u.customclick)||[],S=e.adverifications||[],b=[];if(S.forEach((function(e){var t={vendor:e.vendor||"",javascriptResources:e.javascriptresources||[],executableResources:e.executableresources||[],trackingEvents:e.trackingevents||[],verificationParameters:e.verificationparameters||""};b.push(t)})),void 0!==c&&void 0!==h){var k=Va.createAdData(t.session,n,a,{creativeId:l,adId:v,startTime:c,skippableTime:d,duration:h,skippable:0!==d&&null!=d,clickable:{uri:y,trackers:g,customClick:E},verifications:b},c);i.push(k);var m=Va.createAdProgress(t.session,n,a,l,v,0,c);if(i.push(m),m.tracker.adData=k,d>0){var _=Va.createAdSkippable(t.session,n,a,l,v,d,c+h,c+1);i.push(_),m.tracker.adSkippable=_}i.push(Va.createAdProgress(t.session,n,a,l,v,25,c+Math.round(h/4))),i.push(Va.createAdProgress(t.session,n,a,l,v,50,c+Math.round(h/2))),i.push(Va.createAdProgress(t.session,n,a,l,v,75,c+Math.round(3*h/4)));var A=Va.createAdProgress(t.session,n,a,l,v,100,c+h-1);i.push(A),m.tracker.adBreakBegin=f,m.tracker.adEnd=A}Array.isArray(p)&&p.forEach((function(e){var s=e.callbackurl,o=e.time_ms;void 0!==s&&void 0!==o&&i.push(Va.createThirdParty(t.session,o+r,s,n,a,v))}))})),i.push(v)})),this.addEvents(i)}},{key:"start",value:function(){var t=this;void 0===this.updatePositionJob&&(this.updatePositionJob=G.getInstance().asyncDelay(e.POSITION_UPDATE_INTERVAL,(function(){t.updatePositionJob=void 0,t.onPositionUpdated(t.playerAdapter.getPosition())})))}},{key:"stop",value:function(){void 0!==this.updatePositionJob&&(P.d(Wa,"Ad tracking paused (player event)",this.session.id),G.getInstance().cancel(this.updatePositionJob),this.updatePositionJob=void 0)}},{key:"addEvents",value:function(e){var t=this;if(void 0!==this.currentAdBegin){this.currentAdBreakBegin=this.currentAdBegin.tracker.adBreakBegin;var i=this.currentAdBegin.tracker.adBreakId+"-"+this.currentAdBegin.tracker.adId,n=e.length,r=e.find((function(e){return e.tracker instanceof ma&&e.tracker.adBreakId===t.currentAdBreakBegin.tracker.adBreakId}));(e=e.filter((function(e){return e.tracker.adBreakId+"-"+e.tracker.adId!==i&&(e.tracker.adBreakId!==t.currentAdBreakBegin.tracker.adBreakId||void 0!==e.tracker.adId)}))).length!==n&&(this.currentAdBreakBegin.tracker.adBreakEnd.position=r.tracker.adBreakEnd.position,this.currentAdBreakBegin.tracker.adBreakEnd.tracker.position=r.tracker.adBreakEnd.tracker.position,this.currentAdBreakBegin.tracker.adBreakData.tracker.adBreakData.duration=r.tracker.adBreakData.tracker.adBreakData.duration,e.forEach((function(e){e.tracker instanceof Ra&&e.tracker.adBreakId===t.currentAdBreakBegin.tracker.adBreakId&&(e.tracker.adBreakBegin=t.currentAdBreakBegin)})))}var a=[],s=[];this.baseEvents.forEach((function(e){void 0!==e.tracker.adBreakId&&void 0!==e.tracker.adId?s.push(e.tracker.adBreakId+"-"+e.tracker.adId):void 0!==e.tracker.adBreakId&&void 0===e.tracker.adId&&a.push(e.tracker.adBreakId+"-undefined")})),(e=e.filter((function(e){return-1===s.indexOf(e.tracker.adBreakId+"-"+e.tracker.adId)&&-1===a.indexOf(e.tracker.adBreakId+"-"+e.tracker.adId)}))).forEach((function(e){return t.baseEvents.push(e)})),this.baseEvents=this.baseEvents.sort((function(e,t){return e.position-t.position})),this.notifyAdsUpdated(this.baseEvents.filter((function(e){return e.tracker instanceof Ra}))),this.currentEvents=this.baseEvents.filter((function(e){return e.position>=t.lastPosition})),!this.started||this.paused||this.buffering||(void 0===this.updatePositionJob&&this.currentEvents.length>0&&(P.d(Wa,"Ad tracking resumed",this.session.id),this.lastPosition=this.playerAdapter.getPosition()),this.checkStart())}},{key:"onPositionUpdated",value:function(t){var i=this,n=this.lastPosition!==t?this.lastPosition:t-1,r=t;if(!0===this.bkYouFirstFileReceived&&!1===this.bkYouFirstFileProceeded&&(this.bkYouFirstFileProceeded=!0,Date.now()-this.firstImageDate<=4e3)){var a=this.baseEvents.slice().reverse().find((function(e){return e.tracker instanceof Na&&0===e.tracker.adProgress&&n-1e3<e.position&&e.position<n}));void 0!==a?(this.currentAdBreakBegin=a.tracker.adBreakBegin,this.currentAdBreakBegin.tracker.adBreakData.tracker.process(),this.currentAdBreakBegin.tracker.process(),this.baseEvents.filter((function(e){return a.position<=e.position&&e.position<=n&&!(e.tracker instanceof ma)&&!(e.tracker instanceof ka)})).forEach((function(e){return e.tracker.process()})),this.currentAdBegin=a):this.processCurrentAdBreak(t)}if(n<r&&r-n<e.POSITION_SEEK_ERROR_DELTA){var s=this.currentEvents.filter((function(e){return e.position>n&&e.position<=r}));s.forEach((function(e){var t=e.tracker;t.constructor.name.length>3&&P.d(Wa,"Processing "+t.constructor.name,i.session.id),t instanceof ma?i.currentAdBreakBegin=e:t instanceof _a?i.currentAdBreakBegin=void 0:t instanceof Na&&0===t.adProgress?i.currentAdBegin=e:t instanceof Na&&100===t.adProgress&&(i.currentAdBegin=void 0),t.process()})),this.currentEvents=this.baseEvents.filter((function(e){return e.position>r})),this.lastPosition=t,P.d(Wa,"Start: "+(n+1)+", End: "+r+", Current events: "+JSON.stringify(s.map((function(e){return{position:e.position,url:e.tracker.url}})))+", Remaining events number: "+this.currentEvents.length+", Base events number: "+this.baseEvents.length,this.session.id),this.currentEvents.length>0?this.paused||this.buffering?P.d(Wa,"Ad tracking paused (playback paused)",this.session.id):this.start():P.d(Wa,"Ad tracking paused (no more event)",this.session.id)}else P.d(Wa,"Start: "+n+", End: "+r+", skipping...",this.session.id)}},{key:"checkStart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.playerAdapter.getPosition();this.currentEvents.length>0?this.onPositionUpdated(e):P.d(Wa,"Ad tracking paused (no more event)",this.session.id)}},{key:"adUserInteraction",value:function(e){var t,i,n=this,r=null===(t=this.currentAdBegin)||void 0===t||null===(i=t.tracker.adData)||void 0===i?void 0:i.tracker.adData;void 0!==r&&r.clickable.trackers.forEach((function(e){P.d(Wa,"Requesting click tracker "+e.clickurl,n.session.id),be.getInstance().adEvent(n.session,e.clickurl)}))}},{key:"onFirstImage",value:function(e,t){var i=this;this.started=!0,this.paused=!1,this.buffering=!1,this.lastPosition=t,this.firstImageDate=Date.now(),this.currentEvents=this.baseEvents.filter((function(e){return e.position>=i.lastPosition})),this.checkStart(t),this.updateBkYouSession()}},{key:"onPause",value:function(){this.paused=!0,this.stop();var e=this.playerAdapter.getPosition();this.lastPosition!==e?this.onPositionUpdated(e):P.d(Wa,"Ignoring player position "+e+", already proceeded...",this.session.id),this.lastPosition=e,this.lastPositionBeforePause=this.lastPosition}},{key:"onResume",value:function(){this.paused=!1,this.buffering||(this.lastPosition=this.playerAdapter.getPosition(),Math.abs(this.lastPosition-this.lastPositionBeforePause)<1e3&&(P.d(Wa,"Reverting position because of bad position when resuming...",this.session.id),this.lastPosition=this.lastPositionBeforePause,this.lastPositionBeforePause=0),this.checkStart())}},{key:"onBufferingStart",value:function(){this.buffering=!0,this.stop();var e=this.playerAdapter.getPosition();this.lastPosition!==e?this.onPositionUpdated(e):P.d(Wa,"Ignoring player position "+e+", already proceeded...",this.session.id),this.lastPosition=e,this.lastPositionBeforeBuffering=this.lastPosition}},{key:"onBufferingEnd",value:function(e){this.buffering=!1,this.paused||(this.lastPosition=this.playerAdapter.getPosition(),Math.abs(this.lastPosition-this.lastPositionBeforeBuffering)<1e3&&(P.d(Wa,"Reverting position because of period switch...",this.session.id),this.lastPosition=this.lastPositionBeforeBuffering,this.lastPositionBeforeBuffering=0),Math.abs(this.lastPosition-this.lastPositionAfterSeek)<1e3&&(P.d(Wa,"Reverting position because of seek...",this.session.id),this.lastPosition=this.lastPositionAfterSeek,this.lastPositionAfterSeek=0),this.checkStart())}},{key:"processCurrentAdBreak",value:function(e){if(void 0===this.currentAdBreakBegin)for(var t,i,n=this.baseEvents.slice().reverse().filter((function(t){return t.position<=e})),r=0;r<n.length;r++){var a=n[r];if(void 0===t&&a.tracker instanceof ma&&(t=a),void 0===i&&a.tracker instanceof Ra&&(i=a),void 0!==t&&void 0!==i&&e<=i.tracker.adEnd.position){var s;this.currentAdBreakBegin=t,this.currentAdBegin=i,t.tracker.adBreakData.tracker.process(),t.tracker.process(),i.tracker.adData.tracker.process(),i.tracker.process(),i.tracker.skipped(),null===(s=i.tracker.adSkippable)||void 0===s||s.tracker.process();break}}}},{key:"onSeek",value:function(t,i){var n=this,r=this.lastPosition;if(this.lastPosition=i,this.buffering?this.lastPositionAfterSeek=i:this.lastPositionAfterSeek=0,this.currentEvents=this.baseEvents.filter((function(e){return e.position>=n.lastPosition})),Math.abs(i-t)<e.POSITION_SEEK_ERROR_DELTA){var a,s;P.d(Wa,"Seek detected, proceeding events..."),t<i?(a=r,s=i):(a=i,s=r<t?t:r);for(var o=a;o<=s;o+=e.POSITION_UPDATE_INTERVAL){var u=Math.min(o+e.POSITION_UPDATE_INTERVAL,s);P.d(Wa,"Between "+o+" and "+u),this.lastPosition=o,this.onPositionUpdated(u)}P.d(Wa,"Seek processed start:"+a+" end:"+s)}else if(this.processCurrentAdBreak(i),this.onPositionUpdated(i),void 0!==this.currentAdBreakBegin){var l,c=this.currentAdBreakBegin.position,d=null===(l=this.currentAdBreakBegin.tracker.adBreakEnd)||void 0===l?void 0:l.position;if(t<i&&d<=i)this.currentAdBreakBegin.tracker.adBreakEnd.tracker.process(),this.currentAdBreakBegin=void 0,this.currentAdBegin=void 0,this.processCurrentAdBreak(i);else if(i<t&&i<c)this.currentAdBreakBegin.tracker.adBreakEnd.tracker.process(),this.currentAdBreakBegin=void 0,this.currentAdBegin=void 0,this.processCurrentAdBreak(i);else if(c<i&&i<d){var h,f=this.baseEvents.slice().reverse().find((function(t){return t.tracker instanceof Na&&0===t.tracker.adProgress&&i-e.POSITION_UPDATE_INTERVAL<t.position&&t.position<=i}));void 0!==f?this.currentAdBegin!==f&&(this.baseEvents.filter((function(e){return f.position<=e.position&&e.position<=i&&!(e.tracker instanceof ma)})).forEach((function(e){e.tracker.process()})),this.currentAdBegin=f):void 0!==(f=this.baseEvents.slice().reverse().find((function(e){return e.tracker instanceof Na&&0===e.tracker.adProgress&&e.position<i})))&&this.currentAdBegin!==f&&(this.currentAdBegin.tracker.adEnd.tracker.process(),f.tracker.adData.tracker.process(),f.tracker.process(),null===(h=f.tracker.adSkippable)||void 0===h||h.tracker.process(),this.currentAdBegin=f)}}}},{key:"onStop",value:function(e){this.stop(),this.lastPosition=this.playerAdapter.getPosition(),this.onPositionUpdated(this.lastPosition),this.stop(),void 0!==this.updateBkYouSessionJob&&G.getInstance().cancel(this.updateBkYouSessionJob)}},{key:"addListener",value:function(e){void 0===e||this.listeners.includes(e)||this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}},{key:"notifyEvent",value:function(e,t,i,n,r,a){"function"==typeof e[t]&&e[t](i,n,r,a)}},{key:"notifyAdBreakData",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdBreakData",e)}))}},{key:"notifyAdBreakBegin",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdBreakBegin",e)}))}},{key:"notifyAdData",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdData",e)}))}},{key:"notifyAdBegin",value:function(e,t,i){var n,r=this;this.listeners.forEach((function(n){r.notifyEvent(n,"onAdBegin",e,t,i)})),null===(n=this.adPalSession)||void 0===n||n.sendAdImpression()}},{key:"notifyAdSkippable",value:function(e,t,i){var n=this;this.listeners.forEach((function(r){n.notifyEvent(r,"onAdSkippable",e,t,i)}))}},{key:"notifyAdProgress",value:function(e,t,i,n){var r=this;this.listeners.forEach((function(a){r.notifyEvent(a,"onAdProgress",e,t,i,n)}))}},{key:"notifyAdSkipped",value:function(e,t,i){var n=this;this.listeners.forEach((function(r){n.notifyEvent(r,"onAdSkipped",e,t,i)}))}},{key:"notifyAdEnd",value:function(e,t,i){var n=this;this.listeners.forEach((function(r){n.notifyEvent(r,"onAdEnd",e,t,i)}))}},{key:"notifyAdBreakEnd",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdBreakEnd",e)}))}},{key:"notifyAdsUpdated",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdsUpdated",e)}))}}])&&Ga(t.prototype,i),e}();function Ya(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ka(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Ha(qa,"POSITION_UPDATE_INTERVAL",1e3),Ha(qa,"POSITION_SEEK_ERROR_DELTA",6e3),Ha(qa,"SESSION_UPDATE_INTERVAL",5e3),Ha(qa,"NONCE_EXPIRATION_TIME",3e5);var Qa="BpkAdMetricsMgr",za=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ka(this,"session",void 0),Ka(this,"timeline",void 0),Ka(this,"builder",void 0),Ka(this,"adMetrics",void 0),Ka(this,"firstImage",void 0),Ka(this,"lastLayerBitrate",void 0),Ka(this,"adBreakPlaying",void 0),Ka(this,"adPlaying",void 0),Ka(this,"adProgress",void 0),Ka(this,"adQuartiles",void 0),Ka(this,"adSkipped",void 0),Ka(this,"adLastLayerSwitchDate",void 0),Ka(this,"adLastBufferingStartDate",void 0),this.session=t,this.timeline=this.session.sessionReport.timeline,this.builder=new Qr,this.adMetrics={}}var t,i;return t=e,(i=[{key:"onStart",value:function(){this.adMetrics={},this.adLastLayerSwitchDate=0,this.firstImage=!1,this.lastLayerBitrate=0,this.adLastBufferingStartDate=-1,this.adBreakPlaying=!1,this.adPlaying=!1,this.adProgress=0,this.adQuartiles={},this.adSkipped=!1}},{key:"onFirstImage",value:function(e,t){this.lastLayerBitrate=e,this.adLastLayerSwitchDate=Date.now(),this.firstImage=!0}},{key:"onLayerSwitch",value:function(e){this.adBreakPlaying&&this.firstImage&&(this.builder.addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate),this.adLastLayerSwitchDate=Date.now(),this.lastLayerBitrate!==e&&this.builder.addLayerSwitch()),this.lastLayerBitrate=e}},{key:"onBufferingStart",value:function(){this.adBreakPlaying&&(this.adLastBufferingStartDate=Date.now())}},{key:"onStallEnd",value:function(){this.adBreakPlaying&&this.adLastBufferingStartDate>=0&&this.builder.addStall(Date.now()-this.adLastBufferingStartDate),this.adLastBufferingStartDate=-1}},{key:"onRebufferingEnd",value:function(){this.adLastBufferingStartDate=-1}},{key:"onSeek",value:function(e,t){this.adBreakPlaying&&(P.d(Qa,"Ad seeked from "+ti.formatTime(e)+" to "+ti.formatTime(t)),Math.abs(t-e)<qa.POSITION_SEEK_ERROR_DELTA?P.d(Qa,"Ignoring seek < "+qa.POSITION_SEEK_ERROR_DELTA+"ms"):this.adSkipped=!0)}},{key:"onStop",value:function(e){this.adBreakPlaying&&(this.adSkipped=!0,this.handleAdEnd(),this.adBreakPlaying=!1)}},{key:"onAdBreakBegin",value:function(e){var t;this.adBreakPlaying=!0,void 0!==this.timeline&&this.timeline.pushEvent(null===(t=Yt.analyticsModule)||void 0===t?void 0:t.SessionTrackerEvents.AdBreakStart)}},{key:"onAdBegin",value:function(e,t,i){this.adSkipped&&this.handleAdEnd(),this.adSkipped=!1,this.adLastLayerSwitchDate=Date.now(),this.builder.reset().setSessionToken(e).setCreativeId(t).setAdId(i),this.adQuartiles={},this.adPlaying=!0}},{key:"onAdSkippable",value:function(e,t,i){this.builder.setAdSkippable(!0)}},{key:"onAdSkipped",value:function(e,t,i){this.adSkipped=!0,void 0!==this.adQuartiles[0]&&delete this.adQuartiles[0]}},{key:"onAdProgress",value:function(e,t,i,n){this.adQuartiles[n]=!0,this.adProgress=25*Object.keys(this.adQuartiles).length-25,n>0&&void 0===this.adQuartiles[n-25]&&(this.adSkipped=!0)}},{key:"onAdEnd",value:function(e,t,i){this.handleAdEnd(),this.adPlaying=!1}},{key:"onAdBreakEnd",value:function(e){var t;!0===this.adPlaying&&(this.builder.setAdSkipped(!0),this.handleAdEnd()),this.adBreakPlaying=!1,void 0!==this.timeline&&this.timeline.pushEventProgress(null===(t=Yt.analyticsModule)||void 0===t?void 0:t.SessionTrackerEvents.AdBreakStop,this.adProgress)}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(e){if(this.adBreakPlaying){var t=this.builder.clone().setAdProgress(this.adProgress).addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate);this.adLastBufferingStartDate>=0&&t.addStall(Date.now()-this.adLastBufferingStartDate);var i=t.build();i.adId.length>0&&(this.adMetrics[i.adId]=i)}e.adMetrics=Object.values(this.adMetrics)}},{key:"onEndSessionReportUpdateRequested",value:function(e){e.adMetrics=Object.values(this.adMetrics)}},{key:"handleAdEnd",value:function(){this.builder.setAdSkipped(this.adSkipped).setAdProgress(this.adProgress).addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate);var e=this.builder.build();e.adId.length>0&&(this.adMetrics[e.adId]=e),P.d(Qa,"Ad metrics : "+e.toString()),this.builder.reset(),this.adSkipped=!1}},{key:"onAdsUpdated",value:function(e){var t=this;e.forEach((function(e){if(void 0===t.adMetrics[e.tracker.adId]){var i=new Qr;t.adMetrics[e.tracker.adId]=i.setSessionToken(e.tracker.sessionToken).setCreativeId(e.tracker.creativeId).setAdId(e.tracker.adId).build(),P.d(Qa,"Adding ad metrics report for ad id "+e.tracker.adId)}}))}}])&&Ya(t.prototype,i),e}();function Ja(e,t,i){return Za(e,t),Xa(i,"get"),function(e,t){return t.get?t.get.call(e):t.value}(e,i)}function Xa(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Za(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function $a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var es="BpkOMSDKMgr",ts=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"smartLib",void 0)}return function(e,t,i){t&&$a(e.prototype,t),i&&$a(e,i)}(e,[{key:"init",value:function(){P.d(es,"Initializing OM SDK manager...")}},{key:"release",value:function(){}},{key:"attachInstance",value:function(e){this.smartLib=e}},{key:"attachHandler",value:function(e){P.d(es,"Attaching OM SDK handler..."),this.omsdkHandler=e}},{key:"isEnabled",value:function(){return void 0!==this.omsdkHandler&&null!==this.omsdkHandler}}],[{key:"getInstance",value:function(){return Ja(e,e,is)||function(e,t,i,n){Za(e,t),Xa(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n)}(e,e,is,new e),Ja(e,e,is)}}]),e}(),is={writable:!0,value:void 0};function ns(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function rs(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function as(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ss="BpkOMSessionHandler",os=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),as(this,"session",void 0),as(this,"adSession",void 0),as(this,"playerAdapter",void 0),as(this,"internalAdManager",void 0),as(this,"omsdkHandler",void 0),as(this,"omAdSession",void 0),as(this,"firstImageDate",void 0),as(this,"adBreakPosition",void 0),this.session=t,this.adSession=t.adSession,this.playerAdapter=i,this.internalAdManager=this.session.smartLib.internalAdManager,this.omsdkHandler=ts.getInstance().omsdkHandler,this.firstImageDate=0,this.adBreakPosition="midroll"}var t,i;return t=e,(i=[{key:"onStart",value:function(){}},{key:"onRedirectionEnd",value:function(){}},{key:"onFirstImage",value:function(e,t){this.firstImageDate=Date.now()}},{key:"onLayerSwitch",value:function(e){}},{key:"onPause",value:function(){var e;null===(e=this.omAdSession)||void 0===e||e.pause()}},{key:"onResume",value:function(){var e;null===(e=this.omAdSession)||void 0===e||e.resume()}},{key:"onBufferingStart",value:function(){var e;null===(e=this.omAdSession)||void 0===e||e.bufferStart()}},{key:"onBufferingEnd",value:function(e){var t;null===(t=this.omAdSession)||void 0===t||t.bufferFinish()}},{key:"onStallEnd",value:function(){}},{key:"onRebufferingEnd",value:function(){}},{key:"onSeek",value:function(e,t){var i;void 0!==this.adData&&Math.abs(t-e)>=1e3&&(t>=this.adData.startTime+this.adData.duration||t<this.adData.startTime)&&(null===(i=this.omAdSession)||void 0===i||i.skipped())}},{key:"onStop",value:function(e){this.adData=void 0,void 0!==this.omAdSession&&(this.omAdSession.finish(),this.omAdSession=void 0),this.adBreakPosition="midroll"}},{key:"onStartSessionReportUpdateRequested",value:function(e){}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(e){}},{key:"onEndSessionReportUpdateRequested",value:function(e){}},{key:"onAdBreakData",value:function(e){Math.abs(e.startTime+e.duration-this.playerAdapter.getDuration())<1e4?this.adBreakPosition="postroll":Date.now()-this.firstImageDate<3e3?this.adBreakPosition="preroll":this.adBreakPosition="midroll",P.d(ss,"Ad break position is "+this.adBreakPosition,this.session.id)}},{key:"onAdBreakBegin",value:function(e){}},{key:"onAdData",value:function(e){var t,i,n,r,a,s,o,u=this;void 0!==this.adData&&(null===(s=this.omAdSession)||void 0===s||s.finish(),this.omAdSession=void 0),this.adData=e,o=void 0!==(null===(t=this.adSession)||void 0===t?void 0:t.adVerificationData)?function(e){return function(e){if(Array.isArray(e))return ns(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ns(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ns(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.adSession.adVerificationData):[],this.adData.verifications.forEach((function(e){var t=e.javascriptResources.find((function(e){return"omid"===e.apiframework}));o.push({verificationVendor:e.vendor,verificationURL:t.url,verificationParameters:e.verificationParameters})})),this.omAdSession=this.omsdkHandler.createOMAdSession(this.internalAdManager.omPartnerName,this.internalAdManager.omPartnerVersion,null===(i=this.adSession)||void 0===i?void 0:i.adCustomReference,o),void 0!==(null===(n=this.adSession)||void 0===n?void 0:n.adView)&&this.omAdSession.setAdView(this.adSession.adView),(null===(r=this.adSession)||void 0===r?void 0:r.adFriendlyObstructionViews.length)>0&&this.adSession.adFriendlyObstructionViews.forEach((function(e){u.omAdSession.registerAdFriendlyObstructionView(e.view,e.purpose,e.reason)})),this.omAdSession.start(),void 0!==(null===(a=this.adSession)||void 0===a?void 0:a.adViewState)&&this.omAdSession.setAdViewState(this.adSession.adViewState),!0===e.skippable?this.omAdSession.loaded(e.skippableTime-e.startTime,e.duration,this.adBreakPosition,this.playerAdapter.getVolume()):this.omAdSession.loaded(-1,e.duration,this.adBreakPosition,this.playerAdapter.getVolume())}},{key:"onAdBegin",value:function(e,t,i){}},{key:"onAdSkippable",value:function(e,t,i){}},{key:"onAdProgress",value:function(e,t,i,n){var r;null===(r=this.omAdSession)||void 0===r||r.progress(n)}},{key:"onAdEnd",value:function(e,t,i){var n;this.adData=void 0,null===(n=this.omAdSession)||void 0===n||n.finish(),this.omAdSession=void 0}},{key:"onAdBreakEnd",value:function(e){this.adData=void 0,void 0!==this.omAdSession&&(this.omAdSession.finish(),this.omAdSession=void 0),this.adBreakPosition="midroll"}},{key:"onVolumeChanged",value:function(e){var t;P.d(ss,"Volume is now "+e,this.session.id),null===(t=this.omAdSession)||void 0===t||t.volumeChange(e)}},{key:"onPlayerError",value:function(e,t){var i;P.e(ss,"Broadpeak status code "+e,this.session.id),P.e(ss,"Player error code "+t,this.session.id),null===(i=this.omAdSession)||void 0===i||i.error(e,t)}}])&&rs(t.prototype,i),e}();function us(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ls(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function cs(e,t,i){return hs(e,t),ds(i,"get"),function(e,t){return t.get?t.get.call(e):t.value}(e,i)}function ds(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function hs(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}Yt.adModule={AdMetrics:Kr,AdMetricsBuilder:Qr,AdMetricsManager:za,AdEvent:ja,AdJSONEvent:xa,AdDashEvent:Fa,AdEventFactory:Va,AdSmartLibLegacyTracker:aa,AdTracker:Ea,AdThirdPartyTracker:Sa,AdSmartLibTracker:ba,AdBreakDataTracker:ka,AdBreakBeginTracker:ma,AdBreakEndTracker:_a,AdDataTracker:Aa,AdProgressTracker:Na,AdBeginProgressTracker:Ra,AdSkippableTracker:Da,AdTrackerFactory:Pa,AdTrackingManager:qa,AdManager:ie,AdViewState:$,AdFriendlyObstructionPurpose:ee,AdSession:se,InternalAdManager:ce,OMSDKManager:ts,OMSessionHandler:os};var fs="BpkNanoCDNRequestMgr",vs=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){return cs(e,e,ps)||function(e,t,i,n){hs(e,t),ds(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n)}(e,e,ps,new e),cs(e,e,ps)}}],(i=[{key:"requestNanoCDNStatus",value:function(t){var i="http://"+t+":"+e.NANOCDN_CORE_PORT+"/nanocdnstatus.xml";return new Promise((function(e,t){G.getInstance().asyncGet(i,{Connection:"close"},3e3,(function(t){var i=0,n="";void 0!==t.statusCode&&(i=parseInt(t.statusCode,10)),void 0!==t.body&&(n=t.body),e({httpStatus:i,body:n})}))}))}},{key:"requestNanoCDN",value:function(t,i,n){var r=this,a=n.options,s=O.parseURL(t),o=!Dt.getInstance().isConnectedToWifi()||!0===a.get(Ke.REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI)&&Dt.getInstance().isConnectedToWifi();if(("127.0.0.1"===i.nanoCDNDescr.hostIP||"localhost"===i.nanoCDNDescr.hostIP)&&!1===o)return P.d(fs,"Ignoring nanoCDN "+i.nanoCDNDescr.hostIP+" because of the Wi-Fi connection...",n.id),Promise.resolve(ht.error(ht.RESULT_NANOCDN_REQUEST_LOCAL_IF_CONNECTED_TO_WIFI_NOT_ALLOWED));var u="";""!==s.query&&(u="&"+s.query);var l="";i.analyticsAddress.length>1&&(l="&ssu="+O.extractHostnamePort(i.analyticsAddress));var c="";!0===n.options.get(Ke.MULTICAST_ONLY)&&(c="&mo=1");var d="";!0===n.options.get(Ke.ULTRA_LOW_LATENCY_SUPPORT)&&(d="&ulls=1");var h="http://"+i.nanoCDNDescr.hostIP+":"+e.NANOCDN_RR_PORT+s.path+"?response=200&bk-ml=1"+l+"&us="+s.host+c+d+u;return P.d(fs,"Sending request to the nanoCDN ("+i.nanoCDNDescr.hostIP+")...",n.id),be.getInstance().getRedirectionLocation(h,e.NANOCDN_REQUEST_TIMEOUT,i,n).then((function(e){P.d(fs,"nanoCDN responded with status code "+e.httpStatus,n.id),n.sessionReport.nanoCDNStatusCode=e.httpStatus;var t=r.getNanoCDNDetailedErrorMessage(e,n),a=ht.error(ht.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN,t);if(200===e.httpStatus&&""!==e.redirectedURL)a=ht.success(e.redirectedURL);else if(509===e.httpStatus||503===e.httpStatus&&i.nanoCDNDescr.mcastFrame>0)a=ht.error(ht.RESULT_NANOCDN_SESSION_LIMIT_REACHED,t);else if(503===e.httpStatus&&0===i.nanoCDNDescr.mcastFrame)a=ht.error(ht.RESULT_NANOCDN_SERVICE_UNAVAILABLE,t);else if(404===e.httpStatus)a=ht.error(ht.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN,t);else if(e.httpStatus<=0)return ht.error(ht.RESULT_NANOCDN_RESPONSE_UNREADABLE);return a})).then((function(e){return e.isError()&&(n.sessionReport.nanoCDNStatusCode=e.getDetailedErrorCode()),e}))}},{key:"getNanoCDNDetailedErrorMessage",value:function(t,i){if(t.httpStatus>0){if(!0===t.headers.hasOwnProperty(e.HEADER_NANO_CDN_DETAILED_ERROR_CODE)){var n=t.headers[e.HEADER_NANO_CDN_DETAILED_ERROR_CODE];return P.d(fs,"Reading detailed error code from header: "+n,i.id),n}return P.d(fs,"Reading detailed error code from http status: "+t.httpStatus+" "+t.httpMessage,i.id),String(t.httpStatus+" "+t.httpMessage)}return String(ht.RESULT_NO_DETAILED_ERROR)}},{key:"requestNanoCDNList",value:function(e,t,i,n,r){var a=this,s=n.smartLib.nanoCDNHostManager.getNanoCDNDescrList();if(i>=s.length)return{result:ht.error(ht.RESULT_NO_STREAMING_URL_FOUND),redirectedURL:"",nanoCDNDescr:void 0,errors:r};var o=s[i];return t.nanoCDNDescr=o,o===t.nanoCDNDescrConfigured?this.requestNanoCDNList(e,t,i+1,n,r):this.requestNanoCDN(e,t,n).then((function(u){return r[o.hostIP]=u.getErrorCode(),u.isError()&&s.length>=2?i+1>=s.length?{result:u,redirectedURL:u.getURL(),nanoCDNDescr:o,errors:r}:a.requestNanoCDNList(e,t,i+1,n,r):{result:u,redirectedURL:u.getURL(),nanoCDNDescr:o,errors:r}}))}},{key:"processNanoCDNSession",value:function(e,t,i,n,r){var a=this;return this.requestNanoCDN(e,t,i).then((function(n){var r={};r[t.nanoCDNDescr.hostIP]=n.getErrorCode();var s=i.smartLib.nanoCDNHostManager.getNanoCDNDescrList();return n.isError()&&s.length>=2?a.requestNanoCDNList(e,t,0,i,r):{result:n,redirectedURL:n.getURL(),nanoCDNDescr:t.nanoCDNDescr,errors:r}})).then((function(a){if(P.d(fs,"nanoCDN error codes : "+JSON.stringify(a.errors),i.id),!a.result.isError())return i.smartLib.nanoCDNHostManager.setCurrentNanoCDNDescr(a.nanoCDNDescr),n&&!1===r?be.getInstance().requestBkM(e,t,a.nanoCDNDescr.hostIP,i).then((function(e){return e.isError()||-1===e.getURL().indexOf("://"+a.nanoCDNDescr.hostIP+":")||!0!==i.options.get(Ke.ULTRA_LOW_LATENCY_SUPPORT)||(e.url=O.addOrReplaceParam(e.url,"ulls","1")),e})):a.result;var s=i.smartLib.nanoCDNHostManager.getNanoCDNDescrList(),o=s.length,u=cn.count(a.errors,(function(e,t){return t===ht.RESULT_NANOCDN_SESSION_LIMIT_REACHED})),l=cn.count(a.errors,(function(e,t){return t===ht.RESULT_NANOCDN_SERVICE_UNAVAILABLE})),c=a.result.getDetailedErrorMessage();if(a.result=u===o?ht.error(ht.RESULT_NANOCDN_SESSION_LIMIT_REACHED,c):l===o?ht.error(ht.RESULT_NANOCDN_SERVICE_UNAVAILABLE,c):u>=1?ht.error(ht.RESULT_NANOCDN_SESSION_LIMIT_REACHED_ON_REQUESTED_CHANNEL,c):0===u?ht.error(ht.RESULT_NANOCDN_CHANNEL_UNAVAILABLE,c):ht.error(ht.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN,c),n){if(l>=1){var d=s.find((function(e){return a.errors[e.hostIP]===ht.RESULT_NANOCDN_SERVICE_UNAVAILABLE}));return P.d(fs,"nanoCDN responded service unavailable, requesting the BkM...",i.id),be.getInstance().requestBkM(e,t,d.hostIP,i)}return P.d(fs,"nanoCDN responded an error, requesting the BkM...",i.id),be.getInstance().requestBkM(e,t,void 0,i)}return!0===r?a.result:ht.success(e)}))}}])&&us(t.prototype,i),n&&us(t,n),e}();ls(vs,"NANOCDN_RR_PORT","8000"),ls(vs,"NANOCDN_CORE_PORT","18081"),ls(vs,"HEADER_NANO_CDN_DETAILED_ERROR_CODE","x-bpk-error"),ls(vs,"NANOCDN_REQUEST_TIMEOUT",1e3);var ps={writable:!0,value:void 0},ys=__webpack_require__(831);function gs(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Es(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Ss=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Es(this,"hostIP",void 0),Es(this,"nbSessions",void 0),Es(this,"maxNbSessions",void 0),Es(this,"ratio",void 0),Es(this,"jsonAccountId",void 0),Es(this,"profilePrefetched",void 0),Es(this,"mcastFrame",void 0),this.hostIP="",this.nbSessions=0,this.maxNbSessions=e.NANOCDNDESCR_DEFAULT_MAX_SESSION,this.ratio=0,this.jsonAccountId="",this.profilePrefetched=-1,this.mcastFrame=-1}var t,i,n;return t=e,n=[{key:"parseNanoCDNStatusResponse",value:function(t,i){var n,r,a=(0,ys.fromXML)(t);if(void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG]){if((n=new e).hostIP=i,void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_SESSIONS_TAG]&&(void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_SESSIONS_TAG][e.NANOCDNDESCR_SESSIONS_NUMBER_PARAM]&&(r=parseInt(a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_SESSIONS_TAG][e.NANOCDNDESCR_SESSIONS_NUMBER_PARAM],10),isNaN(r)||(n.nbSessions=r)),void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_SESSIONS_TAG][e.NANOCDNDESCR_SESSIONS_LIMIT_PARAM]&&(r=parseInt(a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_SESSIONS_TAG][e.NANOCDNDESCR_SESSIONS_LIMIT_PARAM],10),isNaN(r)||(n.maxNbSessions=r))),void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_ACCESSTOKEN_TAG]){var s={};for(var o in a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_ACCESSTOKEN_TAG])s[o.substring(1)]=a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_ACCESSTOKEN_TAG][o];n.jsonAccountId=JSON.stringify(s)}void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_TAG]&&(void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_PROFILE_PREFETCHED_PARAM]&&(r=parseInt(a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_PROFILE_PREFETCHED_PARAM],10),isNaN(r)||(n.profilePrefetched=r)),void 0!==a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_MCAST_FRAME_PARAM]&&(r=parseInt(a[e.NANOCDNDESCR_NANOCDN_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_TAG][e.NANOCDNDESCR_CTRL_CHANNEL_MCAST_FRAME_PARAM],10),isNaN(r)||(n.mcastFrame=r))),n.processRatio()}return n}}],(i=[{key:"processRatio",value:function(){this.ratio=this.maxNbSessions/(this.nbSessions+1)}}])&&gs(t.prototype,i),n&&gs(t,n),e}();function bs(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ks(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Es(Ss,"NANOCDNDESCR_NANOCDN_TAG","nanocdn"),Es(Ss,"NANOCDNDESCR_SESSIONS_TAG","sessions"),Es(Ss,"NANOCDNDESCR_SESSIONS_NUMBER_PARAM","@number"),Es(Ss,"NANOCDNDESCR_SESSIONS_LIMIT_PARAM","@limit"),Es(Ss,"NANOCDNDESCR_MULTICAST_TAG","multicasts"),Es(Ss,"NANOCDNDESCR_ACCESSTOKEN_TAG","access-token"),Es(Ss,"NANOCDNDESCR_CTRL_CHANNEL_TAG","ctrl-channel"),Es(Ss,"NANOCDNDESCR_CTRL_CHANNEL_PROFILE_PREFETCHED_PARAM","@profile_prefetched"),Es(Ss,"NANOCDNDESCR_CTRL_CHANNEL_MCAST_FRAME_PARAM","@mcast_frame"),Es(Ss,"NANOCDNDESCR_DEFAULT_MAX_SESSION",50);var ms="BpkHostResolvingAsyncTask",_s=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ks(this,"nanoCDNHostManager",void 0),ks(this,"nanoCDNHost",void 0),ks(this,"retry",void 0),ks(this,"retryDelay",void 0),ks(this,"active",void 0),ks(this,"waiting",void 0),ks(this,"job",void 0),this.nanoCDNHostManager=t,this.nanoCDNHost=i,this.retry=0,this.retryDelay=6e4,this.active=!0,this.waiting=!1,this.job=void 0}var t,i;return t=e,(i=[{key:"start",value:function(){var e,t=this;P.d(ms,"Starting resolving nanoCDN with host: '"+this.nanoCDNHost+"'"),null===(e=Yt.nanoCDNModule)||void 0===e||e.NanoCDNRequestManager.getInstance().requestNanoCDNStatus(this.nanoCDNHost).then((function(e){if(200===e.httpStatus){var i=Ss.parseNanoCDNStatusResponse(e.body,t.nanoCDNHost);if(void 0===i)throw new Error("Can't resolve nanoCDN:'"+t.nanoCDNHost+"' status:"+e.httpStatus);return P.d(ms,"Checking nanoCDN result: host: "+i.hostIP+" session: "+i.nbSessions+" limit: "+i.maxNbSessions+" jsonid:"+i.jsonAccountId+" profile_prefetched:"+i.profilePrefetched+" mcast_frame:"+i.mcastFrame),i}throw new Error("Can't resolve nanoCDN:'"+t.nanoCDNHost+"' status:"+e.httpStatus)})).then((function(e){t.active&&(P.i(ms,"Found nanoCDN with host: '"+t.nanoCDNHost+"'"),e.jsonAccountId.length>0&&P.i(ms,"Found json account id: '"+e.jsonAccountId+"'"),t.nanoCDNHostManager.addNanoCDN(e),t.active=!1,t.nanoCDNHostManager.removeHostResolvingAsyncTask(t.nanoCDNHost))})).catch((function(e){t.active&&(t.nanoCDNHostManager.removeNanoCDN(t.nanoCDNHost),t.retry++,P.d(ms,e.message+" retry:"+t.retry),-1===t.retryDelay?(P.i(ms,"Can't found nanoCDN with host: '"+t.nanoCDNHost+"'"),t.active=!1,t.nanoCDNHostManager.removeHostResolvingAsyncTask(t.nanoCDNHost)):(t.waiting=!0,t.job=G.getInstance().asyncDelay(t.retryDelay,(function(){t.waiting=!1,t.active&&t.start()}))))}))}},{key:"stop",value:function(){this.active&&P.d(ms,"Host resolving stopped for '"+this.nanoCDNHost+"'"),this.active=!1,G.getInstance().cancel(this.job)}},{key:"setResolvingRetryDelay",value:function(e){this.retryDelay=e}}])&&bs(t.prototype,i),e}();function As(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Ns=function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),As(this,"name",void 0),As(this,"ipAddress",void 0),As(this,"nanoCDNDescr",void 0),this.name=t,this.ipAddress=i,this.nanoCDNDescr=n};function Rs(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ds(e,t){return Is(e,Ts(e,t,"get"))}function Ps(e,t,i){return ws(e,Ts(e,t,"set"),i),i}function Ts(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function ws(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function Os(e,t,i){return Cs(e,t),Ls(i,"get"),Is(e,i)}function Ls(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Cs(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function Is(e,t){return t.get?t.get.call(e):t.value}function Ms(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bs(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Us(e,t,i){return t&&Bs(e.prototype,t),i&&Bs(e,i),e}var js="BpkMdnsMgr",Fs=function(){function e(){Ms(this,e)}return Us(e,null,[{key:"start",value:function(e){}},{key:"stop",value:function(){}}]),e}(),xs=new WeakMap,Vs=new WeakMap,Gs=new WeakMap,Hs=function(){function e(){Ms(this,e),xs.set(this,{writable:!0,value:Fs}),Rs(this,"smartLib",void 0),Vs.set(this,{writable:!0,value:void 0}),Gs.set(this,{writable:!0,value:void 0}),Ps(this,Vs,!1),Ps(this,Gs,[])}return Us(e,[{key:"init",value:function(e){Ps(this,xs,e)}},{key:"release",value:function(){}},{key:"attachInstance",value:function(e){this.smartLib=e}},{key:"start",value:function(){Ds(this,xs)===Fs?P.e(js,"Exception: nanoCDN discovery is not available for that platform"):Ds(this,Vs)?P.v(js,"mDNS discovery already started"):(P.i(js,"mDNS discovery starting..."),Ds(this,xs).start(e.MDNS_NANOCDN_SERVICE_TYPE),Ps(this,Vs,!0))}},{key:"stop",value:function(){!0===Ds(this,Vs)&&(Ps(this,Vs,!1),Ds(this,xs).stop(),P.i(js,"mDNS discovery stopped"))}},{key:"onServiceFound",value:function(e,t){var i,n=this;P.d(js,"Found service "+e+" ip:"+t),null===(i=Yt.nanoCDNModule)||void 0===i||i.NanoCDNRequestManager.getInstance().requestNanoCDNStatus(t).then((function(e){if(200===e.httpStatus){var i=Ss.parseNanoCDNStatusResponse(e.body,t);if(void 0===i)throw new Error("Can't resolve nanoCDN:'"+t+"' status:"+e.httpStatus);return P.d(js,"Checking nanoCDN result: host: "+i.hostIP+" session: "+i.nbSessions+" limit: "+i.maxNbSessions+" jsonid:"+i.jsonAccountId+" profile_prefetched:"+i.profilePrefetched+" mcast_frame:"+i.mcastFrame),i}throw new Error("Can't resolve nanoCDN:'"+t+"' status:"+e.httpStatus)})).then((function(i){P.i(js,"Found nanoCDN with host: '"+t+"'"),i.jsonAccountId.length>0&&P.i(js,"Found json account id: '"+i.jsonAccountId+"'"),n.smartLib.nanoCDNHostManager.addNanoCDN(i),void 0===n.getService(e,t)&&Ds(n,Gs).push(new Ns(e,t,i)),P.i(js,"Registered nanoCDN with host: '"+t+"'")})).catch((function(e){P.i(js,e.message)}))}},{key:"onServiceLost",value:function(e,t){var i=this.getService(e,t);void 0===i&&this.removeService(i)}},{key:"getService",value:function(e,t){for(var i=0;i<Ds(this,Gs).length;i++){var n=Ds(this,Gs)[i];if(n.name===e&&n.ipAddress===t)return n}}},{key:"removeService",value:function(e){P.d(js,"Lost service "+e.name+" ip:"+e.ipAddress),this.smartLib.nanoCDNHostManager.removeNanoCDN(e.ipAddress);var t=Ds(this,Gs).indexOf(e);-1!==t&&Ds(this,Gs).splice(t,1)}}],[{key:"getInstance",value:function(){return Os(e,e,Ws)||function(e,t,i,n){Cs(e,t),Ls(i,"set"),ws(e,i,n)}(e,e,Ws,new e),Os(e,e,Ws)}}]),e}(),Ws={writable:!0,value:void 0};function qs(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Ys(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ks(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Rs(Hs,"MDNS_NANOCDN_SERVICE_TYPE","_nanocdn._tcp.local.");var Qs="BpkNanoCDNHostMgr",zs=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ks(this,"smartLib",void 0),Ks(this,"state",void 0),Ks(this,"nanoCDNHostResolvingTasks",void 0),Ks(this,"nanoCDNHostConfigured",void 0),Ks(this,"currentNanoCDNDescr",void 0),Ks(this,"nanoCDNList",void 0),Ks(this,"nanoCDNReceiver",void 0),Ks(this,"nanoCDNResolvingRetryDelay",void 0),Ks(this,"lastHostResolvingDate",void 0),this.state=e.STATE_NONE,this.nanoCDNHostResolvingTasks={},this.nanoCDNHostConfigured="",this.currentNanoCDNDescr=void 0,this.nanoCDNList=[],this.nanoCDNReceiver=void 0,this.nanoCDNResolvingRetryDelay=e.DEFAULT_NANOCDN_RESOLVING_RETRY_DELAY,this.lastHostResolvingDate=0}var t,i;return t=e,(i=[{key:"init",value:function(e,t){this.smartLib=e,null==t&&(t=""),-1!==t.indexOf("*")&&(t=t.replace("*","127.0.0.1,discover")),this.nanoCDNHostConfigured!==t&&(this.nanoCDNHostConfigured=t,this.clearHostResolution(),this.launchHostResolution())}},{key:"registerNanoCDNReceiver",value:function(e){this.nanoCDNReceiver=null==e?void 0:e}},{key:"setNanoCDNResolvingRetryDelay",value:function(e){var t=parseInt(e,10);for(var i in t>=0&&t<1e3?(this.nanoCDNResolvingRetryDelay=1e3,P.w(Qs,"nanoCDN resolving retry delay has been increased to 1000ms (minimum delay)")):t<=-1?(this.nanoCDNResolvingRetryDelay=-1,P.d(Qs,"nanoCDN resolving retry has been disabled")):this.nanoCDNResolvingRetryDelay=t,this.nanoCDNHostResolvingTasks)if(this.nanoCDNHostResolvingTasks[i].waiting){this.nanoCDNHostResolvingTasks[i].stop();var n=new _s(this,i);n.setResolvingRetryDelay(this.nanoCDNResolvingRetryDelay),n.start(),this.nanoCDNHostResolvingTasks[i]=n}else this.nanoCDNHostResolvingTasks[i].setResolvingRetryDelay(this.nanoCDNResolvingRetryDelay)}},{key:"launchHostResolution",value:function(){if(void 0!==this.nanoCDNHostConfigured&&0!==this.nanoCDNHostConfigured.length){this.state=e.STATE_IDLING;for(var t=this.nanoCDNHostConfigured.split(","),i=0;i<t.length;i++){var n=t[i];n===e.NANOCDN_HOST_DISCOVER?(this.state=e.STATE_DISCOVERING,this.lastHostResolvingDate=Date.now(),Hs.getInstance().start()):Dt.getInstance().appInBackground||(this.state=e.STATE_RESOLVING,this.lastHostResolvingDate=Date.now(),this.resolveNanoCDNHost(n))}}}},{key:"refreshHostResolution",value:function(){var t=this;if(void 0!==this.nanoCDNHostConfigured&&0!==this.nanoCDNHostConfigured.length&&this.nanoCDNHostConfigured===e.NANOCDN_HOST_DISCOVER){var i=function(e){return function(e){if(Array.isArray(e))return qs(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return qs(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?qs(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.nanoCDNList),n=[];this.state=e.STATE_DISCOVERING,this.lastHostResolvingDate=Date.now();for(var r=function(e){var r,a=i[e];n.push(null===(r=Yt.nanoCDNModule)||void 0===r?void 0:r.NanoCDNRequestManager.getInstance().requestNanoCDNStatus(a.hostIP).then((function(e){200!==e.httpStatus&&t.removeNanoCDN(a.hostIP)})))},a=0;a<i.length;a++)r(a);Promise.all(n).then((function(){Hs.getInstance().stop(),Hs.getInstance().start()}))}}},{key:"clearHostResolution",value:function(){for(var t in this.state=e.STATE_IDLING,this.nanoCDNHostResolvingTasks)this.nanoCDNHostResolvingTasks[t].stop(),delete this.nanoCDNHostResolvingTasks[t];Hs.getInstance().stop(),this.clearNanoCDNList(),this.lastHostResolvingDate=0}},{key:"resolveNanoCDNHost",value:function(e){if(P.i(Qs,"Initializing nanoCDN resolving with '"+e+"'"),null!=e&&0!==e.length){void 0!==this.nanoCDNHostResolvingTasks[e]&&(this.nanoCDNHostResolvingTasks[e].stop(),delete this.nanoCDNHostResolvingTasks[e]);var t=new _s(this,e);t.setResolvingRetryDelay(this.nanoCDNResolvingRetryDelay),t.start(),this.nanoCDNHostResolvingTasks[e]=t}else P.i(Qs,"nanoCDN host resolving is not required for '"+e+"'")}},{key:"removeHostResolvingAsyncTask",value:function(e){void 0!==this.nanoCDNHostResolvingTasks[e]&&(this.nanoCDNHostResolvingTasks[e].stop(),delete this.nanoCDNHostResolvingTasks[e])}},{key:"getCurrentNanoCDNDescr",value:function(){return void 0===this.currentNanoCDNDescr&&this.nanoCDNList.length>0?this.nanoCDNList[0]:this.currentNanoCDNDescr}},{key:"setCurrentNanoCDNDescr",value:function(e){this.currentNanoCDNDescr=e}},{key:"addNanoCDN",value:function(e){for(var t=!1,i=0;i<this.nanoCDNList.length;i++)if(this.nanoCDNList[i].hostIP===e.hostIP){t=!0,this.nanoCDNList.splice(i,1);break}for(var n=!1,r=0,a=0===this.nanoCDNList.length,s=0;s<this.nanoCDNList.length&&!n;s++)e.ratio>this.nanoCDNList[s].ratio&&(n=!0,r=s);if(n?this.nanoCDNList.splice(r,0,e):this.nanoCDNList.push(e),a&&!t){var o=e.jsonAccountId;P.i(Qs,"onNanoCDNFound '"+o+"'"+(void 0===this.nanoCDNReceiver?" (no receiver)":"")),void 0!==this.nanoCDNReceiver&&"function"==typeof this.nanoCDNReceiver.onNanoCDNFound&&this.nanoCDNReceiver.onNanoCDNFound(o)}}},{key:"removeNanoCDN",value:function(e){for(var t=!1,i=0;i<this.nanoCDNList.length&&!t;i++)if(this.nanoCDNList[i].hostIP===e){t=!0,this.nanoCDNList.splice(i,1);break}0===this.nanoCDNList.length&&t&&(P.i(Qs,"onNanoCDNLost"+(void 0===this.nanoCDNReceiver?" (no receiver)":"")),void 0!==this.nanoCDNReceiver&&"function"==typeof this.nanoCDNReceiver.onNanoCDNLost&&this.nanoCDNReceiver.onNanoCDNLost());var n=this.getCurrentNanoCDNDescr();void 0!==n&&n.hostIP===e&&(this.currentNanoCDNDescr=void 0)}},{key:"getNanoCDNDescrList",value:function(){return this.nanoCDNList}},{key:"getNanoCDNWithHost",value:function(e){for(var t=0;t<this.nanoCDNList.length;t++)if(this.nanoCDNList[t].hostIP===e)return this.nanoCDNList[t]}},{key:"clearNanoCDNList",value:function(){0!==this.nanoCDNList.length&&(this.nanoCDNList=[],this.currentNanoCDNDescr=void 0,P.i(Qs,"onNanoCDNLost"+(void 0===this.nanoCDNReceiver?" (no receiver)":"")),void 0!==this.nanoCDNReceiver&&"function"==typeof this.nanoCDNReceiver.onNanoCDNLost&&this.nanoCDNReceiver.onNanoCDNLost())}},{key:"release",value:function(){this.clearHostResolution(),this.nanoCDNHostConfigured=""}},{key:"onForeground",value:function(){if(Date.now()-this.lastHostResolvingDate>1e3){var t=this.nanoCDNHostConfigured.split(",").length;0!==this.nanoCDNList.length&&this.nanoCDNList.length===t||this.nanoCDNHostConfigured===e.NANOCDN_HOST_DISCOVER||!0!==Dt.getInstance().networkAvailable?this.nanoCDNHostConfigured===e.NANOCDN_HOST_DISCOVER&&!0===Dt.getInstance().networkAvailable&&this.refreshHostResolution():(this.clearHostResolution(),this.launchHostResolution())}else P.d(Qs,"Received event onForeground but ignored")}},{key:"onBackground",value:function(){Object.keys(this.nanoCDNHostResolvingTasks).length>0&&(P.d(Qs,"Host resolving will be resumed when the app will be restored"),this.clearHostResolution()),this.lastHostResolvingDate=0}},{key:"onNetworkAvailable",value:function(e){Date.now()-this.lastHostResolvingDate>1e3?(P.d(Qs,"Received event onNetworkAvailable. networkType:"+e),this.clearHostResolution(),this.launchHostResolution()):P.d(Qs,"Received event onNetworkAvailable but ignored")}},{key:"onNetworkLost",value:function(){P.d(Qs,"Received event onNetworkLost"),this.clearHostResolution()}}])&&Ys(t.prototype,i),e}();function Js(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Xs(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Ks(zs,"DEFAULT_NANOCDN_RESOLVING_RETRY_DELAY",6e4),Ks(zs,"NANOCDN_HOST_DISCOVER","discover"),Ks(zs,"STATE_NONE",0),Ks(zs,"STATE_IDLING",1),Ks(zs,"STATE_DISCOVERING",2),Ks(zs,"STATE_RESOLVING",3),Yt.nanoCDNModule={NanoCDNRequestManager:vs,HostResolvingTask:_s,MdnsManager:Hs,NanoCDNDescr:Ss,NanoCDNHostManager:zs,NanoCDNService:Ns};var Zs=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Xs(this,"contentURL",void 0),Xs(this,"redirectedURL",void 0),Xs(this,"cdnList",void 0),Xs(this,"cdnIndex",void 0),Xs(this,"fallbackURLList",void 0),Xs(this,"creationDate",void 0),this.contentURL=t,this.redirectedURL=i,this.cdnList=n,this.cdnIndex=0,this.creationDate=Date.now(),this.generateFallbackURLList()}var t,i,n;return t=e,n=[{key:"create",value:function(t,i){if(null!=i&&0===i.indexOf("http://127.0.0.1:18080/")){var n=O.getParam(i,"us"),r=O.getParam(i,"prio");if(""!==n&&""!==r){var a=n.split(","),s=r.split(",").map((function(e){return parseInt(e,10)})),o=new Array(a.length),u=[];if(a.length!==s.length)return;for(var l=0;l<a.length;l++){var c=a[l],d=s[l];void 0===o[d-1]?o[d-1]=[c]:o[d-1].push(c)}return o.forEach((function(e){e.forEach((function(e){u.push(e)}))})),new e(t,i,u)}}}}],(i=[{key:"generateFallbackURLList",value:function(){this.fallbackURLList=[];for(var e=0;e<this.cdnList.length;e++)e!==this.cdnIndex&&this.fallbackURLList.push(this.formatURL(e))}},{key:"formatURL",value:function(e){var t=O.parseURL(this.contentURL);return this.cdnList[e]+t.path+(t.query.length>0?"?"+t.query:"")}},{key:"selectNextCDN",value:function(){this.cdnIndex<this.cdnList.length?(this.cdnIndex++,this.generateFallbackURLList()):this.cdnIndex++}},{key:"isCDNValid",value:function(){return this.cdnIndex<this.cdnList.length}},{key:"getMainURL",value:function(){return this.formatURL(this.cdnIndex)}},{key:"getFallbackURLList",value:function(){return this.fallbackURLList}}])&&Js(t.prototype,i),n&&Js(t,n),e}();function $s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function eo(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var to="BpkDiversityFailoverCache",io=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),eo(this,"contentURL",void 0),eo(this,"failoverSession",void 0),eo(this,"handler",void 0)}var t,i;return t=e,(i=[{key:"getFailoverSession",value:function(t){var i;if(t===this.contentURL){if(void 0!==this.failoverSession&&void 0!==this.handler){var n=Date.now();if(0===this.handler.sessionReport.endSessionDate||n-this.handler.sessionReport.endSessionDate<e.CACHE_EXPIRATION_TIME)return this.failoverSession;P.v(to,"Diversity failover cache expired",this.handler.id),this.clearCache()}}else P.v(to,"New Diversity failover session",null===(i=this.handler)||void 0===i?void 0:i.id),this.clearCache()}},{key:"storeFailoverSession",value:function(e,t,i){P.i(to,"Storing Diversity failover session in cache ("+t.cdnList.length+" CDNs)",null==i?void 0:i.id),this.contentURL=e,this.failoverSession=t,this.handler=i}},{key:"updateCache",value:function(e){P.i(to,"Updating Diversity failover cache",null==e?void 0:e.id),this.handler=e}},{key:"clearCache",value:function(){var e;P.i(to,"Clearing Diversity failover cache",null===(e=this.handler)||void 0===e?void 0:e.id),this.contentURL=void 0,this.failoverSession=void 0,this.handler=void 0}}])&&$s(t.prototype,i),e}();function no(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ro(e,t){return ho(e,so(e,t,"get"))}function ao(e,t,i){return oo(e,so(e,t,"set"),i),i}function so(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function oo(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function uo(e,t,i){return co(e,t),lo(i,"get"),ho(e,i)}function lo(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function co(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function ho(e,t){return t.get?t.get.call(e):t.value}function fo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vo(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function po(e,t,i){return t&&vo(e.prototype,t),i&&vo(e,i),e}eo(io,"CACHE_EXPIRATION_TIME",6e4);var yo="BpkDiversity",go=function(){function e(){fo(this,e)}return po(e,null,[{key:"startLib",value:function(){}},{key:"stopLib",value:function(){}},{key:"setNbConnection",value:function(){}},{key:"setLogLevel",value:function(){}},{key:"getStats",value:function(){}},{key:"getJobStats",value:function(){}},{key:"getVersion",value:function(){}}]),e}(),Eo=new WeakMap,So=new WeakMap,bo=new WeakMap,ko=new WeakMap,mo=new WeakMap,_o=new WeakMap,Ao=function(){function e(){fo(this,e),no(this,"smartLib",void 0),Eo.set(this,{writable:!0,value:void 0}),So.set(this,{writable:!0,value:void 0}),bo.set(this,{writable:!0,value:void 0}),ko.set(this,{writable:!0,value:void 0}),mo.set(this,{writable:!0,value:void 0}),_o.set(this,{writable:!0,value:void 0}),no(this,"failoverCache",void 0),ao(this,So,0),ao(this,bo,2e3),ao(this,ko,0),ao(this,_o,e.MULTIPATH_LOG_LEVEL_ERROR),this.failoverCache=new io}return po(e,[{key:"attachInstance",value:function(e){this.smartLib=e}},{key:"attachHandler",value:function(e){ao(this,Eo,e)}},{key:"init",value:function(){if(ro(this,So)<=0){var e=this.getVersion();if(void 0===e&&(e="multipath get version not working"),ro(this,Eo).setNbConnection(ro(this,ko)),P.i(yo,e),P.i(yo,"Connection number: "+ro(this,ko)),ao(this,So,ro(this,Eo).startLib("--log-level "+ro(this,_o)+" --blacklist_timeout_cdn 200 --rcv_timeout_cdn "+ro(this,bo))),ro(this,So)<=0){var t;switch(ro(this,So)){case-1:t="can't get a valid port";break;case-2:t="issues to launch modules";break;case-3:t="options parsing error";break;default:t=ro(this,So)}P.e(yo,"Init lib multipath failed, status:"+t)}else P.i(yo,"Init lib multipath Successfull, port:"+ro(this,So))}}},{key:"release",value:function(){var e;ao(this,So,0),null===(e=ro(this,Eo))||void 0===e||e.stopLib(),this.failoverCache.clearCache()}},{key:"getVersion",value:function(){return ro(this,Eo).getVersion()}},{key:"isActive",value:function(){return ro(this,Eo)!==go&&ro(this,So)>0}},{key:"rewriteURL",value:function(e){if(ro(this,So)>0&&null!=e){var t=e.indexOf("["),i=e.indexOf("]"),n="/bpk-token/";t>=0&&i>=0||(t=e.indexOf(n))>=0&&(t+=n.length-1,i=e.indexOf("/",t+1)),t>=0&&i>=0&&ao(this,mo,e.substring(t+1,i)),""!==O.getParam(e,"us")&&(e=e.replace(":18080/",":"+ro(this,So)+"/"))}return e}},{key:"getFailoverSession",value:function(e,t){var i=this.failoverCache.getFailoverSession(e);if(void 0!==i){if(i.selectNextCDN(),!i.isCDNValid())return;this.failoverCache.updateCache(t)}return i}},{key:"createFailoverSession",value:function(e,t,i){var n;P.i(yo,"Parsing Diversity failover response...",i.id);try{n=Zs.create(e,t)}catch(e){P.d(yo,"Diversity failover response unreadable (try catch)",i.id)}return void 0!==n?(this.failoverCache.storeFailoverSession(e,n,i),P.i(yo,"Diversity failover session starting",i.id)):P.i(yo,"Diversity failover response unreadable (parsing), falling back to default workflow",i.id),n}},{key:"getNbConnection",value:function(){return ro(this,ko)}},{key:"setNbConnection",value:function(e){ao(this,ko,e),ro(this,Eo).setNbConnection(e)}},{key:"setRcvTimeoutMs",value:function(e){ao(this,bo,e)}},{key:"setLogLevel",value:function(e){ao(this,_o,e),ro(this,Eo).setLogLevel(e)}},{key:"getStats",value:function(e,t){var i="";return ro(this,So)>0?i=ro(this,Eo).getStats(e,t):P.d(yo,"No diversity metrics"),i}},{key:"getJobStats",value:function(e,t){var i="";return ro(this,So)>0&&(""!==e&&null!=e||void 0===ro(this,mo)||(e=ro(this,mo)),i=ro(this,Eo).getJobStats(e,t)),""!==i&&void 0!==i||(i='{"id":"'+t+'","Bytes":0,"DurationMs":0,"Bitratebps":0,"ResponseTimeMs":0,"Cdn":[]}'),i}},{key:"saveDiversityStats",value:function(e){}},{key:"getDiversityStats",value:function(){}}],[{key:"getInstance",value:function(){return uo(e,e,No)||function(e,t,i,n){co(e,t),lo(i,"set"),oo(e,i,n)}(e,e,No,new e),uo(e,e,No)}}]),e}();no(Ao,"MULTIPATH_STATS_PERIODIC",0),no(Ao,"MULTIPATH_STATS_SINCE_START",1),no(Ao,"MULTIPATH_LOG_LEVEL_PANIC",1),no(Ao,"MULTIPATH_LOG_LEVEL_FATAL",2),no(Ao,"MULTIPATH_LOG_LEVEL_ERROR",3),no(Ao,"MULTIPATH_LOG_LEVEL_WARN",4),no(Ao,"MULTIPATH_LOG_LEVEL_NOTICE",5),no(Ao,"MULTIPATH_LOG_LEVEL_INFO",6),no(Ao,"MULTIPATH_LOG_LEVEL_DEBUG",7);var No={writable:!0,value:void 0};function Ro(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Do(e,t,i){return To(e,t),Po(i,"get"),function(e,t){return t.get?t.get.call(e):t.value}(e,i)}function Po(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function To(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}var wo="BpkDiversityRequestMgr",Oo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"getInstance",value:function(){return Do(e,e,Lo)||function(e,t,i,n){To(e,t),Po(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n)}(e,e,Lo,new e),Do(e,e,Lo)}}],(i=[{key:"processFailoverSession",value:function(e,t,i){var n,r=!0===i.options.get(Ke.REQUEST_DIVERSITY_DYNAMIC_FAILOVER);return r?void 0!==(n=Yt.diversityModule.DiversityManager.getInstance().getFailoverSession(e,i))&&(P.i(wo,"Session in Diversity failover cache, using URL "+n.getMainURL(),i.id),e=n.getMainURL()):Yt.diversityModule.DiversityManager.getInstance().failoverCache.clearCache(),be.getInstance().getURL(e,t,i).then((function(a){if(r){var s=n||Yt.diversityModule.DiversityManager.getInstance().createFailoverSession(e,a.getURL(),i);if(void 0!==s){if(i.diversityFailoverSession=s,void 0===n)return P.i(wo,"Diversity failover session main URL: "+s.getMainURL(),i.id),be.getInstance().getURL(s.getMainURL(),t,i).then((function(e){return e.diversityFailoverSession=s,e}));P.i(wo,"Applying Diversity failover session...",i.id),a.diversityFailoverSession=s}}return a}))}}])&&Ro(t.prototype,i),n&&Ro(t,n),e}(),Lo={writable:!0,value:void 0};function Co(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Io(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Yt.diversityModule={DiversityManager:Ao,DiversityFailoverSession:Zs,DiversityFailoverCache:io,DiversityRequestManager:Oo};var Mo=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Io(this,"playerAdapter",void 0),Io(this,"listener",void 0),Io(this,"pollPeriod",void 0),Io(this,"pollLastDate",void 0),Io(this,"pollPlayerInterval",void 0),Io(this,"lastPosition",void 0),Io(this,"expectedPosition",void 0),this.playerAdapter=t,this.listener=i,this.pollPeriod=e.POLLING_PERIOD,this.pollPlayerInterval=null,this.expectedPosition=0,this.pollLastDate=0}var t,i;return t=e,(i=[{key:"start",value:function(){var e=this;this.expectedPosition=this.playerAdapter.getPosition(),this.pollLastDate=Date.now(),null!==this.pollPlayerInterval&&clearInterval(this.pollPlayerInterval),this.pollPlayerInterval=setInterval((function(){e.pollPlayerPosition()}),this.pollPeriod)}},{key:"stop",value:function(){null!==this.pollPlayerInterval&&(clearInterval(this.pollPlayerInterval),this.pollPlayerInterval=null)}},{key:"forcePollPlayerPosition",value:function(){this.expectedPosition=this.expectedPosition-this.pollPeriod+(Date.now()-this.pollLastDate),this.pollPlayerPosition()}},{key:"pollPlayerPosition",value:function(){this.lastPosition=this.playerAdapter.getPosition();var e=this.expectedPosition+2*this.pollPeriod,t=this.expectedPosition-2*this.pollPeriod;(this.lastPosition<t||this.lastPosition>e)&&void 0!==this.listener&&"function"==typeof this.listener.handleSeek&&!0===this.listener.handleSeek(this.expectedPosition,this.lastPosition)&&P.d("BpkPlayerStateManager","Player is seeking ("+ti.formatTime(this.expectedPosition)+" to "+ti.formatTime(this.lastPosition)+")"),this.expectedPosition=this.lastPosition+this.pollPeriod,void 0!==this.listener&&"function"==typeof this.listener.handlePoll&&this.listener.handlePoll(),this.pollLastDate=Date.now()}},{key:"getPositionBeforeSeek",value:function(){return this.lastPosition}}])&&Co(t.prototype,i),e}();function Bo(e){return(Bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Uo(e,t){return(Uo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function jo(e,t){return!t||"object"!==Bo(t)&&"function"!=typeof t?Fo(e):t}function Fo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xo(e){return(xo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vo(e,t,i){return Ho(e,t),Go(i,"get"),function(e,t){return t.get?t.get.call(e):t.value}(e,i)}function Go(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Ho(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function Wo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qo(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Yo(e,t,i){return t&&qo(e.prototype,t),i&&qo(e,i),e}function Ko(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Io(Mo,"POLLING_PERIOD",500);var Qo="BpkAVPlayAdapter",zo=function(){function e(t){Wo(this,e),Ko(this,"adapter",void 0),Ko(this,"listener",void 0),Ko(this,"lastPosition",void 0),Ko(this,"waitToStartTask",void 0),this.adapter=t,this.listener=t.listener,this.waitToStartTask=void 0}return Yo(e,[{key:"onEvent",value:function(e,t,i){void 0!==this.listener&&"function"==typeof this.listener[e]&&this.listener[e](t,i)}},{key:"onbufferingstart",value:function(){this.onEvent("onbufferingstart"),this.adapter.started&&!this.adapter.stalling&&this.adapter.notifyStallStart(),this.adapter.buffering=!0}},{key:"onbufferingprogress",value:function(e){this.onEvent("onbufferingprogress",e)}},{key:"tryToStart",value:function(){this.adapter.player.getDuration(),this.adapter.player.getCurrentStreamInfo(),this.adapter.player.getCurrentTime(),this.adapter.player.getStreamingProperty("IS_LIVE"),P.d(Qo,"Player fully initialized, starting the session..."),this.adapter.playerStateManager.start(),this.adapter.started=!0,this.adapter.notifyFirstImage()}},{key:"onbufferingcomplete",value:function(){var e=this;if(this.onEvent("onbufferingcomplete"),this.adapter.started)this.adapter.stalling=!1,this.adapter.playerStateManager.forcePollPlayerPosition(),this.adapter.notifyStallEnd();else if(void 0===this.waitToStartTask){this.waitToStartTask={};try{this.tryToStart()}catch(t){this.waitToStartTask=setInterval((function(){try{e.tryToStart(),clearInterval(e.waitToStartTask)}catch(e){}}),100)}}this.adapter.buffering=!1}},{key:"oncurrentplaytime",value:function(e){this.onEvent("oncurrentplaytime",e),this.adapter.started&&(this.adapter.paused||(this.lastPosition===e?this.adapter.stalling||(this.adapter.stalling=!0,this.adapter.notifyStallStart()):(this.adapter.stalling=!1,this.adapter.buffering||this.adapter.notifyStallEnd(!this.adapter.paused)),this.lastPosition=e))}},{key:"onstreamcompleted",value:function(){this.onEvent("onstreamcompleted")}},{key:"onevent",value:function(e,t){switch(this.onEvent("onevent",e,t),e){case"PLAYER_MSG_BITRATE_CHANGE":if("string"==typeof t&&-1!==t.indexOf("BITRATE:")){var i=t.split(":")[1],n=Math.round(Number.parseInt(i,10)/1e3);n<=256?(this.adapter.nextBitrate=-1,P.w(Qo,"Ignoring current bitrate "+n+"kbps because it is too low to be a video layer.")):(this.adapter.nextBitrate=Math.round(Number.parseInt(i,10)/1e3),this.adapter.appliedBitrate=this.adapter.nextBitrate,this.adapter.notifyLayerSwitch())}else{var r=JSON.parse(this.adapter.player.getCurrentStreamInfo()[0].extra_info),a=Math.round(Number.parseInt(r.Bit_rate,10)/1e3);this.adapter.nextBitrate=a,-1===this.adapter.appliedBitrate&&(this.adapter.appliedBitrate=this.adapter.nextBitrate)}break;case"PLAYER_MSG_RESOLUTION_CHANGED":if(-1===this.adapter.nextBitrate){var s=JSON.parse(this.adapter.player.getCurrentStreamInfo()[0].extra_info),o=Math.round(Number.parseInt(s.Bit_rate,10)/1e3);this.adapter.nextBitrate=o}this.adapter.appliedBitrate=this.adapter.nextBitrate,this.adapter.notifyLayerSwitch()}}},{key:"onerror",value:function(e){if(this.onEvent("onerror",e),this.adapter.setStatusCode(this.adapter.getErrorCode(e)),e.indexOf("PLAYER_ERROR_")>=0){var t=e.substr(13);this.adapter.setPlayerErrorCode(t)}P.w(Qo,"Player error: "+e)}},{key:"ondrmevent",value:function(e,t){this.onEvent("ondrmevent",e,t)}},{key:"onsubtitlechange",value:function(){this.onEvent("onsubtitlechange")}}]),e}(),Jo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Uo(e,t)}(i,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=xo(e);if(t){var r=xo(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return jo(this,i)}}(i);function i(){var e;Wo(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return Ko(Fo(e=t.call.apply(t,[this].concat(r))),"player",void 0),Ko(Fo(e),"listener",void 0),Ko(Fo(e),"started",void 0),Ko(Fo(e),"paused",void 0),Ko(Fo(e),"stalling",void 0),Ko(Fo(e),"buffering",void 0),Ko(Fo(e),"nextBitrate",void 0),Ko(Fo(e),"appliedBitrate",void 0),Ko(Fo(e),"playerStateManager",void 0),Ko(Fo(e),"playerListener",void 0),e}return Yo(i,[{key:"onPlayEvent",value:function(){this.started&&(this.notifyResume(),this.paused=!1)}},{key:"onPauseEvent",value:function(){this.started&&(this.notifyPause(),this.paused=!0)}},{key:"onSeekToEvent",value:function(){var e=this;this.playerStateManager.forcePollPlayerPosition(),this.playerListener.oncurrentplaytime(this.getPosition()),setTimeout((function(){e.playerListener.oncurrentplaytime(e.getPosition())}),2)}},{key:"onJumpForwardEvent",value:function(){this.onSeekToEvent()}},{key:"onJumpBackwardEvent",value:function(){this.onSeekToEvent()}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"getName",value:function(){return"AVPlay"}},{key:"getVersion",value:function(){return void 0!==this.player?this.player.getVersion():""}},{key:"getDeviceType",value:function(){return"tv"}},{key:"getBitrate",value:function(){return this.appliedBitrate}},{key:"getPosition",value:function(){if(void 0!==this.player)try{return this.player.getCurrentTime()}catch(e){return P.d(Qo,"getPosition error : "+JSON.stringify(e)),0}return 0}},{key:"getDuration",value:function(){if(void 0!==this.player&&!this.isLive())try{return this.player.getDuration()}catch(e){return P.d(Qo,"getDuration error : "+JSON.stringify(e)),0}return 0}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"isLive",value:function(){try{return void 0!==this.player&&"1"===this.player.getStreamingProperty("IS_LIVE")}catch(e){return P.d(Qo,"isLive error : "+JSON.stringify(e)),!0}}},{key:"getErrorCode",value:function(e){switch(e){case"PLAYER_ERROR_NONE":return Yt.BPSessionEndsNormally;case"PLAYER_ERROR_NO_SUCH_FILE":case"PLAYER_ERROR_INVALID_URI":case"PLAYER_ERROR_CONNECTION_FAILED":return Yt.BPNetworkingError;case"PLAYER_ERROR_NOT_SUPPORTED_FILE":return Yt.BPFormatNotSupportedError}return Yt.BPUnspecifiedError}},{key:"initSessionPlayerObjects",value:function(){var e=this;this.started=!1,this.paused=!1,this.buffering=!0,this.stalling=!1,this.nextBitrate=-1,this.appliedBitrate=-1,void 0!==this.player&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new Mo(this,this),void 0===Vo(i,i,Xo)&&(function(e,t,i,n){Ho(e,t),Go(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n)}(i,i,Xo,{}),Vo(i,i,Xo).play=this.player.play,Vo(i,i,Xo).pause=this.player.pause,Vo(i,i,Xo).seekTo=this.player.seekTo,Vo(i,i,Xo).jumpForward=this.player.jumpForward,Vo(i,i,Xo).jumpBackward=this.player.jumpBackward),this.playerListener=new zo(this),this.player.setListener(this.playerListener),this.player.play=function(){Vo(i,i,Xo).play(),e.onPlayEvent()},this.player.pause=function(){Vo(i,i,Xo).pause(),e.onPauseEvent()},this.player.seekTo=function(t,n,r){void 0===n&&void 0===r?Vo(i,i,Xo).seekTo(t):void 0!==n&&void 0===r?Vo(i,i,Xo).seekTo(t,n):Vo(i,i,Xo).seekTo(t,n,r),e.onSeekToEvent(t)},this.player.jumpForward=function(t,n,r){void 0===n&&void 0===r?Vo(i,i,Xo).jumpForward(t):void 0!==n&&void 0===r?Vo(i,i,Xo).jumpForward(t,n):Vo(i,i,Xo).jumpForward(t,n,r),e.onJumpForwardEvent(t)},this.player.jumpBackward=function(t,n,r){void 0===n&&void 0===r?Vo(i,i,Xo).jumpBackward(t):void 0!==n&&void 0===r?Vo(i,i,Xo).jumpBackward(t,n):Vo(i,i,Xo).jumpBackward(t,n,r),e.onJumpBackwardEvent(t)})}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==this.player&&(void 0!==this.playerListener&&clearInterval(this.playerListener.waitToStartTask),this.player.setListener(this.listener),void 0!==Vo(i,i,Xo)&&(this.player.play=Vo(i,i,Xo).play,this.player.pause=Vo(i,i,Xo).pause,this.player.seekTo=Vo(i,i,Xo).seekTo,this.player.jumpForward=Vo(i,i,Xo).jumpForward,this.player.jumpBackward=Vo(i,i,Xo).jumpBackward))}},{key:"attachPlayer",value:function(e,t){return!!i.checkPlayer(e,t)&&(this.player=e,this.listener=t,!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),this.player=void 0,this.listener=void 0}}],[{key:"checkPlayer",value:function(e,t){return"function"==typeof e.getTotalTrackInfo&&"function"==typeof e.getCurrentStreamInfo}}]),i}(un),Xo={writable:!0,value:void 0};function Zo(e){return(Zo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function eu(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tu(e,t,i){return(tu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=au(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function iu(e,t){return(iu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nu(e,t){return!t||"object"!==Zo(t)&&"function"!=typeof t?ru(e):t}function ru(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function au(e){return(au=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function su(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ou(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,lu(e,t,"set"),i),i}function uu(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,lu(e,t,"get"))}function lu(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}tn.avplayModule={AVPlayAdapter:Jo};var cu="BpkConnectPlayerAdapter",du=new WeakMap,hu=new WeakMap,fu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&iu(e,t)}(a,e);var t,i,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=au(e);if(t){var r=au(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return nu(this,i)}}(a);function a(){var e;$o(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),du.set(ru(e),{writable:!0,value:void 0}),hu.set(ru(e),{writable:!0,value:void 0}),su(ru(e),"started",void 0),su(ru(e),"paused",void 0),su(ru(e),"waiting",void 0),su(ru(e),"seeking",void 0),su(ru(e),"bitrate",void 0),su(ru(e),"playerStateManager",void 0),su(ru(e),"playerListeners",void 0),e}return t=a,n=[{key:"attachLibrary",value:function(e){void 0!==e.conax&&void 0!==e.eventTimelineAnalyzer?(P.d(cu,"CONNECT Player library attached"),a.library=e):P.e(cu,"Try to attach a library, but it is not recognized")}},{key:"checkPlayer",value:function(e,t){return"undefined"!=typeof window&&void 0!==window.OTV&&(a.library=window.OTV),"object"===Zo(e.activePlugins_)&&"object"===Zo(e.player_)&&"boolean"==typeof e.userActive_}}],(i=[{key:"onPlayingEvent",value:function(){this.started?(this.paused&&this.notifyResume(),this.seeking&&(this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(),this.waiting=!1),this.waiting&&this.notifyStallEnd()):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage()),this.paused=!1,this.waiting=!1,this.seeking=!1}},{key:"onPlayEvent",value:function(){this.paused&&this.notifyResume(),this.paused=!1}},{key:"onPauseEvent",value:function(){(!uu(this,du).seeking()||uu(this,du).seeking()&&this.seeking)&&(this.notifyPause(),this.paused=!0)}},{key:"onWaitingEvent",value:function(){uu(this,du).seeking()||this.waiting||this.seeking||(this.notifyStallStart(),this.waiting=!0)}},{key:"onSeekingEvent",value:function(){this.seeking||(this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition(),this.seeking=!0)}},{key:"onProgressEvent",value:function(){this.paused&&(this.seeking&&(this.notifyStallEnd(!1),this.seeking=!1,this.waiting=!1),this.waiting&&(this.notifyStallEnd(!1),this.waiting=!1))}},{key:"onErrorEvent",value:function(){var e=uu(this,du).error();this.setStatusCode(this.getErrorCode(e)),this.setPlayerErrorCode(e.code),P.w(cu,"Player error:"+e.message+" (code: "+e.code+")")}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"handlePoll",value:function(){var e=this.getBitrate();e>0&&this.bitrate!==e&&(this.bitrate=e,this.notifyLayerSwitch(this.bitrate))}},{key:"getName",value:function(){return"CONNECT Player"}},{key:"getVersion",value:function(){return a.library.versions.product}},{key:"getDeviceType",value:function(){var e=tu(au(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){var e,t=null===(e=uu(this,du).otvtoolkit().networkStatistics)||void 0===e?void 0:e.impl;return void 0!==t&&void 0!==t.availableBitrates?Math.floor(t.availableBitrates[t.requestQualityIdx]/1e3):0}},{key:"getPosition",value:function(){if(void 0!==uu(this,du)){if(uu(this,du).isDynamic){var e,t=null===(e=uu(this,du).dashjs)||void 0===e?void 0:e.timeAsUTC();if(void 0!==t)return Math.round(1e3*t)}return Math.round(1e3*uu(this,du).currentTime())}return 0}},{key:"getDuration",value:function(){return void 0!==uu(this,du)&&isFinite(uu(this,du).duration())?Math.round(1e3*uu(this,du).duration()):0}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){switch(e.code){case 0:case 1:return Yt.BPUnspecifiedError;case 2:return Yt.BPNetworkingError;case 3:return Yt.BPDecodingError;case 4:return Yt.BPFormatNotSupportedError;case 5:return Yt.BPAccessRightError;default:return Yt.BPUnspecifiedError}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.waiting=!1,this.seeking=!1,this.bitrate=0,this.handlePoll(),void 0!==uu(this,du)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new Mo(this,this),this.playerListeners=[this.onPlayingEvent.bind(this),this.onPlayEvent.bind(this),this.onPauseEvent.bind(this),this.onWaitingEvent.bind(this),this.onSeekingEvent.bind(this),this.onProgressEvent.bind(this),this.onErrorEvent.bind(this)],uu(this,du).on("playing",this.playerListeners[0]),uu(this,du).on("play",this.playerListeners[1]),uu(this,du).on("pause",this.playerListeners[2]),uu(this,du).on("waiting",this.playerListeners[3]),uu(this,du).on("seeking",this.playerListeners[4]),uu(this,du).on("progress",this.playerListeners[5]),uu(this,du).on("error",this.playerListeners[6]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==uu(this,du)&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(uu(this,du).off("playing",this.playerListeners[0]),uu(this,du).off("play",this.playerListeners[1]),uu(this,du).off("pause",this.playerListeners[2]),uu(this,du).off("waiting",this.playerListeners[3]),uu(this,du).off("seeking",this.playerListeners[4]),uu(this,du).off("progress",this.playerListeners[5]),uu(this,du).off("error",this.playerListeners[6]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(void 0===a.library&&P.e(cu,"Player library not attached to the adapter, please call ConnectPlayerAdapter.attachLibrary(OTV) before attachPlayer"),ou(this,du,e),ou(this,hu,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),ou(this,du,void 0),ou(this,hu,void 0)}}])&&eu(t.prototype,i),n&&eu(t,n),a}(un);function vu(e){return(vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yu(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gu(e,t,i){return(gu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ku(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function Eu(e,t){return(Eu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Su(e,t){return!t||"object"!==vu(t)&&"function"!=typeof t?bu(e):t}function bu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ku(e){return(ku=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mu(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _u(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Nu(e,t,"set"),i),i}function Au(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,Nu(e,t,"get"))}function Nu(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}su(fu,"library",void 0),tn.connectplayerModule={ConnectPlayerAdapter:fu};var Ru="BpkDashJsPlayerAdapter",Du=new WeakMap,Pu=new WeakMap,Tu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Eu(e,t)}(a,e);var t,i,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ku(e);if(t){var r=ku(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Su(this,i)}}(a);function a(){var e;pu(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),Du.set(bu(e),{writable:!0,value:void 0}),Pu.set(bu(e),{writable:!0,value:void 0}),mu(bu(e),"started",void 0),mu(bu(e),"paused",void 0),mu(bu(e),"buffering",void 0),mu(bu(e),"seeking",void 0),mu(bu(e),"seekBeginPosition",void 0),mu(bu(e),"lastLayer",void 0),mu(bu(e),"playerStateManager",void 0),mu(bu(e),"playerListener",void 0),mu(bu(e),"position",void 0),e}return t=a,n=[{key:"attachLibrary",value:function(e){void 0!==e.MediaPlayer&&void 0!==e.Version?(P.d(Ru,"Dash.js library attached"),a.library=e):P.e(Ru,"Try to attach a library, but it is not recognized")}},{key:"checkPlayer",value:function(e,t){return"undefined"!=typeof window&&void 0!==window.dashjs&&(a.library=window.dashjs),"object"===vu(a.library)&&"function"==typeof e.getDashMetrics&&"function"==typeof e.getClassName&&"MediaPlayer"===e.getClassName()}}],(i=[{key:"handleEvent",value:function(e){if("playbackPlaying"===e.type)this.started?(this.buffering&&(this.notifyStallEnd(),this.setStatusCode(Yt.BPSessionEndsNormally),this.buffering=!1,this.seeking=!1),this.paused&&(this.notifyResume(),this.paused=!1)):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage());else if("playbackPaused"===e.type)this.started&&(!this.buffering&&Au(this,Du).isSeeking()?(this.seeking=!0,this.buffering=!0,this.seekBeginPosition=this.playerStateManager.getPositionBeforeSeek(),this.notifyStallStart(),this.seeking&&this.notifySeek(this.seekBeginPosition,this.getPosition())):this.buffering&&Au(this,Du).isSeeking()&&!this.seeking?(this.seeking=!0,this.seekBeginPosition=this.playerStateManager.getPositionBeforeSeek(),this.notifySeek(this.seekBeginPosition,this.getPosition())):Au(this,Du).isPaused()&&!this.paused&&(this.paused=!0,this.notifyPause()));else if("playbackWaiting"===e.type||"bufferStalled"===e.type&&"video"===e.mediaType)this.started&&!this.buffering&&(Au(this,Du).isSeeking()&&(this.seeking=!0,this.seekBeginPosition=this.playerStateManager.getPositionBeforeSeek()),this.buffering=!0,this.notifyStallStart(),this.seeking&&this.notifySeek(this.seekBeginPosition,this.getPosition()));else if("bufferLoaded"===e.type&&"video"===e.mediaType)this.started&&this.paused&&(this.notifyStallEnd(),this.setStatusCode(Yt.BPSessionEndsNormally),this.buffering=!1,this.seeking=!1);else if("qualityChangeRendered"===e.type){var t=this.getBitrate();t!==this.lastLayer&&(this.lastLayer=t,this.notifyLayerSwitch(t))}else"error"===e.type&&"object"===vu(e.error)&&"DashJSError"===e.error.constructor.name&&(P.e(Ru,"Player encountered an error : "+e.error.code),this.setStatusCode(this.getErrorCode(e.error)),this.setPlayerErrorCode(e.error.code))}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"getName",value:function(){return"Dash.js"}},{key:"getVersion",value:function(){return a.library.Version.substring(0,32)}},{key:"getDeviceType",value:function(){var e=gu(ku(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){if(void 0!==Au(this,Du)&&Au(this,Du).isReady()){var e=Au(this,Du).getQualityFor("video"),t=Au(this,Du).getQualityFor("audio"),i=Au(this,Du).getBitrateInfoListFor("video"),n=Au(this,Du).getBitrateInfoListFor("audio"),r=0;return e<i.length&&(r=Math.round(i[e].bitrate/1e3)),t<n.length&&(r+=Math.round(n[t].bitrate/1e3)),r}return 0}},{key:"getPosition",value:function(){return void 0!==Au(this,Du)?Au(this,Du).isDynamic()&&(isNaN(Au(this,Du).timeAsUTC())||(this.position=Math.round(1e3*Au(this,Du).timeAsUTC())),0!==this.position)?this.position:Math.round(1e3*Au(this,Du).time()):0}},{key:"getDuration",value:function(){return void 0===Au(this,Du)||Au(this,Du).isDynamic()?0:Math.round(1e3*Au(this,Du).duration())}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){var t=a.library.MediaPlayer.errors;switch(e.code){case t.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE:return Yt.BPFormatNotSupportedError;case t.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE:case t.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE:case t.SEGMENTS_UPDATE_FAILED_ERROR_CODE:case t.SEGMENTS_UNAVAILABLE_ERROR_CODE:case t.SEGMENT_BASE_LOADER_ERROR_CODE:case t.TIME_SYNC_FAILED_ERROR_CODE:case t.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE:case t.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE:case t.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE:case t.APPEND_ERROR_CODE:case t.REMOVE_ERROR_CODE:case t.DATA_UPDATE_FAILED_ERROR_CODE:return Yt.BPDecodingError;case t.CAPABILITY_MEDIASOURCE_ERROR_CODE:return Yt.BPFormatNotSupportedError;case t.CAPABILITY_MEDIAKEYS_ERROR_CODE:return Yt.BPAccessRightError;case t.DOWNLOAD_ERROR_ID_MANIFEST_CODE:case t.DOWNLOAD_ERROR_ID_SIDX_CODE:case t.DOWNLOAD_ERROR_ID_CONTENT_CODE:case t.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE:case t.DOWNLOAD_ERROR_ID_XLINK_CODE:return Yt.BPNetworkingError;case t.MANIFEST_ERROR_ID_CODEC_CODE:case t.MANIFEST_ERROR_ID_PARSE_CODE:case t.MANIFEST_ERROR_ID_NOSTREAMS_CODE:case t.TIMED_TEXT_ERROR_ID_PARSE_CODE:return Yt.BPDecodingError;case t.MANIFEST_ERROR_ID_MULTIPLEXED_CODE:case t.MEDIASOURCE_TYPE_UNSUPPORTED_CODE:return Yt.BPFormatNotSupportedError}return e.code>=t.MEDIA_KEYERR_CODE?Yt.BPAccessRightError:Yt.BPUnspecifiedError}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.buffering=!1,this.seeking=!1,this.seekBeginPosition=0,this.lastLayer=0,this.position=0,void 0!==Au(this,Du)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new Mo(this,this),this.playerListener=this.handleEvent.bind(this),Au(this,Du).on(a.library.MediaPlayer.events.PLAYBACK_PLAYING,this.playerListener,this),Au(this,Du).on(a.library.MediaPlayer.events.PLAYBACK_PAUSED,this.playerListener,this),Au(this,Du).on(a.library.MediaPlayer.events.BUFFER_EMPTY,this.playerListener,this),Au(this,Du).on(a.library.MediaPlayer.events.QUALITY_CHANGE_RENDERED,this.playerListener,this),Au(this,Du).on(a.library.MediaPlayer.events.ERROR,this.playerListener,this),Au(this,Du).on(a.library.MediaPlayer.events.PLAYBACK_WAITING,this.playerListener,this),Au(this,Du).on(a.library.MediaPlayer.events.BUFFER_LOADED,this.playerListener,this))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==Au(this,Du)&&void 0!==this.playerListener&&(Au(this,Du).off(a.library.MediaPlayer.events.PLAYBACK_PLAYING,this.playerListener,this),Au(this,Du).off(a.library.MediaPlayer.events.PLAYBACK_PAUSED,this.playerListener,this),Au(this,Du).off(a.library.MediaPlayer.events.BUFFER_EMPTY,this.playerListener,this),Au(this,Du).off(a.library.MediaPlayer.events.QUALITY_CHANGE_RENDERED,this.playerListener,this),Au(this,Du).off(a.library.MediaPlayer.events.ERROR,this.playerListener,this),Au(this,Du).off(a.library.MediaPlayer.events.PLAYBACK_WAITING,this.playerListener,this),Au(this,Du).off(a.library.MediaPlayer.events.BUFFER_LOADED,this.playerListener,this))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(void 0===a.library&&P.e(Ru,"Player library not attached to the adapter, please call DashJsPlayerAdapter.attachLibrary(dashjs) before attachPlayer"),_u(this,Du,e),_u(this,Pu,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),_u(this,Du,void 0),_u(this,Pu,void 0)}}])&&yu(t.prototype,i),n&&yu(t,n),a}(un);function wu(e){return(wu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ou(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lu(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Cu(e,t,i){return(Cu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Uu(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function Iu(e,t){return(Iu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Mu(e,t){return!t||"object"!==wu(t)&&"function"!=typeof t?Bu(e):t}function Bu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Uu(e){return(Uu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ju(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Fu(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Vu(e,t,"set"),i),i}function xu(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,Vu(e,t,"get"))}function Vu(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}mu(Tu,"library",void 0),tn.dashjsModule={DashJsPlayerAdapter:Tu};var Gu=new WeakMap,Hu=new WeakMap,Wu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Iu(e,t)}(a,e);var t,i,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Uu(e);if(t){var r=Uu(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Mu(this,i)}}(a);function a(){var e;Ou(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),Gu.set(Bu(e),{writable:!0,value:void 0}),Hu.set(Bu(e),{writable:!0,value:void 0}),ju(Bu(e),"started",void 0),ju(Bu(e),"buffering",void 0),ju(Bu(e),"playerStateManager",void 0),ju(Bu(e),"playerListener",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return"number"==typeof e.playPosition&&"number"==typeof e.playState}}],(i=[{key:"onPlayStateChange",value:function(e){switch(e){case 0:break;case 1:this.started?(!0===this.buffering&&(this.buffering=!1,this.notifyStallEnd(!0)),this.notifyResume(),this.setStatusCode(Yt.BPSessionEndsNormally),this.setPlayerErrorCode("")):(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage());break;case 2:!0===this.buffering&&(this.buffering=!1,this.notifyStallEnd(!0)),this.notifyPause();break;case 3:break;case 4:this.started&&(void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition(),this.buffering=!0,this.notifyStallStart());break;case 5:break;case 6:P.e("BpkHbbTV1PlayerAdapter","On player error : "+xu(this,Gu).error),this.setStatusCode(this.getErrorCode(xu(this,Gu).error)),this.setPlayerErrorCode(xu(this,Gu).error)}}},{key:"handleSeek",value:function(e,t){!1===this.buffering&&(this.buffering=!0,this.notifyStallStart()),this.notifySeek(e,t)}},{key:"getName",value:function(){return"HbbTV"}},{key:"getVersion",value:function(){if("object"===("undefined"==typeof navigator?"undefined":wu(navigator))&&void 0!==navigator.userAgent){var e=navigator.userAgent.match("HbbTV/([0-9.]*)");if(null!==e)return e[1]}return"1.X"}},{key:"getDeviceType",value:function(){var e=Cu(Uu(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="tv"),e}},{key:"getBitrate",value:function(){return-1}},{key:"getPosition",value:function(){return void 0!==xu(this,Gu)?Math.round(xu(this,Gu).playPosition):0}},{key:"getDuration",value:function(){return void 0!==xu(this,Gu)&&0!==xu(this,Gu).playTime&&xu(this,Gu).playTime!==1/0?Math.round(xu(this,Gu).playTime):0}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){switch(e){case 0:return Yt.BPFormatNotSupportedError;case 1:return Yt.BPNetworkingError;case 2:return Yt.BPUnspecifiedError;case 3:case 4:return Yt.BPDecodingError;case 5:case 6:return Yt.BPNetworkingError}return Yt.BPUnspecifiedError}},{key:"initSessionPlayerObjects",value:function(){var e=this;this.started=!1,this.buffering=!1,void 0!==xu(this,Gu)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new Mo(this,this),this.playerListener=xu(this,Gu).onPlayStateChange,xu(this,Gu).onPlayStateChange=function(t){e.onPlayStateChange(t),"function"==typeof e.playerListener&&e.playerListener(t)})}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==xu(this,Gu)&&(xu(this,Gu).onPlayStateChange=this.playerListener)}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(Fu(this,Gu,e),Fu(this,Hu,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),Fu(this,Gu,void 0),Fu(this,Hu,void 0)}}])&&Lu(t.prototype,i),n&&Lu(t,n),a}(un);function qu(e){return(qu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ku(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qu(e,t,i){return(Qu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Zu(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function zu(e,t){return(zu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ju(e,t){return!t||"object"!==qu(t)&&"function"!=typeof t?Xu(e):t}function Xu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zu(e){return(Zu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $u(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function el(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,il(e,t,"set"),i),i}function tl(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,il(e,t,"get"))}function il(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}tn.hbbtv1Module={HbbTV1PlayerAdapter:Wu};var nl=new WeakMap,rl=new WeakMap,al=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zu(e,t)}(a,e);var t,i,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Zu(e);if(t){var r=Zu(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Ju(this,i)}}(a);function a(){var e;Yu(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),nl.set(Xu(e),{writable:!0,value:void 0}),rl.set(Xu(e),{writable:!0,value:void 0}),$u(Xu(e),"started",void 0),$u(Xu(e),"paused",void 0),$u(Xu(e),"waiting",void 0),$u(Xu(e),"seeking",void 0),$u(Xu(e),"playerStateManager",void 0),$u(Xu(e),"playerListeners",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return"object"===qu(e.seekable)&&"function"==typeof e.play}}],(i=[{key:"onPlayingEvent",value:function(){this.started?(this.paused&&this.notifyResume(),this.seeking&&(this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(),this.waiting=!1),this.waiting&&this.notifyStallEnd()):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage()),this.paused=!1,this.waiting=!1,this.seeking=!1}},{key:"onPlayEvent",value:function(){this.paused&&this.notifyResume(),this.paused=!1}},{key:"onPauseEvent",value:function(){(!tl(this,nl).seeking||tl(this,nl).seeking&&this.seeking)&&(this.notifyPause(),this.paused=!0)}},{key:"onWaitingEvent",value:function(){tl(this,nl).seeking||this.waiting||this.seeking||(this.notifyStallStart(),this.waiting=!0)}},{key:"onSeekingEvent",value:function(){this.seeking||(this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition(),this.seeking=!0)}},{key:"onProgressEvent",value:function(){this.paused&&(this.seeking&&(this.notifyStallEnd(!1),this.seeking=!1,this.waiting=!1),this.waiting&&(this.notifyStallEnd(!1),this.waiting=!1))}},{key:"onErrorEvent",value:function(){var e=tl(this,nl).error;this.setStatusCode(this.getErrorCode(e)),this.setPlayerErrorCode(e.code),P.w("BpkHTML5PlayerAdapter","Player error:"+e.message+" (code: "+e.code+")")}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"getName",value:function(){return"HTML5"}},{key:"getVersion",value:function(){return""}},{key:"getDeviceType",value:function(){var e=Qu(Zu(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){return-1}},{key:"getPosition",value:function(){return void 0!==tl(this,nl)?Math.round(1e3*tl(this,nl).currentTime):0}},{key:"getDuration",value:function(){return void 0!==tl(this,nl)&&isFinite(tl(this,nl).duration)?Math.round(1e3*tl(this,nl).duration):0}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){switch(e.code){case 1:return Yt.BPUnspecifiedError;case 2:return Yt.BPNetworkingError;case 3:return Yt.BPDecodingError;case 4:return Yt.BPFormatNotSupportedError;default:return Yt.BPUnspecifiedError}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.waiting=!1,this.seeking=!1,void 0!==tl(this,nl)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new Mo(this,this),this.playerListeners=[this.onPlayingEvent.bind(this),this.onPlayEvent.bind(this),this.onPauseEvent.bind(this),this.onWaitingEvent.bind(this),this.onSeekingEvent.bind(this),this.onProgressEvent.bind(this),this.onErrorEvent.bind(this)],tl(this,nl).addEventListener("playing",this.playerListeners[0]),tl(this,nl).addEventListener("play",this.playerListeners[1]),tl(this,nl).addEventListener("pause",this.playerListeners[2]),tl(this,nl).addEventListener("waiting",this.playerListeners[3]),tl(this,nl).addEventListener("seeking",this.playerListeners[4]),tl(this,nl).addEventListener("progress",this.playerListeners[5]),tl(this,nl).addEventListener("error",this.playerListeners[6]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==tl(this,nl)&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(tl(this,nl).removeEventListener("playing",this.playerListeners[0]),tl(this,nl).removeEventListener("play",this.playerListeners[1]),tl(this,nl).removeEventListener("pause",this.playerListeners[2]),tl(this,nl).removeEventListener("waiting",this.playerListeners[3]),tl(this,nl).removeEventListener("seeking",this.playerListeners[4]),tl(this,nl).removeEventListener("progress",this.playerListeners[5]),tl(this,nl).removeEventListener("error",this.playerListeners[6]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(el(this,nl,e),el(this,rl,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),el(this,nl,void 0),el(this,rl,void 0)}}])&&Ku(t.prototype,i),n&&Ku(t,n),a}(un);function sl(e){return(sl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ol(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ul(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ll(e,t,i){return(ll="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=fl(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function cl(e,t){return(cl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function dl(e,t){return!t||"object"!==sl(t)&&"function"!=typeof t?hl(e):t}function hl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fl(e){return(fl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}tn.html5Module={HTML5PlayerAdapter:al};var pl=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cl(e,t)}(a,e);var t,i,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=fl(e);if(t){var r=fl(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return dl(this,i)}}(a);function a(){var e;ol(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return vl(hl(e=r.call.apply(r,[this].concat(i))),"player",void 0),vl(hl(e),"listener",void 0),vl(hl(e),"started",void 0),vl(hl(e),"paused",void 0),vl(hl(e),"buffering",void 0),vl(hl(e),"seeking",void 0),vl(hl(e),"bitrate",void 0),vl(hl(e),"seekStart",void 0),vl(hl(e),"seekEnd",void 0),vl(hl(e),"playerStateManager",void 0),vl(hl(e),"playerListeners",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){var i;return void 0!==(null===(i=e.Event)||void 0===i?void 0:i.Core)}}],(i=[{key:"handleSeek",value:function(e,t){return!0===this.seeking?(this.notifySeek(e,t),!0):(!1===this.seeking&&(this.seekStart=e,this.seekEnd=t),!1)}},{key:"onSeekingEvent",value:function(){this.seeking=!0,void 0!==this.seekStart&&void 0!==this.seekEnd&&(this.notifySeek(this.seekStart,this.seekEnd),this.seekStart=void 0,this.seekEnd=void 0)}},{key:"onSeekedEvent",value:function(){this.seeking=!1}},{key:"onPlayheadUpdated",value:function(e){}},{key:"onPlaybackInfoUpdated",value:function(e){var t=Math.floor(e.payload.selectedVideoTrack.bandwidth/1e3);t>0&&t!==this.bitrate&&(this.bitrate=t,this.notifyLayerSwitch(t))}},{key:"onPlayingEvent",value:function(e){!1===this.started?(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage()):(!0===this.paused&&(this.paused=!1,this.notifyResume()),this.onStallEndEvent())}},{key:"onPlayEvent",value:function(e){!0===this.started&&!0===this.paused&&(this.paused=!1,this.notifyResume())}},{key:"onPauseEvent",value:function(e){!0===this.started&&!1===this.paused&&(this.paused=!0,this.notifyPause())}},{key:"onStallStartEvent",value:function(e){!0===this.started&&!1===this.buffering&&(this.buffering=!0,this.notifyStallStart(),void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition())}},{key:"onStallEndEvent",value:function(e){!0===this.started&&!0===this.buffering&&(this.buffering=!1,void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(!this.paused),this.setStatusCode(Yt.BPSessionEndsNormally),this.setPlayerErrorCode(""))}},{key:"onErrorEvent",value:function(e){e.payload.severity===this.player.Error.Severity.CRITICAL&&(P.e("BpkKalturaPlayerAdapter","On player error "+e.payload.code),this.setStatusCode(this.getErrorCode(e.payload)),this.setPlayerErrorCode(e.payload.code))}},{key:"getName",value:function(){return"Kaltura"}},{key:"getVersion",value:function(){var e,t;return void 0!==(null===(e=this.player)||void 0===e||null===(t=e._provider)||void 0===t?void 0:t._playerVersion)?this.player._provider._playerVersion:"Unknown"}},{key:"getDeviceType",value:function(){var e=ll(fl(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){return this.bitrate}},{key:"getPosition",value:function(){return void 0!==this.player?Math.round(1e3*this.player.currentTime):0}},{key:"getDuration",value:function(){return void 0===this.player||this.player.isLive()?0:Math.round(1e3*this.player.duration)}},{key:"getCapabilities",value:function(){return{adTracking:!1}}},{key:"getErrorCode",value:function(e){var t=this.player.Error.Category;switch(e.category){case t.NETWORK:return Yt.BPNetworkingError;case t.TEXT:case t.MEDIA:case t.MANIFEST:return Yt.BPFormatNotSupportedError;case t.STREAMING:return Yt.BPDecodingError;case t.DRM:return Yt.BPAccessRightError;case t.PLAYER:case t.ADS:case t.STORAGE:case t.CAST:case t.VR:return Yt.BPUnspecifiedError}return Yt.BPUnspecifiedError}},{key:"initSessionPlayerObjects",value:function(){var e=this;this.started=!1,this.paused=!1,this.buffering=!1,this.seeking=!1,this.bitrate=-1,this.seekStart=void 0,this.seekEnd=void 0,void 0!==this.player&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new Mo(this,this),this.playerListeners=[function(t){e.onPlayheadUpdated(t)},function(t){e.onPlaybackInfoUpdated(t)},function(t){e.onPlayingEvent(t)},function(t){e.onPlayEvent(t)},function(t){e.onPauseEvent(t)},function(t){e.onSeekingEvent(),e.onStallStartEvent(t)},function(t){e.onStallStartEvent(t)},function(t){e.onStallEndEvent(t)},function(t){e.onSeekedEvent(),e.onStallEndEvent(t)},function(t){e.onErrorEvent(t)}],this.player.addEventListener(this.player.Event.Core.VIDEO_TRACK_CHANGED,this.playerListeners[1]),this.player.addEventListener(this.player.Event.Core.PLAYING,this.playerListeners[2]),this.player.addEventListener(this.player.Event.Core.PLAY,this.playerListeners[3]),this.player.addEventListener(this.player.Event.Core.PAUSE,this.playerListeners[4]),this.player.addEventListener(this.player.Event.Core.SEEKING,this.playerListeners[5]),this.player.addEventListener(this.player.Event.Core.WAITING,this.playerListeners[6]),this.player.addEventListener(this.player.Event.Core.STALLED,this.playerListeners[7]),this.player.addEventListener(this.player.Event.Core.SEEKED,this.playerListeners[8]),this.player.addEventListener(this.player.Event.Core.ERROR,this.playerListeners[9]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==this.player&&void 0!==this.playerListeners&&10===this.playerListeners.length&&(this.player.removeEventListener(this.player.Event.Core.VIDEO_TRACK_CHANGED,this.playerListeners[1]),this.player.removeEventListener(this.player.Event.Core.PLAYING,this.playerListeners[2]),this.player.removeEventListener(this.player.Event.Core.PLAY,this.playerListeners[3]),this.player.removeEventListener(this.player.Event.Core.PAUSE,this.playerListeners[4]),this.player.removeEventListener(this.player.Event.Core.SEEKING,this.playerListeners[5]),this.player.removeEventListener(this.player.Event.Core.WAITING,this.playerListeners[6]),this.player.removeEventListener(this.player.Event.Core.STALLED,this.playerListeners[7]),this.player.removeEventListener(this.player.Event.Core.SEEKED,this.playerListeners[8]),this.player.removeEventListener(this.player.Event.Core.ERROR,this.playerListeners[9]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(this.player=e,this.listener=t,!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),this.player=void 0,this.listener=void 0}}])&&ul(t.prototype,i),n&&ul(t,n),a}(un);function yl(e){return(yl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gl(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function El(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Sl(e,t){return(Sl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bl(e,t){return!t||"object"!==yl(t)&&"function"!=typeof t?kl(e):t}function kl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ml(e){return(ml=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Al(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Rl(e,t,"set"),i),i}function Nl(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,Rl(e,t,"get"))}function Rl(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}tn.kalturaModule={KalturaPlayerAdapter:pl};var Dl="BpkSagemcomDIW387Adapter",Pl=new WeakMap,Tl=new WeakMap,wl=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sl(e,t)}(a,e);var t,i,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ml(e);if(t){var r=ml(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return bl(this,i)}}(a);function a(){var e;gl(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),Pl.set(kl(e),{writable:!0,value:void 0}),Tl.set(kl(e),{writable:!0,value:void 0}),_l(kl(e),"mediaStartTime",0),_l(kl(e),"mediaDuration",0),_l(kl(e),"started",void 0),_l(kl(e),"paused",void 0),_l(kl(e),"playerStateManager",void 0),_l(kl(e),"playerListener",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return void 0!==e.Get&&void 0!==e.session&&void 0!==e.event}}],(i=[{key:"handlePlayerEvent",value:function(e){switch(e){case 36896:case 4162:!1===this.started&&(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage());break;case 4096:case 36865:case 36898:case 4114:this.setMediaInfo(0,0);break;case 38401:case 4168:this.paused=!0,this.notifyPause();break;case 38400:case 4169:this.paused=!1,this.notifyResume();break;case 37376:case 37377:case 37378:case 37379:case 37380:case 37392:this.setStatusCode(Yt.BPDecodingError),this.setPlayerErrorCode(e),this.setMediaInfo(0,0);break;case 37381:this.setStatusCode(Yt.BPFormatNotSupportedError),this.setPlayerErrorCode(e),this.setMediaInfo(0,0);break;case 37382:case 38721:case 38722:this.setStatusCode(Yt.BPAccessRightError),this.setPlayerErrorCode(e),this.setMediaInfo(0,0);break;case 37120:case 37121:case 37122:case 37123:case 37124:this.setStatusCode(Yt.BPNetworkingError),this.setPlayerErrorCode(e),this.setMediaInfo(0,0);break;case 4196:void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition(),this.notifyStallStart();break;case 4197:this.notifyStallEnd(!this.paused);break;case 38704:case 4307:this.notifyLayerSwitch();break;case 2415972357:case 2415972358:this.handleNetwork()}}},{key:"handleEvent",value:function(e){if(void 0!==Nl(this,Pl)){var t=Nl(this,Pl).event.getSource(e.keyCodeVal).split(":");if(t.length>=2){var i=parseInt(t[1],10);"live_livePlayerWidget"!==t[0]&&(P.d(Dl,"Processing event 0x"+i.toString(16)),this.handlePlayerEvent(i))}else parseInt(e,10)}}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"handleNetwork",value:function(){var e=this.executeSystemCommand("NETWORK","INTERFACE","LIST"),t=this.executeSystemCommand("NETWORK","INTERFACE");P.d(Dl,"Interface list: "+e),P.d(Dl,"Interface index: "+t);for(var i=e.split(";"),n=0;n<i.length;n++){var r=i[n].split(":");if(r.length>=2){var a=this.transformResult(r[0]),s=r[1];if(t===a){var o=-1!==s.indexOf("wlan")||-1!==s.indexOf("wifi");return void(1==(-1!==s.indexOf("eth"))?Dt.getInstance().notifyNetworkAvailable(30):!0===o&&Dt.getInstance().notifyNetworkAvailable(10))}}}Dt.getInstance().notifyNetworkLost()}},{key:"getName",value:function(){var e=this.executeSystemCommand("INFO","LOADER_VERSION");return-1!==e.indexOf("DIW387")?"Sagemcom DIW387":-1!==e.indexOf("DIW384")?"Sagemcom DIW384":-1!==e.indexOf("DIW393")?"Sagemcom DIW393":"Sagemcom DIW387"}},{key:"getVersion",value:function(){return this.executeSystemCommand("INFO","SOFTWARE_VERSION")}},{key:"getDeviceType",value:function(){return"stb"}},{key:"getBitrate",value:function(){if(void 0!==Nl(this,Pl)&&void 0!==a.handle){var e=this.executeSessionCommand("VARIANT","CURRENT"),t=-1;if("string"==typeof e&&""!==e){if(!(a.handle.indexOf("avplayer")>-1)){var i=e.split(":");return null!==i&&i.length>0&&(t=i[2]),isNaN(t)?-1:Math.round(parseInt(t,10)/1e3)}for(var n=e.split(","),r=0;r<n.length;r++)if(n[r].indexOf("bandwidth:")>-1){var s=n[r].split(":");if(s.length>=2)return isNaN(s[1])?-1:Math.round(parseInt(s[1],10)/1e3)}}return-1}return-1}},{key:"getPosition",value:function(){if(void 0!==Nl(this,Pl)){var e=this.executeSessionCommand("POSITION","SEC");return""===e?-1:e>=946684800&&this.mediaStartTime>0?e-this.mediaStartTime:1e3*e}return 0}},{key:"getDuration",value:function(){if(void 0!==Nl(this,Pl)){var e=this.executeSessionCommand("DURATION","SEC");return""===e?-1:e>=9007199254740991?this.mediaDuration:1e3*e}return 0}},{key:"getCapabilities",value:function(){return{adTracking:!1}}},{key:"transformResult",value:function(e){return isNaN(e)?e:parseInt(e,10)}},{key:"executeSystemCommand",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;try{var n;return n=void 0===i?Nl(this,Pl).Get(e,t).toString():Nl(this,Pl).Get(e,t,i).toString(),this.transformResult(n)}catch(e){return console.log(e),""}}},{key:"executeSessionCommand",value:function(e,t){try{var i=Nl(this,Pl).session.Get(a.handle,e,t).toString().split(";");return 1===i.length?this.transformResult(i[0]):i.length>=2&&"0"===i[0]?this.transformResult(i[1]):""}catch(e){return console.log(e),""}}},{key:"setInstanceName",value:function(e){P.d(Dl,"Setting instance name to "+e),a.handle="string"==typeof e?e:""}},{key:"onPlayerEvent",value:function(e){if(P.d(Dl,"Processing "+e.session_name+" "+e.event_hex),void 0!==Nl(this,Pl)){var t=e.session_name;if(("avplayerSession"===t||"HLS_VOD"===t)&&void 0!==e.event_hex){var i=String(e.event_hex);if(i.length>=5&&"5"===i[0]){var n=parseInt(i.substr(1,4),16);this.handlePlayerEvent(n)}}if(void 0!==e.event_hex){var r=String(e.event_hex);if(r.length>=8&&"9"===r[0]){var a=parseInt(r,16);this.handlePlayerEvent(a)}}}else P.w(Dl,"Cannot handle event if no player attached")}},{key:"setMediaInfo",value:function(e,t){this.mediaStartTime=e,this.mediaDuration=t}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.mediaStartTime=0,this.mediaDuration=0,void 0!==Nl(this,Pl)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new Mo(this,this))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0)}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(Al(this,Pl,e),this.playerListener=this.handleEvent.bind(this),document.addEventListener("keypress",this.playerListener,!1),this.handleNetwork(),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),void 0!==Nl(this,Pl)&&(document.removeEventListener("keypress",this.playerListener),this.playerListener=void 0,Al(this,Pl,void 0)),Al(this,Tl,void 0)}}])&&El(t.prototype,i),n&&El(t,n),a}(un);function Ol(e){return(Ol="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ll(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cl(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Il(e,t,i){return(Il="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=jl(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function Ml(e,t){return(Ml=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Bl(e,t){return!t||"object"!==Ol(t)&&"function"!=typeof t?Ul(e):t}function Ul(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jl(e){return(jl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function xl(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Gl(e,t,"set"),i),i}function Vl(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,Gl(e,t,"get"))}function Gl(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}_l(wl,"handle",void 0),tn.diw387Module={SagemcomDIW387Adapter:wl};var Hl="BpkShakaPlayerAdapter",Wl=new WeakMap,ql=new WeakMap,Yl=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ml(e,t)}(a,e);var t,i,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=jl(e);if(t){var r=jl(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Bl(this,i)}}(a);function a(){var e;Ll(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),Wl.set(Ul(e),{writable:!0,value:void 0}),ql.set(Ul(e),{writable:!0,value:void 0}),Fl(Ul(e),"started",void 0),Fl(Ul(e),"bitrate",void 0),Fl(Ul(e),"playingEventReceived",void 0),Fl(Ul(e),"playerStateManager",void 0),Fl(Ul(e),"playerListeners",void 0),e}return t=a,n=[{key:"attachLibrary",value:function(e){void 0!==e.util&&void 0!==e.Player?(P.d(Hl,"Shaka Player library attached"),a.library=e):P.e(Hl,"Try to attach a library, but it is not recognized")}},{key:"checkPlayer",value:function(e,t){if("undefined"!=typeof window&&void 0!==window.shaka&&(a.library=window.shaka),"function"==typeof e.getConfiguration){var i=e.getConfiguration();if(void 0!==i.manifest&&void 0!==i.streaming)return!0}return!1}}],(i=[{key:"onPlayEvent",value:function(){this.started&&this.notifyResume()}},{key:"onPlayingEvent",value:function(){this.playingEventReceived=!0,this.started||(Vl(this,Wl).isBuffering()?P.d(Hl,"Player is still buffering, first image event not yet triggered"):(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage()))}},{key:"onPauseEvent",value:function(){this.notifyPause()}},{key:"onBuffering",value:function(){var e=Vl(this,Wl).isBuffering();this.started?e?(void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition(),this.notifyStallStart()):(this.notifyStallEnd(),this.setStatusCode(Yt.BPSessionEndsNormally),this.setPlayerErrorCode("")):!e&&this.playingEventReceived&&(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage())}},{key:"onLayerSwitchEvent",value:function(){var e=this.getBitrate();e!==this.bitrate&&(this.bitrate=e,this.notifyLayerSwitch(e))}},{key:"onVariantChanged",value:function(){this.onLayerSwitchEvent()}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"onErrorEvent",value:function(e){e.detail.severity===a.library.util.Error.Severity.CRITICAL&&(this.setStatusCode(this.getErrorCode(e.detail)),this.setPlayerErrorCode(e.detail.code))}},{key:"getName",value:function(){return"Shaka Player"}},{key:"getVersion",value:function(){var e=a.library.Player.version.substring(0,32),t=e.indexOf(" ");return t>=0?e.substring(0,t):e}},{key:"getDeviceType",value:function(){var e=Il(jl(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){if(void 0!==Vl(this,Wl))for(var e=Vl(this,Wl).getVariantTracks(),t=0;t<e.length;t++){var i=e[t];if(!0===i.active)return Math.round(i.bandwidth/1e3)}return 0}},{key:"getPosition",value:function(){if(void 0!==Vl(this,Wl)){var e=0;return Vl(this,Wl).isLive()&&(e=Vl(this,Wl).getPresentationStartTimeAsDate().getTime()),e+Math.round(1e3*Vl(this,Wl).getMediaElement().currentTime)}return 0}},{key:"getDuration",value:function(){return void 0===Vl(this,Wl)||Vl(this,Wl).isLive()?0:Math.round(1e3*Vl(this,Wl).getMediaElement().duration)}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){switch(e.category){case a.library.util.Error.Category.NETWORK:return Yt.BPNetworkingError;case a.library.util.Error.Category.TEXT:case a.library.util.Error.Category.MEDIA:case a.library.util.Error.Category.MANIFEST:return Yt.BPFormatNotSupportedError;case a.library.util.Error.Category.STREAMING:return Yt.BPDecodingError;case a.library.util.Error.Category.DRM:return Yt.BPAccessRightError;case a.library.util.Error.Category.PLAYER:case a.library.util.Error.Category.CAST:case a.library.util.Error.Category.STORAGE:default:return Yt.BPUnspecifiedError}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.bitrate=0,this.playingEventReceived=!1,void 0!==Vl(this,Wl)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new Mo(this,this),this.playerListeners=[this.onPlayEvent.bind(this),this.onPauseEvent.bind(this),this.onBuffering.bind(this),this.onLayerSwitchEvent.bind(this),this.onErrorEvent.bind(this),this.onPlayingEvent.bind(this),this.onVariantChanged.bind(this)],Vl(this,Wl).getMediaElement().addEventListener("play",this.playerListeners[0]),Vl(this,Wl).getMediaElement().addEventListener("pause",this.playerListeners[1]),Vl(this,Wl).addEventListener("buffering",this.playerListeners[2]),Vl(this,Wl).addEventListener("adaptation",this.playerListeners[3]),Vl(this,Wl).addEventListener("error",this.playerListeners[4]),Vl(this,Wl).getMediaElement().addEventListener("playing",this.playerListeners[5]),Vl(this,Wl).addEventListener("variantchanged",this.playerListeners[6]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==Vl(this,Wl)&&void 0!==this.playerListeners&&7===this.playerListeners.length&&(Vl(this,Wl).getMediaElement().removeEventListener("play",this.playerListeners[0]),Vl(this,Wl).getMediaElement().removeEventListener("pause",this.playerListeners[1]),Vl(this,Wl).removeEventListener("buffering",this.playerListeners[2]),Vl(this,Wl).removeEventListener("adaptation",this.playerListeners[3]),Vl(this,Wl).removeEventListener("error",this.playerListeners[4]),Vl(this,Wl).getMediaElement().removeEventListener("playing",this.playerListeners[5]),Vl(this,Wl).removeEventListener("variantchanged",this.playerListeners[6]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(void 0===a.library&&P.e(Hl,"Player library not attached to the adapter, please call ShakaPlayerAdapter.attachLibrary(shaka) before attachPlayer"),xl(this,Wl,e),xl(this,ql,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),xl(this,Wl,void 0),xl(this,ql,void 0)}}])&&Cl(t.prototype,i),n&&Cl(t,n),a}(un);function Kl(e){return(Kl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ql(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function zl(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Jl(e,t,i){return(Jl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ec(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function Xl(e,t){return(Xl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Zl(e,t){return!t||"object"!==Kl(t)&&"function"!=typeof t?$l(e):t}function $l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ec(e){return(ec=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ic(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,rc(e,t,"set"),i),i}function nc(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,rc(e,t,"get"))}function rc(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}Fl(Yl,"library",void 0),tn.shakaModule={ShakaPlayerAdapter:Yl};var ac=new WeakMap,sc=new WeakMap,oc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xl(e,t)}(a,e);var t,i,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ec(e);if(t){var r=ec(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Zl(this,i)}}(a);function a(){var e;Ql(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e=r.call.apply(r,[this].concat(i)),ac.set($l(e),{writable:!0,value:void 0}),sc.set($l(e),{writable:!0,value:void 0}),tc($l(e),"started",void 0),tc($l(e),"bitrate",void 0),tc($l(e),"lastState",void 0),tc($l(e),"playerStateManager",void 0),tc($l(e),"playerListeners",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return"object"===Kl(e.log)&&"function"==typeof e.setWantedBufferAhead&&"function"==typeof e.getWallClockTime}}],(i=[{key:"onPlayerStateChangeEvent",value:function(e){switch(e){case"PLAYING":this.started?(this.notifyResume(),this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(),this.setStatusCode(Yt.BPSessionEndsNormally),this.setPlayerErrorCode("")):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage());break;case"PAUSED":this.started&&("SEEKING"===this.lastState||"BUFFERING"===this.lastState?(this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd()):!1===nc(this,ac).videoElement.seeking&&this.notifyPause());break;case"BUFFERING":case"SEEKING":this.started&&(this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition())}this.lastState=e}},{key:"onPauseEvent",value:function(){this.started&&!1===nc(this,ac).videoElement.seeking&&this.notifyPause()}},{key:"onPlayEvent",value:function(){this.started&&this.notifyResume()}},{key:"onVideoBitrateChangeEvent",value:function(){var e=this.getBitrate();e!==this.bitrate&&(this.bitrate=e,this.notifyLayerSwitch(e))}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"onErrorEvent",value:function(e){switch(P.e("BpkRxPlayerAdapter","On player error: "+e.type+" ("+e.code+")"),e.type){case"NETWORK_ERROR":this.setStatusCode(Yt.BPNetworkingError);break;case"MEDIA_ERROR":switch(e.code){case"BUFFER_APPEND_ERROR":case"BUFFER_FULL_ERROR":case"BUFFER_TYPE_UNKNOWN":case"MANIFEST_INCOMPATIBLE_CODECS_ERROR":case"MANIFEST_PARSE_ERROR":case"MANIFEST_UNSUPPORTED_ADAPTATION_TYPE":case"MEDIA_ERR_ABORTED":case"MEDIA_ERR_NOT_LOADED_METADATA":case"MEDIA_ERR_DECODE":this.setStatusCode(Yt.BPDecodingError);break;case"MEDIA_ERR_BLOCKED_AUTOPLAY":case"MEDIA_ERR_PLAY_NOT_ALLOWED":case"MEDIA_SOURCE_NOT_SUPPORTED":case"MEDIA_STARTING_TIME_NOT_FOUND":case"MEDIA_TIME_BEFORE_MANIFEST":case"MEDIA_TIME_AFTER_MANIFEST":case"DISCONTINUITY_ENCOUNTERED":case"MANIFEST_UPDATE_ERROR":case"MEDIA_TIME_NOT_FOUND":this.setStatusCode(Yt.BPUnspecifiedError);break;case"MEDIA_ERR_NETWORK":this.setStatusCode(Yt.BPNetworkingError);break;case"MEDIA_ERR_SRC_NOT_SUPPORTED":case"MEDIA_ERR_UNKNOWN":this.setStatusCode(Yt.BPFormatNotSupportedError);break;case"MEDIA_KEYS_NOT_SUPPORTED":case"NO_PLAYABLE_REPRESENTATION":this.setStatusCode(Yt.BPAccessRightError);break;default:this.setStatusCode(Yt.BPUnspecifiedError)}break;case"ENCRYPTED_MEDIA_ERROR":this.setStatusCode(Yt.BPAccessRightError);break;case"OTHER_ERROR":"PIPELINE_PARSE_ERROR"===e.code?this.setStatusCode(Yt.BPDecodingError):this.setStatusCode(Yt.BPUnspecifiedError);break;default:this.setStatusCode(Yt.BPUnspecifiedError)}"string"==typeof e.code&&this.setPlayerErrorCode(e.code)}},{key:"getName",value:function(){return"RxPlayer"}},{key:"getVersion",value:function(){return void 0!==nc(this,ac)?nc(this,ac).version:"Unknown"}},{key:"getDeviceType",value:function(){var e=Jl(ec(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){return void 0!==nc(this,ac)?Math.round((nc(this,ac).getAudioBitrate()+nc(this,ac).getVideoBitrate())/1e3):0}},{key:"getPosition",value:function(){return void 0!==nc(this,ac)?Math.round(1e3*nc(this,ac).getPosition()):0}},{key:"getDuration",value:function(){return void 0===nc(this,ac)||nc(this,ac).isLive()?0:Math.round(1e3*nc(this,ac).getVideoDuration())}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.lastState="",this.bitrate=0,void 0!==nc(this,ac)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new Mo(this,this),this.playerListeners=[this.onPlayerStateChangeEvent.bind(this),this.onVideoBitrateChangeEvent.bind(this),this.onPauseEvent.bind(this),this.onPlayEvent.bind(this),this.onErrorEvent.bind(this)],nc(this,ac).addEventListener("playerStateChange",this.playerListeners[0]),nc(this,ac).addEventListener("videoBitrateChange",this.playerListeners[1]),nc(this,ac).videoElement.addEventListener("pause",this.playerListeners[2]),nc(this,ac).videoElement.addEventListener("play",this.playerListeners[3]),nc(this,ac).addEventListener("error",this.playerListeners[4]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==nc(this,ac)&&void 0!==this.playerListeners&&5===this.playerListeners.length&&(nc(this,ac).removeEventListener("playerStateChange",this.playerListeners[0]),nc(this,ac).removeEventListener("videoBitrateChange",this.playerListeners[1]),nc(this,ac).videoElement.removeEventListener("pause",this.playerListeners[2]),nc(this,ac).videoElement.removeEventListener("play",this.playerListeners[3]),nc(this,ac).removeEventListener("error",this.playerListeners[4]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(ic(this,ac,e),ic(this,sc,t),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),ic(this,ac,void 0),ic(this,sc,void 0)}}])&&zl(t.prototype,i),n&&zl(t,n),a}(un);function uc(e){return(uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cc(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function dc(e,t,i){return(dc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=pc(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function hc(e,t){return(hc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fc(e,t){return!t||"object"!==uc(t)&&"function"!=typeof t?vc(e):t}function vc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pc(e){return(pc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}tn.rxplayerModule={RxPlayerAdapter:oc};var gc="BpkHlsJsPlayerAdapter",Ec=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hc(e,t)}(a,e);var t,i,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=pc(e);if(t){var r=pc(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return fc(this,i)}}(a);function a(){var e;lc(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return yc(vc(e=r.call.apply(r,[this].concat(i))),"player",void 0),yc(vc(e),"listener",void 0),yc(vc(e),"started",void 0),yc(vc(e),"paused",void 0),yc(vc(e),"waiting",void 0),yc(vc(e),"seeking",void 0),yc(vc(e),"playerStateManager",void 0),yc(vc(e),"playerListeners",void 0),yc(vc(e),"mediaEventsBound",void 0),yc(vc(e),"currentPresentationTime",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return"number"==typeof e.nextLoadLevel&&"function"==typeof e.swapAudioCodec}}],(i=[{key:"onPlayingEvent",value:function(){this.started?(this.paused&&this.notifyResume(),this.seeking&&(this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(),this.waiting=!1),this.waiting&&this.notifyStallEnd(),this.setStatusCode(Yt.BPSessionEndsNormally),this.setPlayerErrorCode("")):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage()),this.paused=!1,this.waiting=!1,this.seeking=!1}},{key:"onPlayEvent",value:function(){this.paused&&this.notifyResume(),this.paused=!1}},{key:"onPauseEvent",value:function(){null!=this.player&&null!=this.player.media&&(!this.player.media.seeking||this.player.media.seeking&&this.seeking)&&(this.notifyPause(),this.paused=!0)}},{key:"onWaitingEvent",value:function(){null!=this.player&&null!=this.player.media&&(this.player.media.seeking||this.waiting||this.seeking||(this.notifyStallStart(),this.waiting=!0))}},{key:"onSeekingEvent",value:function(){this.started&&!this.seeking&&(this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition(),this.seeking=!0)}},{key:"onProgressEvent",value:function(){this.paused&&(this.seeking&&(this.notifyStallEnd(!1),this.setStatusCode(Yt.BPSessionEndsNormally),this.setPlayerErrorCode(""),this.seeking=!1,this.waiting=!1),this.waiting&&(this.notifyStallEnd(!1),this.setStatusCode(Yt.BPSessionEndsNormally),this.setPlayerErrorCode(""),this.waiting=!1))}},{key:"onLayerSwitchEvent",value:function(){var e=this.getBitrate();e!==this.bitrate&&(this.bitrate=e,this.notifyLayerSwitch(e))}},{key:"onErrorEvent",value:function(){if(null!=this.player&&null!=this.player.media){var e=this.player.media.error;this.setStatusCode(this.getErrorCode(e)),this.setPlayerErrorCode(e.code),P.w(gc,"Player error:"+e.message+" (code: "+e.code+")")}}},{key:"onHlsErrorEvent",value:function(e,t){!0===t.fatal&&(this.setStatusCode(this.getHlsErrorCode(t)),this.setPlayerErrorCode(t.details)),P.w(gc,"HLS.js error:"+t.details+" (type: "+t.type+")")}},{key:"onLevelLoadedEvent",value:function(e,t){}},{key:"onFragmentChangedEvent",value:function(e,t){t&&t.frag&&t.frag.programDateTime&&(this.currentPresentationTime=Math.round(t.frag.programDateTime-1e3*t.frag.start))}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"getName",value:function(){return"HLS.js"}},{key:"getVersion",value:function(){return void 0!==this.player?this.player.constructor.version:""}},{key:"getDeviceType",value:function(){var e=dc(pc(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){return void 0!==this.player&&this.player.currentLevel>=0&&this.player.currentLevel<this.player.levels.length?Math.round(this.player.levels[this.player.currentLevel].bitrate/1e3):-1}},{key:"getPosition",value:function(){return void 0!==this.player&&this.player.media?this.currentPresentationTime+Math.round(1e3*this.player.media.currentTime):0}},{key:"getDuration",value:function(){return void 0!==this.player&&this.player.media&&isFinite(this.player.media.duration)?Math.round(1e3*this.player.media.duration):0}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){switch(e.code){case 1:return Yt.BPUnspecifiedError;case 2:return Yt.BPNetworkingError;case 3:return Yt.BPDecodingError;case 4:return Yt.BPFormatNotSupportedError;default:return Yt.BPUnspecifiedError}}},{key:"getHlsErrorCode",value:function(e){switch(e.details){case"manifestLoadError":case"manifestLoadTimeOut":case"levelLoadError":case"fragLoadError":case"fragLoadTimeOut":case"bufferNudgeOnStall":return Yt.BPNetworkingError;case"manifestParsingError":case"fragDecryptError":case"fragParsingError":case"bufferAppendError":case"bufferStalledError":return Yt.BPDecodingError;case"manifestIncompatibleCodecsError":return Yt.BPFormatNotSupportedError;case"keyLoadError":case"keyLoadTimeOut":return Yt.BPAccessRightError;case"internalException":default:return Yt.BPUnspecifiedError}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.waiting=!1,this.seeking=!1,this.bitrate=-1,this.mediaEventsBound=!1,this.currentPresentationTime=0,void 0!==this.player&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new Mo(this,this),this.playerListeners=[this.onMediaAttachedEvent.bind(this),this.onLevelLoadedEvent.bind(this),this.onFragmentChangedEvent.bind(this),this.onHlsErrorEvent.bind(this),this.onPlayingEvent.bind(this),this.onPlayEvent.bind(this),this.onPauseEvent.bind(this),this.onWaitingEvent.bind(this),this.onSeekingEvent.bind(this),this.onProgressEvent.bind(this),this.onErrorEvent.bind(this),this.onLayerSwitchEvent.bind(this)],this.player.on("hlsMediaAttached",this.playerListeners[0],this),this.player.on("hlsLevelLoaded",this.playerListeners[1],this),this.player.on("hlsFragChanged",this.playerListeners[2],this),this.player.on("hlsError",this.playerListeners[3],this),this.player.on("hlsLevelSwitched",this.playerListeners[11],this))}},{key:"onMediaAttachedEvent",value:function(){!1===this.mediaEventsBound&&void 0!==this.player&&this.player.media&&(this.player.media.addEventListener("playing",this.playerListeners[4]),this.player.media.addEventListener("play",this.playerListeners[5]),this.player.media.addEventListener("pause",this.playerListeners[6]),this.player.media.addEventListener("waiting",this.playerListeners[7]),this.player.media.addEventListener("seeking",this.playerListeners[8]),this.player.media.addEventListener("progress",this.playerListeners[9]),this.player.media.addEventListener("error",this.playerListeners[10]),this.mediaEventsBound=!0)}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==this.player&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(this.player.off("hlsMediaAttached",this.playerListeners[0],this),this.player.off("hlsLevelLoaded",this.playerListeners[1],this),this.player.off("hlsFragChanged",this.playerListeners[2],this),this.player.off("hlsError",this.playerListeners[3],this),this.player.off("hlsLevelSwitched",this.playerListeners[11],this)),void 0!==this.player&&this.player.media&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(this.mediaEventsBound=!1,this.player.media.removeEventListener("playing",this.playerListeners[4]),this.player.media.removeEventListener("play",this.playerListeners[5]),this.player.media.removeEventListener("pause",this.playerListeners[6]),this.player.media.removeEventListener("waiting",this.playerListeners[7]),this.player.media.removeEventListener("seeking",this.playerListeners[8]),this.player.media.removeEventListener("progress",this.playerListeners[9]),this.player.media.removeEventListener("error",this.playerListeners[10]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(this.player=e,this.listener=t,!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),this.player=void 0,this.listener=void 0}}])&&cc(t.prototype,i),n&&cc(t,n),a}(un);function Sc(e){return(Sc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kc(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function mc(e,t,i){return(mc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Rc(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function _c(e,t){return(_c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ac(e,t){return!t||"object"!==Sc(t)&&"function"!=typeof t?Nc(e):t}function Nc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rc(e){return(Rc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}tn.hlsjsModule={HlsJsPlayerAdapter:Ec};var Pc="BpkBitmovinPlayerAdapter",Tc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_c(e,t)}(a,e);var t,i,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Rc(e);if(t){var r=Rc(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Ac(this,i)}}(a);function a(){var e;bc(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return Dc(Nc(e=r.call.apply(r,[this].concat(i))),"player",void 0),Dc(Nc(e),"listener",void 0),Dc(Nc(e),"started",void 0),Dc(Nc(e),"paused",void 0),Dc(Nc(e),"waiting",void 0),Dc(Nc(e),"seeking",void 0),Dc(Nc(e),"bitrate",void 0),Dc(Nc(e),"lastProgramDateTime",void 0),Dc(Nc(e),"lastPositionAtProgramDateTime",void 0),Dc(Nc(e),"lastDiscontinuitySequenceNumber",void 0),Dc(Nc(e),"playerStateManager",void 0),Dc(Nc(e),"playerListeners",void 0),e}return t=a,n=[{key:"checkPlayer",value:function(e,t){return"function"==typeof e.getSupportedTech&&"function"==typeof e.castStop&&"object"===Sc(e.buffer)}}],(i=[{key:"onPlayEvent",value:function(){this.started&&this.notifyResume(),this.paused=!1}},{key:"onPlayingEvent",value:function(){this.started?(this.paused&&this.notifyResume(),this.waiting&&this.notifyStallEnd(),this.setStatusCode(Yt.BPSessionEndsNormally),this.setPlayerErrorCode("")):(this.playerStateManager.start(),this.started=!0,this.notifyFirstImage()),this.paused=!1}},{key:"onPausedEvent",value:function(e){-1===e.issuer.indexOf("seek")&&!1===this.paused?(this.notifyPause(),this.paused=!0):-1!==e.issuer.indexOf("seek")&&(this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition(),this.seeking=!0)}},{key:"onStallStartedEvent",value:function(){this.notifyStallStart(),this.waiting=!0}},{key:"onStallEndedEvent",value:function(){(!0!==this.waiting&&!0!==this.seeking||!this.player.isPaused()||!1!==this.paused)&&(this.notifyStallEnd(!this.paused),this.waiting=!1,this.setStatusCode(Yt.BPSessionEndsNormally),this.setPlayerErrorCode(""))}},{key:"onSeekEvent",value:function(){this.notifyStallStart(),this.playerStateManager.forcePollPlayerPosition(),this.seeking=!0}},{key:"onSeekedEvent",value:function(){this.playerStateManager.forcePollPlayerPosition(),this.notifyStallEnd(!this.paused),this.seeking=!1,this.setStatusCode(Yt.BPSessionEndsNormally),this.setPlayerErrorCode("")}},{key:"onSegmentRequestFinished",value:function(e){!0===e.success&&this.paused&&this.waiting&&(this.notifyStallEnd(!1),this.setStatusCode(Yt.BPSessionEndsNormally),this.setPlayerErrorCode(""),this.waiting=!1)}},{key:"onVideoPlaybackQualityChangedEvent",value:function(){var e=this.getBitrate();e!==this.bitrate&&(this.bitrate=e,this.notifyLayerSwitch(e))}},{key:"onSegmentPlaybackEvent",value:function(e){if(void 0!==e.dateTime){var t=Math.round(1e3*this.player.getCurrentTime());void 0!==e.discontinuitySequenceNumber&&this.lastDiscontinuitySequenceNumber!==e.discontinuitySequenceNumber&&(this.lastProgramDateTime=e.dateTime.getTime(),this.lastPositionAtProgramDateTime=t,this.lastDiscontinuitySequenceNumber=e.discontinuitySequenceNumber,P.d(Pc,"Program date time updated")),console.log(e)}}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"onErrorEvent",value:function(e){P.e(Pc,"On player error: "+e.name+" ("+e.code+")");var t=e.code;t>=1e3&&t<=1099||t>=1100&&t<=1199?this.setStatusCode(Yt.BPUnspecifiedError):t>=1200&&t<=1299?this.setStatusCode(Yt.BPFormatNotSupportedError):t>=1300&&t<=1399?this.setStatusCode(Yt.BPDecodingError):t>=1400&&t<=1499?this.setStatusCode(Yt.BPNetworkingError):t>=2e3&&t<=2099?this.setStatusCode(Yt.BPAccessRightError):this.setStatusCode(Yt.BPUnspecifiedError),this.setPlayerErrorCode(t)}},{key:"getName",value:function(){return"Bitmovin"}},{key:"getVersion",value:function(){return void 0!==this.player?this.player.version:"Unknown"}},{key:"getDeviceType",value:function(){var e=mc(Rc(a.prototype),"getDeviceType",this).call(this);return 0===e.length&&(e="browser"),e}},{key:"getBitrate",value:function(){if(void 0!==this.player){var e=this.player.getPlaybackAudioData().bitrate,t=this.player.getPlaybackVideoData().bitrate,i=0;return isNaN(e)||(i+=Math.round(e/1e3)),isNaN(t)||(i+=Math.round(t/1e3)),i}return 0}},{key:"getPosition",value:function(){if(void 0!==this.player){var e=Math.round(1e3*this.player.getCurrentTime());return 0!==this.lastProgramDateTime?this.lastProgramDateTime+(e-this.lastPositionAtProgramDateTime):e}return 0}},{key:"getDuration",value:function(){return void 0===this.player||this.player.isLive()?0:Math.round(1e3*this.player.getDuration())}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"initSessionPlayerObjects",value:function(){this.started=!1,this.paused=!1,this.waiting=!1,this.seeking=!1,this.bitrate=0,this.lastProgramDateTime=0,this.lastPositionAtProgramDateTime=0,this.lastDiscontinuitySequenceNumber=-1,void 0!==this.player&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new Mo(this,this),this.playerListeners=[this.onPlayEvent.bind(this),this.onPlayingEvent.bind(this),this.onPausedEvent.bind(this),this.onStallStartedEvent.bind(this),this.onStallEndedEvent.bind(this),this.onVideoPlaybackQualityChangedEvent.bind(this),this.onSegmentPlaybackEvent.bind(this),this.onSegmentRequestFinished.bind(this),this.onSeekEvent.bind(this),this.onSeekedEvent.bind(this),this.onErrorEvent.bind(this)],this.player.on("play",this.playerListeners[0]),this.player.on("playing",this.playerListeners[1]),this.player.on("paused",this.playerListeners[2]),this.player.on("stallstarted",this.playerListeners[3]),this.player.on("stallended",this.playerListeners[4]),this.player.on("videoplaybackqualitychanged",this.playerListeners[5]),this.player.on("segmentplayback",this.playerListeners[6]),this.player.on("segmentrequestfinished",this.playerListeners[7]),this.player.on("seek",this.playerListeners[8]),this.player.on("seeked",this.playerListeners[9]),this.player.on("error",this.playerListeners[10]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==this.player&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(this.player.off("play",this.playerListeners[0]),this.player.off("playing",this.playerListeners[1]),this.player.off("paused",this.playerListeners[2]),this.player.off("stallstarted",this.playerListeners[3]),this.player.off("stallended",this.playerListeners[4]),this.player.off("videoplaybackqualitychanged",this.playerListeners[5]),this.player.off("segmentplayback",this.playerListeners[6]),this.player.off("segmentrequestfinished",this.playerListeners[7]),this.player.off("seek",this.playerListeners[8]),this.player.off("seeked",this.playerListeners[9]),this.player.off("error",this.playerListeners[10]))}},{key:"attachPlayer",value:function(e,t){return!!a.checkPlayer(e,t)&&(this.player=e,this.listener=t,!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),this.player=void 0,this.listener=void 0}}])&&kc(t.prototype,i),n&&kc(t,n),a}(un);tn.bitmovinModule={BitmovinPlayerAdapter:Tc},Yt.analyticsModule={PlayerManager:Gn,PlayerAdapter:un,GenericPlayerAdapter:Sn,PlayerEventListener:Nn,GenericPlayerApi:Yn,AnalyticsRequestManager:$n,SessionTrackerTimeline:Ur,SessionTrackerEvent:Nr,SessionTrackerEvents:pr,Metrics:or,MetricsManager:hr},Yt.adModule={AdMetrics:Kr,AdMetricsBuilder:Qr,AdMetricsManager:za,AdEvent:ja,AdJSONEvent:xa,AdDashEvent:Fa,AdEventFactory:Va,AdSmartLibLegacyTracker:aa,AdTracker:Ea,AdThirdPartyTracker:Sa,AdSmartLibTracker:ba,AdBreakDataTracker:ka,AdBreakBeginTracker:ma,AdBreakEndTracker:_a,AdDataTracker:Aa,AdProgressTracker:Na,AdBeginProgressTracker:Ra,AdSkippableTracker:Da,AdTrackerFactory:Pa,AdTrackingManager:qa,AdManager:ie,AdViewState:$,AdFriendlyObstructionPurpose:ee,AdSession:se,InternalAdManager:ce,OMSDKManager:ts,OMSessionHandler:os},Yt.nanoCDNModule={NanoCDNRequestManager:vs,HostResolvingTask:_s,MdnsManager:Hs,NanoCDNDescr:Ss,NanoCDNHostManager:zs,NanoCDNService:Ns},Yt.diversityModule={DiversityManager:Ao,DiversityFailoverSession:Zs,DiversityFailoverCache:io,DiversityRequestManager:Oo},tn.modular=!1,tn.getInstance().init(),Yt.analyticsModule=e,Yt.adModule=t,Yt.nanoCDNModule=i,Yt.diversityModule=n,tn.shakaModule=d,tn.dashjsModule=s,tn.html5Module=u,tn.avplayModule=r,tn.diw387Module=c,tn.hbbtv1Module=o,tn.kalturaModule=l,tn.connectplayerModule=a,tn.rxplayerModule=h,tn.hlsjsModule=f,tn.bitmovinModule=v}(),__webpack_exports__}()},module.exports=t()}).call(this,__webpack_require__(26))},function(e,t,i){var n=i(0),r=i(28),a=i(5),s=i(31),o=i(32),u=i(53),l=r("wks"),c=n.Symbol,d=u?c:c&&c.withoutSetter||s;e.exports=function(e){return a(l,e)&&(o||"string"==typeof l[e])||(o&&a(c,e)?l[e]=c[e]:l[e]=d("Symbol."+e)),l[e]}},function(e,t){e.exports=KalturaPlayer},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,i){var n=i(51),r={}.hasOwnProperty;e.exports=function(e,t){return r.call(n(e),t)}},function(e,t,i){var n=i(4);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,i){var n=i(7);e.exports=function(e){if(!n(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t,i){var n=i(52),r=i(0),a=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?a(n[e])||a(r[e]):n[e]&&n[e][t]||r[e]&&r[e][t]}},function(e,t,i){var n=i(6),r=i(24),a=i(8),s=i(27),o=Object.defineProperty;t.f=n?o:function(e,t,i){if(a(e),t=s(t,!0),a(i),r)try{return o(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(e[t]=i.value),e}},function(e,t,i){var n=i(0),r=i(12),a=i(5),s=i(18),o=i(21),u=i(34),l=u.get,c=u.enforce,d=String(String).split("String");(e.exports=function(e,t,i,o){var u,l=!!o&&!!o.unsafe,h=!!o&&!!o.enumerable,f=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof t||a(i,"name")||r(i,"name",t),(u=c(i)).source||(u.source=d.join("string"==typeof t?t:""))),e!==n?(l?!f&&e[t]&&(h=!0):delete e[t],h?e[t]=i:r(e,t,i)):h?e[t]=i:s(t,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&l(this).source||o(this)}))},function(e,t,i){var n=i(6),r=i(10),a=i(29);e.exports=n?function(e,t,i){return r.f(e,t,a(1,i))}:function(e,t,i){return e[t]=i,e}},function(e,t,i){var n=i(19),r=i(0);e.exports="process"==n(r.process)},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t,i){var n={};n[i(2)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t){e.exports=!1},function(e,t,i){var n=i(0),r=i(18),a=n["__core-js_shared__"]||r("__core-js_shared__",{});e.exports=a},function(e,t,i){var n=i(0),r=i(12);e.exports=function(e,t){try{r(n,e,t)}catch(i){n[e]=t}return t}},function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t,i){var n=i(9);e.exports=n("navigator","userAgent")||""},function(e,t,i){var n=i(17),r=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(e){return r.call(e)}),e.exports=n.inspectSource},function(e,t,i){var n=i(6),r=i(58),a=i(29),s=i(23),o=i(27),u=i(5),l=i(24),c=Object.getOwnPropertyDescriptor;t.f=n?c:function(e,t){if(e=s(e),t=o(t,!0),l)try{return c(e,t)}catch(e){}if(u(e,t))return a(!r.f.call(e,t),e[t])}},function(e,t,i){var n=i(59),r=i(30);e.exports=function(e){return n(r(e))}},function(e,t,i){var n=i(6),r=i(4),a=i(25);e.exports=!n&&!r((function(){return 7!=Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))},function(e,t,i){var n=i(0),r=i(7),a=n.document,s=r(a)&&r(a.createElement);e.exports=function(e){return s?a.createElement(e):{}}},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){var n=i(7);e.exports=function(e,t){if(!n(e))return e;var i,r;if(t&&"function"==typeof(i=e.toString)&&!n(r=i.call(e)))return r;if("function"==typeof(i=e.valueOf)&&!n(r=i.call(e)))return r;if(!t&&"function"==typeof(i=e.toString)&&!n(r=i.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t,i){var n=i(16),r=i(17);(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.11.0",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t){var i=0,n=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++i+n).toString(36)}},function(e,t,i){var n=i(13),r=i(33),a=i(4);e.exports=!!Object.getOwnPropertySymbols&&!a((function(){return!Symbol.sham&&(n?38===r:r>37&&r<41)}))},function(e,t,i){var n,r,a=i(0),s=i(20),o=a.process,u=o&&o.versions,l=u&&u.v8;l?r=(n=l.split("."))[0]+n[1]:s&&(!(n=s.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=s.match(/Chrome\/(\d+)/))&&(r=n[1]),e.exports=r&&+r},function(e,t,i){var n,r,a,s=i(54),o=i(0),u=i(7),l=i(12),c=i(5),d=i(17),h=i(55),f=i(35),v=o.WeakMap;if(s){var p=d.state||(d.state=new v),y=p.get,g=p.has,E=p.set;n=function(e,t){if(g.call(p,e))throw new TypeError("Object already initialized");return t.facade=e,E.call(p,e,t),t},r=function(e){return y.call(p,e)||{}},a=function(e){return g.call(p,e)}}else{var S=h("state");f[S]=!0,n=function(e,t){if(c(e,S))throw new TypeError("Object already initialized");return t.facade=e,l(e,S,t),t},r=function(e){return c(e,S)?e[S]:{}},a=function(e){return c(e,S)}}e.exports={set:n,get:r,has:a,enforce:function(e){return a(e)?r(e):n(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return i}}}},function(e,t){e.exports={}},function(e,t,i){var n=i(15),r=i(19),a=i(2)("toStringTag"),s="Arguments"==r(function(){return arguments}());e.exports=n?r:function(e){var t,i,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?i:s?r(t):"Object"==(n=r(t))&&"function"==typeof t.callee?"Arguments":n}},function(e,t,i){var n=i(0),r=i(22).f,a=i(12),s=i(11),o=i(18),u=i(60),l=i(40);e.exports=function(e,t){var i,c,d,h,f,v=e.target,p=e.global,y=e.stat;if(i=p?n:y?n[v]||o(v,{}):(n[v]||{}).prototype)for(c in t){if(h=t[c],d=e.noTargetGet?(f=r(i,c))&&f.value:i[c],!l(p?c:v+(y?".":"#")+c,e.forced)&&void 0!==d){if(typeof h==typeof d)continue;u(h,d)}(e.sham||d&&d.sham)&&a(h,"sham",!0),s(i,c,h,e)}}},function(e,t,i){var n=i(39),r=Math.min;e.exports=function(e){return e>0?r(n(e),9007199254740991):0}},function(e,t){var i=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:i)(e)}},function(e,t,i){var n=i(4),r=/#|\.prototype\./,a=function(e,t){var i=o[s(e)];return i==l||i!=u&&("function"==typeof t?n(t):!!t)},s=a.normalize=function(e){return String(e).replace(r,".").toLowerCase()},o=a.data={},u=a.NATIVE="N",l=a.POLYFILL="P";e.exports=a},function(e,t,i){var n=i(0);e.exports=n.Promise},function(e,t){e.exports={}},function(e,t,i){var n=i(14);e.exports=function(e,t,i){if(n(e),void 0===t)return e;switch(i){case 0:return function(){return e.call(t)};case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,r){return e.call(t,i,n,r)}}return function(){return e.apply(t,arguments)}}},function(e,t,i){var n=i(8),r=i(14),a=i(2)("species");e.exports=function(e,t){var i,s=n(e).constructor;return void 0===s||null==(i=n(s)[a])?t:r(i)}},function(e,t,i){var n,r,a,s=i(0),o=i(4),u=i(43),l=i(77),c=i(25),d=i(46),h=i(13),f=s.location,v=s.setImmediate,p=s.clearImmediate,y=s.process,g=s.MessageChannel,E=s.Dispatch,S=0,b={},k=function(e){if(b.hasOwnProperty(e)){var t=b[e];delete b[e],t()}},m=function(e){return function(){k(e)}},_=function(e){k(e.data)},A=function(e){s.postMessage(e+"",f.protocol+"//"+f.host)};v&&p||(v=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return b[++S]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},n(S),S},p=function(e){delete b[e]},h?n=function(e){y.nextTick(m(e))}:E&&E.now?n=function(e){E.now(m(e))}:g&&!d?(a=(r=new g).port2,r.port1.onmessage=_,n=u(a.postMessage,a,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts&&f&&"file:"!==f.protocol&&!o(A)?(n=A,s.addEventListener("message",_,!1)):n="onreadystatechange"in c("script")?function(e){l.appendChild(c("script")).onreadystatechange=function(){l.removeChild(this),k(e)}}:function(e){setTimeout(m(e),0)}),e.exports={set:v,clear:p}},function(e,t,i){var n=i(20);e.exports=/(?:iphone|ipod|ipad).*applewebkit/i.test(n)},function(e,t,i){var n=i(8),r=i(7),a=i(48);e.exports=function(e,t){if(n(e),r(t)&&t.constructor===e)return t;var i=a.f(e);return(0,i.resolve)(t),i.promise}},function(e,t,i){"use strict";var n=i(14),r=function(e){var t,i;this.promise=new e((function(e,n){if(void 0!==t||void 0!==i)throw TypeError("Bad Promise constructor");t=e,i=n})),this.resolve=n(t),this.reject=n(i)};e.exports.f=function(e){return new r(e)}},function(e,t,i){var n=i(6),r=i(10).f,a=Function.prototype,s=a.toString,o=/^\s*function ([^ (]*)/;n&&!("name"in a)&&r(a,"name",{configurable:!0,get:function(){try{return s.call(this).match(o)[1]}catch(e){return""}}})},function(e,t,i){var n=i(15),r=i(11),a=i(56);n||r(Object.prototype,"toString",a,{unsafe:!0})},function(e,t,i){var n=i(30);e.exports=function(e){return Object(n(e))}},function(e,t,i){var n=i(0);e.exports=n},function(e,t,i){var n=i(32);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,i){var n=i(0),r=i(21),a=n.WeakMap;e.exports="function"==typeof a&&/native code/.test(r(a))},function(e,t,i){var n=i(28),r=i(31),a=n("keys");e.exports=function(e){return a[e]||(a[e]=r(e))}},function(e,t,i){"use strict";var n=i(15),r=i(36);e.exports=n?{}.toString:function(){return"[object "+r(this)+"]"}},function(e,t,i){"use strict";var n,r,a,s,o=i(37),u=i(16),l=i(0),c=i(9),d=i(41),h=i(11),f=i(68),v=i(69),p=i(70),y=i(7),g=i(14),E=i(71),S=i(21),b=i(72),k=i(76),m=i(44),_=i(45).set,A=i(78),N=i(47),R=i(80),D=i(48),P=i(81),T=i(34),w=i(40),O=i(2),L=i(13),C=i(33),I=O("species"),M="Promise",B=T.get,U=T.set,j=T.getterFor(M),F=d,x=l.TypeError,V=l.document,G=l.process,H=c("fetch"),W=D.f,q=W,Y=!!(V&&V.createEvent&&l.dispatchEvent),K="function"==typeof PromiseRejectionEvent,Q=w(M,(function(){if(!(S(F)!==String(F))){if(66===C)return!0;if(!L&&!K)return!0}if(u&&!F.prototype.finally)return!0;if(C>=51&&/native code/.test(F))return!1;var e=F.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[I]=t,!(e.then((function(){}))instanceof t)})),z=Q||!k((function(e){F.all(e).catch((function(){}))})),J=function(e){var t;return!(!y(e)||"function"!=typeof(t=e.then))&&t},X=function(e,t){if(!e.notified){e.notified=!0;var i=e.reactions;A((function(){for(var n=e.value,r=1==e.state,a=0;i.length>a;){var s,o,u,l=i[a++],c=r?l.ok:l.fail,d=l.resolve,h=l.reject,f=l.domain;try{c?(r||(2===e.rejection&&te(e),e.rejection=1),!0===c?s=n:(f&&f.enter(),s=c(n),f&&(f.exit(),u=!0)),s===l.promise?h(x("Promise-chain cycle")):(o=J(s))?o.call(s,d,h):d(s)):h(n)}catch(e){f&&!u&&f.exit(),h(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&$(e)}))}},Z=function(e,t,i){var n,r;Y?((n=V.createEvent("Event")).promise=t,n.reason=i,n.initEvent(e,!1,!0),l.dispatchEvent(n)):n={promise:t,reason:i},!K&&(r=l["on"+e])?r(n):"unhandledrejection"===e&&R("Unhandled promise rejection",i)},$=function(e){_.call(l,(function(){var t,i=e.facade,n=e.value;if(ee(e)&&(t=P((function(){L?G.emit("unhandledRejection",n,i):Z("unhandledrejection",i,n)})),e.rejection=L||ee(e)?2:1,t.error))throw t.value}))},ee=function(e){return 1!==e.rejection&&!e.parent},te=function(e){_.call(l,(function(){var t=e.facade;L?G.emit("rejectionHandled",t):Z("rejectionhandled",t,e.value)}))},ie=function(e,t,i){return function(n){e(t,n,i)}},ne=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,X(e,!0))},re=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw x("Promise can't be resolved itself");var n=J(t);n?A((function(){var i={done:!1};try{n.call(t,ie(re,i,e),ie(ne,i,e))}catch(t){ne(i,t,e)}})):(e.value=t,e.state=1,X(e,!1))}catch(t){ne({done:!1},t,e)}}};Q&&(F=function(e){E(this,F,M),g(e),n.call(this);var t=B(this);try{e(ie(re,t),ie(ne,t))}catch(e){ne(t,e)}},(n=function(e){U(this,{type:M,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=f(F.prototype,{then:function(e,t){var i=j(this),n=W(m(this,F));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=L?G.domain:void 0,i.parent=!0,i.reactions.push(n),0!=i.state&&X(i,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),r=function(){var e=new n,t=B(e);this.promise=e,this.resolve=ie(re,t),this.reject=ie(ne,t)},D.f=W=function(e){return e===F||e===a?new r(e):q(e)},u||"function"!=typeof d||(s=d.prototype.then,h(d.prototype,"then",(function(e,t){var i=this;return new F((function(e,t){s.call(i,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof H&&o({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return N(F,H.apply(l,arguments))}}))),o({global:!0,wrap:!0,forced:Q},{Promise:F}),v(F,M,!1,!0),p(M),a=c(M),o({target:M,stat:!0,forced:Q},{reject:function(e){var t=W(this);return t.reject.call(void 0,e),t.promise}}),o({target:M,stat:!0,forced:u||Q},{resolve:function(e){return N(u&&this===a?F:this,e)}}),o({target:M,stat:!0,forced:z},{all:function(e){var t=this,i=W(t),n=i.resolve,r=i.reject,a=P((function(){var i=g(t.resolve),a=[],s=0,o=1;b(e,(function(e){var u=s++,l=!1;a.push(void 0),o++,i.call(t,e).then((function(e){l||(l=!0,a[u]=e,--o||n(a))}),r)})),--o||n(a)}));return a.error&&r(a.value),i.promise},race:function(e){var t=this,i=W(t),n=i.reject,r=P((function(){var r=g(t.resolve);b(e,(function(e){r.call(t,e).then(i.resolve,n)}))}));return r.error&&n(r.value),i.promise}})},function(e,t,i){"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,a=r&&!n.call({1:2},1);t.f=a?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},function(e,t,i){var n=i(4),r=i(19),a="".split;e.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==r(e)?a.call(e,""):Object(e)}:Object},function(e,t,i){var n=i(5),r=i(61),a=i(22),s=i(10);e.exports=function(e,t){for(var i=r(t),o=s.f,u=a.f,l=0;l<i.length;l++){var c=i[l];n(e,c)||o(e,c,u(t,c))}}},function(e,t,i){var n=i(9),r=i(62),a=i(67),s=i(8);e.exports=n("Reflect","ownKeys")||function(e){var t=r.f(s(e)),i=a.f;return i?t.concat(i(e)):t}},function(e,t,i){var n=i(63),r=i(66).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,r)}},function(e,t,i){var n=i(5),r=i(23),a=i(64).indexOf,s=i(35);e.exports=function(e,t){var i,o=r(e),u=0,l=[];for(i in o)!n(s,i)&&n(o,i)&&l.push(i);for(;t.length>u;)n(o,i=t[u++])&&(~a(l,i)||l.push(i));return l}},function(e,t,i){var n=i(23),r=i(38),a=i(65),s=function(e){return function(t,i,s){var o,u=n(t),l=r(u.length),c=a(s,l);if(e&&i!=i){for(;l>c;)if((o=u[c++])!=o)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===i)return e||c||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},function(e,t,i){var n=i(39),r=Math.max,a=Math.min;e.exports=function(e,t){var i=n(e);return i<0?r(i+t,0):a(i,t)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,i){var n=i(11);e.exports=function(e,t,i){for(var r in t)n(e,r,t[r],i);return e}},function(e,t,i){var n=i(10).f,r=i(5),a=i(2)("toStringTag");e.exports=function(e,t,i){e&&!r(e=i?e:e.prototype,a)&&n(e,a,{configurable:!0,value:t})}},function(e,t,i){"use strict";var n=i(9),r=i(10),a=i(2),s=i(6),o=a("species");e.exports=function(e){var t=n(e),i=r.f;s&&t&&!t[o]&&i(t,o,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports=function(e,t,i){if(!(e instanceof t))throw TypeError("Incorrect "+(i?i+" ":"")+"invocation");return e}},function(e,t,i){var n=i(8),r=i(73),a=i(38),s=i(43),o=i(74),u=i(75),l=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,i){var c,d,h,f,v,p,y,g=i&&i.that,E=!(!i||!i.AS_ENTRIES),S=!(!i||!i.IS_ITERATOR),b=!(!i||!i.INTERRUPTED),k=s(t,g,1+E+b),m=function(e){return c&&u(c),new l(!0,e)},_=function(e){return E?(n(e),b?k(e[0],e[1],m):k(e[0],e[1])):b?k(e,m):k(e)};if(S)c=e;else{if("function"!=typeof(d=o(e)))throw TypeError("Target is not iterable");if(r(d)){for(h=0,f=a(e.length);f>h;h++)if((v=_(e[h]))&&v instanceof l)return v;return new l(!1)}c=d.call(e)}for(p=c.next;!(y=p.call(c)).done;){try{v=_(y.value)}catch(e){throw u(c),e}if("object"==typeof v&&v&&v instanceof l)return v}return new l(!1)}},function(e,t,i){var n=i(2),r=i(42),a=n("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||s[a]===e)}},function(e,t,i){var n=i(36),r=i(42),a=i(2)("iterator");e.exports=function(e){if(null!=e)return e[a]||e["@@iterator"]||r[n(e)]}},function(e,t,i){var n=i(8);e.exports=function(e){var t=e.return;if(void 0!==t)return n(t.call(e)).value}},function(e,t,i){var n=i(2)("iterator"),r=!1;try{var a=0,s={next:function(){return{done:!!a++}},return:function(){r=!0}};s[n]=function(){return this},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var i=!1;try{var a={};a[n]=function(){return{next:function(){return{done:i=!0}}}},e(a)}catch(e){}return i}},function(e,t,i){var n=i(9);e.exports=n("document","documentElement")},function(e,t,i){var n,r,a,s,o,u,l,c,d=i(0),h=i(22).f,f=i(45).set,v=i(46),p=i(79),y=i(13),g=d.MutationObserver||d.WebKitMutationObserver,E=d.document,S=d.process,b=d.Promise,k=h(d,"queueMicrotask"),m=k&&k.value;m||(n=function(){var e,t;for(y&&(e=S.domain)&&e.exit();r;){t=r.fn,r=r.next;try{t()}catch(e){throw r?s():a=void 0,e}}a=void 0,e&&e.enter()},v||y||p||!g||!E?b&&b.resolve?(l=b.resolve(void 0),c=l.then,s=function(){c.call(l,n)}):s=y?function(){S.nextTick(n)}:function(){f.call(d,n)}:(o=!0,u=E.createTextNode(""),new g(n).observe(u,{characterData:!0}),s=function(){u.data=o=!o})),e.exports=m||function(e){var t={fn:e,next:void 0};a&&(a.next=t),r||(r=t,s()),a=t}},function(e,t,i){var n=i(20);e.exports=/web0s(?!.*chrome)/i.test(n)},function(e,t,i){var n=i(0);e.exports=function(e,t){var i=n.console;i&&i.error&&(1===arguments.length?i.error(e):i.error(e,t))}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,i){"use strict";var n=i(37),r=i(16),a=i(41),s=i(4),o=i(9),u=i(44),l=i(47),c=i(11);n({target:"Promise",proto:!0,real:!0,forced:!!a&&s((function(){a.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=u(this,o("Promise")),i="function"==typeof e;return this.then(i?function(i){return l(t,e()).then((function(){return i}))}:e,i?function(i){return l(t,e()).then((function(){throw i}))}:e)}}),r||"function"!=typeof a||a.prototype.finally||c(a.prototype,"finally",o("Promise").prototype.finally)},function(e,t,i){"use strict";i.r(t),i.d(t,"Plugin",(function(){return y})),i.d(t,"VERSION",(function(){return g})),i.d(t,"NAME",(function(){return E}));var n=i(3),r=(i(49),i(1));function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(e,t){this._plugin=t,this._plugin.setSourceChangeCallback((function(t){return e.src=t}))}var t,i,n;return e.prototype.dispatchEvent=function(e){return e.defaultPrevented},t=e,(i=[{key:"active",get:function(){return!1}}])&&a(t.prototype,i),n&&a(t,n),e}();i(50),i(57),i(82);var o=function(e){var t,i;function n(t){var i,n,r,a;return i=e.call(this)||this,n=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i),a="BPMiddleware",(r="id")in n?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a,i._context=t,i}return i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,n.prototype.load=function(e){var t=this;this._context.srcReady().finally((function(){return t.callNext(e)}))},n}(n.core.BaseMiddleware);n.core.BaseMiddleware;var u=n.core.Utils,l=n.core.LogLevel,c=-1,d=0,h=1;r.LoggerManager.getInstance().setLogLevel(c);var f,v,p,y=function(e){var t,i;i=e,(t=a).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=a.prototype;function a(t,i,n){var a;return(a=e.call(this,t,i,n)||this)._setLogLevel(),a.eventManager.listen(a.player,a.player.Event.Core.ERROR,(function(){return a.reset()})),a._attachSourceChange(),r.SmartLib.getInstance().init(a.config.analyticsAddress,a.config.nanoCDNHost,a.config.broadpeakDomainNames),a.config.uuid&&r.SmartLib.getInstance().setUUID(a.config.uuid),a}return n.getEngineDecorator=function(e){return new s(e,this)},n.getMiddlewareImpl=function(){return new o(this)},a.isValid=function(){return!0},n.srcReady=function(){return this._srcPromise},n.setSourceChangeCallback=function(e){this.sourceChangeCallback=e},n.reset=function(){this.session&&this.session.stopStreamingSession(),this.session=null},n.destroy=function(){r.SmartLib.getInstance().release()},n._setLogLevel=function(){switch(u.Object.getPropertyPath(this.player,"config.log.level")){case l.ERROR.name:case l.OFF.name:r.LoggerManager.getInstance().setLogLevel(c);break;case l.DEBUG.name:r.LoggerManager.getInstance().setLogLevel(h);break;case l.TIME.name:case l.WARN.name:case l.INFO.name:default:r.LoggerManager.getInstance().setLogLevel(d)}},n._attachSourceChange=function(){var e=this;this.eventManager.listen(this.player,this.player.Event.Core.SOURCE_SELECTED,(function(t){e._srcPromise=u.Object.defer(),e.session=r.SmartLib.getInstance().createStreamingSession(),e.session.attachPlayer(e.player),e._getSource(t.payload.selectedSource[0].url)}))},n._getSource=function(e){var t=this;this.session.getURL(e).then((function(e){e.isError()?(t.logger.error("getUrl failed",e.getErrorCode(),e.getErrorMessage()),t.reset(),t._srcPromise.reject()):(t.logger.debug("getUrl response",e.getURL()),t.sourceChangeCallback(e.getURL()),t._srcPromise.resolve())}))},a}(n.BasePlugin);p={analyticsAddress:null,nanoCDNHost:null,broadpeakDomainNames:[]},(v="defaultConfig")in(f=y)?Object.defineProperty(f,v,{value:p,enumerable:!0,configurable:!0,writable:!0}):f[v]=p;var g="1.1.2",E="@playkit-js/playkit-broadpeak-smartlib";Object(n.registerPlugin)("broadpeak",y)}]);
//# sourceMappingURL=playkit-broadpeak.js.map